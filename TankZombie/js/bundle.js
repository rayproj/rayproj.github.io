!function(){"use strict";var t,e=Laya.View,n=Laya.ClassUtils.regClass;!function(t){class s extends e{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("BattleScene")}}t.BattleSceneUI=s,n("ui.BattleSceneUI",s);class i extends e{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("LobbyScene")}}t.LobbySceneUI=i,n("ui.LobbySceneUI",i)}(t||(t={}));class s extends t.BattleSceneUI{constructor(){super()}onEnable(){s.Instance=this}onDisable(){s.Instance=null}}s.Instance=null;const i=new Laya.EventDispatcher,a={InitConfig:"init.config",InitLanguage:"init.language",InitMusic:"init.music"};function __decorate(t,e,n,s){var i,a=arguments.length,o=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var r=t.length-1;r>=0;r--)(i=t[r])&&(o=(a<3?i(o):a>3?i(e,n,o):i(e,n))||o);return a>3&&o&&Object.defineProperty(e,n,o),o}const o={TankDialog:{1:"Lv $$ Unlock"},Default:{1:"Not enough coins",2:"Not enough diamonds",3:"Use $$ successful!",4:"Lv $$ Unlock",5:"Upgrade success!",6:"Advanced success!",7:"OK",8:"Unlock Tank",9:"Go to war"},LobbyScene:{1:"BULLET",2:"LIFE",3:"UAV",4:"ARMY",5:"LOCK",11:"ACT+$$%",21:"HP+$$%",31:"ACT+$$%",41:"ATK+$$"},TankAdvaDialog:{1:"Damage bonus\nCritical hit\nCritical damage",2:"Life",3:"Damage bonus\nCritical hit\nCritical damage",4:"Damage bonus\nCritical hit\nCritical damage"},GetRewardDialog:{1:"GET COINS",2:"GET DIAMONDS",3:"WATCH ADS TO GET",4:"$$ COINS",5:"$$ DIAMONDS"},BattleScene:{1:"Collection successful!",2:"BOSS Incoming!",3:"MISSION COMPLETE!"}};var r;!function(t){t.ZH="zh",t.EN="en"}(r||(r={}));var l;!function(t){t.WEB="web",t.FACEBOOK="facebook"}(l||(l={}));class h{static get Language(){return h._Language}static set Language(t){h._Language=t,i.event(a.InitLanguage)}}h.Debug=!0,h.Platform=l.WEB,h.KeysSaveData=["laya.tank"],h.IntertitialAdsIds=["454658549471127_492523012351347","454658549471127_492523172351331","454658549471127_492523262351322","454658549471127_492523352351313","454658549471127_492523412351307"],h.BannerId="",h._Language=r.EN;class c{constructor(){this.intertitialAdsIds=h.IntertitialAdsIds,this.hasRemoveAD=!1,this.isLoadInterstitialAD=!1,this.loadedInterstitialAD=null,this.loadInterstitialADOne=!1,this.errorLoadInterstitialCount=0,this.interstitialKeyArr=[],this.isPlayInterstitialAD=!1,this.bannerObj=null,h.Platform==l.FACEBOOK&&Laya.timer.loop(33,this,this.loadInterstitial),this.addBannerInfo()}loadInterstitial(){this.hasRemoveAD||this.isLoadInterstitialAD||this.loadedInterstitialAD||(1!=this.isPlayInterstitialAD?this.errorLoadInterstitialCount>=3?1==this.loadInterstitialADOne&&(this.loadInterstitialADOne=!1,this.preLoadInterstitialAD()):(this.loadInterstitialADOne=!1,this.preLoadInterstitialAD()):this.isPlayInterstitialAD=!1)}preLoadInterstitialAD(){this.isLoadInterstitialAD=!0,this.interstitialKeyArr.length<=0&&(this.interstitialKeyArr=this.intertitialAdsIds.concat(),this.interstitialKeyArr.sort((t,e)=>Math.random()-.5));const t=this.interstitialKeyArr.shift();let e;FBInstant.getInterstitialAdAsync(t).then(n=>(console.log("加载插屏广告"+t),(e=n).loadAsync())).then(()=>{console.log("加载插屏广告加载成功"),this.isLoadInterstitialAD=!1,this.loadedInterstitialAD=e}).catch(t=>{this.isLoadInterstitialAD=!1,this.errorLoadInterstitialCount++,console.log("加载插屏广告加载失败："+t.message)})}addBannerInfo(){const t={bannerId:h.BannerId,bannerViewCD:{},showBanner:e=>new Promise((n,s)=>{if(!e)return FBInstant.hideBannerAdAsync(),void n();e="alluseone";let i=t.bannerViewCD[e]||0,a=(new Date).getTime();a-i<3e4?console.log("banner time:",30-(a-i)/1e3+"秒"):(t.bannerViewCD[e]=a,FBInstant.loadBannerAdAsync(t.bannerId).then(()=>{console.log("show baner success"),n()}).catch(t=>{null!=t&&console.log("【load banner fail】:"+t.code,t.message)}))})};this.bannerObj=t}showBannerAD(t){return new Promise((e,n)=>{this.bannerObj.showBanner(t).then(()=>{e()})})}showInterstitialAD(){return new Promise((t,e)=>{this.hasRemoveAD?t():(this.loadInterstitialADOne=!0,this.loadedInterstitialAD?this.loadedInterstitialAD.showAsync().then(()=>{console.log("InterstitialAd广告显示成功"),this.loadedInterstitialAD=null,this.isPlayInterstitialAD=!0,t()}).catch(t=>{this.loadedInterstitialAD=null,this.isPlayInterstitialAD=!0,this.errorLoadInterstitialCount++,console.log("加载插屏广告加载失败："+t.message),e(t)}):e())})}showRewardVideoAd(t){return new Promise((e,n)=>{let s;FBInstant.getRewardedVideoAsync(t).then(t=>(console.log("RewardedVideo开始加载"),(s=t).loadAsync())).then(()=>(console.log("RewardedVideo加载成功回调"),s.showAsync())).then(()=>{console.log("RewardedVideo广告显示成功"),e()}).catch(t=>{console.log("RewardedVideo广告显示失败"),n(t)})})}}class d{static GetRandom(t,e){return Math.floor(Math.random()*(t-e+1)+e)}static FormatNumber(t){const e=["K","M","B","T"];let n="";if(t<1e4)n=Math.floor(t)+"";else{let s=t,i=0;for(;s/1e3/1e3>=1;){if(++i>=e.length){i=e.length-1;break}s/=1e3}n=(s/1e3).toFixed(2)+e[i]}return n}static FormatTimer(t){const e=Math.floor(t/3600);t-=60*e*60;const n=Math.floor(t/60);return t-=60*n,{h:e,m:n,s:Math.floor(t)}}static IsSameDay(t,e){return new Date(t).setHours(0,0,0,0)===new Date(e).setHours(0,0,0,0)}static FindKey(t,e,n=((t,e)=>t===e)){return Object.keys(t).find(s=>n(t[s],e))}static ChangeStrAt(t,e,n){return t.substr(0,n)+e+t.substr(n+e.length)}static CopyBaseArray2(t){const e=[];for(let n=0;n<t.length;n++){const s=t[n];for(let t=0;t<s.length;t++){const i=s[t];e[n]||(e[n]=[]),e[n].push(i)}}return e}static IsSameVector(t,e,n=.01){let s=!1;return t instanceof Laya.Vector3&&e instanceof Laya.Vector3?s=Math.abs(t.x-e.x)<=n&&Math.abs(t.y-e.y)<=n&&Math.abs(t.z-e.z)<=n:t instanceof Laya.Vector2&&e instanceof Laya.Vector2&&(s=Math.abs(t.x-e.x)<=n&&Math.abs(t.y-e.y)<=n),s}static GetBezierPoint(t,e,n,s,i){i?(s.x=(1-t)*(1-t)*e.x+2*t*(1-t)*i.x+t*t*n.x,s.y=(1-t)*(1-t)*e.y+2*t*(1-t)*i.y+t*t*n.y,s.z=(1-t)*(1-t)*e.z+2*t*(1-t)*i.z+t*t*n.z):(s.x=e.x+(n.x-e.x)*t,s.y=e.y+(n.y-e.y)*t,s.z=e.z+(n.z-e.z)*t)}}class m{constructor(){this.msg_fbRankName="CubeManiaRank",this.fbSafeScore=8e6,this.scoreRankArr=[22e5,18e5,13e5,95e4,5e5,25e4,1e5,55e3,3e4,15e3],this.stepScore=[1e3,5e4],this.playerScore=0,this.rankData=[],this.realRankData=null,this.friendsList=[]}getRankData(){const t=this.rankData,e=this.realRankData;if(t.length){if(e){for(let n=0;n<t.length;n++){const s=t[n];e[s.playerID]&&(s.score=e[s.playerID].score)}t.sort((t,e)=>e.score-t.score)}for(let e=0;e<t.length;e++)t[e].rank=e+1}return t}setScoreAsync(t){this.playerScore=Math.max(this.playerScore,t),this.rankData.length&&this.updateRankData(),this.initFriendsList(),this.realRankData={},h.Platform==l.FACEBOOK&&this.checkNeedSetRealRankData()}updateRankData(){const t=this.rankData;for(let e=0;e<t.length;e++)if(t[e].playerID===S.playerInfo.id){t[e].score=this.playerScore;break}this.rankData.sort((t,e)=>e.score-t.score)}initFriendsList(){switch(this.initFriendsList=(()=>{}),h.Platform){case l.FACEBOOK:y.getSDK().getFriends().then(t=>{this.friendsList=t,this.buildUnrealRank()});case l.WEB:this.friendsList=this.getRandomBotArr(),this.buildUnrealRank()}}getRandomBotArr(){const t=S.getRobotNames(),e=[];for(;e.length<7;){const n=t[d.GetRandom(0,t.length-1)];e.indexOf(n)<0&&e.push(n)}const n=S.getRobotPhotos(),s=[];for(;s.length<7;){const t=n[d.GetRandom(0,n.length-1)];s.indexOf(t)<0&&s.push(t)}const i=[];for(let t=0;t<s.length;t++)i.push({id:t+1e4+"",name:e[t],userface:s[t]+"",score:1e3*t+50});return i}buildUnrealRank(){const t=[],e=[];let n=this.playerScore,s=this.playerScore,i=0,a=0;for(a=0;a<this.scoreRankArr.length&&!(this.playerScore>=this.scoreRankArr[a]);a++);const o=()=>n+=Math.floor(this.stepScore[0]+this.stepScore[1]*Math.random()),r=()=>(s-=Math.floor(this.stepScore[0]+this.stepScore[1]*Math.random()),s=Math.max(0,s));for((i=a)===this.scoreRankArr.length&&(i=100),a=i-1;a>=0;a--)t.push(o());for(a=0;a<100;a++)e.push(r());let l=this.friendsList;this.rankData.push({playerID:S.playerInfo.id,name:S.playerInfo.name,photo:S.playerInfo.userface,score:this.playerScore});const h=Math.min(l.length,i);for(a=0;a<h;a++){const e=l.shift();e.score=t.shift(),this.rankData.push({playerID:e.id,name:e.name,score:e.score,photo:e.userface})}this.rankData.reverse();const c=l.length;for(a=0;a<c;a++){const t=l.shift();t.score=e.shift(),this.rankData.push({playerID:t.id,name:t.name,score:t.score,photo:t.userface})}}checkNeedSetRealRankData(){FBInstant.context.getID()&&FBInstant.getLeaderboardAsync(this.msg_fbRankName+"."+FBInstant.context.getID()).then(t=>t.setScoreAsync(this.playerScore,"")).then(()=>{console.log("更新玩家排行榜分数成功"),this.getRealRank()}).catch(t=>{console.error("更新玩家排行榜分数失败：",t)})}getRealRank(){FBInstant.context.getID()&&FBInstant.getLeaderboardAsync(this.msg_fbRankName+"."+FBInstant.context.getID()).then(t=>t.getConnectedPlayerEntriesAsync(0,10)).then(t=>{if(console.log("获取FB排行榜数据成功：",t),t&&t.length)for(let e=0;e<t.length;e++){const n=t[e],s=n.getScore();if(Number(s)>=this.fbSafeScore)continue;const i=n.getPlayer(),a=i.getID(),o=i.getPhoto(),r=i.getName(),l=n.getRank();this.realRankData[a]={playerID:a,name:r,photo:o,score:s,rank:l}}}).catch(t=>{console.log("获取FB排行榜数据失败：",t)})}}class u{constructor(){this.supplementPropList=[],this.isCanPayment=!1}showPay(t,e,n,s){if(!this.isCanPayment)return console.log("支付没有准备好"),void(n&&n());FBInstant.payments.purchaseAsync({productID:t.payid,developerPayload:t.developerPayload}).then(t=>{console.log("购买成功，使商品生效并保存玩家信息：",t),e&&e()}).catch(t=>{"USER_INPUT"==t.code?(console.log("支付取消：",t),s&&s()):(console.log("支付失败：",t),n&&n())})}consumeFbItem(t){return new Promise((e,n)=>{FBInstant.payments.consumePurchaseAsync(t).then(()=>{console.log("商品消费掉了："+t),e(t)})})}getPayList(){}checkPaymentStatus(){this.isCanPayment?FBInstant.payments.getPurchasesAsync().then(t=>{t.length&&(console.log("有未消费的订单：",t),this.supplementPropList=t)}):console.log("支付没有准备好")}isCanPay(){return!S.onIOS()}}class p{constructor(){}shareGame(){return new Promise((t,e)=>{const n=document.createElement("img");n.crossOrigin="anonymous",n.src=A.ShareGamePng,n.onload=(()=>{const s=document.createElement("canvas");s.width=n.width,s.height=n.height,s.getContext("2d").drawImage(n,0,0,n.width,n.height);const i=s.toDataURL("image/jpeg");n.remove(),s.remove(),FBInstant.shareAsync({intent:"SHARE",image:i,text:"I have passed many levels. Can you surpass me?",data:{myReplayData:"..."}}).then(()=>{t(i)}).catch(t=>{console.error("FB分享游戏失败"),e(t)})})})}sendFaceBookFriend(t,e,n,s){console.log("开始邀请好友/朋友圈"),FBInstant.context.chooseAsync({filter:["NEW_CONTEXT_ONLY"]}).then(()=>{console.log("开始邀请好友/朋友圈成功");const i=new g;i.onDrawCompleted=(t=>{console.log("自定义好友图片加载完成，邀请好友"),FBInstant.updateAsync({action:"CUSTOM",cta:"Play",template:"play_turn",image:t,text:"Come and play together",data:{},strategy:"LAST",notification:"PUSH"}).then(()=>{console.log("邀请好友/朋友圈成功"),e&&e(t)}).catch(t=>{this.updateAsyncError("邀请好友",t,n,s)})}),i.initWithData(t)}).catch(t=>{this.updateAsyncError("邀请好友",t,n,s)})}appointFaceBookFriendAndUpdateAsync(t,e,n,s){console.log("开始邀请指定好友id："+t.playerID),FBInstant.context.createAsync(t.playerID).then(()=>{if(!FBInstant.context.getID())return void(n&&n());console.log("开始邀请指定好友");const i=new g;i.onDrawCompleted=(t=>{console.log("自定义好友图片加载完成，邀请指定好友"),FBInstant.updateAsync({action:"CUSTOM",cta:"Play",template:"play_turn",image:t,text:"Come and play together",data:{},strategy:"LAST",notification:"PUSH"}).then(function(){console.log("邀请指定好友成功"),e&&e(t)}).catch(t=>{this.updateAsyncError("邀请指定好友",t,n,s)})}),i.initWithData(t)}).catch(t=>{this.updateAsyncError("邀请指定好友",t,n,s)})}updateAsyncError(t,e,n,s){console.log(t+"失败，",e),e&&"USER_INPUT"===e.code?s&&s():n&&n()}}class g{initWithData(t){const e=t.pngData;for(let n=0;n<e.length;n++){const s=e[n],i=new Image;s.htmlImage=i,i.crossOrigin="anonymous",i.src=s.url,i.imgHeight=s.imgHeight,i.imgWidth=s.imgWidth,i.isLoad=!1,i.onload=(()=>{i.isLoad=!0,i.width=i.imgWidth,i.height=i.imgHeight,this.drawImage(t)})}}onDrawCompleted(t){}drawImage(t){for(let e=0;e<t.pngData.length;e++){const n=t.pngData[e];if(n.htmlImage&&0==n.htmlImage.isLoad)return}const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");for(let e=0;e<t.pngData.length;e++){const s=t.pngData[e];n.drawImage(s.htmlImage,s.posX,s.posY,s.htmlImage.width,s.htmlImage.height)}for(let e=0;e<t.fontData.length;e++){const s=t.fontData[e];n.font=s.font,n.lineWidth=s.lineWidth,n.fillStyle=s.fillStyle,n.textAlign=s.textAlign,n.strokeStyle=s.strokeStyle,n.strokeText(s.des.toString(),s.posX,s.posY),n.fillText(s.des.toString(),s.posX,s.posY)}const s=e.toDataURL("image/png");for(let e=0;e<t.pngData.length;e++){const n=t.pngData[e];n&&n.htmlImage&&n.htmlImage.remove()}e.remove(),this.onDrawCompleted&&this.onDrawCompleted(s)}}class y{constructor(){this.startedGame=!1,this.faceBookUpdateAsync=new p,this.leaderboard=new m,this.faceBookPayment=new u,this.faceBookAdvertisement=new c}static getSDK(){return this.Instance||(this.Instance=new y),this.Instance}getUserData(){return new Promise((t,e)=>{FBInstant.player.getDataAsync(h.KeysSaveData).then(e=>{console.log("FB用户数据：",e),e&&!Object.keys(e).length&&(e=null),e&&(e=e[h.KeysSaveData[0]]),t(e)})})}saveUserData(t){return new Promise((e,n)=>{FBInstant.player.setDataAsync(t).then(()=>{e()})})}startGame(t=!0,e=!0){return new Promise((n,s)=>{this.startedGame?n():(this.startedGame=!0,FBInstant.startGameAsync().then(()=>{const s=FBInstant.getSupportedAPIs().join("|");console.log("FB API: ",s),this.faceBookPayment.getPayList();const i=S.playerInfo;i.id=FBInstant.player.getID(),i.name=FBInstant.player.getName(),i.userface=FBInstant.player.getPhoto(),i.entryPointData=FBInstant.getEntryPointData(),console.log("用户信息：",i),this.platform=FBInstant.getPlatform(),console.log("FB平台：",this.platform),this.getFriends(),t&&this.subscribeBotAsync(),e&&this.createShortcut(),n()}))})}postScoreToFB(t){FBInstant.postSessionScoreAsync(t),console.log("postSessionScoreAsync发送分数给FB：",t)}getFriends(){return new Promise((t,e)=>{this.friends?t(this.friends.concat()):(this.friends=[],FBInstant.player.getConnectedPlayersAsync().then(e=>{console.log("获取好友列表成功：",e);for(let t=0;t<e.length;t++){let n=e[t];this.friends.push({name:n.getName(),id:n.getID(),userface:n.getPhoto()})}t(this.friends.concat())}).catch(t=>{console.error("获取好友列表失败：",t)}))})}subscribeBotAsync(){FBInstant.player.canSubscribeBotAsync().then(t=>{t&&FBInstant.player.subscribeBotAsync().then(()=>{}).catch(t=>{console.error("请求玩家订阅游戏机器人错误：",t)})}).catch(t=>{console.error("是否可以与游戏机器人对战错误：",t)})}createShortcut(){return new Promise((t,e)=>{console.log("开始创建快捷方式"),FBInstant.player.getDataAsync(["shortcut"]).then(e=>{console.log("获取快捷方式数据：",e),null!=e&&null!=e.shortcut&&1==e.shortcut||FBInstant.canCreateShortcutAsync().then(e=>{console.log(`用户${e?"有":"没有"}资格创建快捷方式`),e&&FBInstant.createShortcutAsync().then(()=>{FBInstant.player.setDataAsync({shortcut:1}).then(()=>{}),console.log("创建快捷方式成功"),t()}).catch(t=>{console.error("创建快捷方式失败：",t)})}).catch(t=>{console.log("快捷方式不可以创建：",t)})}).catch(t=>{console.log("获取创建桌面快捷方式数据失败：",t)})})}setLoadingProgress(t){FBInstant.setLoadingProgress(t)}logEvent(t,e,n){FBInstant.logEvent(t,e,n)}goToOtherGame(t,e){FBInstant.switchGameAsync(t,e).then(()=>{console.log("跳转其他游戏成功")}).catch(t=>{console.error("跳转其他游戏失败，失败编码为：",t)})}getEntryPointData(){return new Promise((t,e)=>{t(FBInstant.getEntryPointData())})}}class f{constructor(){this.id="0",this.name="Player",this.userface="robot1",this.newPlayer=!0}}const S=new class{constructor(){this.startedGame=!1,this.playerInfo=new f}saveUserData(t){return new Promise((e,n)=>{switch(h.Platform){case l.FACEBOOK:y.getSDK().saveUserData(t).then(()=>{console.log("FB存档成功"),e()});break;case l.WEB:Laya.LocalStorage.setJSON(h.KeysSaveData[0],t),console.log("本地存档成功"),e()}})}getUserData(){return new Promise((t,e)=>{switch(h.Platform){case l.FACEBOOK:y.getSDK().getUserData().then(e=>{this.playerInfo.newPlayer=!e,t(e)});break;case l.WEB:let e=Laya.LocalStorage.getJSON(h.KeysSaveData[0]);e&&(e=e[h.KeysSaveData[0]]),this.playerInfo.newPlayer=!e,t(e),console.log("本地用户数据：",e)}})}startGame(t=!0,e=!0){return new Promise((n,s)=>{switch(h.Platform){case l.FACEBOOK:this.startedGame?n():(this.startedGame=!0,y.getSDK().startGame(t,e).then(()=>{n()}));break;case l.WEB:this.startedGame||(this.startedGame=!0),n()}})}postSessionScore(t){switch(h.Platform){case l.FACEBOOK:y.getSDK().postScoreToFB(t);break;case l.WEB:}}shareGame(){return new Promise((t,e)=>{switch(h.Platform){case l.FACEBOOK:y.getSDK().faceBookUpdateAsync.shareGame().then(e=>{t(e)});break;case l.WEB:const e=document.createElement("img");e.crossOrigin="anonymous",e.src=A.ShareGamePng,e.onload=(()=>{const n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0,e.width,e.height);const s=n.toDataURL("image/jpeg");e.remove(),n.remove(),t(s)})}})}inviteFriend(t,e,n,s){switch(h.Platform){case l.FACEBOOK:y.getSDK().faceBookUpdateAsync.sendFaceBookFriend(t,e,n,s);break;case l.WEB:console.log("邀请好友/朋友圈");const i=new g;i.onDrawCompleted=(t=>{e&&e(t)}),i.initWithData(t)}}inviteFriendWithId(t,e,n,s){switch(h.Platform){case l.FACEBOOK:y.getSDK().faceBookUpdateAsync.appointFaceBookFriendAndUpdateAsync(t,e,n,s);break;case l.WEB:console.log("邀请指定好友");const i=new g;i.onDrawCompleted=(t=>{e&&e(t)}),i.initWithData(t)}}getRankData(){switch(h.Platform){case l.FACEBOOK:case l.WEB:return y.getSDK().leaderboard.getRankData()}}setScoreAsync(t){switch(h.Platform){case l.FACEBOOK:case l.WEB:y.getSDK().leaderboard.setScoreAsync(t)}}showBannerAd(){return new Promise((t,e)=>{switch(h.Platform){case l.FACEBOOK:y.getSDK().faceBookAdvertisement.showBannerAD().then(()=>{t()}).catch(t=>{e(t)});break;case l.WEB:t()}})}showInterstitialAd(){return new Promise((t,e)=>{if(!(this.lastIntAdShowTime&&Date.now()<this.lastIntAdShowTime+6e4))switch(h.Platform){case l.FACEBOOK:y.getSDK().faceBookAdvertisement.showInterstitialAD().then(()=>{this.lastIntAdShowTime=Date.now(),t()}).catch(t=>{e(t)});break;case l.WEB:t()}})}showRewardVideoAd(t){return new Promise((t,e)=>{switch(h.Platform){case l.FACEBOOK:case l.WEB:t()}})}gaLogEvent(t,e){switch(h.Platform){case l.FACEBOOK:const n=window.gaLogEvent;n&&n.log&&n.log(t,e);break;case l.WEB:}}onIOS(){return Laya.Browser.onIOS}getRobotNames(){return["Max Julia","Nathan Anthony","Asa Webb","Phil Harrison","Diana Hoyle","Gloria Nelly","Rodney Warner","Eunice Peggy","Henry Katrine","Oscar Anderson","Glenn Cocker","Kerr Reade","Lindsay Gill,","Vito Hobbes","Andy Hugh","Elroy MacAdam","Ternence Emma","Ruth Harrington","Sam Carmen","Yvette Spenser","Joy Eve","Erin Christ","Omar Maxwell","Devin Theresa","Godfery Collins","Edwiin Becky","Christopher Pop","Aldrich White","June Margery","Dominic Larkin","Jason Carllyle","Armand Flower","Ian Hughes","Rex Burke","Crystal Peg","Quintina Petty","Myron Yule","Kay Noel","Linda Felix","Abel Smith","Irene Fast","Ruth Nell","Wade Kit","Ivy Grant","Tom Pope","Sibyl Rhodes","Noel Lawrence","Charles Edward","Kirk Finn","Ophelia Peter","Candice Wild","Bblythe Eveline","Mary Philemon","Grace Beerbohm","Brian Rayleign","Oscar Mark","Will Carroll","Cora Garcia","Truman Kennedy","Maurice Fanny","Booth Birrell","Eve DuBois","Edwina Theresa","Marsh Roland","Salome Malan","Ryan Ellis","Morgan Chris","Byron Tracy","Eric Bertie","Hazel Evan","Chad Ferguson","Dolores Adolph","Ira Bell","Basil Moses","Eartha Lawson","Lucien Harper","Ivan Bulwer","Gloria Jim","Anna Aldridge","Wilbur Dunlop","Yale Bob","Roberta Dewar","Jo Bruce","Simon Wallace","Abel Christy","Otis Copper","Elva Sheridan","Edison Horatio","Christian Coco","Betty Pater","Janet Beaufort","Norma Matthew","Payne Anto","Bertram Dewey","Vera Ingersoll","Vincent Holmes","Jamie Lucy","Aaron Ramsden","Buck Daisy","Howar Louisa","Yvonne Wallis","Nathan Oliver","Ada Clara","Caesar Henry","Cynthia Noyes","Nathaniel Leo","Griffith Marcus","Tabitha Pulit","Chad Hewlett","Patricia Yerkes","Jennifer Nahum","Alston Sophia","Brian Martin","Leif Hamilton","Mike Conrad","Coral Gus","Matthew Isaac","Broderick Joe","Harold Cover","Orville McCar","Lena Giles","Giles Anna","Sophia Joyce","Clare Carpenter","Tab Yeates","Jacqueline Cra","Alvin MacArthur","Alvis Garcia","Omar Salome","Maud Ferguson","Eudora Cotton","Lennon Dickens","Robin Toby","Zora Buck","Tony Camilla","Hedy Wordsworth","Lesley Morgan","Devin Maud","Isidore Palmer","Benson Scripps","Phil Webster","Hyman Pearson","Magee","Hilary Martha","Grace Noah","Arm Ernest","Wendell Abraham","Adair Acheson","Betsy Larkin","Marshall Walton","Rex Bertha","Nicole Harrod","Arm Elinor","Audrey Swin","Elvira Tommy","Roxanne Eveline","Newman Bess","Dominic Wood","Nat Anderson","Nelly James","Gabriel Grote","Joseph Darwin","Gloria Joan","Hubery Conan","Tyrone Marion","Sabina Dickey","Emma Ernest","Avery Raglan","Maxine Sharp","Sarah Felix","Alfred Isabel","Wright Gall","Evange Lucius","Burnell Gal","Zoe Kennedy","Gwend Oliver","Alexia Ted","Blanche Chaplin","Aries Bell","Dolores Lincoln","Ulysses Guy","Barnett Nick","Yale Julian","Wade Peter","Benjamin Donne","Miranda Douglas","Jim Marshall","Richard Van","Saxon Leopold","Ralap Milton","Dave Surrey","Emily Barney","Thomas Christ","Cliff Thoreau","Jenny Quiller","Marina Aldridge","Augus Abe","Quinn Irving","Alice Zacharias","Winifred Troll","There Euphemia","Mandy Spring","Ida Dewar","Geoffrey Parker","Zenobia Gunther","Raymond Carroll","Jill Wilde","Jacqueline Hugh","Edwiin Eisen","Lucien Henri","Ingrid Patience","Victor Wilhel","Marvin Jennings","Teresa Maria","Faithe Rob","Cherry Morrison","Sandy Wagner"]}getRobotPhotos(){return[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]}};function ConfigName(t){return function(e){e.prototype.configName=t}}class D{constructor(t=!0){t&&(D.ConfigMap[this.configName]||(D.ConfigMap[this.configName]=this))}static saveConfig(){const t={[h.KeysSaveData[0]]:D.ConfigMap};S.saveUserData(t)}static getConfig(){return new Promise((t,e)=>{S.getUserData().then(e=>{if(e)for(const t in e){const n=e[t],s=D.ConfigMap[t];for(const t in n){const e=n[t];s[t]=e}}i.event(a.InitConfig),t()})})}onInit(t){}}D.ConfigMap={};let L=class extends D{constructor(){super(),this.loginTime=0,this.musicVolume=1,i.on(a.InitConfig,this,this.isSameDay)}onInit(t){}isSameDay(){const t=this.loginTime;let e=!t||!d.IsSameDay(t,Date.now());this.loginTime=Date.now();const n=D.ConfigMap;for(const t in n){const s=n[t];s&&s.onInit&&"function"==typeof s.onInit&&s.onInit(e)}}};const C=new(L=__decorate([ConfigName("userBaseConfig")],L)),E={Click:"audio/click.mp3"};const b=new class{constructor(){this.soundsMap={},i.on(a.InitConfig,this,this.initVolume),i.on(a.InitMusic,this,this.initVolume)}sound(t,e=1){const n=this.soundsMap[t];n&&Date.now()-n<=50||(this.soundsMap[t]=Date.now(),Laya.SoundManager.playSound(t,e))}music(t,e=0){this.stopMusic(),Laya.SoundManager.playMusic(t,e)}stopMusic(){Laya.SoundManager.stopMusic()}stopSound(t){Laya.SoundManager.stopSound(t)}initVolume(){const t=C.musicVolume,e=t?.5:0,n=t?.5:0;Laya.SoundManager.setMusicVolume(e),Laya.SoundManager.setSoundVolume(n)}};class v{static GetPrefabFromMerge(t){const e=t.split("/"),n=e[e.length-1],s=Laya.loader.getRes(A.PrefabMerge)[n],i=new Laya.Prefab;return i.json=s,i}static GetNameFromMerge(t){const e=t.split("/");return e[e.length-1].replace(".json","")}static LoadPrefab(t){return new Promise((e,n)=>{const s=Laya.loader.getRes(t);if(s)e(s);else{let n=null;T.NoMerge[this.GetNameFromMerge(t)]?Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}),null,Laya.Loader.PREFAB):(n=this.GetPrefabFromMerge(t),e(n))}})}static LoadRes(t){return new Promise((e,n)=>{Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}))})}static GetRes(t,e=!1){let n=Laya.loader.getRes(t);return e&&!T.NoMerge[this.GetNameFromMerge(t)]&&(n=this.GetPrefabFromMerge(t)),n}static GetComponent(t,e){let n=e.getComponent(t);return n||(n=e.addComponent(t)),n}static InstantiatePrefab(t,e){const n=Laya.Pool.getItemByCreateFun(t,e.create,e);return n.__sign__=t,n}static InstantiateSprite3D(t,e,n){let s=Laya.Pool.getItem(e);return s||(s=t instanceof Laya.MeshSprite3D?Laya.MeshSprite3D.instantiate(t,n):Laya.Sprite3D.instantiate(t,n)),v.SetSign(s,e),s}static Project3DTo2D(t,e){const n=new Laya.Vector4;t.viewport.project(e,t.projectionViewMatrix,n);const s=new Laya.Vector2;return s.x=n.x/Laya.stage.clientScaleX,s.y=n.y/Laya.stage.clientScaleY,s}static SetSign(t,e){t.__sign__||(t.__sign__=e)}static OpenDialog(t,e,n,s=!1,i=!1,a=!1,o){this.LoadPrefab(t).then(r=>{const l=Laya.stage,h=this.InstantiatePrefab(t,r),c=o?o.x:l.width/2,d=o?o.y:l.height/2;a&&h.size(l.width,l.height),h.pos(c,d);const m=h.getChildByName("maskNode");m&&(m.offAllCaller(m),this.SetClick(m,m,()=>{i&&this.CloseDialog(h)},null,!0,!0)),e||(e=l),e.addChild(h),n&&n(h),s||(h.scale(0,0),h.alpha=0,Laya.Tween.to(h,{scaleX:1,scaleY:1,alpha:1},200,Laya.Ease.backOut))})}static CloseDialog(t,e=!1){return new Promise((n,s)=>{let i=t.owner;t instanceof Laya.Node&&(i=t),i&&(e?(i.removeSelf(),n()):Laya.Tween.to(i,{scaleX:0,scaleY:0,alpha:0},200,Laya.Ease.backIn,Laya.Handler.create(this,()=>{i.removeSelf(),n()})))})}static SetClick(t,e,n,s,i,a){t.offAllCaller(e);const o=t.scaleX/Math.abs(t.scaleX),r=t.scaleY/Math.abs(t.scaleY);t.on(Laya.Event.MOUSE_DOWN,e,()=>{i||Laya.Tween.to(t,{scaleX:.9*o,scaleY:.9*r},100)}),t.on(Laya.Event.MOUSE_UP,e,()=>{a||b.sound(E.Click),i||Laya.Tween.to(t,{scaleX:o,scaleY:r},100)}),t.on(Laya.Event.MOUSE_OUT,e,()=>{i||Laya.Tween.to(t,{scaleX:o,scaleY:r},100)}),t.on(Laya.Event.CLICK,e,n,s)}static Schedule(t,e,n,s,i,a,o){let r=0;const l=e;return e=(()=>{if(r>=i)return Laya.timer.clear(t,e),void(o&&o.call(t));r++,l.call(t,a)}),Laya.timer.once(n,t,e,a),Laya.timer.loop(s,t,e,a),e}static Sequence(t,...e){const n=()=>{const s=e[0];s&&Laya.Tween.to(t,s[1],s[0],s[2],Laya.Handler.create(t,()=>{s[3]&&s[3](),e.shift(),n()}))};n()}static ShakeEffect(t,e=180){const n=t.x,s=t.y,i=()=>{Laya.Tween.clearAll(t),this.Sequence(t,[20,{x:n+5,y:s-7}],[20,{x:n-6,y:s-7}],[20,{x:n-13,y:s-3}],[20,{x:n+3,y:s+6}],[20,{x:n-5,y:s-5}],[20,{x:n+2,y:s+8}],[20,{x:n-8,y:s+10}],[20,{x:n+3,y:s-10}],[20,{x:n,y:s},null,()=>{t.x=n,t.y=s}])};i(),Laya.timer.clear(t,i),Laya.timer.loop(180,t,i),Laya.timer.once(e,t,()=>{Laya.timer.clear(t,i),Laya.Tween.clearAll(t),t.x=n,t.y=s})}static Vibrate(t){window.navigator&&window.navigator.vibrate&&window.navigator.vibrate(t)}static ScaleParticle3DNode(t,e){if(t instanceof Laya.ShuriKenParticle3D&&(t.transform.localScale=new Laya.Vector3(e,e,e)),t.numChildren)for(let n=0;n<t.numChildren;n++){const s=t.getChildAt(n);this.ScaleParticle3DNode(s,e)}}static EmitParticle3DNode(t,e=0){if(t instanceof Laya.ShuriKenParticle3D&&t.particleSystem.emit(e),t.numChildren)for(let n=0;n<t.numChildren;n++){const s=t.getChildAt(n);this.EmitParticle3DNode(s,e)}}static OpenScene(t){Laya.Scene.closeAll(),Laya.timer.frameOnce(1,this,()=>{Laya.Scene.open(t)})}}const T={Common:{CommonTipDialog:"prefab/common/CommonTipDialog.json",GuidanceDialog:"prefab/common/GuidanceDialog.json"},NoMerge:{}},I={ERASBD:"font/ERASBD.ttf"};const A=new class{constructor(){this.PrefabMerge="prefab/merge.json",this.JsonMerge="json/merge.json",this.ShareGamePng="res/share.jpg",this.InviteGamePng="res/invite.jpg",this.PrefabPools=[],this.preloaded={}}clearPrefabPools(){const t=this.PrefabPools;for(let e=0;e<t.length;e++){const n=t[e],s=Laya.Pool.getPoolBySign(n);if(s&&s.length)for(let t=0;t<s.length;t++)s[t].destroy();Laya.Pool.clearBySign(n)}t.length=0}clearGPUMemory(t){for(let e=0;e<t.length;e++){const n=t[e],s=Laya.loader.getRes(n);s&&s.destroy&&s.destroy()}}getBaseAsset(){let t=1,e=0;return new Promise((n,s)=>{const i=()=>{++e<t||n()},a=[];for(const t in I){const e=I[t];a.push(e)}a.length&&(t++,Laya.loader.create(a,Laya.Handler.create(this,()=>{i()}))),Laya.loader.create([this.PrefabMerge,this.JsonMerge],Laya.Handler.create(this,()=>{i()}),null,Laya.Loader.JSON)})}preloadPrefab(t){const e=new Laya.Sprite;e.visible=!1,Laya.stage.addChild(e);for(let n=0;n<t.length;n++){const s=t[n];this.preloaded[s]=1,v.LoadPrefab(s).then(i=>{const a=Laya.Pool.getItemByCreateFun(s,i.create,i);a._components=null,e.addChild(a),n==t.length-1&&e.removeSelf()})}}};class _ extends Laya.Script{constructor(){super(),this.m3DAssets=[],this.timer=0,this.longUpdateDelta=1e3}onEnable(){this.timer=0}onDisable(){i.offAllCaller(this),Laya.timer.clearAll(this),Laya.Tween.clearAll(this.owner)}onUpdate(){this.timer+=Laya.timer.delta,this.timer>=this.longUpdateDelta&&(this.timer=0,this.onLongUpdate())}onLongUpdate(){}recover(t){let e=t.__sign__;e&&Laya.Pool.recover(e,t);let n=A.PrefabPools;n&&n.indexOf(e)<0&&n.push(e)}find(t,e){const n=t.split("/");let s=null,i=0;if(n&&n.length)for(;i<n.length;){const t=n[i];i++,t&&(s=(s||e).getChildByName(t))}return s}point(t,e){return new Laya.Point(t,e)}vec2(t,e){return new Laya.Vector2(t,e)}vec3(t,e,n){return t instanceof Laya.Vector2&&(e=t.y,t=t.x),new Laya.Vector3(t,e,n)}vec4(t,e,n,s){return t instanceof Laya.Vector2&&(e=t.y,t=t.x),t instanceof Laya.Vector3&&(e=t.y,n=t.z,t=t.x),new Laya.Vector4(t,e,n,s)}quat(t,e,n,s){return new Laya.Quaternion}}class k extends _{constructor(){super(),this.startX=360,this.startY=640,this.maxRadius=106,this.rockerPos=null,this.rocker=null,this.touchId=0,this.isDown=!1,this.touchNode=null,this.onTouchDown=null,this.onTouchMove=null,this.onTouchUp=null}onEnable(){k.Instance=this;const t=this.owner;this.rocker=t.getChildByName("rocker"),this.rockerPos=this.vec2(106,106),this.initRocker()}initRocker(){this.owner.pos(this.startX,this.startY),this.rocker.pos(this.rockerPos.x,this.rockerPos.y)}stopTouch(){Laya.TouchManager.I.onMouseUp(this.touchNode,this.touchId)}initTouch(t){t.on(Laya.Event.MOUSE_DOWN,this,this.onStageMouseDown1),t.on(Laya.Event.MOUSE_MOVE,this,this.onStageMouseMove1),t.on(Laya.Event.MOUSE_UP,this,this.onStageMouseUp1),this.touchNode=t}onStageMouseDown1(t){const e=this.owner;this.isDown=!0,this.touchId=t.touchId,e.pos(t.stageX,t.stageY),this.rocker.pos(this.rockerPos.x,this.rockerPos.y),this.onTouchDown&&this.onTouchDown()}onStageMouseUp1(t){t.touchId==this.touchId&&(this.isDown=!1,this.initRocker(),this.onTouchUp&&this.onTouchUp())}stopMove(){this.isDown=!1,this.initRocker(),this.onTouchUp&&this.onTouchUp()}onStageMouseMove1(t){if(!this.isDown||t.touchId!=this.touchId)return;const e=this.owner,n=this.rocker,s=e.globalToLocal(this.point(t.stageX,t.stageY)),i=s.x-this.rockerPos.x,a=s.y-this.rockerPos.y;let o=Math.atan2(i,a);if(o<0&&(o+=2*Math.PI),i*i+a*a>=this.maxRadius*this.maxRadius){const t=Math.floor(Math.sin(o)*this.maxRadius+this.rockerPos.x),e=Math.floor(Math.cos(o)*this.maxRadius+this.rockerPos.y);n.pos(t,e)}else n.pos(s.x,s.y);this.onTouchMove&&this.onTouchMove(i,a)}onDisable(){super.onDisable(),k.Instance=null,this.touchNode&&this.touchNode.offAllCaller(this)}onUpdate(){}}var P,N,w;k.Instance=null,function(t){t[t.Lv=1]="Lv",t[t.Gold=2]="Gold",t[t.Diamond=3]="Diamond",t[t.Adv=4]="Adv",t[t.Default=5]="Default"}(P||(P={}));class B{static setTankData(t){const e=this.tankData,n=t["tank.json"];if(n&&n.length)for(let t=0;t<n.length;t++){const s=n[t];e[s.id]=s}}static setTankAttData(t){const e=this.tankAttData,n=t["bullet.json"];if(n&&n.length)for(let t=0;t<n.length;t++){const s=n[t];e[s.lv]=s}}static setTankHpData(t){const e=this.tankHpData,n=t["armor.json"];if(n&&n.length)for(let t=0;t<n.length;t++){const s=n[t];e[s.lv]=s}}static setTankSoldierData(t){const e=this.tankSoldierData,n=t["soldier.json"];if(n&&n.length)for(let t=0;t<n.length;t++){const s=n[t];e[s.lv]=s}}static setTankUavData(t){const e=this.tankUavData,n=t["plane.json"];if(n&&n.length)for(let t=0;t<n.length;t++){const s=n[t];e[s.lv]=s}}}B.tankData={},B.tankAttData={},B.tankHpData={},B.tankSoldierData={},B.tankUavData={},function(t){t[t.Ready=0]="Ready",t[t.Start=1]="Start",t[t.Pause=2]="Pause",t[t.End=3]="End"}(N||(N={})),function(t){t[t.Player=Laya.Physics3DUtils.COLLISIONFILTERGROUP_CUSTOMFILTER3]="Player",t[t.Enemy=Laya.Physics3DUtils.COLLISIONFILTERGROUP_CUSTOMFILTER4]="Enemy",t[t.Default=Laya.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER]="Default",t[t.All=Laya.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER]="All"}(w||(w={}));const R={GameBgm1:"audio/gameBgm1.mp3",GameLose:"audio/gamelose.mp3",GameWin:"audio/gamewin.mp3",TaskWin:"audio/taskwin.mp3",LobbyBgm1:"audio/lobbyBgm1.mp3",TankMove:"audio/tankMove.mp3",TankShot1:"audio/tankShot1.mp3",TankShot2:"audio/tankShot2.mp3",TankShot3:"audio/tankShot3.mp3",TankShot4:"audio/tankShot4.mp3",TankShot5:"audio/tankShot5.mp3",TankShot6:"audio/tankShot6.mp3",TankShot7:"audio/tankShot7.mp3",TankShot8:"audio/tankShot8.mp3",TankShot9:"audio/tankShot9.mp3",TankSkill1:"audio/tankSkill1.mp3",TankSkill3:"audio/tankSkill3.mp3",EnemyAppear1:"audio/enemyAppear1.mp3",EnemyAppear2:"audio/enemyAppear2.mp3",EnemyAppear3:"audio/enemyAppear3.mp3",EnemyAppear4:"audio/enemyAppear4.mp3",EnemyDie1:"audio/enemyDie1.mp3",EnemyDie2:"audio/enemyDie2.mp3",EnemyDie3:"audio/enemyDie3.mp3",EnemyDie4:"audio/enemyDie4.mp3",PlayerProp:"audio/playerProp.mp3",EffectBoom:"audio/effectBoom.mp3",LevelUp:"audio/levelup.mp3",Money:"audio/money.mp3"},x={RockerNode:"prefab/game/RockerNode.json",EnemyHpBar:"prefab/game/EnemyHpBar.json",PlayerHpBar:"prefab/game/PlayerHpBar.json",PlayerDirNode:"prefab/game/PlayerDirNode.json",PlayerBomberNode:"prefab/game/PlayerBomberNode.json",TaskCollectBar:"prefab/game/TaskCollectBar.json",SettingDialog:"prefab/game/SettingDialog.json",TaskSuccessDialog:"prefab/game/TaskSuccessDialog.json",TaskOverDialog:"prefab/game/TaskOverDialog.json",PlayerProp:"prefab/game/PlayerProp.json",TankDialog:"prefab/lobby/TankDialog.json",CommonRewardDialog:"prefab/lobby/CommonRewardDialog.json",GetRewardDialog:"prefab/lobby/GetRewardDialog.json",GuidanceHandNode:"prefab/common/GuidanceHandNode.json"},O={Base:["unity/pack1","unity/pack2","unity/pack3","unity/pack4"]},M={LobbyScene:"unity/gamescene/lobby.ls",GameScene1:"unity/gamescene/tank1.ls",GameScene2:"unity/gamescene/tank2.ls",TankDialog:"unity/gamescene/tankDialog.ls",GameCoinNode:"unity/gamescene/GameCoinNode.lh",Tank1:"unity/gamescene/Tank1.lh",Tank2:"unity/gamescene/Tank2.lh",Tank3:"unity/gamescene/Tank3.lh",Tank4:"unity/gamescene/Tank4.lh",TankBullet1:"unity/gamescene/TankBullet1.lh",TankBulletHit1:"unity/gamescene/TankBulletHit1.lh",TankBullet2:"unity/gamescene/TankBullet2.lh",TankBulletHit2:"unity/gamescene/TankBulletHit2.lh",TankBullet3:"unity/gamescene/TankBullet3.lh",TankBulletHit3:"unity/gamescene/TankBulletHit3.lh",TankBullet4:"unity/gamescene/TankBullet4.lh",TankBullet5:"unity/gamescene/TankBullet5.lh",TankBulletHit5:"unity/gamescene/TankBulletHit5.lh",PlayerSoldier:"unity/gamescene/PlayerSoldier.lh",PlayerUav:"unity/gamescene/PlayerUav.lh",Enemy1:"unity/gamescene/Enemy1.lh",Enemy2:"unity/gamescene/Enemy2.lh",Enemy3:"unity/gamescene/Enemy3.lh",Enemy4:"unity/gamescene/Enemy4.lh",Enemy1001:"unity/gamescene/Boss1.lh",EnemyAtt2:"unity/gamescene/EnemyAtt2.lh",EnemyAttRange1:"unity/gamescene/EnemyAttRange1.lh",EnemyAttRange2:"unity/gamescene/EnemyAttRange2.lh",EnemyDeath1:"unity/gamescene/EnemyDeath1.lh",EnemyDeath2:"unity/gamescene/EnemyDeath2.lh",TaskCommNode:"unity/gamescene/TaskCommNode.lh",TaskSaveNode:"unity/gamescene/TaskSaveNode.lh",TaskGuardNode:"unity/gamescene/TaskGuardNode.lh",TaskTargetNode:"unity/gamescene/TaskTargetNode.lh",PropBlood:"unity/gamescene/PropBlood.lh",PropBlood2:"unity/gamescene/PropBlood2.lh",PropSpeed:"unity/gamescene/PropSpeed.lh",PropSpeed2:"unity/gamescene/PropSpeed2.lh",PropShield:"unity/gamescene/PropShield.lh",PropShield2:"unity/gamescene/PropShield2.lh",PropAtt:"unity/gamescene/PropAtt.lh",PropAtt2:"unity/gamescene/PropAtt2.lh",PropLaser:"unity/gamescene/PropLaser.lh",PropLaser2:"unity/gamescene/PropLaser2.lh",PropLightning:"unity/gamescene/PropLightning.lh",PropLightning2:"unity/gamescene/PropLightning2.lh",PropWind:"unity/gamescene/PropWind.lh",PropWind2:"unity/gamescene/PropWind2.lh",PropWind3:"unity/gamescene/PropWind3.lh",PropFire:"unity/gamescene/PropFire.lh",EffectBoom:"unity/gamescene/EffectBoom.lh",TankSkill2:"unity/gamescene/TankSkill2.lh",TankSkill21:"unity/gamescene/TankSkill21.lh",TankSkill4:"unity/gamescene/TankSkill4.lh"},G={1:M.Tank1,2:M.Tank2,3:M.Tank3,4:M.Tank4},H={1:M.TankBullet1,2:M.TankBullet2,3:M.TankBullet3,4:M.TankBullet4,5:M.TankBullet5,6:M.PropLaser2,7:M.PropLightning2,8:M.PropWind2,9:M.TankSkill2},F={1:M.TankBulletHit1,2:M.TankBulletHit2,3:M.TankBulletHit3,4:M.EffectBoom,5:M.TankBulletHit5,8:M.PropWind3,9:M.EffectBoom},U={1:"unity/gamescene/Assets/tank/model/tank1/tank1.jpg",2:"unity/gamescene/Assets/tank/model/tank1/tank2.jpg",3:"unity/gamescene/Assets/tank/model/tank1/tank3.jpg",4:"unity/gamescene/Assets/tank/model/tank1/tank4.jpg"},V={GameScene1:"unity/gamescene/tank1.json",GameScene2:"unity/gamescene/tank2.json"},W={OnSoldierDeath:"on.soldier.death",OnEnemyDeath:"on.enemy.death",OnLobbyEnemyDeath:"on.lobby.enemy.death",OnEnemySkill:"on.enemy.skill",OnGameState:"on.game.state",OnAnimState:"on.anim.state",OnGameTask:"on.game.task",OnGameEnemy:"on.game.enemy",OnGameCollect:"on.game.collect",OnGameAssault:"on.game.assault",OnGameGuard:"on.game.guard",OnGameBoss:"on.game.boss",OnClearEnemy:"on.clear.enemy",OnGameProp:"on.game.prop",OnGameOver:"on.game.over",OnGameSuccess:"on.game.success",OnTankSelect:"on.tank.select",OnPlayerScore:"on.player.score",OnSkillFire:"on.skill.fire",OnSkillAtk:"on.skill.atk",OnSkillPulse:"on.skill.pulse"};var z,$;!function(t){t[t.Sweep=1]="Sweep",t[t.Save=2]="Save",t[t.Guard=3]="Guard",t[t.Kill=4]="Kill",t[t.Live=5]="Live",t[t.Collect=6]="Collect",t[t.Assault=7]="Assault"}(z||(z={})),function(t){t[t.Blood=1]="Blood",t[t.Shield=2]="Shield",t[t.Speed=3]="Speed",t[t.Laser=4001]="Laser",t[t.Lightning=5001]="Lightning",t[t.Wind=6001]="Wind",t[t.Fire=7001]="Fire",t[t.Att=4]="Att"}($||($={}));const j={[$.Blood]:M.PropBlood,[$.Shield]:M.PropShield,[$.Speed]:M.PropSpeed,[$.Laser]:M.PropLaser,[$.Lightning]:M.PropLightning,[$.Wind]:M.PropWind,[$.Fire]:M.PropFire,[$.Att]:M.PropAtt},K={[P.Adv]:"lobby/adIcon.png",[P.Gold]:"lobby/icon5.png",[P.Diamond]:"lobby/icon6.png"},X={HpLevel:2,SoldierLevel:3,UavLevel:6,Tank2Level:5,tankIds:[1,2,3,4],VideoGold:1e4,VideoDiamond:1e3},Q={isClickTankDialog:!1};class Y extends Laya.Script3D{constructor(){super(),this.timer=0,this.longUpdateDelta=1e3}onEnable(){this.timer=0}onDisable(){i.offAllCaller(this),Laya.timer.clearAll(this);const t=this.owner;Laya.Tween.clearAll(t),Laya.Tween.clearAll(t.transform)}onUpdate(){this.timer+=Laya.timer.delta,this.timer>=this.longUpdateDelta&&(this.timer=0,this.onLongUpdate())}onLongUpdate(){}recover(t){let e=t.__sign__;e&&Laya.Pool.recover(e,t);let n=A.PrefabPools;n&&n.indexOf(e)<0&&n.push(e)}find(t,e){const n=t.split("/");let s=null,i=0;if(n&&n.length)for(;i<n.length;){const t=n[i];i++,t&&(s=(s||e).getChildByName(t))}return s}vec2(t,e){return new Laya.Vector2(t,e)}vec3(t,e,n){return t instanceof Laya.Vector2&&(e=t.y,t=t.x),new Laya.Vector3(t,e,n)}vec4(t,e,n,s){return t instanceof Laya.Vector2&&(e=t.y,t=t.x),t instanceof Laya.Vector3&&(e=t.y,n=t.z,t=t.x),new Laya.Vector4(t,e,n,s)}quat(t,e,n,s){return new Laya.Quaternion(t,e,n,s)}}var J='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n\tprecision highp int;\n#else\n\tprecision mediump float;\n\tprecision mediump int;\n#endif\n#include "Lighting.glsl";\n#include "LayaUtile.glsl"\n#include "Shadow.glsl";\n\n\nattribute vec4 a_Position;\n\n#ifdef GPU_INSTANCE\n\tuniform mat4 u_ViewProjection;\n#else\n\tuniform mat4 u_MvpMatrix;\n#endif\n\n#if defined(DIFFUSEMAP)||defined(THICKNESSMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\n\tattribute vec2 a_Texcoord0;\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(LIGHTMAP)&&defined(UV1)\n\tattribute vec2 a_Texcoord1;\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\n#ifdef COLOR\n\tattribute vec4 a_Color;\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nattribute vec3 a_Normal;\nvarying vec3 v_Normal; \n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_ViewDir; \n#endif\n\n#if defined(NORMALMAP)\n\tattribute vec4 a_Tangent0;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_WorldMat;\n#else\n\tuniform mat4 u_WorldMat;\n#endif\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\n\tvarying vec4 v_ShadowCoord;\n#endif\n\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\tvarying vec4 v_SpotShadowCoord;\n#endif\n\nuniform vec4 u_TilingOffset;\n\nvoid main()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform;\n\t \t#ifdef SIMPLEBONE\n\t\t\tfloat currentPixelPos;\n\t\t\t#ifdef GPU_INSTANCE\n\t\t\t\tcurrentPixelPos = a_SimpleTextureParams.x+a_SimpleTextureParams.y;\n\t\t\t#else\n\t\t\t\tcurrentPixelPos = u_SimpleAnimatorParams.x+u_SimpleAnimatorParams.y;\n\t\t\t#endif\n\t\t\tfloat offset = 1.0/u_SimpleAnimatorTextureSize;\n\t\t\tskinTransform =  loadMatFromTexture(currentPixelPos,int(a_BoneIndices.x),offset) * a_BoneWeights.x;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.y),offset) * a_BoneWeights.y;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.z),offset) * a_BoneWeights.z;\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.w),offset) * a_BoneWeights.w;\n\t\t#else\n\t\t\tskinTransform =  u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\t#endif\n\t\tposition=skinTransform*a_Position;\n\t #else\n\t\tposition=a_Position;\n\t#endif\n\n\n\t\n\tmat4 worldMat;\n\t#ifdef GPU_INSTANCE\n\t\tworldMat = a_WorldMat;\n\t#else\n\t\tworldMat = u_WorldMat;\n\t#endif\n\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = u_ViewProjection * worldMat * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\n\tmat3 worldInvMat;\n\t#ifdef BONE\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat*skinTransform));\n\t#else\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat));\n\t#endif  \n\tv_Normal=normalize(a_Normal*worldInvMat);\n\t#if defined(NORMALMAP)\n\t\tv_Tangent=normalize(a_Tangent0.xyz*worldInvMat);\n\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\n\t\tvec3 positionWS=(worldMat*position).xyz;\n\t\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t\tv_ViewDir = u_CameraPos-positionWS;\n\t\t#endif\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\n\t\t\tv_PositionWorld = positionWS;\n\t\t#endif\n\t#endif\n\n\t#if defined(DIFFUSEMAP)||defined(THICKNESSMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t#endif\n\n\t#ifdef LIGHTMAP\n\t\t#ifdef UV1\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x,1.0-a_Texcoord1.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#else\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,1.0-a_Texcoord0.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t#endif \n\t\tv_LightMapUV.y=1.0-v_LightMapUV.y;\n\t#endif\n\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tv_Color=a_Color;\n\t#endif\n\n\t#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\n\t\tv_ShadowCoord =getShadowCoord(vec4(positionWS,1.0));\n\t#endif\n\n\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\t\tv_SpotShadowCoord = u_SpotViewProjectMatrix*vec4(positionWS,1.0);\n\t#endif\n\n\tgl_Position=remapGLPositionZ(gl_Position);\n}',Z='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n\tprecision highp int;\n#else\n\tprecision mediump float;\n\tprecision mediump int;\n#endif\n\n\n#include "Lighting.glsl";\n#include "Shadow.glsl"\n\nuniform vec4 u_DiffuseColor;\nuniform float u_Time;\nuniform float u_UvMove;\n\n#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n\n\n#if defined(DIFFUSEMAP)||defined(THICKNESSMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform sampler2D u_LightMap;\n\t#ifdef LIGHTMAP_DIRECTIONAL\n\t\tuniform sampler2D u_LightMapDirection;\n\t#endif\n#endif\n\nvarying vec3 v_Normal;\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvarying vec3 v_ViewDir; \n\n\tuniform vec3 u_MaterialSpecular;\n\tuniform float u_Shininess;\n\n\t#ifdef LEGACYSINGLELIGHTING\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tuniform DirectionLight u_DirectionLight;\n\t\t#endif\n\t\t#ifdef POINTLIGHT\n\t\t\tuniform PointLight u_PointLight;\n\t\t#endif\n\t\t#ifdef SPOTLIGHT\n\t\t\tuniform SpotLight u_SpotLight;\n\t\t#endif\n\t#else\n\t\tuniform mat4 u_View;\n\t\tuniform vec4 u_ProjectionParams;\n\t\tuniform vec4 u_Viewport;\n\t\tuniform int u_DirationLightCount;\n\t\tuniform sampler2D u_LightBuffer;\n\t\tuniform sampler2D u_LightClusterBuffer;\n\t#endif\n\n\t#ifdef SPECULARMAP \n\t\tuniform sampler2D u_SpecularTexture;\n\t#endif\n#endif\n\n#ifdef NORMALMAP \n\tuniform sampler2D u_NormalTexture;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\n\tvarying vec3 v_PositionWorld;\n#endif\n\n\n#include "GlobalIllumination.glsl";//"GlobalIllumination.glsl use uniform should at front of this\n\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\n\tvarying vec4 v_ShadowCoord;\n#endif\n\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\tvarying vec4 v_SpotShadowCoord;\n#endif\n\n\nvoid main()\n{\n\tvec2 texcoord0 = v_Texcoord0;\n\tif(texcoord0.x <= 0.1) texcoord0.y -= (u_Time * 0.2 * u_UvMove);\n\tvec3 normal;//light and SH maybe use normal\n\t#if defined(NORMALMAP)\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\n\t#else\n\t\tnormal = normalize(v_Normal);\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 viewDir= normalize(v_ViewDir);\n\t#endif\n\n\tLayaGIInput giInput;\n\t#ifdef LIGHTMAP\t\n\t\tgiInput.lightmapUV=v_LightMapUV;\n\t#endif\n\tvec3 globalDiffuse=layaGIBase(giInput,1.0,normal);\n\t\n\tvec4 mainColor=u_DiffuseColor;\n\t#ifdef DIFFUSEMAP\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, texcoord0);\n\t\tmainColor=mainColor*difTexColor;\n\t#endif \n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tmainColor=mainColor*v_Color;\n\t#endif \n    \n\t#ifdef ALPHATEST\n\t\tif(mainColor.a<u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\t\n\tvec3 diffuse = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\tvec3 transmissionDiffuse = vec3(0.0);\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 dif,spe,transmis;\n\t\tfloat transmissionFactor;\n\t\t#ifdef SPECULARMAP\n\t\t\tvec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n\t\t#else\n\t\t\t#ifdef DIFFUSEMAP\n\t\t\t\tvec3 gloss=vec3(difTexColor.a);\n\t\t\t#else\n\t\t\t\tvec3 gloss=vec3(1.0);\n\t\t\t#endif\n\t\t#endif\n\t\t#ifdef THICKNESSMAP\n\t\t\ttransmissionFactor = texture2D(u_ThinknessTexture, v_Texcoord0).r;\n\t\t#endif\n\t#endif\n\n\t\n\t\n\t#ifdef LEGACYSINGLELIGHTING\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,transmissionFactor,dif,spe,transmis);\n\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\t\t\t\t#ifdef SHADOW_CASCADE\n\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\n\t\t\t\t#else\n\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\n\t\t\t\t#endif\n\t\t\t\tfloat shadowAttenuation=sampleShadowmap(shadowCoord);\n\t\t\t\tdif *= shadowAttenuation;\n\t\t\t\tspe *= shadowAttenuation;\n\t\t\t\ttransmis *=shadowAttenuation;\n\t\t\t#endif\n\t\t\tdiffuse+=dif;\n\t\t\tspecular+=spe;\n\t\t\ttransmissionDiffuse+=transmis;\n\t\t#endif\n\t\n\t\t#ifdef POINTLIGHT\n\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,transmissionFactor,dif,spe,transmis);\n\t\t\tdiffuse+=dif;\n\t\t\tspecular+=spe;\n\t\t\ttransmissionDiffuse+=transmis;\n\t\t#endif\n\n\t\t#ifdef SPOTLIGHT\n\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,transmissionFactor,dif,spe,transmis);\n\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\n\t\t\t\tfloat spotShadowAttenuation = sampleSpotShadowmap(spotShadowcoord);\n\t\t\t\tdif *= spotShadowAttenuation;\n\t\t\t\tspe *= spotShadowAttenuation;\n\t\t\t\ttransmis *=spotShadowAttenuation;\n\t\t\t#endif\n\t\t\tdiffuse+=dif;\n\t\t\tspecular+=spe;\n\t\t\ttransmissionDiffuse+=transmis;\n\t\t#endif\n\t#else\n\t\t#ifdef DIRECTIONLIGHT\n\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t{\n\t\t\t\tif(i >= u_DirationLightCount)\n\t\t\t\t\tbreak;\n\t\t\t\tDirectionLight directionLight = getDirectionLight(u_LightBuffer,i);\n\t\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\t\t\t\t\tif(i == 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t#ifdef SHADOW_CASCADE\n\t\t\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\n\t\t\t\t\t\t#endif\n\t\t\t\t\t\tdirectionLight.color *= sampleShadowmap(shadowCoord);\n\t\t\t\t\t}\n\t\t\t\t#endif\n\t\t\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,directionLight,transmissionFactor,dif,spe,transmis);\n\t\t\t\tdiffuse+=dif;\n\t\t\t\tspecular+=spe;\n\t\t\t\ttransmissionDiffuse+=transmis;\n\t\t\t}\n\t\t#endif\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t\tivec4 clusterInfo =getClusterInfo(u_LightClusterBuffer,u_View,u_Viewport, v_PositionWorld,gl_FragCoord,u_ProjectionParams);\n\t\t\t#ifdef POINTLIGHT\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t\t{\n\t\t\t\t\tif(i >= clusterInfo.x)//PointLightCount\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tPointLight pointLight = getPointLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\n\t\t\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,pointLight,transmissionFactor,dif,spe,transmis);\n\t\t\t\t\tdiffuse+=dif;\n\t\t\t\t\tspecular+=spe;\n\t\t\t\t\ttransmissionDiffuse+=transmis;\n\t\t\t\t}\n\t\t\t#endif\n\t\t\t#ifdef SPOTLIGHT\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \n\t\t\t\t{\n\t\t\t\t\tif(i >= clusterInfo.y)//SpotLightCount\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tSpotLight spotLight = getSpotLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\n\t\t\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\n\t\t\t\t\t\tif(i == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\n\t\t\t\t\t\t\tspotLight.color *= sampleSpotShadowmap(spotShadowcoord);\n\t\t\t\t\t\t}\n\t\t\t\t\t#endif\n\t\t\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,spotLight,transmissionFactor,dif,spe,transmis);\n\t\t\t\t\tdiffuse+=dif;\n\t\t\t\t\tspecular+=spe;\n\t\t\t\t\ttransmissionDiffuse+=transmis;\n\t\t\t\t}\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\n\tgl_FragColor =vec4(mainColor.rgb*(globalDiffuse + diffuse),mainColor.a);\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tgl_FragColor.rgb+=specular;\n\t#endif\n\n\t#ifdef ENABLETRANSMISSION\n\t\tgl_FragColor.rgb+= transmissionDiffuse;\n\t#endif\n\n\t  \n\t#ifdef FOG\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n\n\t//gl_FragColor.rgb =transmissionDiffuse;\n}\n\n';const q=Laya.Shader3D,tt=Laya.Material,et=Laya.RenderState,nt='#include "ShadowCasterVS.glsl"\n\nvoid main()\n{\n\tvec4 positionCS =  shadowCasterVertex();\n\tgl_Position=remapGLPositionZ(positionCS);\n}',st='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\n\tprecision highp float;\n\tprecision highp int;\n#else\n\tprecision mediump float;\n\tprecision mediump int;\n#endif\n\n#include "ShadowCasterFS.glsl"\n\nvoid main()\n{\n\tgl_FragColor=shadowCasterFragment();\n}',it='\n\t#include "Lighting.glsl";\n\tattribute vec4 a_Position;\n\tattribute vec3 a_Normal;\n\tuniform mat4 u_MvpMatrix;\n\tuniform mat4 u_WorldMat;\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_ViewDir;\n\tvarying vec3 v_Normal;\n\tvoid main()\n\t{\n\t\tvec4 position = a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t\tgl_Position = remapGLPositionZ(gl_Position);\n\t\tmat3 worldMat = mat3(u_WorldMat);\n\t\tvec3 positionWS = position.xyz;\n\t\tv_ViewDir = normalize(u_CameraPos - positionWS);\n\t\tmat3 worldInvMat = INVERSE_MAT(worldMat);\n\t\tv_Normal= normalize(a_Normal * worldInvMat);\n\t}',at="\n\t#ifdef FSHIGHPRECISION\n\t\tprecision highp float;\n\t#else\n\t\tprecision mediump float;\n\t#endif\n\tvarying vec3 v_ViewDir;\n\tvarying vec3 v_Normal;\n\tvoid main()\n\t{\n\t\tfloat rim = 1.0 - dot(v_ViewDir, v_Normal);\n\t\tgl_FragColor = vec4(0.0, 1.0, 1.0, 1.0) * rim;\n\t}";class ot extends tt{constructor(){super(),this.UvMove=q.propertyNameToID("u_UvMove"),this._enableVertexColor=!1,this._enableTransmission=!1,ot.IsInit||(ot.IsInit=!0,ot.__initDefine__(),this.initShader()),this.setShaderName("BLINNPHONG1"),this._albedoIntensity=1,this._albedoColor=new Laya.Vector4(1,1,1,1);var t=this._shaderValues;t.setVector(ot.ALBEDOCOLOR,new Laya.Vector4(1,1,1,1)),t.setVector(ot.MATERIALSPECULAR,new Laya.Vector4(1,1,1,1)),t.setNumber(ot.SHININESS,.078125),t.setNumber(tt.ALPHATESTVALUE,.5),t.setVector(ot.TILINGOFFSET,new Laya.Vector4(1,1,0,0)),this._enableLighting=!0,this.renderMode=ot.RENDERMODE_OPAQUE}static __initDefine__(){ot.SHADERDEFINE_DIFFUSEMAP=q.getDefineByName("DIFFUSEMAP"),ot.SHADERDEFINE_NORMALMAP=q.getDefineByName("NORMALMAP"),ot.SHADERDEFINE_SPECULARMAP=q.getDefineByName("SPECULARMAP"),ot.SHADERDEFINE_ENABLEVERTEXCOLOR=q.getDefineByName("ENABLEVERTEXCOLOR"),ot.SHADERDEFINE_ENABLETRANSMISSION=q.getDefineByName("ENABLETRANSMISSION"),ot.SHADERDEFINE_THICKNESSMAP=q.getDefineByName("THICKNESSMAP")}get _ColorR(){return this._albedoColor.x}set _ColorR(t){this._albedoColor.x=t,this.albedoColor=this._albedoColor}get _ColorG(){return this._albedoColor.y}set _ColorG(t){this._albedoColor.y=t,this.albedoColor=this._albedoColor}get _ColorB(){return this._albedoColor.z}set _ColorB(t){this._albedoColor.z=t,this.albedoColor=this._albedoColor}get _ColorA(){return this._albedoColor.w}set _ColorA(t){this._albedoColor.w=t,this.albedoColor=this._albedoColor}get _Color(){return this._shaderValues.getVector(ot.ALBEDOCOLOR)}set _Color(t){this.albedoColor=t}get _SpecColorR(){return this._shaderValues.getVector(ot.MATERIALSPECULAR).x}set _SpecColorR(t){this._shaderValues.getVector(ot.MATERIALSPECULAR).x=t}get _SpecColorG(){return this._shaderValues.getVector(ot.MATERIALSPECULAR).y}set _SpecColorG(t){this._shaderValues.getVector(ot.MATERIALSPECULAR).y=t}get _SpecColorB(){return this._shaderValues.getVector(ot.MATERIALSPECULAR).z}set _SpecColorB(t){this._shaderValues.getVector(ot.MATERIALSPECULAR).z=t}get _SpecColorA(){return this._shaderValues.getVector(ot.MATERIALSPECULAR).w}set _SpecColorA(t){this._shaderValues.getVector(ot.MATERIALSPECULAR).w=t}get _SpecColor(){return this._shaderValues.getVector(ot.MATERIALSPECULAR)}set _SpecColor(t){this.specularColor=t}get _AlbedoIntensity(){return this._albedoIntensity}set _AlbedoIntensity(t){if(this._albedoIntensity!==t){var e=this._shaderValues.getVector(ot.ALBEDOCOLOR);Laya.Vector4.scale(this._albedoColor,t,e),this._albedoIntensity=t,this._shaderValues.setVector(ot.ALBEDOCOLOR,e)}}get _Shininess(){return this._shaderValues.getNumber(ot.SHININESS)}set _Shininess(t){t=Math.max(0,Math.min(1,t)),this._shaderValues.setNumber(ot.SHININESS,t)}get _MainTex_STX(){return this._shaderValues.getVector(ot.TILINGOFFSET).x}set _MainTex_STX(t){var e=this._shaderValues.getVector(ot.TILINGOFFSET);e.x=t,this.tilingOffset=e}get _MainTex_STY(){return this._shaderValues.getVector(ot.TILINGOFFSET).y}set _MainTex_STY(t){var e=this._shaderValues.getVector(ot.TILINGOFFSET);e.y=t,this.tilingOffset=e}get _MainTex_STZ(){return this._shaderValues.getVector(ot.TILINGOFFSET).z}set _MainTex_STZ(t){var e=this._shaderValues.getVector(ot.TILINGOFFSET);e.z=t,this.tilingOffset=e}get _MainTex_STW(){return this._shaderValues.getVector(ot.TILINGOFFSET).w}set _MainTex_STW(t){var e=this._shaderValues.getVector(ot.TILINGOFFSET);e.w=t,this.tilingOffset=e}get _MainTex_ST(){return this._shaderValues.getVector(ot.TILINGOFFSET)}set _MainTex_ST(t){this.tilingOffset=t}get _Cutoff(){return this.alphaTestValue}set _Cutoff(t){this.alphaTestValue=t}set renderMode(t){switch(t){case ot.RENDERMODE_OPAQUE:this.alphaTest=!1,this.renderQueue=tt.RENDERQUEUE_OPAQUE,this.depthWrite=!0,this.cull=et.CULL_BACK,this.blend=et.BLEND_DISABLE,this.depthTest=et.DEPTHTEST_LESS;break;case ot.RENDERMODE_CUTOUT:this.renderQueue=tt.RENDERQUEUE_ALPHATEST,this.alphaTest=!0,this.depthWrite=!0,this.cull=et.CULL_BACK,this.blend=et.BLEND_DISABLE,this.depthTest=et.DEPTHTEST_LESS;break;case ot.RENDERMODE_TRANSPARENT:this.renderQueue=tt.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=et.CULL_BACK,this.blend=et.BLEND_ENABLE_ALL,this.blendSrc=et.BLENDPARAM_SRC_ALPHA,this.blendDst=et.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=et.DEPTHTEST_LESS;break;default:throw new Error("Material:renderMode value error.")}}get enableVertexColor(){return this._enableVertexColor}set enableVertexColor(t){this._enableVertexColor=t,t?this._shaderValues.addDefine(ot.SHADERDEFINE_ENABLEVERTEXCOLOR):this._shaderValues.removeDefine(ot.SHADERDEFINE_ENABLEVERTEXCOLOR)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(t){this._MainTex_STX=t}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(t){this._MainTex_STY=t}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(t){this._MainTex_STZ=t}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(t){this._MainTex_STW=t}get tilingOffset(){return this._shaderValues.getVector(ot.TILINGOFFSET)}set tilingOffset(t){t?this._shaderValues.setVector(ot.TILINGOFFSET,t):this._shaderValues.getVector(ot.TILINGOFFSET).setValue(1,1,0,0)}get albedoColorR(){return this._ColorR}set albedoColorR(t){this._ColorR=t}get albedoColorG(){return this._ColorG}set albedoColorG(t){this._ColorG=t}get albedoColorB(){return this._ColorB}set albedoColorB(t){this._ColorB=t}get albedoColorA(){return this._ColorA}set albedoColorA(t){this._ColorA=t}get albedoColor(){return this._albedoColor}set albedoColor(t){var e=this._shaderValues.getVector(ot.ALBEDOCOLOR);Laya.Vector4.scale(t,this._albedoIntensity,e),this._albedoColor=t,this._shaderValues.setVector(ot.ALBEDOCOLOR,e)}get albedoIntensity(){return this._albedoIntensity}set albedoIntensity(t){this._AlbedoIntensity=t}get specularColorR(){return this._SpecColorR}set specularColorR(t){this._SpecColorR=t}get specularColorG(){return this._SpecColorG}set specularColorG(t){this._SpecColorG=t}get specularColorB(){return this._SpecColorB}set specularColorB(t){this._SpecColorB=t}get specularColorA(){return this._SpecColorA}set specularColorA(t){this._SpecColorA=t}get specularColor(){return this._shaderValues.getVector(ot.MATERIALSPECULAR)}set specularColor(t){this._shaderValues.setVector(ot.MATERIALSPECULAR,t)}get shininess(){return this._Shininess}set shininess(t){this._Shininess=t}get albedoTexture(){return this._shaderValues.getTexture(ot.ALBEDOTEXTURE)}set albedoTexture(t){t?this._shaderValues.addDefine(ot.SHADERDEFINE_DIFFUSEMAP):this._shaderValues.removeDefine(ot.SHADERDEFINE_DIFFUSEMAP),this._shaderValues.setTexture(ot.ALBEDOTEXTURE,t)}get normalTexture(){return this._shaderValues.getTexture(ot.NORMALTEXTURE)}set normalTexture(t){t?this._shaderValues.addDefine(ot.SHADERDEFINE_NORMALMAP):this._shaderValues.removeDefine(ot.SHADERDEFINE_NORMALMAP),this._shaderValues.setTexture(ot.NORMALTEXTURE,t)}get specularTexture(){return this._shaderValues.getTexture(ot.SPECULARTEXTURE)}set specularTexture(t){t?this._shaderValues.addDefine(ot.SHADERDEFINE_SPECULARMAP):this._shaderValues.removeDefine(ot.SHADERDEFINE_SPECULARMAP),this._shaderValues.setTexture(ot.SPECULARTEXTURE,t)}get enableTransmission(){return this._enableTransmission}set enableTransmission(t){this._enableTransmission=t,t?this._shaderValues.addDefine(ot.SHADERDEFINE_ENABLETRANSMISSION):this._shaderValues.removeDefine(ot.SHADERDEFINE_ENABLETRANSMISSION)}get transmissionRate(){return this._shaderValues.getNumber(ot.TRANSMISSIONRATE)}set transmissionRate(t){this._shaderValues.setNumber(ot.TRANSMISSIONRATE,t)}get backDiffuse(){return this._shaderValues.getNumber(ot.IBACKDIFFUSE)}set backDiffuse(t){this._shaderValues.setNumber(ot.IBACKDIFFUSE,Math.max(t,1))}get backScale(){return this._shaderValues.getNumber(ot.IBACKSCALE)}set backScale(t){this._shaderValues.setNumber(ot.IBACKSCALE,t)}get thinknessTexture(){return this._shaderValues.getTexture(ot.THINKNESSTEXTURE)}set thinknessTexture(t){t?this._shaderValues.addDefine(ot.SHADERDEFINE_THICKNESSMAP):this._shaderValues.removeDefine(ot.SHADERDEFINE_THICKNESSMAP),this._shaderValues.setTexture(ot.THINKNESSTEXTURE,t)}get transmissionColor(){return this._shaderValues.getVector(ot.TRANSMISSIONCOLOR)}set transmissionColor(t){this._shaderValues.setVector(ot.TRANSMISSIONCOLOR,t)}clone(){let t=new ot;return this.cloneTo(t),t}cloneTo(t){super.cloneTo(t);let e=t;e._enableLighting=this._enableLighting,e._albedoIntensity=this._albedoIntensity,e._enableVertexColor=this._enableVertexColor,this._albedoColor.cloneTo(e._albedoColor)}initShader(){const t=Laya.VertexMesh,e={a_Position:t.MESH_POSITION0,a_Color:t.MESH_COLOR0,a_Normal:t.MESH_NORMAL0,a_Texcoord0:t.MESH_TEXTURECOORDINATE0,a_Texcoord1:t.MESH_TEXTURECOORDINATE1,a_BoneWeights:t.MESH_BLENDWEIGHT0,a_BoneIndices:t.MESH_BLENDINDICES0,a_Tangent0:t.MESH_TANGENT0,a_MvpMatrix:t.MESH_MVPMATRIX_ROW0,a_WorldMat:t.MESH_WORLDMATRIX_ROW0},n={u_Bones:q.PERIOD_CUSTOM,u_DiffuseTexture:q.PERIOD_MATERIAL,u_UvMove:q.PERIOD_MATERIAL,u_SpecularTexture:q.PERIOD_MATERIAL,u_NormalTexture:q.PERIOD_MATERIAL,u_AlphaTestValue:q.PERIOD_MATERIAL,u_DiffuseColor:q.PERIOD_MATERIAL,u_MaterialSpecular:q.PERIOD_MATERIAL,u_Shininess:q.PERIOD_MATERIAL,u_WaterScale:q.PERIOD_MATERIAL,u_TilingOffset:q.PERIOD_MATERIAL,u_WorldMat:q.PERIOD_SPRITE,u_MvpMatrix:q.PERIOD_SPRITE,u_LightmapScaleOffset:q.PERIOD_SPRITE,u_LightMap:q.PERIOD_SPRITE,u_LightMapDirection:q.PERIOD_SPRITE,u_SimpleAnimatorTexture:q.PERIOD_SPRITE,u_SimpleAnimatorParams:q.PERIOD_SPRITE,u_SimpleAnimatorTextureSize:q.PERIOD_SPRITE,u_CameraPos:q.PERIOD_CAMERA,u_Viewport:q.PERIOD_CAMERA,u_ProjectionParams:q.PERIOD_CAMERA,u_View:q.PERIOD_CAMERA,u_ViewProjection:q.PERIOD_CAMERA,u_ReflectTexture:q.PERIOD_SCENE,u_ReflectIntensity:q.PERIOD_SCENE,u_FogStart:q.PERIOD_SCENE,u_FogRange:q.PERIOD_SCENE,u_FogColor:q.PERIOD_SCENE,u_DirationLightCount:q.PERIOD_SCENE,u_LightBuffer:q.PERIOD_SCENE,u_LightClusterBuffer:q.PERIOD_SCENE,u_AmbientColor:q.PERIOD_SCENE,u_ShadowBias:q.PERIOD_SCENE,u_ShadowLightDirection:q.PERIOD_SCENE,u_ShadowMap:q.PERIOD_SCENE,u_ShadowParams:q.PERIOD_SCENE,u_ShadowSplitSpheres:q.PERIOD_SCENE,u_ShadowMatrices:q.PERIOD_SCENE,u_ShadowMapSize:q.PERIOD_SCENE,u_SpotShadowMap:q.PERIOD_SCENE,u_SpotViewProjectMatrix:q.PERIOD_SCENE,u_ShadowLightPosition:q.PERIOD_SCENE,u_AmbientSHAr:q.PERIOD_SCENE,u_AmbientSHAg:q.PERIOD_SCENE,u_AmbientSHAb:q.PERIOD_SCENE,u_AmbientSHBr:q.PERIOD_SCENE,u_AmbientSHBg:q.PERIOD_SCENE,u_AmbientSHBb:q.PERIOD_SCENE,u_AmbientSHC:q.PERIOD_SCENE,"u_DirectionLight.color":q.PERIOD_SCENE,"u_DirectionLight.direction":q.PERIOD_SCENE,"u_PointLight.position":q.PERIOD_SCENE,"u_PointLight.range":q.PERIOD_SCENE,"u_PointLight.color":q.PERIOD_SCENE,"u_SpotLight.position":q.PERIOD_SCENE,"u_SpotLight.direction":q.PERIOD_SCENE,"u_SpotLight.range":q.PERIOD_SCENE,"u_SpotLight.spot":q.PERIOD_SCENE,"u_SpotLight.color":q.PERIOD_SCENE,u_Time:q.PERIOD_SCENE},s={s_Cull:q.RENDER_STATE_CULL,s_Blend:q.RENDER_STATE_BLEND,s_BlendSrc:q.RENDER_STATE_BLEND_SRC,s_BlendDst:q.RENDER_STATE_BLEND_DST,s_DepthTest:q.RENDER_STATE_DEPTH_TEST,s_DepthWrite:q.RENDER_STATE_DEPTH_WRITE},i=q.add("BLINNPHONG1",null,null,!0),a=new Laya.SubShader(e,n);i.addSubShader(a);let o=a.addShaderPass(it,at,null,"Forward");o.renderState.blend=Laya.RenderState.BLEND_ENABLE_ALL,o.renderState.srcBlend=Laya.RenderState.BLENDPARAM_SRC_ALPHA,o.renderState.dstBlend=Laya.RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA,o.renderState.depthWrite=!1,o.renderState.depthTest=Laya.RenderState.DEPTHTEST_GREATER,a.addShaderPass(J,Z,s,"Forward"),a.addShaderPass(nt,st,s,"ShadowCaster")}set uvMove(t){this._shaderValues.setNumber(this.UvMove,t)}}ot.IsInit=!1,ot.RENDERMODE_OPAQUE=0,ot.RENDERMODE_CUTOUT=1,ot.RENDERMODE_TRANSPARENT=2,ot.ALBEDOTEXTURE=q.propertyNameToID("u_DiffuseTexture"),ot.NORMALTEXTURE=q.propertyNameToID("u_NormalTexture"),ot.SPECULARTEXTURE=q.propertyNameToID("u_SpecularTexture"),ot.ALBEDOCOLOR=q.propertyNameToID("u_DiffuseColor"),ot.MATERIALSPECULAR=q.propertyNameToID("u_MaterialSpecular"),ot.SHININESS=q.propertyNameToID("u_Shininess"),ot.TILINGOFFSET=q.propertyNameToID("u_TilingOffset"),ot.TRANSMISSIONRATE=q.propertyNameToID("u_TransmissionRate"),ot.IBACKDIFFUSE=q.propertyNameToID("u_BackDiffuse"),ot.IBACKSCALE=q.propertyNameToID("u_BackScale"),ot.THINKNESSTEXTURE=q.propertyNameToID("u_ThinknessTexture"),ot.TRANSMISSIONCOLOR=q.propertyNameToID("u_TransmissionColor");class rt{static setLevelData(t){const e=this.levelData,n=t["level.json"];if(n&&n.length)for(let t=0;t<n.length;t++){const s=n[t];e[s.id]=s}}static setPropData(t){const e=this.propData,n=t["prop.json"];if(n&&n.length)for(let t=0;t<n.length;t++){const s=n[t];e[s.id]=s}}static GetRandomProp(){const t=this.propData,e=d.GetRandom(100,1),n=Object.keys(t);let s=0,i=0,a=0;for(;s<n.length;){const o=parseInt(n[s]);if(e<=(i+=100*t[o].drop)){a=o;break}s++}return a}}rt.levelData={},rt.propData={};const lt={1:{cd:15e3,icon:"lobby/skill1.png"},2:{cd:1e4,icon:"lobby/skill2.png"},3:{cd:15e3,icon:"lobby/skill3.png"},4:{cd:1e4,icon:"lobby/skill4.png"}};var ht;!function(t){t.Idle="backShot",t.Walk="walkShot",t.Death="death"}(ht||(ht={}));const ct={1:{all:217,anim:{idle:[0,39,1],walkShot:[42,72,1],idleShot:[74,109,1],backShot:[112,146,1],death:[148,217,0]}}},dt={1:{all:461,anim:{idle:[188,308,1],walk:[26,72,1],run:[0,24,1],attack1:[74,153,0],attack2:[155,186,0],hit:[401,461,0],death:[310,399,0]}},2:{all:461,anim:{idle:[188,308,1],walk:[26,72,1],run:[0,24,1],attack1:[74,153,0],attack2:[155,186,0],hit:[401,461,0],death:[310,399,0]}},3:{all:319,anim:{idle:[0,60,1],walk:[158,190,1],attack1:[132,156,0],death:[192,272,0],jump:[60,130,0],sweep:[274,319,0]}},4:{all:461,anim:{idle:[188,308,1],walk:[26,72,1],run:[0,24,1],attack1:[74,153,0],attack2:[155,186,0],hit:[401,461,0],death:[310,399,0]}},1001:{all:319,anim:{idle:[0,60,1],walk:[158,190,1],attack1:[132,156,0],death:[192,272,0],jump:[60,130,0],sweep:[274,319,0]}}},mt={1:{idle:"idle",walk:"walk",run:"run",hit:"hit",attack1:"attack1",death:"death",$dash:"attack2",$throw:"attack1"},2:{idle:"idle",walk:"walk",run:"run",hit:"hit",attack1:"attack1",death:"death",$dash:"attack2",$throw:"attack1"},3:{idle:"idle",walk:"walk",run:"walk",attack1:"attack1",death:"death",$dash:"attack1",$throw:"sweep",$jump:"jump",$sweep:"sweep"},4:{idle:"idle",walk:"walk",run:"run",hit:"hit",attack1:"attack1",death:"death",$dash:"attack2",$throw:"attack1"},1001:{idle:"idle",walk:"walk",run:"walk",attack1:"attack1",death:"death",$dash:"attack1",$throw:"sweep",$jump:"jump",$sweep:"sweep"}},ut={1:{hit:1820,attack1:2570,death:2e3,$dash:1e3,$throw:1e3},2:{hit:1820,attack1:2570,death:2e3,$dash:1e3,$throw:1e3},3:{hit:0,attack1:800,death:2e3,$dash:500,$throw:300},4:{hit:1820,attack1:2570,death:2e3,$dash:1e3,$throw:1e3},1001:{hit:0,attack1:800,death:2e3,$dash:500,$throw:300}};var pt;!function(t){t.Idle="idle",t.Walk="walk",t.Run="run",t.Hit="hit",t.Attack1="attack1",t.Death="death",t.$Dash="$dash",t.$Throw="$throw",t.$Jump="$jump",t.$Sweep="$sweep"}(pt||(pt={}));class gt extends Y{constructor(){super(),this.ins=null,this.animator=null,this.enemyData=null,this._enemyState=pt.Run}get enemyState(){return this._enemyState}set enemyState(t){if(this._enemyState=t,"$"==t[0])return;const e=mt[this.enemyData.model][t];e&&(this.animator.play(e,0),this.animator.play(t==pt.Idle?pt.Walk:e,1))}onEnable(){const t=this.owner,e=te.Instance;this.ins=e;const n=t.getComponent(Laya.Animator);this.animator=n,1==n.getControllerLayer(0)._states.length&&this.initAnim(),this.enemyState=pt.Idle,i.on(W.OnGameState,this,()=>{const t=e.gameState!=N.Start?.01:1;n.speed=t}),i.on(W.OnAnimState,this,t=>{n.speed=t}),n.speed=1}onHit(){const t=this.enemyState;if(t==pt.Death)return;if(t==pt.Hit)return;if(t==pt.Attack1)return;if("$"==t[0])return;const e=ut[this.enemyData.model].hit;e&&(this.enemyState=pt.Hit,Laya.timer.clearAll(this),Laya.timer.once(e,this,()=>{this.enemyState==pt.Hit&&(this.enemyState=pt.Run)}))}onAtt(){const t=this.enemyState;t!=pt.Death&&t!=pt.Attack1&&"$"!=t[0]&&(this.enemyState=pt.Attack1,Laya.timer.clearAll(this),Laya.timer.once(ut[this.enemyData.model].attack1,this,()=>{this.enemyState==pt.Attack1&&(this.enemyState=pt.Run)}))}onDeath(){if(this.enemyState!=pt.Death)return new Promise((t,e)=>{this.enemyState=pt.Death,Laya.timer.clearAll(this),Laya.timer.once(ut[this.enemyData.model].death,this,()=>{t()})})}initAnim(){const t=this.enemyData,e=this.animator,n=dt[t.model],s=n.all,i=n.anim,a=e.getDefaultState().clip,o=e.getControllerLayer(),r=e.getControllerLayer(1);for(const t in i){let e=i[t];const n=new Laya.AnimatorState;n.name=t,n.clipStart=e[0]/s,n.clipEnd=e[1]/s,n.clip=a;const l=n.clone();o.addState(n),r.addState(l)}a.islooping=!0}onDisable(){super.onDisable()}onUpdate(){}}class yt extends Y{constructor(){super(),this._path=null,this.speed=.2,this.currIndex=0,this.timer2=0,this.duration=0,this.lastPos=this.vec3(),this.stopHandler=null,this.endHandler=null,this.rotateHandler=null,this.enabled=!1}get path(){return this._path}set path(t){const e=this.path;if(e&&t.length>2){let n=!0;for(let s=1;s<t.length-1;s++){const i=t[s],a=e[s];if(!a||!Laya.Vector3.equals(i,a)){n=!1;break}}if(n)return}t.length&&(this._path=t,this.currIndex=0,this.updateDuration())}updateDuration(){if(this.currIndex>=this.path.length-1)return this.enabled=!1,void(this.endHandler&&this.endHandler());const t=this.path[this.currIndex],e=this.path[this.currIndex+1],n=Laya.Vector3.distance(this.vec3(t.x,0,t.z),this.vec3(e.x,0,e.z));if(this.duration=n/this.speed,this.duration||(this.duration=this.speed),this.timer2=0,(!this.rotateHandler||!this.rotateHandler())&&n){const n=this.vec3(e.x-t.x,0,-(e.z-t.z)),s=this.quat();Laya.Quaternion.rotationLookAt(n,this.vec3(0,1,0),s),this.owner.transform.rotation=s}}onDisable(){}onUpdate(){if(!this.enabled)return;if(this.stopHandler&&this.stopHandler())return;const t=this.owner,e=this.path[this.currIndex],n=this.path[this.currIndex+1];n&&e?(this.timer2+=this.speed,Laya.Vector3.lerp(e,n,this.timer2/this.duration,this.lastPos),t.transform.position=this.lastPos,this.timer2>=this.duration&&(this.currIndex++,this.updateDuration())):this.enabled=!1}}class ft extends Y{constructor(){super(),this.ins=null,this.navAgent=null,this.shapeCast=new Laya.BoxColliderShape(.15,.1,.15),this.rayHitRes=new Laya.HitResult,this._speed=.1,this.isAgent=!1}get speed(){return this._speed}set speed(t){this._speed=t,this.navAgent.speed=t}onEnable(){const t=te.Instance;this.ins=t;const e=this.owner;e.getComponent(Laya.PhysicsCollider).collisionGroup=w.Enemy;const n=v.GetComponent(yt,e);this.navAgent=n,this.speed=.1;const s=e.getComponent(gt);n.stopHandler=(()=>s.enemyState!=pt.Run||t.gameState!=N.Start),this.isAgent=!1}loopFindPath(){this.findPath(),Laya.timer.clearAll(this),Laya.timer.loop(1e3+500*Math.random(),this,this.findPath),this.isAgent=!0}endFindPath(){const t=this.navAgent;t.path=[],t.enabled=!1,Laya.timer.clearAll(this),this.isAgent=!1}findPath(){const t=this.ins,e=t.gameScene.physicsSimulation,n=this.shapeCast,s=this.rayHitRes,i=this.owner,a=t.getEnemyTarget(),o=this.navAgent;if(s.collider=null,e.shapeCast(n,i.transform.position,a.transform.position,s,null,null,w.Default,w.All^w.Player^w.Enemy),s.collider&&"land"!=s.collider.owner.name){let t=NavMesh.findPath(i.transform.position,a.transform.position,"game",0);if(t&&t.length){let e=[];for(let n=0;n<t.length;n++){const s=t[n];e.push(this.vec3(s.x,0,s.z))}o.path=[i.transform.position.clone()].concat(e),o.enabled=!0}else o.enabled=!1}else o.path=[i.transform.position.clone(),a.transform.position.clone()],o.enabled=!0}onDisable(){super.onDisable()}onUpdate(){}}class St extends _{constructor(){super(),this.hpBar=null,this.hpBar2=null,this.tValue1Vec=this.vec3(),this.tValue2Vec=this.vec3(),this.tValue3Vec=this.vec3(),this.ins=null,this.currValue=1,this.lastTime=0,this.target=null,this.autoHide=!0}onEnable(){this.ins=te.Instance;const t=this.owner;this.updateHpBar(1),this.updatePos(),t.visible=!1}updateHpBar(t){const e=this.owner;e.visible||(e.visible=!0),t=Math.min(t,1),this.hpBar.value=t,this.currValue=t,this.lastTime=Date.now()}updatePos(){const t=this.owner,e=this.ins,n=v.Project3DTo2D(e.camera,this.target.transform.position);t.pos(n.x,n.y)}onDisable(){super.onDisable(),this.recover(this.owner)}onUpdate(){const t=this.owner;this.autoHide&&this.lastTime&&Date.now()>=this.lastTime+2e3&&t.visible&&(t.visible=!1),this.updatePos(),this.tValue1Vec.x=this.hpBar2.value,this.tValue2Vec.x=this.currValue,Laya.Vector3.lerp(this.tValue1Vec,this.tValue2Vec,.08,this.tValue3Vec),this.hpBar2.value=this.tValue3Vec.x}}class Dt extends _{constructor(){super(),this.mDuration=300}setData(t,e=300){const n="string"==typeof t?t:`game/prop${t}.png`;this.owner.skin=n,this.mDuration=e}onEnable(){const t=this.owner;t.alpha=0;const e=t.y-200;Laya.Tween.to(t,{alpha:1},500,Laya.Ease.circOut),Laya.timer.once(this.mDuration,this,()=>{Laya.Tween.to(t,{alpha:0,y:e},300,Laya.Ease.circIn,Laya.Handler.create(this,()=>{t.removeSelf()}))})}onDisable(){super.onDisable(),this.recover(this.owner)}}class Lt extends Y{constructor(){super(),this.ins=null,this.type=null,this.iconNode=null,this.playerComp=null}onEnable(){this.ins=te.Instance,this.iconNode=this.owner.getChildByName("icon"),this.playerComp=this.ins.player1.getComponent(wt),this.owner.getComponent(Laya.PhysicsCollider).collisionGroup=w.Enemy,this.owner.__ignore__=!0}onDisable(){super.onDisable(),this.iconNode.transform.localRotationEulerY=0,this.owner.transform.localScale=this.vec3(1,1,1),this.owner.__ignore__&&delete this.owner.__ignore__,this.recover(this.owner)}setPropData(t){this.type=t}onTriggerEnter(t){const e=this.owner,n=t.owner.transform.position;if(this.type==$.Blood&&this.playerComp.currHp>=this.playerComp.hp);else{Laya.Tween.to(e.transform,{localPositionX:n.x,localPositionY:n.y+1,localPositionZ:n.z,localScaleX:.1,localScaleY:.1,localScaleZ:.1},500,null,Laya.Handler.create(this,()=>{e.removeSelf()})),i.event(W.OnGameProp,this.type),b.sound(R.PlayerProp);const t=v.GetRes(x.PlayerProp,!0),s=v.InstantiatePrefab(x.PlayerProp,t),a=Laya.stage;s.getComponent(Dt).setData(this.type),s.pos(a.width/2,a.height/2-130),Laya.stage.addChild(s)}}onUpdate(){this.ins.gameState==N.Start&&(this.iconNode.transform.localRotationEulerY-=1)}}class Ct extends _{constructor(){super()}onEnable(){}onDisable(){super.onDisable(),this.recover(this.owner)}}class Et extends Y{constructor(){super(),this.ins=null,this.hpBarComp=null,this.playerComp=null,this.enemyAnim=null,this.enemyAgent=null,this.eid=0,this.effectNodes=[],this.rightHand=null,this.rightUpLeg=null,this.enemyData=null,this.currHp=100,this.canSkill=!1,this.eid=Et.Eid++}onEnable(){const t=this.enemyData,e=this.owner;if(!t)return void e.removeSelf();this.ins=te.Instance,this.enemyAnim=e.getComponent(gt),this.enemyAgent=e.getComponent(ft),this.enemyAgent.speed=.1*t.speed;const n=v.GetRes(x.EnemyHpBar,!0),i=v.InstantiatePrefab(x.EnemyHpBar,n),a=v.GetComponent(St,i);a.target=e.getChildByName("top"),s.Instance.hpBarNode.addChild(i),this.hpBarComp=a,this.currHp=t.hp,this.canSkill=!1,Object.keys(t.skills).length&&this.initSkill(),this.rightHand=this.find("Hips/Spine/Spine1/Spine2/RightShoulder/RightArm/RightForeArm/RightHand/RightHandIndex1",e),this.rightUpLeg=this.find("Hips/RightUpLeg",e),this.playerComp=this.ins.player1.getComponent(wt);const o=d.GetRandom(4,1);b.sound(R["EnemyAppear"+o]);const r=e.getChildByName("mark");r&&(r.active=t.id>1e3)}initSkill(){const t=this.enemyData.skills,e=Object.keys(t),n=this.enemyAnim,s=()=>{const a=parseInt(e[d.GetRandom(e.length-1,0)]),o=t[a].cd;Laya.timer.once(1e3*o,this,s),this.ins.gameState==N.Start&&this.canSkill&&n.enemyState==pt.Run&&i.event(W.OnEnemySkill,[a,this.owner])};s()}onHit(t=0){const e=this.enemyData,n=this.enemyAnim;if(n.enemyState==pt.Death)return;e.id<1e3&&n.onHit();const s=this.hpBarComp.owner;s.visible||(s.visible=!0),this.currHp-=t*(1-e.reduction),this.hpBarComp.updateHpBar(this.currHp/e.hp),this.currHp<=0&&(Laya.timer.once(200,this,()=>{s.visible=!1}),this.onDeath())}onAtt(){this.enemyAnim.onAtt()}onDeath(t){const e=this.owner,n=this.enemyAnim,s=this.ins.playerData,a=this.enemyData;t||i.event(W.OnEnemyDeath,[this.eid,this.enemyData]);const o=d.GetRandom(4,1);b.sound(R["EnemyDie"+o]),t||(s.score+=a.integral),n.onDeath().then(()=>{e.removeSelf();const n=this.rightUpLeg.transform.position;n.y=.02;const s=v.GetRes(M.EnemyDeath1),i=v.GetRes(M.EnemyDeath2),a=v.InstantiateSprite3D(s,M.EnemyDeath1);v.GetComponent(Ct,a),a.transform.position=n,this.ins.gameScene.addChild(a);const o=v.InstantiateSprite3D(i,M.EnemyDeath2);v.GetComponent(Ct,o),o.transform.position=n,this.ins.gameScene.addChild(o),setTimeout(()=>{a.removeSelf(),o.removeSelf()},1e3);const r=rt.GetRandomProp(),l=j[r];if(r&&l&&!t){const t=v.GetRes(l),e=v.InstantiateSprite3D(t,l);v.GetComponent(Lt,e).setPropData(r),e.transform.position=n,this.ins.gameScene.addChild(e)}})}onDisable(){super.onDisable(),this.hpBarComp&&this.hpBarComp.owner.removeSelf();const t=this.effectNodes;for(let e=0;e<t.length;e++){t[e].removeSelf()}t.length=0;const e=this.owner.__interval__;e&&(clearInterval(e),delete this.owner.__interval__),this.owner.__stopMove__&&delete this.owner.__stopMove__,this.recover(this.owner)}isInAgentRange(t=3.5){const e=this.ins.getEnemyTarget(),n=this.owner;let s=!1;return NavMesh.Vector3.distanceToSquared(e.transform.position,n.transform.position)<=t*t&&(s=!0),s}onUpdate(){if(this.ins.gameState!=N.Start)return;const t=this.enemyAnim,e=t.enemyState,n=this.enemyAgent;this.owner.__stopMove__||e==pt.Hit||e==pt.Death||e==pt.Attack1||"$"==e[0]?n.isAgent&&n.endFindPath():(this.isInAgentRange(.3)?(this.onAtt(),n.isAgent&&n.endFindPath()):this.isInAgentRange(100)?(e!=pt.Run&&(t.enemyState=pt.Run),n.isAgent||n.loopFindPath()):e==pt.Run&&(this.enemyAnim.enemyState=pt.Idle,n.isAgent&&n.endFindPath()),this.isInAgentRange(4)?this.canSkill=!0:this.canSkill=!1)}}Et.Eid=1;class bt extends Y{constructor(){super()}onEnable(){const t=te.Instance,e=this.owner,n=[],s=t.gameScene.physicsSimulation,i=new Laya.SphereColliderShape(.3);v.Schedule(this,()=>{const a=e.transform.position.clone();if(a.y=0,s.shapeCastAll(i,a,this.vec3(a.x,2,a.z),n,null,null,w.Default,w.Enemy),n&&n.length)for(let e=0;e<n.length;e++){const s=n[e];if(s&&s.collider){const e=s.collider.owner.getComponent(Et);if(e){const n=t.playerData;let s=n.atk*n.skillRatio;e.onHit(s)}}}},0,100,10)}onDisable(){super.onDisable(),this.recover(this.owner)}}class vt extends Y{constructor(){super(),this.end=null}onEnable(){const t=te.Instance,e=this.owner,n=[],s=t.gameScene.physicsSimulation,i=new Laya.BoxColliderShape(.3,1,.3),a=e.transform.position.clone();v.Schedule(this,()=>{if(s.shapeCastAll(i,a,this.end,n,null,null,w.Default,w.Enemy),n&&n.length)for(let e=0;e<n.length;e++){const s=n[e];if(s&&s.collider){const e=s.collider.owner.getComponent(Et);if(e){const n=t.playerData;let s=n.atk*n.skillRatio;e.onHit(s)}}}},0,1e3,5,null,()=>{e.removeSelf()})}onDisable(){super.onDisable(),this.recover(this.owner)}}class Tt extends Y{constructor(){super()}onEnable(){const t=te.Instance,e=this.owner,n=e.getChildByName("end"),s=e.scene,i=[],a=new Laya.BoxColliderShape(.2,.1,.2);Laya.timer.once(250,this,()=>{if(s.physicsSimulation.shapeCastAll(a,e.transform.position,n.transform.position,i,null,null,w.Default,w.Enemy),i&&i.length)for(let e=0;e<i.length;e++){const n=i[e];if(n&&n.collider){const e=n.collider.owner.getComponent(Et);if(e){const n=t.playerData;let s=n.atk;d.GetRandom(100,1)<=n.crit&&(s*=n.critProb),s*=n.atkData.attNumb,e.onHit(s)}}}}),Laya.timer.once(500,this,()=>{e.removeSelf()})}onDisable(){super.onDisable(),this.recover(this.owner)}}class It extends Y{constructor(){super(),this.ins=null,this.start=null,this.target=null,this.lightned=[],this.tForwVec=this.vec3(),this.tPosVec=this.vec3()}onEnable(){const t=te.Instance;this.ins=t;const e=this.owner,n=this.target.getComponent(Et);if(n){const e=t.playerData;let s=e.atk;d.GetRandom(100,1)<=e.crit&&(s*=e.critProb),s*=e.atkData.attNumb,n.onHit(s)}this.onUpdate(),Laya.timer.once(200,this,()=>{e.removeSelf()}),Laya.timer.once(50,this,()=>{const e=t.playerData.atkData.shoNumbe;if(this.lightned.length<e){const t=this.ins,e=this.getMinEnemy(2);if(e){this.lightned.push(e.getComponent(Et).eid);const n=v.GetRes(H[7]),s=v.InstantiateSprite3D(n,H[7]),i=v.GetComponent(It,s);i.lightned=this.lightned,i.start=this.target,i.target=e,t.gameScene.addChild(s)}}})}getMinEnemy(t=1){const e=this.ins.enemyMgr.enemys,n=this.target.transform.position;let s=0,i=null;for(let a=0;a<e.length;a++){const o=e[a];if(!o)continue;const r=o.getComponent(Et),l=o.transform.position;let h=(l.x-n.x)*(l.x-n.x)+(l.z-n.z)*(l.z-n.z);this.lightned.indexOf(r.eid)&&h<=t*t&&(!s||h<s)&&(s=h,i=o)}return i}onDisable(){super.onDisable(),this.recover(this.owner)}onUpdate(){const t=this.start.transform,e=this.target.transform;if(t&&e){const n=this.owner,s=this.tPosVec;s.x=t.position.x,s.y=It.Y,s.z=t.position.z,n.transform.position=s;const i=this.tForwVec;Laya.Vector3.subtract(t.position,e.position,i),i.y=0,i.x/=1.8,i.z/=1.8,n.transform.worldMatrix.setForward(i)}}}It.Y=0;class At extends Y{constructor(){super()}onEnable(){const t=te.Instance,e=this.owner,n=[],s=t.gameScene.physicsSimulation,i=new Laya.SphereColliderShape(1),a=e.transform.position.clone();if(a.y=0,s.shapeCastAll(i,a,this.vec3(a.x,2,a.z),n,null,null,w.Default,w.Enemy),n&&n.length)for(let e=0;e<n.length;e++){const s=n[e];if(s&&s.collider){const e=s.collider.owner.getComponent(Et);if(e){const n=t.playerData;let s=n.atk*n.atkData.attNumb;e.onHit(s)}}}}onDisable(){super.onDisable(),this.recover(this.owner)}}class _t extends Y{constructor(){super()}onEnable(){const t=te.Instance,e=this.owner,n=[],s=t.gameScene.physicsSimulation,i=new Laya.SphereColliderShape(.5),a=e.transform.position.clone();if(a.y=0,s.shapeCastAll(i,a,this.vec3(a.x,2,a.z),n,null,null,w.Default,w.Enemy),n&&n.length)for(let t=0;t<n.length;t++){const e=n[t];if(e&&e.collider){const t=e.collider.owner,n=t.getComponent(Et);if(n&&"$"!=n.enemyAnim.enemyState[0]){const e=this.vec3();t.transform.getForward(e);const n=t.transform.localPosition;t.__stopMove__=1,Laya.Tween.clearAll(t.transform),Laya.Tween.to(t.transform,{localPositionX:n.x+.1*e.x,localPositionZ:n.z+.1*e.z},100,null,Laya.Handler.create(this,()=>{t.__stopMove__=0}))}}}}onDisable(){super.onDisable(),this.recover(this.owner)}}class kt extends _{constructor(){super(),this.ins=null,this.end=null,this.hitResult=new Laya.HitResult,this.forward=this.vec3(),this.boxShape=new Laya.BoxColliderShape(.2,.2,.2),this.tDirVec=this.vec3(),this.tRotaQua=this.quat(),this.bulletId=null,this.target=null,this.track=!0,this.speed=1,this.belong=1,this.autoTrack=!0}onEnable(){this.ins=te.Instance;const t=this.owner;this.end=t.getChildByName("end"),Laya.timer.once(1e3/this.speed,this,()=>{t.removeSelf()}),t.transform.getForward(this.forward),this.autoTrack=!0}onDisable(){super.onDisable(),this.hitResult.collider=null,this.recover(this.owner)}onHit(t){const e=this.bulletId,n=F[e],s=v.GetRes(n),i=v.InstantiateSprite3D(s,n);5==e||4==e||9==e?v.GetComponent(At,i):8==e?v.GetComponent(_t,i):v.GetComponent(Ct,i),v.ScaleParticle3DNode(i,{1:1,2:1,3:1,4:1,5:3,8:1,9:1}[e]||1),i.transform.position=t.point,this.ins.gameScene.addChild(i),setTimeout(()=>{i.removeSelf()},1e3)}onUpdate(){if(this.ins.gameState!=N.Start)return;const t=this.target;if(!this.target)return;const e=this.owner;if(!e.parent)return;const n=e.scene;if(this.hitResult.collider=null,n.physicsSimulation.shapeCast(this.boxShape,e.transform.position,this.end.transform.position,this.hitResult,null,null,w.Default,w.All^w.Player),this.hitResult.collider){const t=this.hitResult.collider.owner,n=t.getComponent(Et);if(n){const t=this.ins.playerData;let e=0;if(1==this.belong){e=t.atk,d.GetRandom(100,1)<=t.crit&&(e*=t.critProb),e*=Math.max(t.atkData.attNumb,1)}else if(2==this.belong){const n=t.soldierData;if(n){e=n.curt,d.GetRandom(100,1)<=100*n.strike&&(e*=1.5+n.strHurt),e*=n.mattNum}}else{const n=t.uavData;if(n){e=n.curt,d.GetRandom(100,1)<=100*n.strike&&(e*=1.5+n.strHurt),e*=n.mattNum}}n.onHit(e)}if(!(n&&n.enemyAnim.enemyState==pt.Death||t.__ignore__))return e.removeSelf(),void this.onHit(this.hitResult)}const s=this.tDirVec;if(this.track&&this.autoTrack&&t&&t.parent){const n=t.transform.position,i=e.transform.position,a=this.tRotaQua;s.x=n.x-i.x,s.y=0,s.z=-(n.z-i.z),Math.abs(s.x)>=.1||Math.abs(s.z)>=.1?(Laya.Quaternion.rotationLookAt(s,this.ins.UpVec3,a),e.transform.rotation=a,e.transform.getForward(this.forward)):this.autoTrack=!1}const i=this.forward;s.x=.05*-i.x*this.speed,s.y=3==this.belong?.05*-i.y*this.speed:0,s.z=.05*-i.z*this.speed,e.transform.translate(s,!1)}}class Pt extends Y{constructor(){super()}onEnable(){const t=te.Instance,e=this.owner,n=[],s=t.gameScene.physicsSimulation,i=new Laya.SphereColliderShape(1.5),a=e.transform.position.clone();a.y=0,v.Schedule(this,()=>{if(s.shapeCastAll(i,a,this.vec3(a.x,2,a.z),n,null,null,w.Default,w.Enemy),n&&n.length)for(let e=0;e<n.length;e++){const s=n[e];if(s&&s.collider){const e=s.collider.owner,n=e.getComponent(Et);if(n){const s=t.playerData;let i=s.atk*s.skillRatio;n.onHit(i);const a=this.vec3();e.transform.getForward(a);const o=e.transform.localPosition;e.__stopMove__=1,Laya.Tween.clearAll(e.transform),Laya.Tween.to(e.transform,{localPositionX:o.x+.1*a.x,localPositionZ:o.z+.1*a.z},100,null,Laya.Handler.create(this,()=>{e.__stopMove__=0}))}}}},0,150,3),Laya.timer.once(1e3,this,()=>{e.removeSelf()})}onDisable(){super.onDisable(),this.recover(this.owner)}}class Nt extends Y{constructor(){super(),this.ins=null,this.playerComp=null}onEnable(){this.ins=te.Instance,this.playerComp=this.ins.player1.getComponent(wt)}onDisable(){}onTriggerEnter(t){if(t&&t.owner){const e=this.playerComp,n=t.owner,s=n.getComponent(Et);if(s){const t=s.enemyAnim,i=()=>{if(this.ins.gameState!=N.Start)return;if(t.enemyState!=pt.Death){if(this.ins.gameState!=N.Start)return;e.onHit(s.enemyData.atk)}};i();const a=setInterval(i,1e3);n.__interval__=a}else n.__enemySkill__&&e.onHit(n.__enemySkill__)}}onTriggerExit(t){if(t&&t.owner){const e=t.owner,n=e.__interval__;n&&(clearInterval(n),e.__interval__=null)}}}class wt extends Y{constructor(){super(),this.ins=null,this.timer2=0,this.shotGun=null,this.startPos=null,this.startPos2=null,this.shotBody=null,this.shotRange=null,this.shotRangeMat=null,this.selfMats=[],this.hpBarComp=null,this.propAtt=null,this.propAtt2=null,this.propShield=null,this.propShield2=null,this.propSpeed=null,this.propSpeed2=null,this.propBloods=[],this.mBodyScale=1,this.tShoted=!1,this.tRotaQuat=this.quat(),this.tDirVec=this.vec3(),this.tDirVec2=this.vec3(),this.tRangeRoatVec=this.vec3(90,0,0),this.albColor1=this.vec4(1,1,1,1),this.albColor2=this.vec4(.4,0,0,.2),this.hp=1e3,this.currHp=1e3,this.speed=.0025,this.currSpeed=.0025,this.canLoss=!0,this.shootSpeed=300,this.shotEffect=null}onEnable(){const t=te.Instance,e=this.owner,n=t.playerData;this.hp=this.currHp=n.hp,this.shootSpeed=n.atkData.attSpeed;const a=B.tankData[n.tank];this.speed=this.currSpeed=.0025*a.dex,this.tShoted=!1,this.ins=t,this.timer2=0,this.shotRange=e.getChildByName("range"),this.shotRangeMat=this.shotRange.meshRenderer.sharedMaterial;const o=v.GetRes(x.PlayerHpBar,!0),r=v.InstantiatePrefab(x.PlayerHpBar,o);r.scale(1,1);const l=v.GetComponent(St,r);l.target=e.getChildByName("top"),l.autoHide=!1,s.Instance.hpBarNode.addChild(r),r.visible=!0,this.hpBarComp=l,i.on(W.OnSkillFire,this,this.shotFire),i.on(W.OnSkillAtk,this,this.onPropAtt),i.on(W.OnSkillPulse,this,this.shotPulse),i.on(W.OnGameProp,this,t=>{t==$.Att?this.onPropAtt(!0):t==$.Speed?this.onPropSpeed():t==$.Blood?this.onPropBlood():t==$.Shield&&this.onPropShield()})}initMaterail(t){const e=this.owner,n=e.getChildByName("gun");this.shotGun=n,this.startPos=n.getChildByName("start"),this.startPos2=n.getChildByName("start2"),It.Y=this.startPos.transform.position.y,this.shotEffect=n.getChildByName("shotEffect").getChildAt(0);const s=e.getChildByName("body");this.shotBody=s,this.mBodyScale=s.transform.localScaleX;const i=s.getChildByName("body");this.albColor1=i.meshRenderer.sharedMaterial.albedoColor;const a=new ot;a.uvMove=0,a.albedoColor=this.albColor1,a.albedoIntensity=2.56,a.specularColor=this.vec4(1,1,1,1),a.shininess=.24;const o=v.GetRes(U[t]);a.albedoTexture=o,a.renderQueue=Laya.Material.RENDERQUEUE_ALPHATEST+1,a.blendSrc=Laya.RenderState.BLENDPARAM_SRC_ALPHA,a.blendDst=Laya.RenderState.BLENDPARAM_ONE_MINUS_SRC_ALPHA,i.meshRenderer.material=a;const r=a.clone();return r.renderQueue=Laya.Material.RENDERQUEUE_ALPHATEST+2,n.meshRenderer.material=r,this.selfMats.push(a,r),a}addCharacter(t){t.addComponent(Nt);const e=t.addComponent(Laya.CharacterController),n=new Laya.BoxColliderShape(.4,.4,.4);return e.colliderShape=n,e.restitution=0,e.friction=0,e.rollingFriction=0,e.gravity=this.vec3(),e.collisionGroup=w.Player,e}onDisable(){this.hpBarComp.owner.removeSelf(),this.propAtt&&(this.propAtt.removeSelf(),this.propAtt=null,clearTimeout(this.propAtt2),this.propAtt2=null),this.propShield&&(this.propShield.removeSelf(),this.propShield=null,clearTimeout(this.propShield2),this.propShield2=null),this.propSpeed&&(this.propSpeed.removeSelf(),this.propSpeed=null,clearTimeout(this.propSpeed2),this.propSpeed2=null);for(let t=0;t<this.propBloods.length;t++){this.propBloods[t].removeSelf()}this.propBloods.length=0,super.onDisable()}playerScale(t,e=1.5,n=500){Laya.Tween.clearAll(t),Laya.Tween.to(t.transform,{localScaleX:e,localScaleY:e,localScaleZ:e},n)}onPropAtt(t){const e=rt.propData[$.Att].num1.split(","),n=parseFloat(e[0]),s=1+parseFloat(e[1]),i=parseFloat(e[2]),a=this.ins.playerData;if(this.propAtt)clearTimeout(this.propAtt2),this.propAtt2=null,t||(this.playerScale(this.shotBody,1.3*this.mBodyScale),this.playerScale(this.shotGun,1.3*this.mBodyScale));else{const e=this.owner.getChildByName("att"),i=v.GetRes(M.PropAtt2),o=v.InstantiateSprite3D(i,M.PropAtt2);this.propAtt=o,v.GetComponent(Ct,o),e.addChild(o),t||(this.playerScale(this.shotBody,1.3*this.mBodyScale),this.playerScale(this.shotGun,1.3*this.mBodyScale)),a.atk*=s,this.shootSpeed-=n}this.propAtt2=setTimeout(()=>{this.propAtt.removeSelf(),this.propAtt=null,this.propAtt2=null,a.atk=a.atk0,this.shootSpeed=a.atkData.attSpeed,this.shotBody.transform.localScaleX!=this.mBodyScale&&(this.playerScale(this.shotBody,this.mBodyScale),this.playerScale(this.shotGun,this.mBodyScale))},1e3*i)}onPropShield(){if(this.propShield)clearTimeout(this.propShield2),this.propShield2=null;else{const t=this.owner.getChildByName("shield"),e=v.GetRes(M.PropShield2),n=v.InstantiateSprite3D(e,M.PropShield2);this.propShield=n,v.GetComponent(Ct,n),t.addChild(n)}const t=rt.propData[$.Shield].num1.split(","),e=parseFloat(t[1]);this.propShield2=setTimeout(()=>{this.propShield.removeSelf(),this.propShield=null,this.propShield2=null},1e3*e)}onPropSpeed(){const t=rt.propData[$.Speed].num1.split(","),e=1+parseFloat(t[0]),n=parseFloat(t[1]);if(this.propSpeed)clearTimeout(this.propSpeed2),this.propSpeed2=null;else{const t=this.owner,n=v.GetRes(M.PropSpeed2),s=v.InstantiateSprite3D(n,M.PropSpeed2),i=1/t.transform.localScaleX*-.1;s.transform.localPositionZ=i,this.propSpeed=s,v.GetComponent(Ct,s),t.addChild(s),this.currSpeed=this.speed*e}this.propSpeed2=setTimeout(()=>{this.currSpeed=this.speed,this.propSpeed.removeSelf(),this.propSpeed=null,this.propSpeed2=null},1e3*n)}onPropBlood(){const t=this.owner,e=v.GetRes(M.PropBlood2),n=v.InstantiateSprite3D(e,M.PropBlood2);this.propBloods.push(n);const s=1/t.transform.localScaleX;n.transform.localScale=this.vec3(s,s,s),v.GetComponent(Ct,n),t.addChild(n);const i=rt.propData[$.Blood].num1.split(","),a=parseFloat(i[0]);this.currHp+=this.hp*a,this.currHp=Math.min(this.currHp,this.hp),this.hpBarComp.updateHpBar(this.currHp/this.hp),Laya.timer.once(3e3,this,()=>{n.removeSelf(),this.propBloods.splice(this.propBloods.indexOf(n),1)})}onPropBullet(t){const e=rt.propData[t].num1.split(","),n=parseFloat(e[0]),s=B.tankAttData[n];this.ins.playerData.propBullData=s,this.shootSpeed=s.attSpeed}onHit(t=0){if(this.propShield)return;if(!this.canLoss)return;this.canLoss=!1;const e=this.hpBarComp.owner;e.visible||(e.visible=!0),this.currHp-=t,this.currHp=Math.max(this.currHp,0),this.hpBarComp.updateHpBar(this.currHp/this.hp),this.currHp<=0&&i.event(W.OnGameOver),Laya.timer.once(600,this,()=>{this.canLoss=!0});const n=this.selfMats,s=this.albColor1,a=this.albColor2;for(let t=0;t<n.length;t++){const e=n[t];Laya.Tween.clearAll(e),v.Sequence(e,[250,{albedoColorA:a.w,albedoColorR:a.x,albedoColorG:a.y,albedoColorB:a.z}],[250,{albedoColorA:s.w,albedoColorR:s.x,albedoColorG:s.y,albedoColorB:s.z}])}}shoot(t){const e={5:!0,8:!0,9:!0},n=this.ins,s=n.playerData,i=this.shotGun,a=i.transform.rotationEuler.clone();let o=s.atkData.shoNumbe,r=s.atkData.bulNumbe,l=s.atkData.speId;if(6==l){const t=v.GetRes(H[6]),e=v.InstantiateSprite3D(t,H[6]);return e.transform.localPosition=this.startPos2.transform.localPosition,e.transform.localRotationEuler=this.vec3(),v.GetComponent(Tt,e),i.addChild(e),void b.sound(R.TankShot6)}if(7==l){const e=v.GetRes(H[7]),s=v.InstantiateSprite3D(e,H[7]),i=v.GetComponent(It,s);return i.lightned=[t.getComponent(Et).eid],i.start=this.startPos,i.target=t,n.gameScene.addChild(s),void b.sound(R.TankShot7)}const h=[[0],[-5,5],[-10,0,10],[-15,-5,5,15],[-20,-10,0,10,20]][r-1],c=v.GetRes(H[l]);v.Schedule(this,()=>{const i=1==h.length;for(let o=0;o<h.length;o++){const r=h[o],d=v.InstantiateSprite3D(c,H[l]);9==l&&v.ScaleParticle3DNode(d,2),d.transform.position=this.startPos.transform.position,d.transform.rotationEuler=this.vec3(a.x,a.y+r,a.z);const m=v.GetComponent(kt,d);m.belong=1,m.bulletId=l,m.target=t,m.track=i,m.speed=s.atkData.speed,n.gameScene.addChild(d),e[l]&&v.EmitParticle3DNode(d)}this.shotEffect.particleSystem.play()},0,50,o),b.sound(R["TankShot"+l])}shotFire(){const t=this.ins,e=v.GetRes(M.TankSkill2),n=v.InstantiateSprite3D(e,M.TankSkill2),s=this.startPos.transform.position.clone(),i=this.shotGun.transform.rotationEuler.clone();n.transform.position=s,n.transform.rotationEuler=i,v.GetComponent(bt,n),t.gameScene.addChild(n),v.ScaleParticle3DNode(n,3),v.EmitParticle3DNode(n);const a=this.vec3();n.transform.getForward(a);const o=this.vec3(s.x-1.5*a.x,s.y,s.z-1.5*a.z);Laya.Tween.to(n.transform,{localPositionX:o.x,localPositionZ:o.z},1e3,null,Laya.Handler.create(this,()=>{n.removeSelf();const e=v.GetRes(M.TankSkill21),a=v.InstantiateSprite3D(e,M.TankSkill21);a.transform.position=s,a.transform.rotationEuler=i,v.GetComponent(vt,a).end=o,t.gameScene.addChild(a)}))}shotPulse(){const t=this.ins,e=this.owner,n=v.GetRes(M.TankSkill4);v.Schedule(this,()=>{const s=v.InstantiateSprite3D(n,M.TankSkill4);v.GetComponent(Pt,s);s.transform.position=e.transform.position,t.gameScene.addChild(s)},0,400,3)}onUpdate(){const t=this.ins;if(t.gameState!=N.Start)return;const e=this.owner,n=this.shotGun,s=this.ins.enemyMgr.getMinEnemy(e.transform.position),i=this.shotRangeMat,a=this.tRotaQuat,o=this.tDirVec;if(s){this.tShoted||(this.tShoted=!0),i.albedoColor=t.Red;const e=s.transform.position,r=n.transform.position;o.x=e.x-r.x,o.z=-(e.z-r.z),Laya.Quaternion.rotationLookAt(o,t.UpVec3,a);const l=n.transform.rotation;Laya.Quaternion.lerp(l,a,.1,a),n.transform.rotation=a,this.timer2+=Laya.timer.delta,this.timer2>=this.shootSpeed&&(this.timer2=0,this.shoot(s)),t.currShotEnemy=s}else{const e=this.tDirVec2;o.y=o.z=0,o.x=this.shotBody.transform.localRotationEulerY,e.x=n.transform.localRotationEulerY,Laya.Vector3.lerp(e,o,.1,o),n.transform.localRotationEulerY=o.x,i.albedoColor=t.Green,t.currShotEnemy=null}this.tShoted||(n.transform.localRotationEuler=this.shotBody.transform.localRotationEuler);const r=this.tRangeRoatVec;r.y>=360&&(r.y=0),r.y+=1,this.shotRange.transform.rotationEuler=r}}class Bt{static setTaskData(t){const e=this.taskData,n=t["task.json"];if(n&&n.length)for(let t=0;t<n.length;t++){const s=n[t];let i=s.place;s.place=i?(i+"").split(","):[],s.reward=[[s.rewarType1,s.rewarNumb1],[s.rewarType2,s.rewarNumb2]],delete s.rewarType1,delete s.rewarType2,delete s.rewarNumb1,delete s.rewarNumb2,e[s.bigLv]||(e[s.bigLv]={}),e[s.bigLv][s.smallLv]=s}}static setRefData(t){const e=this.refData,n=t["refresh.json"];if(n&&n.length)for(let t=0;t<n.length;t++){const s=n[t];s.monsterId=s.monsterId+"",s.numb=s.numb+"";const i=s.monsterId.split(","),a=s.numb.split(",");s.enemys={},s.num=0;for(let t=0;t<i.length;t++){const e=parseInt(i[t]),n=parseInt(a[t])||1;s.enemys[e]=n,s.num+=n}delete s.monsterId,delete s.numb,e[s.taskId]=s}}static setEnemyData(t){const e=this.enemyData,n=t["monster.json"];if(n&&n.length)for(let t=0;t<n.length;t++){const s=n[t];if(s.skills={},s.skill){s.skill=s.skill+"";const t=s.skill.split(",");for(let e=0;e<t.length;e++){const n=parseInt(t[e]);s.skills[n]={cd:s.skillCd||10,rate:s.skillNumb||1}}}delete s.skill,e[s.id]=s}}}Bt.taskData={},Bt.refData={},Bt.enemyData={};class Rt extends _{constructor(){super(),this.ins=null,this.rayHitRes=new Laya.HitResult,this.rPos=this.vec3(),this.rPos2=this.vec3(),this.enemyQueue=[],this.enemyQueue2=[],this.schedule1=null,this.mInterval=null,this.enemys=[]}onEnable(){const t=te.Instance;this.ins=t,i.on(W.OnEnemyDeath,this,e=>{let n=null;const s=this.enemys;for(let t=0;t<s.length;t++){if(s[t].getComponent(Et).eid==e){n=t;break}}null!=n&&s.splice(n,1),s.length||t.taskMgr.succeeded||this.refreshEnemy();const i=t.currShotEnemy;i&&i.getComponent(Et).eid==e&&(t.currShotEnemy=null)}),i.on(W.OnGameEnemy,this,t=>{const e=this.enemyQueue;e.length=0;const n=t.enemys,s=t.frequency;if(Object.keys(n).length){for(let t=0;t<s;t++){const i=[];for(const e in n){const a=n[e],o=parseInt(e);let r=Math.floor(a/s);t==s-1&&(r+=a%s),1==s&&(r=a);for(let t=0;t<r;t++)i.push(o)}e.push(i)}e.reverse(),this.schedule1&&(Laya.timer.clear(this,this.schedule1),this.schedule1=null),this.schedule1=v.Schedule(this,this.refreshEnemy,0,1e3*t.time,s)}}),i.on(W.OnClearEnemy,this,this.clearEnemy),Laya.timer.loop(2e3,this,()=>{const t=this.enemyQueue2;t.length&&this.randomEnemy(10).then(e=>{let n=0;v.Schedule(this,()=>{if(!t.length)return;const s=e[n],i=t[0];t.shift(),this.makeEnemy(i,s),n++},0,170,e.length)})})}clearEnemy(){this.schedule1&&(Laya.timer.clear(this,this.schedule1),this.schedule1=null),this.enemyQueue.length=0,this.enemyQueue2.length=0;const t=this.enemys;for(let e=0;e<t.length;e++){t[e].getComponent(Et).onDeath(!0)}t.length=0,this.ins.currShotEnemy=null}refreshEnemy(){if(!this.enemyQueue.length)return;const t=this.enemyQueue[0];this.enemyQueue.shift();const e=this.enemyQueue2;this.randomEnemy(t.length).then(n=>{if(n.length<t.length){console.log(`自动补入${t.length-n.length}个僵尸生产队列`);for(let s=n.length;s<t.length;s++)e.push(t[s])}let s=0;v.Schedule(this,()=>{if(this.ins.taskMgr.succeeded)return;const e=n[s],i=t[s];this.makeEnemy(i,e),s++},0,170,n.length)})}makeEnemy(t,e){const n=this.ins,s=(n.playerData,Bt.enemyData[t]);if(!s)return;const a=M["Enemy"+s.model],o=v.GetRes(a),r=v.InstantiateSprite3D(o,a);v.GetComponent(gt,r).enemyData=s,v.GetComponent(ft,r);let l=2;t>1e3&&(l=6,i.event(W.OnGameBoss,r)),r.transform.localScale=this.vec3(l,l,l),v.GetComponent(Et,r).enemyData=s,r.transform.position=e,n.gameScene.addChild(r),this.enemys.push(r),t>1e3&&i.event(W.OnGameBoss,r);const h=r.getChildByName("effect");h&&(h.active=t>1e3)}getMinEnemy(t,e=2.5){const n=this.enemys;let s=0,i=null;for(let a=0;a<n.length;a++){const o=n[a];if(!o||!o.transform)continue;const r=o.transform.position;let l=(r.x-t.x)*(r.x-t.x)+(r.z-t.z)*(r.z-t.z);l<=e*e&&(!s||l<s)&&(s=l,i=o)}return i}randomEnemy(t){return new Promise((e,n)=>{const s=this.ins,i=s.gameScene.physicsSimulation,a=new Laya.BoxColliderShape(.1,.1,.1),o=this.rayHitRes,r=s.player1.transform.position.clone(),l=this.rPos,h=this.rPos2;let c=0;const m=[],u=setInterval(()=>{if(m.length>=t||c>=120)clearInterval(u),this.mInterval=null,e(m);else{let t=2+2*Math.random(),e=d.GetRandom(0,360)/180*Math.PI,n=r.x+Math.cos(e)*t,s=r.z+Math.sin(e)*t;l.x=h.x=n,l.z=h.z=s,l.y=-.1,h.y=1;let u=!1;for(let t=0;t<m.length;t++){let e=m[t];if(d.IsSameVector(l,e,.1)){u=!0;break}}o.collider=null,i.shapeCast(a,l,h,o),o.collider&&"land"==o.collider.owner.name||(u=!0),u||(l.y=0,m.push(l.clone())),c++}},17);this.mInterval=u})}onDisable(){super.onDisable(),this.mInterval&&clearInterval(this.mInterval)}}class xt extends _{constructor(){super(),this.iconIma=null,this.disLab=null,this.player=null,this.target=null,this.leftTop=this.vec3(100,200),this.leftBot=this.vec3(100,800),this.rightTop=this.vec3(620,200),this.rightBot=this.vec3(620,800),this.tEndPos=this.vec3(),this.tEndPos2=this.vec3(),this.tEndPos3=this.vec3()}onEnable(){const t=te.Instance;this.player=t.player1,this.owner.visible=!1}clearTarget(){this.target=null;const t=this.owner;Laya.timer.clearAll(this),Laya.Tween.clearAll(t),t.visible=!1}setTarget(t){this.clearTarget(),this.target=t;const e=this.owner;this.setPos();const n=this.tEndPos;e.pos(n.x,n.y),e.visible=!0,e.alpha=1,Laya.timer.loop(1e3,this,()=>{v.Sequence(e,[500,{alpha:.3}],[500,{alpha:1}])})}setPos(){const t=this.target.transform.position,e=this.player.transform.position,n=t.x-e.x,s=t.z-e.z,i=n*n+s*s;let a=(Math.atan2(-s,-n)/Math.PI*180+35+360)%360;this.iconIma.rotation=a,this.disLab.text=i.toFixed(1)+"m";let o=1,r=this.leftTop,l=this.leftBot;a<=180?o=a/180:(o=(360-a)/180,r=this.rightTop,l=this.rightBot),Laya.Vector3.lerp(l,r,o,this.tEndPos),this.owner.visible=!(i<=6)}onDisable(){super.onDisable(),this.target=null}onUpdate(){if(!this.target)return;this.setPos();const t=this.owner,e=this.tEndPos2,n=this.tEndPos3;e.x=t.x,e.y=t.y,Laya.Vector3.lerp(e,this.tEndPos,.1,n),t.pos(n.x,n.y)}}class Ot extends Y{constructor(){super(),this.ins=null,this.timer2=0,this.speed=null,this.gravity=null,this.moving=!1,this.tTimer=0,this.tCurrAngle=this.vec3(),this.tSpeedVec=this.vec3(),this.shootSpeed=2,this.g=-4,this.startPos=null,this.endPos=null,this.endHandler=null}onEnable(){this.ins=te.Instance,this.moving=!1}startMove(){const t=this.owner,e=this.startPos,n=this.endPos;this.timer2=Laya.Vector3.distance(e,n)/this.shootSpeed,t.transform.position=e;const s=this.timer2;this.speed=this.vec3((n.x-e.x)/s,(n.y-e.y)/s-.5*this.g*s,(n.z-e.z)/s),this.gravity=this.vec3(),this.tTimer=0,this.moving=!0}onDisable(){this.moving=!1,super.onDisable()}onUpdate(){if(this.ins.gameState!=N.Start)return;if(!this.moving)return;if(this.tTimer>=this.timer2)return this.moving=!1,void(this.endHandler&&this.endHandler());const t=Laya.timer.delta/1e3,e=this.gravity;e.y=this.g*(this.tTimer+=t);const n=this.owner;Laya.Vector3.add(this.speed,e,this.tSpeedVec),Laya.Vector3.scale(this.tSpeedVec,t,this.tSpeedVec),n.transform.translate(this.tSpeedVec,!1)}}class Mt extends _{constructor(){super(),this.ins=null,this.enemyAttRange1=null,this.enemyAtt2=null,this.enemyAttRange2=null}onEnable(){this.ins=te.Instance,i.on(W.OnEnemySkill,this,(t,e)=>{this["onSkill"+t]&&this["onSkill"+t](e)})}isInFace(t){const e=this.ins.getEnemyTarget().transform.position.clone(),n=t.transform.position,s=this.vec3(-(e.x-n.x),0,-(e.z-n.z));Laya.Vector3.normalize(s,s);const i=this.vec3();return t.transform.getForward(i),Laya.Vector3.dot(s,i)>=1.3}onSkill1(t){const e=t.getComponent(Et);if(!e)return;if(!this.isInFace(t))return;const n=e.enemyData,s=mt[n.model].$dash;if(!s)return;const i=e.enemyAnim;i.enemyState=pt.$Dash,i.animator.play(s,0),i.animator.play(s,1),i.animator.speed=.2;const a=n.id>1e3?this.vec3(.8,.8,.6):this.vec3(.4,.4,.4),o=v.InstantiateSprite3D(this.enemyAttRange1,M.EnemyAttRange1);v.GetComponent(Ct,o),o.transform.rotation=t.transform.rotation,o.transform.localScale=a;const r=t.transform.position,l=this.vec3(r.x,.02,r.z);o.transform.position=l,this.ins.gameScene.addChild(o);const h=e.effectNodes;h.push(o),Laya.timer.once(ut[n.model].$dash||1e3,this,()=>{this.ins.gameState==N.Start&&(i.animator.speed=1),i.animator.play(mt[n.model].run,1);const e=o.getChildByName("end").transform.position;Laya.Tween.clearAll(t.transform),Laya.Tween.to(t.transform,{localPositionX:e.x,localPositionZ:e.z},400,null,Laya.Handler.create(this,()=>{o.removeSelf(),h.splice(h.indexOf(o),1)}))}),Laya.timer.once(2e3,this,()=>{i.enemyState==pt.$Dash&&(i.enemyState=pt.Run)})}onSkill2(t){const e=t.getComponent(Et);if(!e)return;if(!this.isInFace(t))return;const n=e.enemyData,s=mt[n.model].$throw;if(!s)return;const i=e.enemyAnim;i.enemyState=pt.$Throw,i.animator.play(s,0),i.animator.play(s,1);const a=n.id>1e3?2:1,o=this.ins.getEnemyTarget().transform.position.clone(),r=v.InstantiateSprite3D(this.enemyAtt2,M.EnemyAtt2);v.GetComponent(Ct,r),r.transform.localPosition=this.vec3(),r.transform.setWorldLossyScale(this.vec3(.5,.5,.5)),r.transform.rotationEuler=this.vec3(),e.rightHand.addChild(r);const l=e.effectNodes;l.push(r);const h=v.InstantiateSprite3D(this.enemyAttRange2,M.EnemyAttRange2);v.GetComponent(Ct,h),h.transform.localScale=this.vec3(a,a,a),h.transform.position=o,this.ins.gameScene.addChild(h),l.push(h),Laya.timer.once(1e3,this,()=>{h.removeSelf()}),Laya.timer.once(ut[n.model].$throw||1e3,this,()=>{const t=r.transform,e=t.position,s=t.rotation,c=t.getWorldLossyScale();r.removeSelf(),l.splice(l.indexOf(r),1),l.splice(l.indexOf(h),1);const d=v.InstantiateSprite3D(this.enemyAtt2,M.EnemyAtt2);d.__enemySkill__=n.atk*n.skillNumb,d.getComponent(Laya.PhysicsCollider).collisionGroup=w.Enemy,this.ins.gameScene.addChild(d),d.transform.position=e,d.transform.rotation=s,d.transform.setWorldLossyScale(c),v.GetComponent(Ct,d);const m=v.GetComponent(Ot,d);m.startPos=d.transform.position.clone(),m.endPos=o,m.endHandler=(()=>{null!=d.__enemySkill__&&delete d.__enemySkill__;const t=d.transform.position;t.y=.02,d.removeSelf();const e=v.GetRes(M.EffectBoom),n=v.InstantiateSprite3D(e,M.EffectBoom);v.ScaleParticle3DNode(n,a),v.GetComponent(Ct,n),n.transform.position=t,this.ins.gameScene.addChild(n),b.sound(R.EffectBoom),Laya.timer.once(2e3,this,()=>{n.removeSelf()}),i.enemyState==pt.$Throw&&(i.enemyState=pt.Run)}),m.startMove()})}onSkill3(t){const e=t.getComponent(Et);if(!e)return;if(!this.isInFace(t))return;const n=e.enemyData,s=mt[n.model].$jump;if(!s)return;const i=e.enemyAnim;i.enemyState=pt.$Jump,i.animator.play(s,0),i.animator.play(s,1);const a=n.id>1e3?2:1,o=this.ins.getEnemyTarget().transform.position.clone(),r=v.InstantiateSprite3D(this.enemyAttRange2,M.EnemyAttRange2);v.GetComponent(Ct,r),r.transform.localScale=this.vec3(a,a,a),r.transform.position=o,this.ins.gameScene.addChild(r),Laya.timer.once(1e3,this,()=>{r.removeSelf()});const l=v.GetComponent(Ot,t);l.startPos=t.transform.position.clone(),l.endPos=o,l.endHandler=(()=>{const t=v.GetRes(M.EffectBoom),e=v.InstantiateSprite3D(t,M.EffectBoom);v.ScaleParticle3DNode(e,a),v.GetComponent(Ct,e),e.transform.position=o,this.ins.gameScene.addChild(e),b.sound(R.EffectBoom),Laya.timer.once(2e3,this,()=>{e.removeSelf()}),i.enemyState==pt.$Jump&&(i.enemyState=pt.Run)}),l.startMove()}onDisable(){super.onDisable()}}let Gt=class extends D{constructor(){super(),this.tankIds=[1],this.tankId=1,this.tankAdvs={},this.attLevel=1,this.hpLevel=0,this.soldierLevel=0,this.uavLevel=0,this._gold=0,this._diamond=0,this.goldSpeed=0,this.diamSpeed=0,this.currLevel=0,this.reddots=[]}get gold(){return this._gold}set gold(t){this._gold=t,i.event("userConfig.gold")}get diamond(){return this._diamond}set diamond(t){this._diamond=t,i.event("userConfig.diamond")}onInit(t){setInterval(()=>{this.gold+=this.goldSpeed,this.diamond+=this.diamSpeed},1e3),this.updateLevel()}updateLevel(){const t=rt.levelData[this.currLevel];this.goldSpeed=t.hangGold,this.diamSpeed=t.hangJewel,X.VideoGold=t.goldNum,this.currLevel>=X.Tank2Level&&this.tankIds.indexOf(2)<0&&(this.tankIds.push(2),Q.newTank=2,this.reddots.indexOf("tank2")<0&&this.reddots.push("tank2")),this.currLevel>=X.HpLevel&&this.hpLevel<1&&(this.hpLevel=1),this.currLevel>=X.SoldierLevel&&this.soldierLevel<1&&(this.soldierLevel=1),this.currLevel>=X.UavLevel&&this.uavLevel<1&&(this.uavLevel=1)}reward(t){for(let e=0;e<t.length;e++){const n=t[e];1==n[0]&&(this.gold+=n[1]||0),2==n[0]&&(this.diamond+=n[1]||0)}}};const Ht=new(Gt=__decorate([ConfigName("userConfig")],Gt));class Ft{constructor(){this.level=1,this.task=1,this.tank=0,this.hp=0,this.atk=0,this.atk0=0,this.crit=0,this.critProb=0,this.atkData=null,this.skillRatio=0,this.propBullData=null,this.soldierData=null,this.uavData=null,this._score=0,this.level=Ht.currLevel,this.tank=Ht.tankId;const t=B.tankData[Ht.tankId],e=B.tankAttData[Ht.attLevel],n=B.tankHpData[Ht.hpLevel];this.atk=t.atk*(1+e.curt),this.atk0=this.atk,this.crit=10+100*e.strike,this.critProb=1.5+e.strHurt,this.skillRatio=t.skillNumb,this.hp=t.hp*(1+(n?n.hpNumb:0)),this.atkData=e,Ht.soldierLevel>0&&(this.soldierData=B.tankSoldierData[Ht.soldierLevel]),Ht.uavLevel>0&&(this.uavData=B.tankUavData[Ht.uavLevel])}get score(){return this._score}set score(t){this._score=t,i.event(W.OnPlayerScore)}}class Ut extends _{constructor(){super(),this.tipLab=null}static Tips(t,e){v.OpenDialog(T.Common.CommonTipDialog,e,e=>{e.getComponent(Ut).setData(t)},!0)}setData(t){const e=this.owner;this.tipLab.text=t,Laya.timer.frameOnce(1,this,()=>{this.tipLab.width>500&&(this.tipLab.wordWrap=!0,this.tipLab.width=500),e.width=this.tipLab.width+50,e.height=this.tipLab.height+45})}onEnable(){const t=this.owner;t.alpha=0;const e=t.y-200;Laya.Tween.to(t,{alpha:1},300,Laya.Ease.circOut),Laya.timer.once(1200,this,()=>{Laya.Tween.to(t,{alpha:0,y:e},300,Laya.Ease.circIn,Laya.Handler.create(this,()=>{t.removeSelf()}))})}onDisable(){super.onDisable()}}class Vt extends Y{constructor(){super(),this.animator=null,this._soldierState=ht.Idle}get soldierState(){return this._soldierState}set soldierState(t){this._soldierState=t,this.animator.play(t)}onEnable(){const t=this.owner.getComponent(Laya.Animator);this.animator=t,1==t.getControllerLayer(0)._states.length&&this.initAnim(),this.soldierState=ht.Idle}playIdle(){this.animator.play("idleShot")}onDeath(){if(this.soldierState!=ht.Death)return new Promise((t,e)=>{this.soldierState=ht.Death,Laya.timer.clearAll(this),Laya.timer.once(1500,this,()=>{t()})})}initAnim(){const t=this.animator,e=ct[1],n=e.all,s=e.anim,i=t.getDefaultState().clip,a=t.getControllerLayer();for(const t in s){let e=s[t];const o=new Laya.AnimatorState;o.name=t,o.clipStart=e[0]/n,o.clipEnd=e[1]/n,o.clip=i,a.addState(o)}i.islooping=!0}onDisable(){super.onDisable()}onUpdate(){}}class Wt extends Y{constructor(){super(),this.ins=null,this.navAgent=null,this.shapeCast=new Laya.BoxColliderShape(.15,.1,.15),this.rayHitRes=new Laya.HitResult,this.soldierAnimator=null,this._speed=.1,this.target=null,this.isAgent=!1}get speed(){return this._speed}set speed(t){this._speed=t,this.navAgent.speed=t}onEnable(){const t=te.Instance;this.ins=t;const e=this.owner,n=v.GetComponent(yt,e),s=v.GetComponent(Vt,e);this.soldierAnimator=s,n.stopHandler=(()=>s.soldierState==ht.Death),n.endHandler=(()=>{s.soldierState!=ht.Death&&(this.isAgent&&this.endFindPath(),s.soldierState=ht.Idle)}),n.rotateHandler=(()=>s.soldierState==ht.Death||t.currShotEnemy),this.navAgent=n,this.speed=.2,this.isAgent=!1}loopFindPath(){this.findPath(),Laya.timer.clearAll(this),Laya.timer.loop(300,this,this.findPath),this.isAgent=!0}endFindPath(){const t=this.navAgent;t.enabled=!1,t.path=[],Laya.timer.clearAll(this),this.isAgent=!1}findPath(){if(this.soldierAnimator.soldierState==ht.Death)return;const t=this.ins.gameScene.physicsSimulation,e=this.shapeCast,n=this.rayHitRes,s=this.owner,i=this.target,a=this.navAgent;if(n.collider=null,t.shapeCast(e,s.transform.position,i.transform.position,n,null,null,w.Default,w.All^w.Player^w.Enemy),n.collider&&"land"!=n.collider.owner.name){let t=NavMesh.findPath(s.transform.position,i.transform.position,"game",0);if(t&&t.length){let e=[];for(let n=0;n<t.length;n++){const s=t[n];e.push(this.vec3(s.x,0,s.z))}a.path=[s.transform.position.clone()].concat(e),a.enabled=!0,this.soldierAnimator.soldierState=ht.Walk}else a.enabled=!1,this.soldierAnimator.soldierState=ht.Idle}else a.path=[s.transform.position.clone(),i.transform.position.clone()],a.enabled=!0,this.soldierAnimator.soldierState=ht.Walk}onDisable(){super.onDisable()}onUpdate(){const t=this.owner,e=this.target;if(!this.isAgent){Laya.Vector3.distanceSquared(t.transform.position,e.transform.position)>=1&&this.loopFindPath()}}}class zt extends Y{constructor(){super(),this.target=null,this.ins=null,this.timer2=0,this.shotGun=null,this.startPos=null,this.shootSpeed=400,this.hpBarComp=null,this.currHp=300,this.hp=300,this.soldierAnimator=null,this.shotEffect=null,this.tForwVec=this.vec3(),this.tForwQuat=this.quat()}onEnable(){this.ins=te.Instance;const t=this.owner,e=v.GetComponent(Vt,t);this.soldierAnimator=e;const n=v.GetComponent(Wt,t);n.target=this.target,n.loopFindPath(),this.shotGun=this.find("Hips/Spine/Spine1/Spine2/RightShoulder/RightArm/RightForeArm/RightHand/RightHandIndex1/gun1/gun2",t),this.startPos=this.shotGun.getChildByName("start"),this.shotEffect=this.shotGun.getChildByName("shotEffect").getChildAt(0),t.__ignore__=!0;const a=this.ins.playerData.soldierData;this.currHp=this.hp=a.merHp;const o=v.GetRes(x.PlayerHpBar,!0),r=v.InstantiatePrefab(x.PlayerHpBar,o);r.scale(.7,.7);const l=v.GetComponent(St,r);l.target=t.getChildByName("top"),s.Instance.hpBarNode.addChild(r),this.hpBarComp=l;const h=[],c=this.ins.gameScene.physicsSimulation,d=new Laya.SphereColliderShape(.3);Laya.timer.loop(500,this,()=>{const n=t.transform.position;if(n.y=0,c.shapeCastAll(d,n,this.vec3(n.x,2,n.z),h,null,null,w.Default,w.Enemy),h&&h.length)for(let t=0;t<h.length;t++){const e=h[t];if(e&&e.collider){const t=e.collider.owner,n=t.getComponent(Et);n&&n.enemyAnim.enemyState!=pt.Death?this.updateHp(n.enemyData.atk):t.__enemySkill__&&this.updateHp(t.__enemySkill__)}}this.currHp<=0&&(Laya.timer.clearAll(this),i.event(W.OnSoldierDeath,t),e.onDeath().then(()=>{t.removeSelf()}))})}updateHp(t){this.currHp-=t,this.currHp=Math.max(this.currHp,0);const e=this.hpBarComp.owner;e.visible||(e.visible=!0),this.hpBarComp.updateHpBar(this.currHp/this.hp)}onDisable(){super.onDisable(),this.hpBarComp&&this.hpBarComp.owner.removeSelf(),this.owner.__ignore__&&delete this.owner.__ignore__,this.recover(this.owner)}shoot(t){const e=this.ins,n=(e.playerData,this.shotGun.transform.rotationEuler.clone());const s=v.GetRes(H[1]),i=v.InstantiateSprite3D(s,H[1]);i.transform.position=this.startPos.transform.position,i.transform.rotationEuler=n;const a=v.GetComponent(kt,i);a.belong=2,a.bulletId=1,a.target=t,a.track=!0,a.speed=1,e.gameScene.addChild(i),this.shotEffect.particleSystem.play()}onUpdate(){if(this.soldierAnimator.soldierState!=ht.Death&&(this.timer2+=Laya.timer.delta,this.timer2>=this.shootSpeed)){this.timer2=0;const t=this.ins.currShotEnemy;if(t){const e=this.owner,n=this.tForwVec,s=this.tForwQuat,i=t.transform.position,a=e.transform.position;n.x=i.x-a.x,n.z=-(i.z-a.z),Laya.Quaternion.rotationLookAt(n,this.ins.UpVec3,s),e.transform.rotation=s,this.shoot(t)}}}}class $t extends _{constructor(){super(),this.ske=null,this.mArrow=null,this.mHitArea=null,this.mCirMask=null,this.mInited=!1}onUpdate(){const t=this.ske;!this.mInited&&t&&t.templet&&(this.mInited=!0,t&&t.templet&&t.playbackRate(.8))}onEnable(){const t=Laya.stage.width,e=Laya.stage.height;this.mInited=!1;const n=this.owner;this.mArrow=n.getChildByName("arrow"),n.size(t,e),n.cacheAs="bitmap",n.on("click",this,()=>{});const s=n.getChildByName("content"),i=new Laya.Sprite;i.alpha=.5,i.graphics.drawRect(0,0,t,e,"#000000"),s.addChild(i);const a=new Laya.Sprite;a.blendMode="destination-out",s.addChild(a),this.mCirMask=a;const o=new Laya.HitArea;o.hit.drawRect(0,0,t,e,"#000000"),n.hitArea=o,n.mouseEnabled=!0,this.mHitArea=o}setData(t){if(this.mHitArea&&this.mCirMask){const e=this.mHitArea,n=this.mCirMask;e.unHit.clear(),e.unHit.drawCircle(t.x,t.y,t.radius,"#000000"),n.graphics.clear(),n.graphics.drawCircle(t.x,t.y,t.radius,"#000000");const s=this.ske;if(s){s.pos(t.x,t.y);const e=t.radius/40;s.scale(e,e)}const i=this.mArrow;if(i){Laya.timer.clearAll(this),Laya.Tween.clearAll(i);const e=t.radius/40||1;let n,s,a;1==(t.arrowDir||1)?(n=t.y+100*e,s=t.y+50*e,a=1):(n=t.y-100*e,s=t.y-50*e,a=-1),i.pos(t.x,n),i.scaleY=a;const o=()=>{Laya.Tween.clearAll(i),v.Sequence(i,[1e3,{y:s},Laya.Ease.circOut],[1e3,{y:n},Laya.Ease.circIn])};o(),Laya.timer.loop(2e3,this,o)}}}onDisable(){super.onDisable()}}const jt=new class{constructor(){this.mGuidIns=null,this.mSteps=null,this.mStep=0}getGuidIns(){const t=v.GetRes(T.Common.GuidanceDialog,!0),e=v.InstantiatePrefab(T.Common.GuidanceDialog,t);return Laya.stage.addChild(e),e}init(t,...e){if(this.mGuidIns)return console.warn("已存在引导实例"),void t.removeSelf();this.mGuidIns=t,this.mSteps=e,this.mStep=0,this.nextStep()}nextStep(){if(this.mSteps&&this.mGuidIns)if(this.mStep==this.mSteps.length)this.mGuidIns.removeSelf(),this.mGuidIns=null,this.mStep=0;else{const t=this.mSteps[this.mStep++];this.mGuidIns.getComponent($t).setData(t)}}};class Kt extends Y{constructor(){super(),this.ins=null}onEnable(){this.ins=te.Instance,this.owner.__ignore__=!0}onDisable(){super.onDisable(),this.recover(this.owner)}onTriggerEnter(t){this.owner.removeSelf(),this.owner.__ignore__&&delete this.owner.__ignore__,i.event(W.OnGameAssault,this.owner)}}class Xt extends Y{constructor(){super(),this.ins=null,this.insUI=null,this.timer3=0,this.colBarNode=null,this.proBar=null,this.timer2=3e3}onEnable(){this.ins=te.Instance,this.insUI=s.Instance,this.owner.__ignore__=!0}onDisable(){super.onDisable(),this.proBar=null,this.colBarNode&&this.colBarNode.removeSelf(),this.colBarNode=null,this.owner.__ignore__&&delete this.owner.__ignore__,this.recover(this.owner)}onTriggerEnter(t){if(!this.proBar){const t=this.owner,e=v.GetRes(x.TaskCollectBar,!0),n=v.InstantiatePrefab(x.TaskCollectBar,e);v.GetComponent(Ct,n),this.colBarNode=n;const s=v.Project3DTo2D(this.ins.camera,t.transform.position);n.pos(s.x,s.y),this.proBar=n.getChildByName("hpBar1"),this.insUI.hpBarNode2.addChild(n)}this.timer3=0,this.proBar.value=0,this.colBarNode.visible=!0}onTriggerStay(t){if(this.timer3>=this.timer2)return this.owner.removeSelf(),void i.event(W.OnGameCollect,this.owner);this.timer3+=Laya.timer.delta,this.proBar.value=this.timer3/this.timer2}onTriggerExit(t){this.colBarNode&&(this.colBarNode.visible=!1,this.proBar.value=0)}onUpdate(){const t=this.colBarNode;if(t&&t.visible){const e=this.owner,n=v.Project3DTo2D(this.ins.camera,e.transform.position);t.pos(n.x,n.y)}}}class Qt extends Y{constructor(){super(),this.ins=null,this.insUI=null,this.colBarNode=null,this.proBar=null,this.tPos=this.vec3(),this._hp=2e3,this.currHp=2e3}get hp(){return this._hp}set hp(t){this._hp=t,this.currHp=t}onEnable(){this.ins=te.Instance,this.insUI=s.Instance;const t=this.owner;t.__ignore__=!0;const e=v.GetRes(x.TaskCollectBar,!0),n=v.InstantiatePrefab(x.TaskCollectBar,e);v.GetComponent(Ct,n),n.scale(1,1),this.colBarNode=n,this.tPos=t.transform.position.clone(),this.tPos.y+=1;const a=v.Project3DTo2D(this.ins.camera,this.tPos);n.pos(a.x,a.y),this.proBar=n.getChildByName("hpBar1"),this.proBar.value=1,this.insUI.hpBarNode2.addChild(n),this.colBarNode.visible=!0;const o=[],r=this.ins.gameScene.physicsSimulation,l=new Laya.SphereColliderShape(.5),h=t.transform.position.clone();Laya.timer.loop(500,this,()=>{if(this.ins.gameState==N.Start){if(r.shapeCastAll(l,h,this.vec3(h.x,2,h.z),o,null,null,w.Default,w.Enemy),o&&o.length)for(let t=0;t<o.length;t++){const e=o[t];if(e&&e.collider){const t=e.collider.owner,n=t.getComponent(Et);n&&n.enemyAnim.enemyState!=pt.Death?this.updateHp(n.enemyData.atk):t.__enemySkill__&&this.updateHp(t.__enemySkill__)}}this.currHp<=0&&(t.removeSelf(),i.event(W.OnGameGuard,this.owner))}})}updateHp(t){this.currHp-=t,this.currHp=Math.max(this.currHp,0),this.proBar.value=this.currHp/this.hp}onDisable(){super.onDisable(),this.proBar=null,this.colBarNode&&(this.colBarNode.scale(.6,.6),this.colBarNode.removeSelf(),this.colBarNode=null),this.owner.__ignore__&&delete this.owner.__ignore__,this.recover(this.owner)}onUpdate(){const t=this.colBarNode;if(t&&t.visible){const e=v.Project3DTo2D(this.ins.camera,this.tPos);t.pos(e.x,e.y)}}}class Yt extends _{constructor(){super(),this.ins=null,this.insUI=null,this.currTask=null,this.currNum=0,this.isTimer=!1,this.dirNodes=[],this.lines=[],this.succeeded=!1,this.guardNode=null}onEnable(){Yt.Instance=this,this.insUI=s.Instance,this.ins=te.Instance,this.longUpdateDelta=1e3,this.isTimer=!1,this.insUI.taskNode.visible=!1,this.succeeded=!1,i.on(W.OnGameTask,this,(t,e)=>{this.initTask(t,e)}),i.on(W.OnEnemyDeath,this,(t,e)=>{const n=this.currTask;if(n.type==z.Sweep||n.type==z.Kill){let t=!0;const s=(n.targetId+"").split(",");s&&s.indexOf(e.id+"")<0&&(t=!1),t&&(this.currNum++,this.updateCurrNum(!1),this.currNum>=n.typeNumb&&this.onTaskSuc(!1))}}),i.on(W.OnGameCollect,this,t=>{const e=this.dirNodes;e.splice(e.indexOf(t),1),this.setDirTarget();const n=this.currTask;n.type!=z.Collect&&n.type!=z.Assault&&n.type!=z.Save||(this.currNum++,this.updateCurrNum(!1),this.currNum>=n.typeNumb?this.onTaskSuc(!1):Ut.Tips(o.BattleScene[1]))}),i.on(W.OnGameAssault,this,t=>{const e=this.dirNodes;e.splice(e.indexOf(t),1),this.setDirTarget(),this.onTaskSuc(!1)}),i.on(W.OnGameGuard,this,t=>{const e=this.dirNodes;e.splice(e.indexOf(t),1),this.setDirTarget(),this.guardNode=null,i.event(W.OnGameOver)})}onTaskSuc(t){if(this.succeeded)return;this.succeeded=!0,this.isTimer=!1;const e=this.dirNodes;for(let t=0;t<e.length;t++){e[t].removeSelf()}e.length=0,this.guardNode=null,this.setDirTarget(),i.event(W.OnClearEnemy),Laya.timer.once(2e3,this,()=>{const e=this.currTask;if(t&&e.type==z.Assault)this.onTaskFail();else{const t=this.ins.playerData,n=Bt.taskData[t.level][t.task+1];if(Ht.reward(e.reward),n){this.ins.gameState=N.Pause,Laya.timer.once(2e3,this,()=>{this.ins.isNewPlayer||S.showInterstitialAd(),this.ins.gameState=N.Start,t.task++,this.initTask(t.level,t.task),this.ins.isNewPlayer&&3==t.task&&Laya.timer.once(5e3,this,()=>{jt.init(jt.getGuidIns(),{x:627,y:Laya.stage.height-202,radius:65})})});const e=v.GetRes(x.PlayerProp,!0),n=v.InstantiatePrefab(x.PlayerProp,e),s=Laya.stage;n.getComponent(Dt).setData("game/taskComp.png",1e3),n.pos(s.width/2,s.height/2),Laya.stage.addChild(n),b.sound(R.TaskWin)}else i.event(W.OnGameSuccess)}})}onTaskFail(){i.event(W.OnGameOver)}initTask(t,e){this.guardNode=null,this.succeeded=!1,this.isTimer=!1;const n=Bt.taskData,s=Bt.refData,a=n[t][e],o=s[a.id];this.currTask=a;const r=this.insUI,l=r.taskDescNode,h=l.getChildByName("titleLab"),c=l.getChildByName("numLab"),m=l.getChildByName("goldLab"),u=l.getChildByName("diamLab");let p=!1;a.type==z.Guard||a.type==z.Live||a.type==z.Assault?(this.currNum=a.typeNumb,p=!0,this.updateCurrNum(!0),c.text=`(${this.currNum}s)`):(this.currNum=0,this.updateCurrNum(!1),c.text=`(${this.currNum}/${a.typeNumb})`),r.tDesLab.text=a.taskTxt,r.taskNode.visible=!1,h.text=a.taskTxt,m.text=d.FormatNumber(a.reward[0][1]),u.text=d.FormatNumber(a.reward[1][1]),l.y=-400,l.visible=!0,this.initDescPropNode1(),v.Sequence(l,[1e3,{y:63},Laya.Ease.backOut,()=>{this.initDescProgNode2()}],[3e3,{y:63},Laya.Ease.backOut],[500,{y:-400},Laya.Ease.backIn,()=>{r.taskNode.visible=!0,l.visible=!1;for(let t=0;t<this.lines.length;t++){this.lines[t].destroy()}if(this.isTimer=p,o&&i.event(W.OnGameEnemy,o),a.type==z.Collect||a.type==z.Save){const t=a.place;if(t&&t.length){const e=this.ins.gameScene,n=e.getChildByName("scene2");let s=M.TaskCommNode;a.type==z.Save&&(s=M.TaskSaveNode);for(let i=0;i<t.length;i++){const a=t[i],o=n.getChildByName(a),r=v.GetRes(s),l=v.InstantiateSprite3D(r,s);let h=null;s==M.TaskSaveNode&&(h=v.GetComponent(Vt,l.getChildByName("soldier"))),v.GetComponent(Xt,l),l.transform.position=o.transform.position,e.addChild(l),h&&h.playIdle(),this.dirNodes.push(l)}}this.setDirTarget()}if(a.type==z.Assault){const t=a.place;if(t&&t.length){const e=this.ins.gameScene,n=e.getChildByName("scene2");for(let s=0;s<t.length;s++){const i=t[s],a=n.getChildByName(i),o=v.GetRes(M.TaskTargetNode),r=v.InstantiateSprite3D(o,M.TaskTargetNode);v.GetComponent(Kt,r),r.transform.position=a.transform.position,e.addChild(r),this.dirNodes.push(r)}}this.setDirTarget()}if(a.type==z.Guard){const t=a.place;if(t&&t.length){const e=this.ins.gameScene,n=e.getChildByName("scene2");for(let s=0;s<t.length;s++){const i=t[s],o=n.getChildByName(i),r=v.GetRes(M.TaskGuardNode),l=v.InstantiateSprite3D(r,M.TaskGuardNode);v.GetComponent(Qt,l).hp=parseInt(a.targetId),l.transform.position=o.transform.position,e.addChild(l),this.dirNodes.push(l),this.guardNode=l}}this.setDirTarget()}}])}setDirTarget(){const t=this.getMinDisNode(),e=this.ins.dirNode;t?e.setTarget(t):e.clearTarget()}getMinDisNode(){const t=this.ins.player1.transform.position,e=this.dirNodes;let n=0,s=null;for(let i=0;i<e.length;i++){const a=e[i];if(!a)continue;const o=a.transform.position;let r=(o.x-t.x)*(o.x-t.x)+(o.z-t.z)*(o.z-t.z);(!n||r<n)&&(n=r,s=a)}return s}updateCurrNum(t){const e=this.insUI.tNumLab;t?e.text=`(${this.currNum}s)`:this.currNum<=this.currTask.typeNumb&&(e.text=`(${this.currNum}/${this.currTask.typeNumb})`)}initDescPropNode1(){const t=this.insUI.taskDescNode,e=this.ins.playerData,n=Bt.taskData[e.level],s=t.getChildByName("progNode");s.getChildByName("title").text=e.level+"";const i=s.getChildByName("taskProg"),a=i.getChildByName("tankNode");a.getChildByName("icon").skin=`lobby/tank${e.tank}.png`;const o=Object.keys(n).length;for(let t=0;t<o-1;t++){const n=new Laya.Image(`game/line${t+1<=e.task?1:2}.png`);n.anchorX=.5,n.y=0,n.x=(t+1)/o*516,i.addChild(n),this.lines.push(n)}let r=(e.task-1)/o;r<0&&(r=0),i.value=r,a.x=516*r}initDescProgNode2(){const t=this.insUI.taskDescNode,e=this.ins.playerData,n=Bt.taskData[e.level],s=t.getChildByName("progNode").getChildByName("taskProg"),i=s.getChildByName("tankNode"),a=Object.keys(n).length,o=e.task/a;Laya.Tween.to(s,{value:o},1e3),Laya.Tween.to(i,{x:516*o},1e3)}onDisable(){super.onDisable(),Yt.Instance=null}onLongUpdate(){if(this.ins.gameState==N.Start&&this.isTimer){if(this.currNum<=0)return this.isTimer=!1,void this.onTaskSuc(!0);this.currNum--,this.updateCurrNum(!0)}}onUpdate(){super.onUpdate()}}Yt.Instance=null;const Jt=new class{constructor(){this.loaded={}}loadBinArray(t){return new Promise((e,n)=>{"string"==typeof t&&(t=[t]);let s=t.length;for(let n=0;n<s;n++)Laya.loader.load(t[n],Laya.Handler.create(this,i=>{this.loaded[t[n]]=i,this.getByteList(i).then(()=>{--s<=0&&e()})}),null,Laya.Loader.BUFFER)})}compilePack(){const t=this.loaded;for(const e in t){const n=t[e];this.getByteList(n)}}getByteList(t){return new Promise((e,n)=>{let s=new Laya.Byte(t);for(;s._pos_<s.length;){let t=this.getByteData(s),e=this.handleCodePoints(t);const n=this.getByteData(s);let i=Laya.URL.formatURL(e),a=null==Laya.Utils.getFilecompatibleExtension(e)?Laya.Utils.getFileExtension(e):Laya.Utils.getFilecompatibleExtension(e);if("json"==a||"lmat"==a||"lh"==a||"ls"==a){let t=this.handleCodePoints(n);Laya.Loader.preLoadedMap[i]=JSON.parse(t)}else"lm"==a||"lani"==a||"ltcb.ls"==a?Laya.Loader.preLoadedMap[i]=n:Laya.Loader.preLoadedPackgURLMap[i]=n}e()})}handleCodePoints(t){const e=t.length;for(var n=[],s=0,i=t.length;s<i;s++)n[s]=t[s];let a,o="",r=0;for(;r<e;)a=n.slice(r,Math.min(r+32768,e)),o+=String.fromCharCode.apply(null,a),r+=32768;return o}getByteData(t){const e=t.readUint32(),n=t.readArrayBuffer(e),s=new Uint8Array(n);return pako.inflate(s)}};class Zt extends Y{constructor(){super(),this.timer2=0,this.uavNode=null,this.wingsNode=[]}onEnable(){const t=this.owner;this.uavNode=t.getChildByName("uav");for(let t=1;t<5;t++)this.wingsNode.push(this.uavNode.getChildAt(t))}onDisable(){super.onDisable(),this.wingsNode.length=0}onUpdate(){this.timer2+=.005*Laya.timer.delta,this.uavNode.transform.localPositionY+=.005*Math.sin(this.timer2),this.uavNode.transform.localPositionX+=.002*Math.cos(this.timer2);for(let t=0;t<this.wingsNode.length;t++){this.wingsNode[t].transform.localRotationEulerY+=10}}}class qt extends Y{constructor(){super(),this.ins=null,this.timer2=0,this.startPos=null,this.shootSpeed=400,this.shotEffect=null,this.tForwVec=this.vec3(),this.tForwQuat=this.quat()}onEnable(){this.ins=te.Instance;const t=this.owner,e=this.find("uav/body",t);this.startPos=e.getChildByName("start"),this.shotEffect=e.getChildByName("shotEffect").getChildAt(0)}onDisable(){super.onDisable(),this.recover(this.owner)}shoot(t){const e=this.ins,n=e.playerData,s=t.transform.position.clone();s.y=.1;const i=this.startPos.transform.position;let a=n.uavData.plaBullet;const o=v.GetRes(H[a]),r=v.InstantiateSprite3D(o,H[a]);r.transform.position=i,r.transform.lookAt(s,e.UpVec3,!1);let l=r.transform.rotationEuler;r.transform.rotationEuler=this.vec3(l.x+180,l.y,l.z+180);const h=v.GetComponent(kt,r);h.belong=3,h.bulletId=a,h.target=t,h.track=!1,h.speed=1,e.gameScene.addChild(r),this.shotEffect.particleSystem.play()}onUpdate(){const t=this.owner,e=this.ins,n=this.ins.player1.transform.position,s=this.tForwQuat,i=this.tForwVec;i.x=n.x,i.y=n.y+1.3,i.z=n.z,Laya.Vector3.lerp(t.transform.position,i,.05,i),t.transform.position=i,this.timer2+=Laya.timer.delta;const a=e.currShotEnemy;if(a){const n=a.transform.position,o=t.transform.position;i.x=n.x-o.x,i.y=0,i.z=-(n.z-o.z),Laya.Quaternion.rotationLookAt(i,e.UpVec3,s)}this.timer2>=this.shootSpeed&&(this.timer2=0,a&&this.shoot(a)),Laya.Quaternion.lerp(t.transform.rotation,s,.1,s),t.transform.rotation=s}}class te extends _{constructor(){super(),this.moveVec=this.vec3(),this.player=null,this.character=null,this.soldiers=[],this.tMoveVec=this.vec3(),this.tMoveVec2=this.vec3(),this.tPlayerQuat=this.quat(),this.tPlayerEndQuat=this.quat(),this.tPlayer1EndPos=this.vec3(),this.tCameraPos=this.vec3(),this.tCameraEndPos=this.vec3(),this.UpVec3=this.vec3(0,1,0),this.Green=this.vec4(0,1,0,1),this.Red=this.vec4(1,0,0,1),this._gameState=N.Ready,this.gameScene=null,this.camera=null,this.player1=null,this.playerComp=null,this.playerBody=null,this.enemyMgr=null,this.taskMgr=null,this.playerData=null,this.dirNode=null,this.currShotEnemy=null,this.isNewPlayer=!1}get gameState(){return this._gameState}set gameState(t){this._gameState=t,i.event(W.OnGameState)}onEnable(){S.startGame(),te.Instance=this;const t=v.GetRes(x.RockerNode,!0),e=v.InstantiatePrefab(x.RockerNode,t);this.owner.addChild(e),this.playerData=new Ft;const n=rt.levelData[Ht.currLevel].mapId+"",a=parseInt(n[0]),r=parseInt(n[1])||1,l="GameScene"+a;if(!V[l]||!M[l])return;Laya.loader.create(V[l],Laya.Handler.create(this,()=>{let t=Laya.loader.getRes(V[l]),e=NavMesh.buildNodesByJson(t);NavMesh.setZoneData("game",e)}));const h=[M[l],M.TankBullet1,M.TankBulletHit1,M.TankBullet2,M.TankBulletHit2,M.TankBullet3,M.TankBulletHit3,M.TankBullet5,M.TankBulletHit5,M.TankBullet4,M.PlayerSoldier,M.PlayerUav,M.Enemy1,M.Enemy2,M.Enemy3,M.Enemy4,M.Enemy1001,M.EnemyAtt2,M.EnemyAttRange1,M.EnemyAttRange2,M.EnemyDeath1,M.EnemyDeath2,M.PropAtt,M.PropBlood,M.PropShield,M.PropSpeed,M.PropAtt2,M.PropBlood2,M.PropShield2,M.PropSpeed2,M.PropLaser2,M.PropLightning2,M.PropWind2,M.PropWind3,M.EffectBoom,M.TaskCommNode,M.TaskTargetNode,M.TaskSaveNode,M.TaskGuardNode,M.TankSkill2,M.TankSkill21,M.TankSkill4],c=Ht.tankId;h.push(G[c]),this.m3DAssets.push.apply(this.m3DAssets,h);const d=[M.TankBullet1,M.TankBulletHit1,M.TankBullet2,M.TankBulletHit2,M.TankBullet3,M.TankBulletHit3,M.TankBullet5,M.TankBulletHit5,M.TankBullet4,M.EffectBoom,M.EnemyDeath1,M.EnemyDeath2,M.EnemyAtt2,M.PropAtt,M.PropBlood,M.PropShield,M.PropSpeed,M.PropAtt2,M.PropBlood2,M.PropShield2,M.PropSpeed2,M.PropLaser2,M.PropLightning2,M.PropWind2,M.PropWind3,M.Enemy1,M.Enemy2,M.Enemy3,M.Enemy4,M.Enemy1001,M.TankSkill2,M.TankSkill21,M.TankSkill4];Laya.loader.create(h,Laya.Handler.create(this,()=>{const t=Laya.loader.getRes(M[l]);Laya.stage.addChild(t),t.zOrder=-1,this.gameScene=t;const n=this.playerData,a=n.level<1;this.isNewPlayer=a;const o=this.vec3(.3,.1,.1),h=this.vec3(.57,.73,.72);let m=o;2==r&&(m=h),t.enableFog=!0,t.fogColor=m,t.fogStart=0,t.fogRange=0,Laya.Tween.to(t,{fogStart:3.3,fogRange:7},2e3,Laya.Ease.circOut,Laya.Handler.create(this,()=>{a||i.event(W.OnGameTask,[n.level,n.task])}));let u=null;a&&v.OpenDialog(x.GuidanceHandNode,null,t=>{u=t},!0);const p=t.getChildByName("Main Camera");p.enableHDR=!1,p.clearColor=this.vec4(m,1),this.camera=p;const g=t.getChildByName("Directional Light");g.shadowStrength=.5,g.shadowMode=Laya.ShadowMode.SoftLow,g.shadowDistance=7,g.shadowResolution=512,g.shadowCascadesMode=Laya.ShadowCascadesMode.NoCascades,g.intensity=1.2;const y=t.getChildByName("player");this.player=y;const f=v.GetRes(G[c]);this.player1=f,f.getChildAt(6).active=3!=r;const S=t.getChildByName("scene").getChildByName("windEffect");S&&(S.active=3==r),this.playerBody=f.getChildByName("body"),f.transform.localPosition=this.vec3(),t.addChild(f);const D=v.GetComponent(wt,f);this.playerComp=D;const L=D.initMaterail(c);this.character=D.addCharacter(y);const C=v.GetRes(M.PlayerSoldier);if(n.soldierData){const t=n.soldierData.merNum+1;for(let e=1;e<t;e++){const t=v.InstantiateSprite3D(C,M.PlayerSoldier);v.GetComponent(zt,t).target=f.getChildByName("body").getChildByName("s"+e),this.gameScene.addChild(t),this.soldiers.push(t)}}const E=v.GetRes(M.PlayerUav);if(n.uavData){const t=1;for(let e=0;e<t;e++){const t=v.InstantiateSprite3D(E,M.PlayerUav);v.GetComponent(Zt,t),v.GetComponent(qt,t),this.gameScene.addChild(t)}}const b=e.getComponent(k);b.initTouch(s.Instance.bgNode),b.onTouchDown=(()=>{a&&u&&(u.destroy(!0),u=null,i.event(W.OnGameTask,[n.level,n.task]))}),b.onTouchMove=((t,e)=>{const n=-35/180*Math.PI;t=t*Math.cos(n)+e*Math.sin(n),e=e*Math.cos(n)-t*Math.sin(n),Laya.Vector3.normalize(this.vec3(t,0,e),this.moveVec),L.uvMove=1}),b.onTouchUp=(()=>{this.moveVec.x=this.moveVec.y=this.moveVec.z=0,L.uvMove=0});const T=this.owner.getComponent(Rt);this.enemyMgr=T,this.taskMgr=this.owner.getComponent(Yt);const I=this.owner.getComponent(Mt);I.enemyAttRange1=v.GetRes(M.EnemyAttRange1),I.enemyAttRange2=v.GetRes(M.EnemyAttRange2),I.enemyAtt2=v.GetRes(M.EnemyAtt2);const A=v.GetRes(x.PlayerDirNode,!0),_=v.InstantiatePrefab(x.PlayerDirNode,A);this.owner.addChild(_),this.dirNode=_.getComponent(xt),this.gameState=N.Start,this.compileShader(d)})),i.on(W.OnSoldierDeath,this,t=>{const e=this.soldiers.indexOf(t);e>-1&&this.soldiers.splice(e,1)}),i.on(W.OnGameBoss,this,t=>{this.gameState=N.Pause,Ut.Tips(o.BattleScene[2]),i.event(W.OnAnimState,1);const e=this.camera,n=e.transform.rotationEuler.clone(),s=e.transform.position.clone(),a=t.getChildByName("look"),r=a.transform.position,l=a.transform.rotationEuler;Laya.Tween.clearAll(e.transform),v.Sequence(e.transform,[1e3,{localPositionX:r.x,localPositionY:r.y,localPositionZ:r.z,localRotationEulerX:l.x,localRotationEulerY:(l.y-180)%360,localRotationEulerZ:l.z},Laya.Ease.expoOut],[1e3,{localPositionX:r.x,localPositionY:r.y,localPositionZ:r.z,localRotationEulerX:l.x,localRotationEulerY:(l.y-180)%360,localRotationEulerZ:l.z}],[1e3,{localPositionX:s.x,localPositionY:s.y,localPositionZ:s.z,localRotationEulerX:n.x,localRotationEulerY:n.y,localRotationEulerZ:n.z},null,()=>{this.gameState=N.Start}])})}getEnemyTarget(){const t=this.soldiers;if(Yt.Instance.guardNode)return Yt.Instance.guardNode;if(t.length){return t[d.GetRandom(t.length-1,0)]}return this.player1}compileShader(t){for(let e=0;e<t.length;e++){const n=t[e],s=v.GetRes(n);s.transform.position=this.vec3(),v.GetComponent(Ct,s),this.gameScene.addChild(s),Laya.timer.frameOnce(2,this,()=>{s.removeSelf()})}}onDisable(){super.onDisable(),te.Instance=null,this.gameScene.destroy(),this.gameScene=null,NavMesh.zoneNodes.game&&delete NavMesh.zoneNodes.game,A.clearGPUMemory(this.m3DAssets),A.clearPrefabPools(),Laya.Resource.destroyUnusedResources(),Jt.compilePack()}onUpdate(){const t=this.player,e=this.player1,n=this.character,s=Laya.timer.delta;if(!t||!e||!n)return;0!=t.transform.localPositionY&&(t.transform.localPositionY=0);let i=this.moveVec,a=this.tMoveVec,o=this.playerComp.currSpeed;if(a.x=i.x*o*s,a.y=0,a.z=i.z*o*s,n.move(a),i.x||i.z){const t=this.playerBody;let e=this.tMoveVec2;e.x=i.x,e.z=-i.z,Laya.Quaternion.rotationLookAt(e,this.UpVec3,this.tPlayerQuat);const n=t.transform.rotation;Laya.Quaternion.slerp(n,this.tPlayerQuat,.01*s,this.tPlayerEndQuat),t.transform.rotation=this.tPlayerEndQuat}Laya.Vector3.lerp(e.transform.position,t.transform.position,.1,this.tPlayer1EndPos),e.transform.position=this.tPlayer1EndPos}onLateUpdate(){const t=this.camera;if(!t)return;const e=this.player1.transform.position,n=this.tCameraEndPos;n.x=e.x-2.5,n.y=e.y+6,n.z=e.z+2.5,Laya.Vector3.lerp(t.transform.position,n,1,this.tCameraPos),t.transform.position=this.tCameraPos}}te.Instance=null;class ee extends _{constructor(){super(),this.receBtn=null,this.rece3Btn=null,this.goldItem=null,this.diamItem=null,this.scoreLab=null,this.closeHandler=null}onEnable(){}setData(t){const e=te.Instance,n=e.playerData,s=["bg","bg/resNode/left","bg/resNode/right","bg/resNode/bg","bg/resNode/title","bg/bg2","bg/bg3"],i=["game/bg2.png","game/taskWin1.png","game/taskWin2.png","game/taskWin3.png","game/taskWin.png","game/tBg1.png","game/tBg3.png"];if(t){for(let t=0;t<s.length;t++){const e=s[t];this.find(e,this.owner).skin=i[t]}Ht.currLevel<Object.keys(Bt.taskData).length&&(Ht.currLevel++,Ht.updateLevel(),e.isNewPlayer&&(Q.guid2=!0))}this.scoreLab.text=n.score+"";const a=rt.levelData[n.level],o=Math.floor(n.score*a.scoreGold),r=Math.floor(n.score*a.scoreJewel),l=this.goldItem.getChildByName("numLab"),h=this.diamItem.getChildByName("numLab");l.text=d.FormatNumber(o),h.text=r+"";const c=()=>{v.CloseDialog(this).then(()=>{Laya.Scene.closeAll(),v.CloseDialog(this).then(()=>{Laya.Scene.open("LobbyScene.scene")})})};v.SetClick(this.receBtn,this,()=>{Ht.reward([[1,o],[2,r]]),c()}),v.SetClick(this.rece3Btn,this,()=>{S.showRewardVideoAd("454658549471127_492523512351297").then(()=>{Ht.reward([[1,3*o],[2,3*r]]),c()})})}onDisable(){super.onDisable()}}class ne extends _{constructor(){super(),this.ins=null,this.insUI=null,this.skillCDSpr=null,this.skillCD=0,this.skillTimer=0}onEnable(){b.music(R.GameBgm1);const t=s.Instance;this.insUI=t;const e=te.Instance;this.ins=e;const n=e.playerData;Laya.timer.loop(1e4,this,()=>{A.clearPrefabPools()}),v.SetClick(t.setBtn,this,()=>{e.gameState==N.Start&&(e.gameState=N.Pause,v.OpenDialog(x.SettingDialog))}),this.skillTimer=0,this.skillCD=lt[n.tank].cd,this.initSkillBtn(lt[n.tank].icon),v.SetClick(t.skillBtn,this,()=>{if(this.skillTimer>0)return;this.skillTimer=this.skillCD,this.updateSkill();const t=this["skill"+n.tank].bind(this);t&&t()}),t.scoreLab.text=d.FormatNumber(n.score),t.goldLab.text=d.FormatNumber(Ht.gold),t.goldSpeedLab.text=d.FormatNumber(Ht.goldSpeed)+"/s",t.diamondLab.text=d.FormatNumber(Ht.diamond),i.on("userConfig.gold",this,()=>{t.goldLab.text=d.FormatNumber(Ht.gold)}),i.on("userConfig.diamond",this,()=>{t.diamondLab.text=d.FormatNumber(Ht.diamond)}),i.on(W.OnPlayerScore,this,()=>{t.scoreLab.text=d.FormatNumber(n.score)}),i.on(W.OnGameOver,this,()=>{e.gameState=N.End,v.OpenDialog(x.TaskOverDialog,null,t=>{t.getComponent(ee).setData(!1),b.sound(R.GameLose)})}),i.on(W.OnGameSuccess,this,()=>{e.gameState=N.End,v.OpenDialog(x.TaskOverDialog,null,t=>{t.getComponent(ee).setData(!0),b.sound(R.GameWin)})}),i.on(W.OnGameState,this,()=>{e.gameState!=N.Start&&k.Instance.stopMove()})}initSkillBtn(t){const e=this.insUI,n=e.skillCDIma,s=e.skillCDLab;e.skillIconIma.skin=t;const i=new Laya.Sprite;this.skillCDSpr=i;const a=new Laya.Sprite;a.loadImage("game/skillCD.png"),i.mask=a,n.addChild(i),i.graphics.drawPie(64,64,64,-90,-90,"#ffc01d"),s.text=Math.floor(this.skillCD/1e3)+"",s.visible=!1,n.visible=!1}updateSkill(){const t=this.skillTimer,e=this.skillCD,n=this.insUI,s=n.skillCDLab,i=this.skillCDSpr,a=(e-t)/e*360-90;i.graphics.drawPie(64,64,64,-90,a,"#ffc01d"),s.text=Math.round(t/1e3)+"",s.visible=t>0,n.skillCDIma.visible=t>0,t<=0&&i.graphics.clear()}skill1(){const t=v.GetRes(x.PlayerBomberNode,!0),e=v.InstantiatePrefab(x.PlayerBomberNode,t);this.ins.owner.addChild(e),b.sound(R.TankSkill1)}skill2(){i.event(W.OnSkillFire)}skill3(){b.sound(R.TankSkill3),i.event(W.OnSkillAtk)}skill4(){i.event(W.OnSkillPulse)}onUpdate(){this.ins.gameState==N.Start&&this.skillTimer>0&&(this.skillTimer-=Laya.timer.delta,this.updateSkill())}onDisable(){super.onDisable(),b.stopMusic()}}class se extends _{constructor(){super()}onEnable(){this.owner.on("click",this,this.nextStep)}nextStep(){jt&&jt.nextStep()}onDisable(){this.owner.off("click",this,this.nextStep)}}class ie extends t.LobbySceneUI{constructor(){super()}onEnable(){ie.Instance=this}onDisable(){ie.Instance=null}}ie.Instance=null;class ae{static Register(t,e){const n=this.Handlers;n[t]||(n[t]=e)}static UnRegister(t){const e=this.Handlers;e[t]&&delete e[t]}}ae.Handlers={};class oe extends _{constructor(){super(),this.handlerKey=null,this.redDot=null}onEnable(){this.redDot||(this.redDot=this.owner.getChildByName("red.dot")),this.longUpdateDelta=1e3,this.onLongUpdate()}onDisable(){}onLongUpdate(){if(this.redDot&&ae.Handlers[this.handlerKey]){const t=ae.Handlers[this.handlerKey]();this.redDot.visible=t}}onUpdate(){super.onUpdate()}}class re extends Y{constructor(){super(),this.eid=0,this.ins=null,this.rightUpLeg=null,this.mCurrHp=10,this.mTimer=0,this.mSpeed=.5,this.mDuration=0,this.mStartPos=null,this.mEndPos=this.vec3(),this.mLastPos=this.vec3(),this.enemyData=null,this.enemyAnim=null,this.eid=re.Eid++}onEnable(){const t=this.owner;this.ins=Se.Instance,this.enemyAnim=t.getComponent(gt),this.rightUpLeg=this.find("Hips/RightUpLeg",t),this.initEnemy();const e=d.GetRandom(4,1);b.sound(R["EnemyAppear"+e]),t.getComponent(Laya.PhysicsCollider).collisionGroup=w.Enemy}initEnemy(){const t=this.owner;this.mCurrHp=5,this.mTimer=0,this.mSpeed=d.GetRandom(12,5)/100;const e=this.enemyAnim;e.enemyState=this.mSpeed>=.06?pt.Run:pt.Idle,e.enemyState==pt.Run&&(e.animator.speed=this.mSpeed/.12),this.mStartPos=t.transform.position.clone();const n=Laya.Vector3.distance(this.mStartPos,this.mEndPos);this.mDuration=n/this.mSpeed;const s=this.vec3(this.mEndPos.x-this.mStartPos.x,0,-(this.mEndPos.z-this.mStartPos.z)),i=this.quat();Laya.Quaternion.rotationLookAt(s,this.vec3(0,1,0),i),t.transform.rotation=i}onHit(){this.enemyAnim.enemyState!=pt.Death&&(this.mCurrHp-=d.GetRandom(20,10)/10,this.mCurrHp<=0&&this.onDeath())}onDeath(){const t=this.owner,e=this.enemyAnim;d.GetRandom(4,1);i.event(W.OnLobbyEnemyDeath,[this.eid,this.enemyData]);const n=this.ins.lobbyScene;e.onDeath().then(()=>{t.removeSelf();const e=this.rightUpLeg.transform.position;e.y=.02;const s=v.GetRes(M.EnemyDeath1),i=v.GetRes(M.EnemyDeath2),a=v.InstantiateSprite3D(s,M.EnemyDeath1);v.GetComponent(Ct,a),a.transform.position=e,n.addChild(a);const o=v.InstantiateSprite3D(i,M.EnemyDeath2);v.GetComponent(Ct,o),o.transform.position=e,n.addChild(o),setTimeout(()=>{a.removeSelf(),o.removeSelf()},1e3),this.ins.hangupMgr.onDropCoin(e)})}onDisable(){super.onDisable(),this.recover(this.owner)}onUpdate(){const t=this.owner,e=this.enemyAnim.enemyState;e!=pt.Death&&e!=pt.Hit&&(this.mTimer>=.8*this.mDuration?this.onDeath():(this.mTimer+=this.mSpeed,Laya.Vector3.lerp(this.mStartPos,this.mEndPos,this.mTimer/this.mDuration,this.mLastPos),t.transform.position=this.mLastPos))}}re.Eid=1;class le extends Y{constructor(){super(),this.coinNode=null}onEnable(){this.coinNode=this.owner.getChildAt(0)}onDisable(){super.onDisable(),this.recover(this.owner)}onUpdate(){this.coinNode.transform.localRotationEulerY-=1}}class he extends _{constructor(){super(),this.ins=null,this.coinNode0=null,this.coinNodes=[],this.coinNodeEndPos=null}onEnable(){this.ins=Se.Instance,Laya.timer.loop(1e4,this,()=>{const t=this.coinNodeEndPos,e=this.coinNodes;for(let n=0;n<e.length;n++){const s=e[n];Laya.Tween.to(s.transform,{localPositionX:t.x,localPositionY:t.y,localPositionZ:t.z},1e3,null,Laya.Handler.create(this,()=>{s.removeSelf()}))}e.length=0,b.sound(R.Money)})}onDropCoin(t){this.coinNode0||(this.coinNode0=v.GetRes(M.GameCoinNode));const e=d.GetRandom(2,1);for(let n=0;n<e;n++){let e=.1+.3*Math.random(),n=d.GetRandom(0,360)/180*Math.PI,s=t.x+Math.cos(n)*e,i=t.z+Math.sin(n)*e,a=d.GetRandom(30,20)/10;const o=v.InstantiateSprite3D(this.coinNode0,M.GameCoinNode);v.GetComponent(le,o),o.transform.position=this.vec3(s,0,i),o.transform.localScale=this.vec3(a,a,a),this.ins.lobbyScene.addChild(o),this.coinNodes.push(o)}}onDisable(){super.onDisable()}}class ce extends Y{constructor(){super()}onEnable(){const t=this.owner,e=t.getChildByName("end"),n=t.scene,s=[],i=new Laya.BoxColliderShape(.2,.1,.2);if(n.physicsSimulation.shapeCastAll(i,t.transform.position,e.transform.position,s,null,null,w.Default,w.Enemy),s&&s.length)for(let t=0;t<s.length;t++){const e=s[t];if(e&&e.collider){const t=e.collider.owner.getComponent(re);t&&t.onHit()}}Laya.timer.once(500,this,()=>{t.removeSelf()})}onDisable(){super.onDisable(),this.recover(this.owner)}}class de extends Y{constructor(){super(),this.ins=null,this.start=null,this.target=null,this.lightned=[],this.tForwVec=this.vec3(),this.tPosVec=this.vec3()}onEnable(){const t=Se.Instance;this.ins=t;const e=this.owner,n=this.target.getComponent(re);n&&n.onHit(),this.onUpdate(),Laya.timer.once(200,this,()=>{e.removeSelf()}),Laya.timer.once(50,this,()=>{if(this.lightned.length<3){const t=this.ins,e=this.getMinEnemy(2);if(e){this.lightned.push(e.getComponent(re).eid);const n=v.GetRes(H[7]),s=v.InstantiateSprite3D(n,H[7]),i=v.GetComponent(de,s);i.lightned=this.lightned,i.start=this.target,i.target=e,t.lobbyScene.addChild(s)}}})}getMinEnemy(t=1){const e=this.ins.enemys,n=this.target.transform.position;let s=0,i=null;for(let a=0;a<e.length;a++){const o=e[a];if(!o)continue;const r=o.getComponent(re),l=o.transform.position;let h=(l.x-n.x)*(l.x-n.x)+(l.z-n.z)*(l.z-n.z);this.lightned.indexOf(r.eid)&&h<=t*t&&(!s||h<s)&&(s=h,i=o)}return i}onDisable(){super.onDisable(),this.recover(this.owner)}onUpdate(){const t=this.start.transform,e=this.target.transform;if(t&&e){const n=this.owner,s=this.tPosVec;s.x=t.position.x,s.y=de.Y,s.z=t.position.z,n.transform.position=s;const i=this.tForwVec;Laya.Vector3.subtract(t.position,e.position,i),i.y=0,i.x/=1.8,i.z/=1.8,n.transform.worldMatrix.setForward(i)}}}de.Y=0;class me extends _{constructor(){super(),this.ins=null,this.end=null,this.hitResult=new Laya.HitResult,this.forward=this.vec3(),this.boxShape=new Laya.BoxColliderShape(.2,.2,.2),this.tDirVec=this.vec3(),this.bulletId=null,this.target=null,this.speed=1,this.ignore=!1,this.uav=!1}onEnable(){const t=Se.Instance;this.ins=t;const e=this.owner;this.end=e.getChildByName("end"),Laya.timer.once(1e3/this.speed,this,()=>{e.removeSelf()}),e.transform.getForward(this.forward)}onDisable(){super.onDisable(),this.hitResult.collider=null,this.recover(this.owner)}onHit(t){const e=this.bulletId,n=F[e],s=v.GetRes(n),i=v.InstantiateSprite3D(s,n);v.GetComponent(Ct,i),v.ScaleParticle3DNode(i,{1:1,2:1,3:1,4:1,5:3,8:1,9:1}[e]||1),i.transform.position=t.point,this.ins.lobbyScene.addChild(i),setTimeout(()=>{i.removeSelf()},1e3)}onUpdate(){if(!this.target)return;const t=this.owner;if(!t.parent)return;const e=t.scene;if(this.hitResult.collider=null,e.physicsSimulation.shapeCast(this.boxShape,t.transform.position,this.end.transform.position,this.hitResult,null,null,w.Default,w.All^w.Player),this.hitResult.collider){const e=this.hitResult.collider.owner.getComponent(re);if(e&&!this.ignore&&e.onHit(),!e||e.enemyAnim.enemyState!=pt.Death)return t.removeSelf(),void this.onHit(this.hitResult)}const n=this.forward,s=this.tDirVec;s.x=.05*-n.x*this.speed,s.y=this.uav?.05*-n.y*this.speed:0,s.z=.05*-n.z*this.speed,t.transform.translate(s,!1)}}class ue extends Y{constructor(){super(),this.ins=null,this.shotGun=null,this.startPos=null,this.startPos2=null,this.shotEffect=null,this.atkData=null,this.mTimer=0,this.mRotaQuat=this.quat(),this.mDirVec=this.vec3(),this.mPos=this.vec3(),this.mShootSpeed=150,this.tankBullet1=null,this.tankBulletHit1=null}onEnable(){const t=this.owner,e=Se.Instance;this.ins=e,this.tankBullet1=v.GetRes(M.TankBullet1),this.tankBulletHit1=v.GetRes(M.TankBulletHit1),this.mTimer=0;const n=t.getChildByName("gun");this.shotGun=n,this.shotEffect=n.getChildByName("shotEffect").getChildAt(0),this.startPos=n.getChildByName("start"),de.Y=this.startPos.transform.position.y,this.startPos2=n.getChildByName("start2"),this.atkData=B.tankAttData[Ht.attLevel],this.mShootSpeed=this.atkData.attSpeed,i.on("userConfig.attLevel",this,()=>{this.atkData=B.tankAttData[Ht.attLevel],this.mShootSpeed=this.atkData.attSpeed})}onDisable(){super.onDisable()}shoot(t){const e={5:!0,8:!0,9:!0},n=this.ins,s=this.shotGun,i=this.startPos,a=this.atkData,o=s.transform.rotationEuler.clone();let r=a.shoNumbe,l=a.bulNumbe,h=a.speId;if(6==h){const t=v.GetRes(H[6]),e=v.InstantiateSprite3D(t,H[6]);return e.transform.localPosition=this.startPos2.transform.localPosition,e.transform.localRotationEuler=this.vec3(),v.GetComponent(ce,e),void s.addChild(e)}if(7==h){const e=v.GetRes(H[7]),s=v.InstantiateSprite3D(e,H[7]),i=v.GetComponent(de,s);return i.lightned=[t.getComponent(re).eid],i.start=this.startPos,i.target=t,void n.lobbyScene.addChild(s)}const c=[[0],[-5,5],[-10,0,10],[-15,-5,5,15],[-20,-10,0,10,20]][l-1],d=v.GetRes(H[h]);v.Schedule(this,()=>{c.length;for(let s=0;s<c.length;s++){const r=c[s],l=v.InstantiateSprite3D(d,H[h]);9==h&&v.ScaleParticle3DNode(l,2),l.transform.position=i.transform.position,l.transform.rotationEuler=this.vec3(o.x,o.y+r,o.z);const m=v.GetComponent(me,l);m.uav=!1,m.ignore=!1,m.bulletId=h,m.target=t,m.speed=a.speed,n.lobbyScene.addChild(l),e[h]&&v.EmitParticle3DNode(l)}this.shotEffect.particleSystem.play()},0,50,r)}onUpdate(){const t=this.ins,e=(this.owner,this.shotGun),n=this.ins.getMinEnemy(this.mPos),s=this.mRotaQuat,i=this.mDirVec;if(n){t.currShotEnemy=n,this.mTimer+=Laya.timer.delta,this.mTimer>=this.mShootSpeed&&(this.mTimer=0,this.shoot(n)),i.x=n.transform.position.x-e.transform.position.x,i.z=-(n.transform.position.z-e.transform.position.z),Laya.Quaternion.rotationLookAt(i,t.UpVec3,s);const a=e.transform.rotation;Laya.Quaternion.lerp(a,s,.15,s),e.transform.rotation=s}else t.currShotEnemy=null}}class pe extends _{constructor(){super(),this.titleLab=null,this.iconIma=null,this.nameLab=null,this.descIma=null,this.descLab=null,this.btnLab=null,this.closeBtn=null,this.onSure=null}static Reward(t,e){v.OpenDialog(x.CommonRewardDialog,e,e=>{e.getComponent(pe).setData(t)})}static Adva(t,e){v.OpenDialog(x.CommonRewardDialog,e,e=>{e.getComponent(pe).setAdvaData(t)})}setData(t){this.onSure=t.onSure,t.title&&(this.titleLab.text=t.title),t.btnTxt&&(this.btnLab.text=t.btnTxt),t.descIcon?this.descIma.skin=t.descIcon:(this.descIma.visible=!1,this.descLab.x=284),this.nameLab.text=t.name,this.iconIma.skin=t.icon,this.descLab.text=t.desc}setAdvaData(t){const e={1:["curt","strike","strHurt"],2:["hpNumb"],3:["curt","strike","strHurt"],4:["curt","strike","strHurt"]},n={1:[100,100,100],2:[100],3:[1,100,100],4:[1,100,100]},s=this.owner.getChildByName("bg");s.height=680;const i=s.getChildByName("top2"),a=s.getChildByName("descNode"),r=a.getChildByName("attr1"),l=a.getChildByName("attr2");i.visible=!0,this.closeBtn.visible=!1,this.titleLab.text=o.Default[6],this.iconIma.skin=`lobby/icon${t}.png`,this.nameLab.text=o.LobbyScene[t],this.descLab.visible=!1,a.visible=!0,a.text=o.TankAdvaDialog[t];const h=Ht[{1:"attLevel",2:"hpLevel",3:"uavLevel",4:"soldierLevel"}[t]],c=B[{1:"tankAttData",2:"tankHpData",3:"tankUavData",4:"tankSoldierData"}[t]],d=c[h-1],m=c[h];r.text=l.text="";for(let s=0;s<e[t].length;s++){const i=e[t][s];let a=d[i],o=m[i];const h=n[t][s];a=Math.floor(a*h),o=Math.floor(o*h),r.text+=`${a}%\n`,l.text+=`→ ${o}%\n`}this.btnLab.text=o.Default[7],this.btnLab.parent.skin="lobby/btn1.png"}onEnable(){v.SetClick(this.closeBtn,this,()=>{v.CloseDialog(this)}),v.SetClick(this.btnLab.parent,this,()=>{this.onSure&&this.onSure(),v.CloseDialog(this)})}onDisable(){super.onDisable()}}class ge extends _{constructor(){super(),this.titleLab=null,this.iconIma=null,this.descLab=null,this.descLab2=null,this.closeBtn=null,this.sureBtn=null,this.mRewardType=1}setData(t){this.mRewardType=t,this.titleLab.text=o.GetRewardDialog[t],2==t&&(this.iconIma.skin="lobby/rDiamond.png");const e=1==t?X.VideoGold+"":X.VideoDiamond+"",n=o.GetRewardDialog[3+t].replace("$$",e);this.descLab.text=o.GetRewardDialog[3],this.descLab2.text=n}onEnable(){v.SetClick(this.closeBtn,this,()=>{v.CloseDialog(this)}),v.SetClick(this.sureBtn,this,()=>{S.showRewardVideoAd("454658549471127_492523512351297").then(()=>{1==this.mRewardType?Ht.gold+=X.VideoGold:Ht.diamond+=X.VideoDiamond,b.sound(R.Money),v.CloseDialog(this)})})}onDisable(){super.onDisable()}}class ye extends Y{constructor(){super(),this.ins=null,this.timer2=0,this.shotGun=null,this.startPos=null,this.shootSpeed=400,this.shotEffect=null,this.tForwVec=this.vec3(),this.tForwQuat=this.quat()}onEnable(){this.ins=Se.Instance;const t=this.owner;v.GetComponent(Vt,t);this.shotGun=this.find("Hips/Spine/Spine1/Spine2/RightShoulder/RightArm/RightForeArm/RightHand/RightHandIndex1/gun1/gun2",t),this.startPos=this.shotGun.getChildByName("start"),this.shotEffect=this.shotGun.getChildByName("shotEffect").getChildAt(0)}onDisable(){super.onDisable(),this.recover(this.owner)}shoot(t){const e=this.ins,n=(this.shotGun,this.owner.transform.rotationEuler.clone());const s=v.GetRes(H[1]),i=v.InstantiateSprite3D(s,H[1]);i.transform.position=this.startPos.transform.position,i.transform.rotationEuler=n;const a=v.GetComponent(me,i);a.uav=!1,a.ignore=!0,a.bulletId=1,a.target=t,a.speed=1.2,e.lobbyScene.addChild(i),this.shotEffect.particleSystem.play()}onUpdate(){if(this.timer2+=Laya.timer.delta,this.timer2>=this.shootSpeed){this.timer2=0;const t=this.ins.currShotEnemy;if(t){const e=this.owner,n=this.tForwVec,s=this.tForwQuat,i=t.transform.position,a=e.transform.position;n.x=i.x-a.x,n.z=-(i.z-a.z),Laya.Quaternion.rotationLookAt(n,this.ins.UpVec3,s),e.transform.rotation=s,this.shoot(t)}}}}class fe extends Y{constructor(){super(),this.ins=null,this.timer2=0,this.startPos=null,this.shootSpeed=400,this.shotEffect=null,this.tForwVec=this.vec3(),this.tForwQuat=this.quat(),this.uavData=null}onEnable(){this.ins=Se.Instance;const t=this.owner,e=this.find("uav/body",t);this.startPos=e.getChildByName("start"),this.shotEffect=e.getChildByName("shotEffect").getChildAt(0)}onDisable(){super.onDisable(),this.recover(this.owner)}shoot(t){const e=this.ins,n=(this.owner,t.transform.position.clone());n.y=.1;const s=this.startPos.transform.position;let i=this.uavData.plaBullet;const a=v.GetRes(H[i]),o=v.InstantiateSprite3D(a,H[i]);o.transform.position=s,o.transform.lookAt(n,e.UpVec3,!1);let r=o.transform.rotationEuler;o.transform.rotationEuler=this.vec3(r.x+180,r.y,r.z+180);const l=v.GetComponent(me,o);l.uav=!0,l.ignore=!0,l.bulletId=i,l.target=t,l.speed=1.2,e.lobbyScene.addChild(o),this.shotEffect.particleSystem.play()}onUpdate(){this.timer2+=Laya.timer.delta;const t=this.owner,e=this.ins.currShotEnemy,n=this.tForwQuat;if(e){const s=this.tForwVec,i=e.transform.position,a=t.transform.position;s.x=i.x-a.x,s.z=-(i.z-a.z),Laya.Quaternion.rotationLookAt(s,this.ins.UpVec3,n)}this.timer2>=this.shootSpeed&&(this.timer2=0,e&&this.shoot(e)),Laya.Quaternion.lerp(t.transform.rotation,n,.1,n),t.transform.rotation=n}}class Se extends _{constructor(){super(),this.insUI=null,this.mTanks={},this.soldiers=[],this.uavs=[],this.enemys=[],this.lobbyScene=null,this.hangupMgr=null,this.currShotEnemy=null,this.UpVec3=new Laya.Vector3(0,1,0)}onEnable(){S.startGame(),b.music(R.LobbyBgm1),Se.Instance=this;const t=ie.Instance;this.insUI=ie.Instance;const e=Ht.currLevel;t.levelLab.text=`Level ${e}: ${rt.levelData[e].name}`,t.goldLab.text=d.FormatNumber(Ht.gold),t.goldSpeedLab.text=d.FormatNumber(Ht.goldSpeed)+"/s",t.diamLab.text=d.FormatNumber(Ht.diamond),v.SetClick(t.goldAddBtn,this,()=>{v.OpenDialog(x.GetRewardDialog,null,t=>{t.getComponent(ge).setData(1)},!1,!0)}),v.SetClick(t.diamAddBtn,this,()=>{v.OpenDialog(x.GetRewardDialog,null,t=>{t.getComponent(ge).setData(2)},!1,!0)}),Se.initAuidoBtn(t.audioBtn),v.SetClick(t.audioBtn,this,()=>{const e=C.musicVolume;C.musicVolume=e?0:1,Se.initAuidoBtn(t.audioBtn)});let n=Ht.tankId;const s=Ht.tankIds,a=Ht.tankAdvs,r=B.tankData,l=t.startBtn;v.SetClick(l,this,()=>{S.playerInfo.newPlayer||S.showInterstitialAd(),Ht.tankId=n,Laya.timer.frameOnce(1,this,()=>{Laya.Scene.closeAll(),Laya.timer.frameOnce(1,this,()=>{Laya.Scene.open("BattleScene.scene")})})}),l.visible=!1,v.SetClick(t.tankBtn,this,()=>{Q.isClickTankDialog=!0,v.OpenDialog(x.TankDialog,t.dialog,null,!1,!1,!0)}),this.initSkillItems();const h=[M.LobbyScene,M.GameCoinNode,M.PlayerSoldier,M.PlayerUav,M.TankBullet1,M.TankBulletHit1,M.TankBullet2,M.TankBulletHit2,M.TankBullet3,M.TankBulletHit3,M.TankBullet5,M.TankBulletHit5,M.TankBullet4,M.EffectBoom,M.PropLaser2,M.PropLightning2,M.PropWind2,M.PropWind3,M.TankSkill2,M.Enemy1,M.Enemy2,M.Enemy3,M.Enemy4,M.Enemy1001,M.EnemyDeath1,M.EnemyDeath2],c=t.leftBtn,m=t.rightBtn,u=t.unlockBtn,p=u.getChildByName("iconIma"),g=u.getChildByName("priceLab"),y=u.getChildByName("red.dot");v.SetClick(u,this,()=>{const t=r[n],e=t.unlock;e==P.Diamond?Ht.diamond>=t.unNumb?(Ht.diamond-=t.unNumb,s.push(n),u.visible=!1,l.visible=!0,Se.ShowNewTank(n)):Ut.Tips(o.Default[2]):e==P.Gold?Ht.gold>=t.unNumb?(Ht.gold-=t.unNumb,s.push(n),u.visible=!1,l.visible=!0,Se.ShowNewTank(n)):Ut.Tips(o.Default[1]):e==P.Adv&&(a[n]||(a[n]=0),S.showRewardVideoAd("454658549471127_492523512351297").then(()=>{a[n]++,a[n]>=t.unNumb?(s.push(n),u.visible=!1,l.visible=!0,Se.ShowNewTank(n)):g.text=a[n]+"/"+t.unNumb}))}),c.visible=m.visible=!1;let f=!1;u.visible=!1;const D=this.mTanks,L=t=>{if(f)return;f=!0,l.visible=!1,u.visible=!1;let e=1==t?n+1:n-1;if(1==t&&e>4&&(e=1),-1==t&&e<1&&(e=4),D[e]){const i=D[n];v.GetComponent(ue,i).enabled=!1;const h=D[e];Laya.Tween.to(i.transform,{localRotationEulerY:90*t},500,Laya.Ease.circOut,Laya.Handler.create(this,()=>{Laya.Tween.to(i.transform,{localPositionX:2*t},1500,Laya.Ease.backIn,Laya.Handler.create(this,()=>{i.active=!1})),h.transform.localPositionX=-2*t,h.transform.localRotationEulerY=90*t,h.active=!0,Laya.Tween.to(h.transform,{localPositionX:0},1500,Laya.Ease.backIn,Laya.Handler.create(this,()=>{Laya.Tween.to(h.transform,{localRotationEulerY:0},500,Laya.Ease.circOut,Laya.Handler.create(this,()=>{v.GetComponent(ue,h).enabled=!0,n=e,f=!1;const t=s.indexOf(n)>-1;if(l.visible=t,t)Ht.tankId=n;else{const t=r[n],e=t.unlock;e==P.Lv||e==P.Default?(p.visible=!1,g.text=o.TankDialog[1].replace("$$",t.unNumb+""),g.x=163):(p.skin=K[e],p.visible=!0,g.text=e==P.Adv?(a[n]||0)+"/"+t.unNumb:d.FormatNumber(t.unNumb),g.x=197),p.skin=K[t.unlock],y.visible=Ht.reddots.indexOf("tank"+n)>-1,u.visible=!0}}))}))}))}else Laya.loader.create(G[e],Laya.Handler.create(this,()=>{this.initTank(e,!1),f=!1,L(t)}))};v.SetClick(c,this,L,[1]),v.SetClick(m,this,L,[-1]),h.push(G[n]),Laya.loader.create(h,Laya.Handler.create(this,()=>{const t=Laya.loader.getRes(M.LobbyScene);Laya.stage.addChild(t),t.zOrder=-1,this.lobbyScene=t;const e=this.vec3(.3,.1,.1);t.enableFog=!0,t.fogColor=e,t.fogStart=0,t.fogRange=0,Laya.Tween.to(t,{fogStart:3.3,fogRange:5.5},2e3,Laya.Ease.circOut,Laya.Handler.create(this,()=>{this.makeEnemy(),Laya.timer.loop(1500,this,this.makeEnemy)}));const s=t.getChildByName("Spot Light");s.shadowMode=Laya.ShadowMode.SoftLow,s.shadowStrength=.8,s.shadowDistance=5,s.shadowResolution=512,s.range=6;const i=t.getChildByName("Main Camera");i.enableHDR=!1;const a=new Laya.Ray(this.vec3(),this.vec3()),o=new Laya.HitResult;if(i.viewportPointToRay(this.vec2(),a),t.physicsSimulation.rayCast(a,o),this.hangupMgr=this.owner.getComponent(he),this.hangupMgr.coinNodeEndPos=o.point,this.initTank(n),this.initSoldier(),this.initUav(),c.visible=m.visible=l.visible=!0,Q.guid2){delete Q.guid2;const t=Laya.stage.height;jt.init(jt.getGuidIns(),{x:91,y:t-100,radius:70,arrowDir:2},{x:360,y:t-300,radius:70})}if(Q.newTank){const t=Q.newTank;delete Q.newTank,Se.ShowNewTank(t)}})),i.on(W.OnLobbyEnemyDeath,this,t=>{let e=null;const n=this.enemys;for(let s=0;s<n.length;s++){if(n[s].getComponent(re).eid==t){e=s;break}}null!==e&&n.splice(e,1)}),i.on(W.OnTankSelect,this,()=>{const t=Ht.tankId;if(n!=t){const e=D[n];v.GetComponent(ue,e).enabled=!1,n=t;for(const t in D){D[t].active=!1}this.initTank(n)}l.visible||(l.visible=!0),u.visible&&(u.visible=!1)}),i.on("userConfig.gold",this,()=>{t.goldLab.text=d.FormatNumber(Ht.gold),this.initTankReddot()}),i.on("userConfig.diamond",this,()=>{t.diamLab.text=d.FormatNumber(Ht.diamond)});const E=t=>{let e=[Ht.attLevel,Ht.hpLevel,Ht.uavLevel,Ht.soldierLevel][t-1];if(e<1)return!1;const n=[B.tankAttData,B.tankHpData,B.tankUavData,B.tankSoldierData][t-1],s=n[e];if(e>=Object.keys(n).length)return!1;const i=["gold","diamond"][s.consume-1];return Ht[i]>=s.conNumb||void 0};ae.Register("LobbyScene.attLevel",()=>E(1)),ae.Register("LobbyScene.hpLevel",()=>E(2)),ae.Register("LobbyScene.uavLevel",()=>E(3)),ae.Register("LobbyScene.soldierLevel",()=>E(4)),ae.Register("LobbyScene.tankBtn",()=>{let t=!1;const e=Ht.reddots,n=[];for(let s=0;s<e.length;s++){const i=e[s];if(/tank[0-9]/.test(i)){n.push(parseInt(i[i.length-1])),t=!0;break}}return 1==n.length&&4==n[0]&&Q.isClickTankDialog&&(t=!1),t}),Laya.timer.loop(1e4,this,()=>{A.clearPrefabPools()})}static ShowNewTank(t){const e=B.tankData[t];pe.Reward({name:e.name,icon:`lobby/tank${t}.png`,desc:e.skillTxt,descIcon:`lobby/skill${t}.png`,title:o.Default[8],btnTxt:o.Default[9],onSure:()=>{Ht.tankId=t,Ut.Tips(o.Default[3].replace("$$",e.name)),i.event(W.OnTankSelect)}})}initTankReddot(){const t=X.tankIds,e=B.tankData,n=Ht.reddots;for(let s=0;s<t.length;s++){const i=t[s];if(Ht.tankIds.indexOf(i)<0){const t=e[i],s=t.unlock,a="tank"+i,o=n.indexOf(a);s==P.Adv?o<0&&n.push(a):s==P.Diamond?Ht.diamond>=t.unNumb?o<0&&n.push(a):o>-1&&n.splice(o,1):s==P.Gold&&(Ht.gold>=t.unNumb?o<0&&n.push(a):o>-1&&n.splice(o,1))}}}initTank(t,e=!0){const n=v.GetRes(G[t]);if(!n)return void Laya.loader.create(G[t],Laya.Handler.create(this,()=>{this.initTank(t,e)}));const s=v.InstantiateSprite3D(n,G[t]);this.mTanks[t]=s,s.getChildAt(1).meshRenderer.sharedMaterial.albedoIntensity=2,s.getChildByName("range").active=!1,s.getChildAt(6).active=!1,s.transform.localPosition=this.vec3(),v.GetComponent(ue,s).enabled=e,s.active=e,this.lobbyScene.addChild(s)}initSoldier(){const t=this.soldiers;for(let e=0;e<t.length;e++){t[e].removeSelf()}const e={1:[this.vec3(.3,0,.3)],2:[this.vec3(-.3,0,.3),this.vec3(.3,0,.3)],3:[this.vec3(-.4,0,.3),this.vec3(0,0,.5),this.vec3(.4,0,.3)]},n=v.GetRes(M.PlayerSoldier),s=B.tankSoldierData[Ht.soldierLevel];if(s){let t=s.merNum;for(let s=0;s<t;s++){const i=v.InstantiateSprite3D(n,M.PlayerSoldier);v.GetComponent(ye,i),i.transform.position=e[t][s],this.lobbyScene.addChild(i),this.soldiers.push(i)}}}initUav(){const t=this.uavs;for(let e=0;e<t.length;e++){t[e].removeSelf()}const e=v.GetRes(M.PlayerUav),n=B.tankUavData[Ht.uavLevel];if(n){let t=1;for(let s=0;s<t;s++){const t=v.InstantiateSprite3D(e,M.PlayerUav);v.GetComponent(Zt,t),v.GetComponent(fe,t).uavData=n,t.transform.position=this.vec3(.2,1.3,-.5),this.lobbyScene.addChild(t),this.uavs.push(t)}}}initSkillItems(){const t=this.insUI.skillItems,e=[Ht.attLevel,Ht.hpLevel,Ht.uavLevel,Ht.soldierLevel];for(let n=0;n<t.numChildren;n++){const s=t.getChildAt(n);this.initSkillItem(s,e[n],n+1)}}initSkillItem(t,e,n){const s={1:1,2:X.HpLevel,3:X.UavLevel,4:X.SoldierLevel},a=t.getChildByName("titleLab"),r=t.getChildByName("bg1"),l=t.getChildByName("bg2"),h=t.getChildByName("maxNode"),c=t.getChildByName("priceNode"),m=t.getChildByName("lockNode");if(a.text=o.LobbyScene[n],e>0){const s=[B.tankAttData,B.tankHpData,B.tankUavData,B.tankSoldierData],a=["gold","diamond"],u=["attLevel","hpLevel","uavLevel","soldierLevel"],p=["curt","hpNumb","curt","curt"],g=[100,100,1,1],y=r.getChildByName("levelLab"),f=l.getChildByName("propLab");m.visible=!1,r.visible=l.visible=!0,y.text=e+"";const S=s[n-1],D=S[e];let L=e>=Object.keys(S).length,C=K[D.consume+1],E=D.conNumb,T=p[n-1];h.visible=L,c.visible=!L,f.text=o.LobbyScene[n+"1"].replace("$$",Math.floor(D[T]*g[n-1])+""),L||(c.getChildByName("icon").skin=C,c.getChildByName("priceLab").text=d.FormatNumber(E),v.SetClick(t,this,()=>{const e=a[D.consume-1],s=u[n-1];if(Ht[e]>=D.conNumb){Ht[e]-=D.conNumb,Ht[s]++,this.initSkillItem(t,Ht[s],n);const a=Ht[s];a>1&&a%10==1||a>=Object.keys(S).length?pe.Adva(n):Ut.Tips(o.Default[5]),"attLevel"==s&&i.event("userConfig.attLevel"),"soldierLevel"==s&&this.initSoldier(),"uavLevel"==s&&this.initUav(),b.sound(R.LevelUp)}else v.OpenDialog(x.GetRewardDialog,null,t=>{t.getComponent(ge).setData(D.consume)},!1,!0)}))}else{r.visible=l.visible=h.visible=c.visible=!1,m.visible=!0;const e=m.getChildByName("iconIma"),i=m.getChildByName("unlockLab");e.skin="lobby/adIcon.png",i.text=o.Default[4].replace("$$",s[n]),v.SetClick(t,this,()=>{})}}makeEnemy(){if(this.enemys.length>=10)return;const t=[1,2,3,4,1001],e=t[d.GetRandom(t.length-1,0)],n={model:e},s=M["Enemy"+e],i=v.GetRes(s),a=v.InstantiateSprite3D(i,s);v.GetComponent(gt,a).enemyData=n,v.GetComponent(re,a);a.transform.localScale=this.vec3(2,2,2);const o=this.vec3();o.x=d.GetRandom(30,0)/10-1.5,o.z=d.GetRandom(35,20)/10,a.transform.position=o,this.lobbyScene.addChild(a),this.enemys.push(a);const r=a.getChildByName("effect");r&&(r.active=!1)}getMinEnemy(t,e=3){const n=this.enemys;let s=0,i=null;for(let a=0;a<n.length;a++){const o=n[a];if(!o)continue;const r=o.transform.position;let l=(r.x-t.x)*(r.x-t.x)+(r.z-t.z)*(r.z-t.z);l<=e*e&&(!s||l<s)&&(s=l,i=o)}return i}onDisable(){super.onDisable(),b.stopMusic(),this.lobbyScene&&this.lobbyScene.destroy(),this.lobbyScene=null,A.clearGPUMemory(this.m3DAssets),A.clearPrefabPools(),Laya.Resource.destroyUnusedResources(),Jt.compilePack()}onUpdate(){super.onUpdate()}static initAuidoBtn(t){const e=C.musicVolume,n=t.getChildAt(0),s=t.getChildAt(1);n.visible=!!e,s.visible=!e,i.event(a.InitMusic)}}Se.Instance=null;class De extends _{constructor(){super(),this.handIma=null,this.mStartPos=this.vec2(142,76),this.mLeftCenter=this.vec2(77,76),this.mRightCenter=this.vec2(207,76),this.mVec=1,this.mAngle=0}onEnable(){const t=this.mStartPos;this.handIma.pos(t.x,t.y),this.mVec=1,this.mAngle=0}onDisable(){super.onDisable()}onUpdate(){if(this.owner.visible){const t=this.handIma;if(1==this.mVec&&this.mAngle>=360&&(this.mAngle=180,this.mVec=2),2==this.mVec&&this.mAngle<=-180&&(this.mAngle=0,this.mVec=1),1==this.mVec){const e=this.mLeftCenter;this.mAngle+=2;const n=this.mAngle/180*Math.PI;t.x=e.x+65*Math.cos(n),t.y=e.y-65*Math.sin(n)}else{const e=this.mRightCenter;this.mAngle-=2;const n=this.mAngle/180*Math.PI;t.x=e.x+65*Math.cos(n),t.y=e.y-65*Math.sin(n)}}}}class Le extends _{constructor(){super(),this.sphereShape=new Laya.SphereColliderShape(1.2),this.hitResults=[]}onEnable(){const t=Laya.stage,e=this.owner;e.pos(t.width/2,t.height),Laya.Tween.to(e,{y:-558},2e3,null,Laya.Handler.create(this,()=>{e.removeSelf()}));const n=te.Instance,s=n.gameScene,i=s.physicsSimulation,a=n.camera,o=new Laya.Ray(this.vec3(),this.vec3()),r=new Laya.HitResult,l=v.GetRes(M.EffectBoom),h=v.GetRes(M.EnemyAttRange2);Laya.timer.loop(200,this,()=>{const t=d.GetRandom(620,100);if(a.viewportPointToRay(this.vec2(t,e.y),o),i.rayCast(o,r,1e4,w.Default,w.All^w.Player^w.Enemy),r.collider){const t=r.point.clone();t.y=0;const e=v.InstantiateSprite3D(h,M.EnemyAttRange2);v.GetComponent(Ct,e),e.transform.localScale=this.vec3(2.5,2.5,2.5),e.transform.position=t,s.addChild(e),setTimeout(()=>{if(l.destroyed||s.destroyed)return;const e=v.InstantiateSprite3D(l,M.EffectBoom);v.ScaleParticle3DNode(e,3),v.GetComponent(Ct,e),e.transform.position=t,s.addChild(e),b.sound(R.EffectBoom);const a=this.hitResults;if(i.shapeCastAll(this.sphereShape,t,this.vec3(t.x,2,t.z),a,null,null,w.Default,w.Enemy),a&&a.length)for(let t=0;t<a.length;t++){const e=a[t];if(e&&e.collider){const t=e.collider.owner.getComponent(Et);if(t){const e=n.playerData;let s=e.atk*e.skillRatio;t.onHit(s)}}}setTimeout(()=>{e.removeSelf()},2e3)},200),setTimeout(()=>{e.removeSelf()},1e3)}})}onDisable(){super.onDisable(),this.recover(this.owner)}}class Ce extends _{constructor(){super(),this.closeBtn=null,this.homeBtn=null,this.audioBtn=null,this.resuBtn=null}onEnable(){const t=te.Instance,e=()=>{v.CloseDialog(this).then(()=>{t.gameState=N.Start})};v.SetClick(this.closeBtn,this,e),v.SetClick(this.resuBtn,this,e),v.SetClick(this.homeBtn,this,()=>{Laya.Scene.closeAll(),v.CloseDialog(this).then(()=>{Laya.Scene.open("LobbyScene.scene")})}),Se.initAuidoBtn(this.audioBtn),v.SetClick(this.audioBtn,this,()=>{const t=C.musicVolume;C.musicVolume=t?0:1,Se.initAuidoBtn(this.audioBtn)})}onDisable(){super.onDisable()}}class Ee extends _{constructor(){super(),this.sureBtn=null,this.goldItem=null,this.diamItem=null,this.taskNode=null,this.lines=[],this.closeHandler=null}onEnable(){const t=te.Instance.playerData,e=Bt.taskData[t.level],n=e[t.task].reward;v.SetClick(this.sureBtn,this,()=>{Ht.reward(n),v.CloseDialog(this).then(()=>{this.closeHandler&&this.closeHandler()})});const s=this.goldItem.getChildByName("numLab"),i=this.diamItem.getChildByName("numLab");s.text=d.FormatNumber(n[0][1]),i.text=d.FormatNumber(n[1][1]);const a=this.taskNode;a.getChildByName("title").text=t.level+"";const o=a.getChildByName("taskProg"),r=o.getChildByName("tankNode");r.getChildByName("icon").skin=`lobby/tank${Ht.tankId}.png`;const l=Object.keys(e).length;for(let e=0;e<l-1;e++){const n=new Laya.Image(`game/line${e+1<=t.task?1:2}.png`);n.anchorX=.5,n.y=0,n.x=(e+1)/l*516,o.addChild(n),this.lines.push(n)}const h=t.task/l,c=(t.task-1)/l;o.value=c,r.x=516*c,Laya.timer.once(500,this,()=>{Laya.Tween.to(o,{value:h},1e3),Laya.Tween.to(r,{x:516*h},1e3)})}onDisable(){super.onDisable();for(let t=0;t<this.lines.length;t++){this.lines[t].destroy()}}}class be extends _{constructor(){super(),this.closeBtn=null,this.tankList=null,this.attrNode=null,this.skillNode=null,this.nameLab=null,this.scene3D=null,this.mTanks={},this.currTank=null}onEnable(){v.SetClick(this.closeBtn,this,()=>{v.CloseDialog(this)});const t=X.tankIds;let e=Ht.tankId;const n=Ht.tankIds,s=Ht.tankAdvs,a=B.tankData,r=this.mTanks,l=this.tankList;l.vScrollBarSkin="";const h=K,c=Ht.reddots;l.renderHandler=Laya.Handler.create(this,(m,u)=>{const p=t[u],g=a[p],y=m.getChildByName("useNode"),f=m.getChildByName("selBtn"),D=m.getChildByName("selNode"),L=m.getChildByName("icon"),C=m.getChildByName("lockNode"),E=m.getChildByName("unlockBtn"),b=m.getChildByName("nameLab"),T=m.getChildByName("stateLab"),I=m.getChildByName("red.dot");let A="tank"+p;I.visible=!1,b.text=g.name,L.skin=`lobby/tank${p}.png`,D.visible=e==p;let _=n.indexOf(p)>-1;if(_){C.visible=E.visible=!1;const t=p==Ht.tankId,n=p==e;y.visible=t,f.visible=n&&!t,T.visible=!0,t||v.SetClick(f,this,()=>{r[p]&&(Ht.tankId=p,Ut.Tips(o.Default[3].replace("$$",g.name)),i.event(W.OnTankSelect))})}else{const t=g.unlock;y.visible=f.visible=T.visible=!1;let i=C.getChildByName("iconIma"),a=C.getChildByName("priceLab");C.visible=!0;const r=p==e;a.visible=i.visible=!r;let l=0,c=18;r&&(i=E.getChildByName("iconIma"),a=E.getChildByName("priceLab"),l=93,c=122),t==P.Lv||t==P.Default?(i.visible=!1,a.text=o.TankDialog[1].replace("$$",g.unNumb+""),a.x=l):(i.skin=h[t],i.visible=!0,a.text=t==P.Adv?(s[p]||0)+"/"+g.unNumb:d.FormatNumber(g.unNumb),a.x=c),E.visible=r,r&&v.SetClick(E,this,()=>{t==P.Diamond?Ht.diamond>=g.unNumb?(Ht.diamond-=g.unNumb,n.push(p),Se.ShowNewTank(e)):Ut.Tips(o.Default[2]):t==P.Gold?Ht.gold>=g.unNumb?(Ht.gold-=g.unNumb,n.push(p),Se.ShowNewTank(e)):Ut.Tips(o.Default[1]):t==P.Adv&&(s[p]||(s[p]=0),S.showRewardVideoAd("454658549471127_492523512351297").then(()=>{s[p]++,s[p]>=g.unNumb&&(n.push(p),Se.ShowNewTank(e))}))})}let k=c.indexOf(A);I.visible=k>-1,v.SetClick(m,this,()=>{if(e=p,this.initAttrNode(e),r[p])for(const t in r){const e=r[t],n=parseInt(t)==p;e.active=n,n&&(this.currTank=r[p])}else{for(const t in r){r[t].active=!1}Laya.loader.create(G[p],Laya.Handler.create(this,()=>{this.initTank(p);const t=e==p;r[p].active=t,t&&(this.currTank=r[p])}))}l.refresh(),l.scrollTo(u),_&&k>-1&&c.splice(k,1)},null,!0)},null,!1),l.array=t,this.initAttrNode(e),Laya.Scene3D.load(M.TankDialog,Laya.Handler.create(this,t=>{t.getChildByName("Main Camera").enableHDR=!1,this.owner.addChild(t),this.scene3D=t,this.initTank(e),this.currTank=r[e]})),i.on(W.OnTankSelect,this,()=>{l.refresh()})}initTank(t){const e=v.GetRes(G[t]),n=v.InstantiateSprite3D(e,G[t]);this.mTanks[t]=n;const s=n.getChildAt(1).meshRenderer.material,i=n.getChildAt(0).getChildAt(0).meshRenderer.material;s.albedoIntensity=i.albedoIntensity=2;const a=2*s.albedoColor.x;s.albedoColor=i.albedoColor=this.vec4(a,a,a,1),n.getChildByName("range").active=!1,n.getChildAt(6).active=!1,n.transform.localPosition=this.vec3(),this.scene3D.addChild(n)}initAttrNode(t){const e=B.tankData[t];this.nameLab.text=e.name;const n=this.attrNode,s=n.getChildByName("attLab"),i=n.getChildByName("hpLab"),a=n.getChildByName("speLab"),o=n.getChildByName("powBox").getChildByName("powLab");s.text=d.FormatNumber(e.atk),i.text=d.FormatNumber(e.hp),a.text=d.FormatNumber(10*e.dex),o.text=d.FormatNumber(e.combat);const r=this.skillNode,l=r.getChildByName("titLab"),h=r.getChildByName("descLab"),c=r.getChildByName("iconBg").getChildByName("iconIma");l.text=e.skillName,h.text=e.skillTxt,c.skin=`lobby/skill${e.skillId}.png`}onDisable(){super.onDisable(),this.scene3D&&this.scene3D.destroy()}onUpdate(){const t=this.currTank;t&&(t.transform.localRotationEulerY+=.5)}}class ve{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("app/battle/BattleSceneUI.ts",s),t("app/battle/BattleScene.ts",te),t("app/battle/EnemyManager.ts",Rt),t("app/battle/EnemySkillManager.ts",Mt),t("app/battle/GameTaskManager.ts",Yt),t("app/battle/BattleScene2.ts",ne),t("core/ui/GuidanceBtn.ts",se),t("app/lobby/LoobySceneUI.ts",ie),t("core/ui/RedDot.ts",oe),t("app/lobby/LoobyScene.ts",Se),t("app/lobby/HangupManager.ts",he),t("app/common/CommonTipDialog.ts",Ut),t("app/common/GuidanceDialog.ts",$t),t("app/common/GuidacneHandNode.ts",De),t("app/battle/prefab/EnemyHpBar.ts",St),t("app/battle/prefab/PlayerBomberNode.ts",Le),t("app/battle/prefab/PlayerDirNode.ts",xt),t("app/battle/prefab/PlayerProp.ts",Dt),t("app/battle/RockerNode.ts",k),t("app/battle/prefab/SettingDialog.ts",Ce),t("app/battle/prefab/TaskOverDialog.ts",ee),t("app/battle/prefab/TaskSuccessDialog.ts",Ee),t("app/lobby/prefab/CommonRewardDialog.ts",pe),t("app/lobby/prefab/GetRewardDialog.ts",ge),t("app/lobby/prefab/TankDialog.ts",be)}}ve.width=720,ve.height=1280,ve.scaleMode="fixedwidth",ve.screenMode="vertical",ve.alignV="top",ve.alignH="center",ve.startScene="LobbyScene.scene",ve.sceneRoot="",ve.debug=!1,ve.stat=!1,ve.physicsDebug=!1,ve.exportSceneToJson=!0,ve.init();class Te{constructor(){this.multiTouchEnabled=!0}initGame(){Laya.ClassUtils.regClass("laya.effect.ColorFilterSetter",Laya.ColorFilterSetter),Laya.ClassUtils.regClass("laya.effect.GlowFilterSetter",Laya.GlowFilterSetter),Laya.ClassUtils.regClass("laya.effect.BlurFilterSetter",Laya.BlurFilterSetter),Laya.SoundManager.useAudioMusic=!1,Laya.MouseManager.multiTouchEnabled=this.multiTouchEnabled,h.Debug||(window.console.log=(()=>{}),window.console.warn=(()=>{}),window.console.error=(()=>{}))}onConfigLoaded(){let t=1,e=0;const n=()=>{++e<t||(S.playerInfo.newPlayer?Laya.Scene.open("BattleScene.scene"):ve.startScene&&Laya.Scene.open(ve.startScene))};O.Base.length&&(t++,Jt.loadBinArray(O.Base).then(()=>{n()})),A.getBaseAsset().then(()=>{const t=Laya.loader.getRes(A.JsonMerge);rt.setLevelData(t),rt.setPropData(t),Bt.setTaskData(t),Bt.setRefData(t),Bt.setEnemyData(t),B.setTankData(t),B.setTankAttData(t),B.setTankHpData(t),B.setTankSoldierData(t),B.setTankUavData(t),Laya.loader.clearRes(A.JsonMerge),D.getConfig().then(()=>{setInterval(D.saveConfig,1e4),n()})})}}new class extends Te{constructor(){super(),window.Laya3D?Laya3D.init(ve.width,ve.height):Laya.init(ve.width,ve.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=ve.scaleMode,Laya.stage.screenMode=ve.screenMode,Laya.stage.alignV=ve.alignV,Laya.stage.alignH=ve.alignH,Laya.URL.exportSceneToJson=ve.exportSceneToJson,(ve.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),ve.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),ve.stat&&Laya.Stat.show(),this.initGame(),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){super.onConfigLoaded()}}}();