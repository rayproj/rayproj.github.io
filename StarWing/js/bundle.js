!function(){"use strict";var t,e;!function(t){t[t.Common=1]="Common",t[t.Hard=2]="Hard",t[t.Hell=3]="Hell"}(t||(t={}));class s{static setChatpers(t){const e=t[1];this.basChapter={id:e[0],nameCN:e[1],name:e[2],chapter:e[3],level:e[4],maxair:e[5],fight:e[6],fightatt:e[7],fighthp:e[8],difficulty:e[9],drop:e[10],addgold:e[11],extragold:e[12],maxbox:e[13],bossbox:e[14],levelbox:e[15],map:e[16],unlockskill:[]};for(let e=2;e<t.length;e+=2){const s=t[e];this.comChapters.push({id:s[0],nameCN:s[1],name:s[2],chapter:s[3],level:s[4],maxair:s[5],fight:s[6],fightatt:s[7],fighthp:s[8],difficulty:s[9],drop:s[10],addgold:s[11],extragold:s[12],maxbox:s[13],bossbox:s[14],levelbox:s[15],map:s[16],unlockskill:[]})}for(let e=3;e<t.length;e+=2){const s=t[e];this.difChapters.push({id:s[0],nameCN:s[1],name:s[2],chapter:s[3],level:s[4],maxair:s[5],fight:s[6],fightatt:s[7],fighthp:s[8],difficulty:s[9],drop:s[10],addgold:s[11],extragold:s[12],maxbox:s[13],bossbox:s[14],levelbox:s[15],map:s[16],unlockskill:[]})}}}s.basChapter=null,s.comChapters=[],s.difChapters=[];class i{static setItems(t){for(let e=1;e<t.length;e++){const s=t[e];this.equs[s[0]]={id:s[0],nameCN:s[1],name:s[2],type:s[3],suit:s[4],quality:s[5],addnum:s[6],maxlv:s[7],materials:s[8],att:s[9]}}}static setAdds(t){for(let e=1;e<t.length;e++){const s=t[e];this.equadds[s[0]]={id:s[0],nameCN:s[1],name:s[2],type:s[3],quality:s[4],minv:s[5],maxv:s[6]}}}}i.equs={},i.equadds={},function(t){t[t.WsFgAtt=1]="WsFgAtt",t[t.WsFgSpe=2]="WsFgSpe",t[t.MgAtt=3]="MgAtt",t[t.Coin=4]="Coin",t[t.Hp=5]="Hp",t[t.SubHurt=6]="SubHurt",t[t.Back=7]="Back",t[t.Blood=8]="Blood",t[t.Up=9]="Up",t[t.Speed=10]="Speed",t[t.BossHurt=11]="BossHurt",t[t.Crit=12]="Crit",t[t.Skill=13]="Skill"}(e||(e={}));class a{static setUpequips(t){const e=this.upequips;for(let s=1;s<t.length;s++){const i=t[s],a=i[1];e[a-1]||(e[a-1]=[]);const l=e[a-1];l[0]||(l[0]={}),l[0][i[2]]={qua:0,att1:i[5],att2:0,addAtt1:i[4],addAtt2:0};for(let t=1;t<8;t++){l[t]||(l[t]={});const e=5+4*(t-1);l[t][i[2]]={qua:t,att1:i[e+2],att2:i[e+4],addAtt1:i[e+1],addAtt2:i[e+3]}}}}static getAtts(t,e,s){const a=[],l=i.equs[t],n=l.type,o=l.att,h=this.upequips[n-1][e];let r=null;if(r="string"==typeof o?o.split("|"):o,h){const t=h[s];if(t)"number"==typeof o?a.push([r,t.att1]):(a.push([parseInt(r[0]),t.att1]),a.push([parseInt(r[1]),t.att2]));else{const t=Object.keys(h).sort((t,e)=>{return parseInt(t)-parseInt(e)});for(let e=0;e<t.length;e++){const i=parseInt(t[e]),l=e+1>=t.length?9999:parseInt(t[e+1]);if(s>i&&s<l){let t=h[i],e=t.att1+(s-i)*t.addAtt1,l=t.att2+(s-i)*t.addAtt2;"number"==typeof o?a.push([r,e]):(a.push([parseInt(r[0]),e]),a.push([parseInt(r[1]),l]));break}}}}return a}}a.upequips=[],a.thunders={1:{2:[1,.1],4:[2,.1]},2:{2:[3,.2],4:[4,.5]},3:{2:[5,.2],4:[6,.2]},4:{2:[5,.2],4:[6,.2],6:[7,.5]},5:{2:[8,.2],4:[9,.35],6:[10,.5]},6:{2:[11,.15],4:[12,.2],6:[13,1]}};class l{static setPlanes(t){for(let e=1;e<t.length;e++){const s=t[e];for(let t=1;t<7;t++){const e=this["plane"+t];e&&(e[s[1]]={id:t,att:s[3+2*t],hp:s[4+2*t],addAtt:s[3],addHp:s[4]})}}}static setGolds(t){for(let e=1;e<t.length;e++){const s=t[e],i=s[1];1==i?this.upPlaGold[s[2]]={gold:s[6],adgo:s[5]}:2==i?this.upEquGold[s[2]]={gold:s[6],adgo:s[5]}:3==i&&(this.upEquMate[s[2]]={gold:s[7],adgo:s[5]})}}static getAttHp(t,e){const s={att:0,hp:0},i=this["plane"+e];if(i){const e=i[t];if(e)s.att=e.att,s.hp=e.hp;else{const e=Object.keys(i).sort((t,e)=>{return parseInt(t)-parseInt(e)});for(let a=0;a<e.length;a++){const l=parseInt(e[a]),n=a+1>=e.length?9999:parseInt(e[a+1]);if(t>l&&t<n){let e=i[l];s.att=e.att+(t-l)*e.addAtt,s.hp=e.hp+(t-l)*e.addHp;break}}}}return s}static getGold(t,e){let s=0,i=this.upPlaGold;2==e&&(i=this.upEquGold),3==e&&(i=this.upEquMate);const a=i[t];if(a)s=a.gold;else{const e=Object.keys(i).sort((t,e)=>{return parseInt(t)-parseInt(e)});for(let a=0;a<e.length;a++){const l=parseInt(e[a]),n=a+1>=e.length?9999:parseInt(e[a+1]);if(t>l&&t<n){let e=i[l];s=e.gold+(t-l)*e.adgo;break}}}return s}}l.plane1={},l.plane2={},l.plane3={},l.plane4={},l.plane5={},l.plane6={},l.upPlaGold={},l.upEquGold={},l.upEquMate={};class n{static setPlanes(t){for(let e=1;e<t.length;e++){const s=t[e];this.planes[s[0]]={id:s[0],nameCN:s[1],name:s[2],att:s[3],hp:s[4],shooting:s[5],crit:s[6],range:s[7],unlocking:s[8],bullettype:s[9],weapon:s[10],sustain:s[11],bulletsp:s[12]}}}}var o;n.planes={},n.planesUI={1:[2,2,8,1,3],2:[3,4,9,3,4],3:[6,6,4,5,7],4:[10,8,5,5,2],5:[6,6,4,5,5],6:[10,9,8,7,6]},function(t){t[t.faceBookSDKTest=0]="faceBookSDKTest",t[t.faceBookSDK=1]="faceBookSDK"}(o||(o={}));class h{}h.gameSDKName=o.faceBookSDKTest,h.fbSaveDataKey=["starwing20210422"],h.gameSaveDataKey="starwing001",h.isNewPlayer=!1,h.rewardedVideoID="1154365871695610_1161636604301870",h.SigninVideoID="1154365871695610_1161636604301870",h.AllSkillVideoID="1154365871695610_1164936070638590",h.CoinVideoID="1154365871695610_1164935663971964",h.DiamondVideoID="1154365871695610_1164935767305287",h.RebornVideoID="1154365871695610_1164935923971938";const r=new Laya.EventDispatcher,c=(t,e)=>{h.gameSDKName!=o.faceBookSDKTest&&window.gaLogEvent&&window.gaLogEvent.log&&window.gaLogEvent.log(t,e)};class d{static getRandom(t,e){return Math.floor(Math.random()*(t-e+1)+e)}static formatNumber(t){const e=["K","M","B","T"];let s="";if(t<1e3)s=Math.floor(t)+"";else{let i=t,a=0;for(;i/1e3/1e3>=1;){if(++a>=e.length){a=e.length-1;break}i/=1e3}s=(i/1e3).toFixed(2)+e[a]}return s}static formatTimer(t){const e=Math.floor(t/3600);t-=60*e*60;const s=Math.floor(t/60);return t-=60*s,[e,s,Math.floor(t)]}static isSameDay(t,e){return new Date(t).setHours(0,0,0,0)===new Date(e).setHours(0,0,0,0)}static findKey(t,e,s=((t,e)=>t===e)){return Object.keys(t).find(i=>s(t[i],e))}}var p;!function(t){t[t.Gold=101]="Gold",t[t.Diamond=201]="Diamond"}(p||(p={}));class u{static setItems(t){for(let e=1;e<t.length;e++){const s=t[e];this.items[s[0]]={id:s[0],nameCN:s[1],name:s[2],type:s[3],desCN:s[4],des:s[5],quality:s[6],equip:s[7]}}}static setShopItems(t){for(let e=1;e<t.length;e++){const s=t[e];this.shopitems.push({id:s[0],item:s[1],box1:s[2],box2:s[3],lim2:s[4],min:s[5],max:s[6],price:s[7]})}}}u.items={},u.shopitems=[],u.bgCha=null,u.FriendPlaneId=1;const y={TaskDialog:{1:"MISSION"},Common:{1:"Rewards",2:"ARMAMENT",3:"HANGAR",4:"BATTLE",5:"ADVENTURE",6:"SHOP",10:"New Chapter",11:"New Plane",12:"TIPS",13:"SURE",14:"CANCEL",15:"Are you sure you want to return to the main page? This game will not have any profit!",16:"Pass the pre chapter a few more times to improve your power.",17:"The limited-time skills will be invalid after refresh. Do you want to continue?",18:"Congratulations on your clearance！",19:"We're sorry, but there are no available videos to show right now. Please try again! ",20:"Insufficient Diamonds",21:"Insufficient Gold",22:"You already have a record. Do you want to start a new game?"},Tips:{1:"Successfully Received",2:"Successful Decomposition",3:"%s Successfully Removed",4:"%s Successful Equipment",5:"%s Upgrade successful",6:"Short of upgrading materials",7:"Short of Armament",8:"Synthesis Success",9:"No synthetic Armament",10:"Upgrade successful",11:"Insufficient Gold",12:"Select %s successfully",13:"Insufficient Diamonds",14:"Unlock by completing the level 20\n of chapter $ in the normal mode",15:"Coming soon",16:"No more Challenges",17:"Learning success"},TaskItem:{1:"Mission time:",2:"Reward:",3:"RECEIVE",4:"START"},RankDialog:{1:"RANK",2:"BACK",3:"invite friends"},AchievementDialog:{1:"Daily",2:"Achievement"},HangarPage:{1:"SELECT",2:"POWER:",3:"ATTACK",4:"HP",5:"RATE",6:"CRIT",7:"RANGE",8:"Hangar growth level is valid for all ships.",9:"Unlock by completing the level 20 of chapter $ in the normal mode",10:"Log in for 7 days in a raw",11:"SHIP SELECTION"},HangarItem:{2:"Clear\nChapter 2",3:"Clear\nChapter 5",4:"Clear\nChapter 7",5:"Sign in reward",6:"Clear\nChapter 13"},SigninDialog:{1:"RECEIVE"},EquipmentPage:{1:"GUN",2:"RADAR",3:"ARMOR",4:"WINGS",5:"2ND GUN",6:"ENGINE",7:"SET",8:"COMPOSE"},EquDecDialog:{1:"DECOMPOSE",2:"Get rewards",3:"DECOMPOSE"},EquMatDesDialog:{1:"MATERIAL"},EquNewAttDialog:{1:"Attribute",2:"Level limit:",3:"Basic attributes:",5:"New attribute:"},EquSuitDialog:{1:"Attributes",2:"Attack",3:"HP",4:"Damage on enemy",5:"Wingman Attack",6:"2nd gun attack",7:"Damage on boss",8:"Attributes"},EquSymDialog:{1:"COMPOSE",2:"Choose the item you want to compose!\nPlace matched items of the same quality to compose a new item!",3:"COMPOSE",4:"SELECT",5:"Composing materials",6:"Weapon Attack",7:"Damage on boss",8:"Attributes"},EquOequDialog:{1:"DECOMPOSE",2:"Basic Attributes",3:"Additional Attributes",4:"Upgrade Materials",5:"Thunder suit",6:"Armament",7:"UPGRADE",8:"REMOVE"},EquMainStr:{1:"Attack +&",2:"HP +&",3:"Damage on enemy +&",4:"Wingman attack +&",5:"2nd gun attack +&",6:"Damage on boss +&"},EquThunder1:{1:"Wingman and 2nd gun attack +10%",2:"Wingman and 2nd gun fire rate + 10%",3:"Damage reduction + 20%",4:"Gold collected +50%",5:"HP +20%",6:"Damage reduction + 20%",7:"Each game can be revived once (reduce 50% hp limit)",8:"Restore a certain HP after defeating an enemy",9:"All attributes + 35%",10:"There's a chance to get high fire speed within 5S",11:"Damage on boss + 15%",12:"Critical rate +20%",13:"The battle begins with a support skill selection"},EquThunder2:{1:"Thunder set",2:"Storm set",3:"Aurora set",4:"Phoenix set",5:"Flame set",6:"Galaxy set"},BattlePage:{1:"START",2:"RECOMMEND",3:"Max level",4:"Normal",5:"Hard",6:"RANK",7:"MISSION",8:"ACHIEVEMENT",9:"Hero",10:"CONTINUE",11:"Endless mode"},EndlessDialog:{1:"Endless mode",2:"Best Score",3:"Best Level",4:"Gold x???",5:"Diamond x???",6:"START",7:"Level ",8:"Best Level ",9:"Score ",10:"Current level"},AdventurePage:{1:"ADVENTURE",2:"Recommended power:",3:"Difficulty",4:"Reward:",5:"Challenge times:",6:"Selected",7:"Choose 3 skills",8:"Select:",9:"GO",10:"All",11:"START",12:"watch+1"},AdventureData:{1:{id:1,title:"lobby/adventure/Equipment_Trial.png",pow:[158600,921e3,43e5],diff:["Normal","Hard","Hell"],num:5,reward:[[0,"lobby/adventure/ic_cl_grey.png","Material"],[1,"lobby/adventure/ic_zb2_grey.png","Armament"],[2,"lobby/adventure/ic_zb2_grey.png","Armament"]]},2:{id:2,title:"lobby/adventure/Gold_Trial.png",pow:[158600,921e3,43e5],diff:["Normal","Hard","Hell"],num:5,reward:[[0,"lobby/equicon/201.png","Diamond x??"],[0,"lobby/equicon/101.png","Gold x??"]]}},Shop:{1:"Reset Time: ",2:"Free remaining times: ",3:"Refresh",4:"FREE",5:"Diamond Shop",6:"Discount Shop",7:"FREE",8:"WATCH"},ShopData:{Box:{1:{title:"Silver chest",desc:"Get a normal, excellent or rare item",reset:10800,adnum:5,price:100,num:1},2:{title:"A box of diamonds",desc:"Can get a certain amount of diamonds",reset:10800,adnum:5,price:100,num:150},3:{title:"Legendary chest",desc:"Get an excellent, rare or epic item",reset:10800,adnum:5,price:300,num:1}},Lim:{Timer:10800,Skill:{timer:3600,adnum:5,price:100},Good:{adnum:5,price:100}}},Battle:{1:"Select Skills",2:"Get Rewards",3:"Unlock New Skills",4:"REWARD",5:"BACK",6:"Sound",7:"RETURN",8:"CONTINUE",9:"PAUSE",10:"Specifications",11:"Obtained skills",12:"Medical transport ship",13:"Choose a reward!",14:"Resurrection or not",15:"watch",16:"ALL",17:"SHARE",18:"Shock",19:"Supply",20:"Friends Assist",21:"Inviting friends can only help one day"}};const m=new class{constructor(){this.level=1,this.planes=[1],this.unlockAdv={1:1,2:1},this.advData={},this.guide=0,this.guide2=0,this.guide3=0,this.unlockPage=[],this.endlessData={lastData:null,lastEnemy:null,bestLevel:1,bestScore:0,startLevel:1},this.signinData={num:0,last:0}}setSignData(){this.signinData.num++,this.signinData.last=Date.now()}setAdvData(t,e){const s=this.advData;s[t]||(s[t]=y.AdventureData[t].num),s[t]+=e}};var g,b,f;!function(t){t[t.Mgun=1]="Mgun",t[t.Radar=2]="Radar",t[t.Armor=3]="Armor",t[t.Wings=4]="Wings",t[t.Agun=5]="Agun",t[t.Engine=6]="Engine"}(g||(g={})),function(t){t[t.White=0]="White",t[t.Green=1]="Green",t[t.Blue=2]="Blue",t[t.Purple=3]="Purple"}(b||(b={})),function(t){t[t.Att=1]="Att",t[t.Hp=2]="Hp",t[t.EneHurt=3]="EneHurt",t[t.Wings=4]="Wings",t[t.Fatt=5]="Fatt",t[t.BossHurt=6]="BossHurt"}(f||(f={}));const k=new class{constructor(){this.coin=0,this.diamond=0,this.items={},this.chapter={},this.dchapter={},this.uchapter={1:1},this.udchapter={},this.equips={},this.hequips={}}updateItem(t){let e=0;for(const s in t){const a=t[s];if(a[0]==p.Gold)this.coin+=a[1],r.event("PlayerItemConfig.coin");else if(a[0]==p.Diamond)this.diamond+=a[1],r.event("PlayerItemConfig.diamond");else if(a[0]>=1011&&a[0]<=1016)this.items[a[0]]?this.items[a[0]]+=a[1]:this.items[a[0]]=a[1];else{let t=a[0],s=a[1];const l=u.items[t],n=l.quality,o=l.equip;let h=i.equs[o].addnum;h=h.split?h.split("|")[n-1]:h;for(let t=0;t<s;t++){let t=[];for(let e=0;e<h;e++){const e=d.getRandom(1007,1001),s=i.equadds[e],a=parseFloat(s.maxv.split("|")[n]),l=parseFloat(s.minv.split("|")[n]);t.push([e,this.getAddV(a,l)])}this.hequips[Date.now()+e]=[o,n,1,t],e++}n>=3&&r.event("player.getPurEqu")}}}getAddV(t,e){const s=[];let i=e;for(;i<=t;)s.push(i),i+=.5;return s[d.getRandom(s.length-1,0)]}updateCoin(t){this.coin+=t,r.event("PlayerItemConfig.coin"),t<0&&r.event("player.expendCoin",-t)}updateChapter(t,e){1==S.diff?(this.chapter[t]?this.chapter[t]++:(this.chapter[t]=1,3==t?m.unlockPage.indexOf("EquipmentPage")<0&&m.unlockPage.push("EquipmentPage"):6==t&&m.unlockPage.indexOf("AdventurePage")<0&&m.unlockPage.push("AdventurePage")),t<15?this.uchapter[t+1]||(window["__global.data__"]=["unlock"],this.uchapter[t+1]=1):15==t&&(this.udchapter[1]||(window["__global.data__"]=["unlock"],this.udchapter[1]=1))):(this.dchapter[t]?this.dchapter[t]++:this.dchapter[t]=1,t<15?this.udchapter[t+1]||(window["__global.data__"]=["unlock"],this.udchapter[t+1]=1):15==t&&(this.udchapter[16]||(window["__global.data__"]="tips.clearance",this.udchapter[16]=1))),t>=2&&m.planes.indexOf(2)<0&&(m.planes.push(2),r.event("player.unlockplane"),m.unlockPage.indexOf("HangarPage")<0&&m.unlockPage.push("HangarPage"),m.unlockPage.indexOf("plane2")<0&&m.unlockPage.push("plane2"),window["__global.data__"]&&window["__global.data__"].push&&window["__global.data__"].push(2)),t>=5&&m.planes.indexOf(3)<0&&(m.planes.push(3),r.event("player.unlockplane"),m.unlockPage.indexOf("HangarPage")<0&&m.unlockPage.push("HangarPage"),m.unlockPage.indexOf("plane3")<0&&m.unlockPage.push("plane3"),window["__global.data__"]&&window["__global.data__"].push&&window["__global.data__"].push(3)),t>=7&&m.planes.indexOf(4)<0&&(m.planes.push(4),r.event("player.unlockplane"),m.unlockPage.indexOf("HangarPage")<0&&m.unlockPage.push("HangarPage"),m.unlockPage.indexOf("plane4")<0&&m.unlockPage.push("plane4"),window["__global.data__"]&&window["__global.data__"].push&&window["__global.data__"].push(4)),t>=13&&m.planes.indexOf(6)<0&&(m.planes.push(6),r.event("player.unlockplane"),m.unlockPage.indexOf("HangarPage")<0&&m.unlockPage.push("HangarPage"),m.unlockPage.indexOf("plane6")<0&&m.unlockPage.push("plane6"),window["__global.data__"]&&window["__global.data__"].push&&window["__global.data__"].push(6))}updateRate(t,e){1==S.diff?this.uchapter[t]&&this.uchapter[t]<e&&(this.uchapter[t]=e):this.udchapter[t]&&this.udchapter[t]<e&&(this.udchapter[t]=e)}};const S=new class{constructor(){this.lastData=null,this.attack=0,this.crit=0,this.critHurt=0,this.speed=0,this.fspeed=0,this.eneHurtStr=0,this.bosHurtStr=0,this.fattack=0,this.wattack=0,this.hp=0,this.currHP=0,this.defense=0,this.subHurt=0,this.id=1,this.chapter=1,this.diff=1,this.rate=1,this.exp=0,this.level=1,this.skills={},this.rewards={},this.specialSuit=[],this.unlock=[],this.nunlock=[],this.coin=0,this.reward=0}setChapter(){let t=this.chapter;const e=this.diff;let i;k.updateChapter(t),t<15?this.chapter++:15==t&&1==e&&(this.chapter=1,this.diff=2),this.rate=1;const a=(i=t<1?s.basChapter:1==e?s.comChapters[t-1]:s.difChapters[t-1]).unlockskill;for(let t=0;t<a.length;t++){const e=a[t];this.unlock.indexOf(e)<0&&this.unlock.push(e),this.nunlock.indexOf(e)<0&&this.nunlock.push(e)}}initPlayer(t){let e=this.id,o=m.level;const h=l.getAttHp(o,e);!t&&this.chapter<1&&(this.chapter=1),this.rate=1,this.specialSuit=[];const r=k.equips,c=i.equs,d={};let p=0,u=0,y=0,g=0,b=0,f=0;for(const t in r){const e=r[t];if(e){const t=a.getAtts(e[0],e[1],e[2]);for(let e=0;e<t.length;e++){const s=t[e],i=s[0],a=s[1];1==i?p+=a:2==i?u+=a:3==i?y+=a:4==i?g+=a:5==i?b+=a:6==i&&(f+=a)}const s=c[e[0]];d[s.suit]?d[s.suit]++:d[s.suit]=1}}const S=n.planes[e];let C=h.att+p,L=h.hp+u,D=100*S.crit,P=1.5,x=.001,v=y,E=f;for(const t in r){const e=r[t];if(e){const t=e[3];for(let e=0;e<t.length;e++){const s=t[e],i=s[0],a=s[1];1001==i?C*=1+a/100:1004==i?L*=1+a/100:1002==i?D*=1+a/100:1003==i?P*=1+a/100:1005==i?x*=1+a/100:1006==i?b*=1+a/100:1007==i&&(g*=1+a/100)}}}for(const t in d){const e=a.thunders[t];if(e){const s=d[t];for(let t=0;t<Math.floor(s/2);t++){let s=2*t+2;if(e[s]){const t=e[s][0],i=e[s][1];1==t?(b*=1+i,g*=1+i):2==t||(3==t?C*=1+i:4==t?this.specialSuit.indexOf(4)<0&&this.specialSuit.push(4):5==t?L*=1+i:6==t?x*=1+i:7==t?this.specialSuit.indexOf(7)<0&&this.specialSuit.push(7):8==t?this.specialSuit.indexOf(8)<0&&this.specialSuit.push(8):9==t?(C*=1+i,L*=1+i):10==t||(11==t?E*=1+i:12==t||13==t&&this.specialSuit.indexOf(13)<0&&this.specialSuit.push(13)))}}}}this.hp=L,this.attack=C,this.crit=D,this.critHurt=P,this.eneHurtStr=v,this.bosHurtStr=E,this.subHurt=x,this.speed=S.shooting,this.fspeed=S.bulletsp,this.fattack=b,this.wattack=g,this.unlock.length||(this.unlock=s.basChapter.unlockskill)}initPlayerUI(t){let e=t,s=m.level;const o=l.getAttHp(s,e),h=k.equips,r=i.equs,c={};let d=0,p=0,u=0,y=0,g=0,b=0;for(const t in h){const e=h[t];if(e){const t=a.getAtts(e[0],e[1],e[2]);for(let e=0;e<t.length;e++){const s=t[e],i=s[0],a=s[1];1==i?d+=a:2==i?p+=a:3==i?u+=a:4==i?y+=a:5==i?g+=a:6==i&&(b+=a)}const s=r[e[0]];c[s.suit]?c[s.suit]++:c[s.suit]=1}}const f=n.planes[e];let S=o.att+d,C=o.hp+p,L=100*f.crit,D=1.5,P=.001,x=b;for(const t in h){const e=h[t];if(e){const t=e[3];for(let e=0;e<t.length;e++){const s=t[e],i=s[0],a=s[1];1001==i?S*=1+a/100:1004==i?C*=1+a/100:1002==i?L*=1+a/100:1003==i?D*=1+a/100:1005==i?P*=1+a/100:1006==i?g*=1+a/100:1007==i&&(y*=1+a/100)}}}for(const t in c){const e=a.thunders[t];if(e){const s=c[t];for(let t=0;t<Math.floor(s/2);t++){let s=2*t+2;if(e[s]){const t=e[s][0],i=e[s][1];1==t?(g*=1+i,y*=1+i):2==t||(3==t?S*=1+i:4==t||(5==t?C*=1+i:6==t?P*=1+i:7==t||8==t||(9==t?(S*=1+i,C*=1+i):10==t||11==t&&(x*=1+i))))}}}}return{hp:C,attack:S}}getCombatValue(){let t=8*this.attack+1*this.hp+2*this.fattack+2*this.wattack+500*this.eneHurtStr+500*this.bosHurtStr;return t=Math.round(t)}getCombatValueUI(t,e){let s=8*t+1*e+2*this.fattack+2*this.wattack+500*this.eneHurtStr+500*this.bosHurtStr;return s=Math.round(s)}};class C{static setTasks(t){for(let e=1;e<t.length;e++){const s=t[e];this.tasks[s[0]]={id:s[0],titleCN:s[1],desCN:s[2],title:s[3],des:s[4],rewardtype:s[5],reward:s[6],time:s[7],probability:s[8],drop:s[9]}}}static setDailyTasks(t){for(let e=1;e<t.length;e++){const s=t[e];s[5];this.dailyTasks[s[0]]={id:s[0],desCN:s[1],des:s[2],rewardtype:s[3],reward:s[4],type:s[5],num:s[6]}}L.initDailys()}static setAchis(t){for(let e=1;e<t.length;e++){const s=t[e];s[6];this.achievements[s[0]]={id:s[0],desCN:s[1],des:s[2],rewardtype:s[3],reward:s[4],index:s[5],type:s[6],num:s[7]}}}}C.tasks={},C.dailyTasks={},C.achievements={},C.isSignin=!1;const L=new class{constructor(){this.tasks={},this.dailys={},this.achieves={},this.shopLims={},this.shopBoxs={},this.friendRoboted=0,this.friended={},this.logintime=0,r.on("config.setter",this,()=>{const t=Date.now();this.logintime&&this.isSameDay(this.logintime,t)||this.isNewDay(!0),this.logintime=t}),r.on("player.upHangarLevel",this,()=>{this.dailys[1]&&this.dailys[1].num++,this.dailys[2]&&this.dailys[2].num++,this.setAchieve(1,0,0,m.level)}),r.on("player.unlockplane",this,()=>{this.setAchieve(2,0,0,m.planes.length)}),r.on("player.watchAd",this,()=>{this.dailys[19]&&this.dailys[19].num++,this.setAchieve(3,0,1)}),r.on("player.shopBox",this,()=>{this.dailys[7]&&this.dailys[7].num++,this.dailys[8]&&this.dailys[8].num++,this.dailys[9]&&this.dailys[9].num++,this.setAchieve(4,0,1)}),r.on("player.expendCoin",this,t=>{this.setAchieve(5,0,t)}),r.on("player.reborn",this,()=>{this.dailys[10]&&this.dailys[10].num++,this.dailys[11]&&this.dailys[11].num++,this.setAchieve(6,0,1)}),r.on("player.getPurEqu",this,()=>{this.setAchieve(7,0,1)}),r.on("player.selSkill",this,()=>{this.dailys[17]&&this.dailys[17].num++,this.dailys[18]&&this.dailys[18].num++,this.setAchieve(8,0,1)}),r.on("player.getEqu",this,()=>{this.setAchieve(9,0,1)}),r.on("player.killBoss",this,()=>{this.dailys[3]&&this.dailys[3].num++,this.dailys[4]&&this.dailys[4].num++,this.setAchieve(10,0,1)}),r.on("player.endlessed",this,()=>{this.dailys[20]&&this.dailys[20].num++,this.setAchieve(11,0,1)}),r.on("player.rated",this,()=>{this.dailys[5]&&this.dailys[5].num++,this.dailys[6]&&this.dailys[6].num++}),r.on("player.upEquLevel",this,()=>{this.dailys[12]&&this.dailys[12].num++,this.dailys[13]&&this.dailys[13].num++,this.dailys[14]&&this.dailys[14].num++}),r.on("player.killEnemy",this,()=>{this.dailys[15]&&this.dailys[15].num++,this.dailys[16]&&this.dailys[16].num++})}setShopLimsGood(t){this.shopLims.good&&(this.shopLims.good.bgoods||(this.shopLims.good.bgoods={}),this.shopLims.good.bgoods[t]||(this.shopLims.good.bgoods[t]=0),this.shopLims.good.bgoods[t]++)}setShopLimsSkill(t){this.shopLims.skill&&(this.shopLims.skill.bskills||(this.shopLims.skill.bskills={}),this.shopLims.skill.bskills[t]||(this.shopLims.skill.bskills[t]={id:t,reset:Date.now()+1e3*y.ShopData.Lim.Skill.timer}))}setShopBoxs(t){const e=this.shopBoxs;e[t]||(e[t]={adnum:y.ShopData.Box[t].adnum,reset:null,danum:0}),e[t].adnum>0?(e[t].adnum--,e[t].reset||(e[t].reset=Date.now()+1e3*y.ShopData.Box[t].reset)):e[t].danum++}isSameDay(t,e){return new Date(t).setHours(0,0,0,0)===new Date(e).setHours(0,0,0,0)}isNewDay(t){t&&(this.friendRoboted=0,this.friended={},this.dailys={},this.initDailys(),m.advData={})}initDailys(){if(this.setAchieve(1,0,0,m.level),this.setAchieve(2,0,0,m.planes.length),Object.keys(this.dailys).length>0)return;const t=C.dailyTasks;if(!Object.keys(t).length)return;const e=[];for(;e.length<4;){const t=d.getRandom(10,1);e.indexOf(t)<0&&e.push(t)}e.push(11);for(let s=0;s<e.length;s++){const i=e[s],a=[];for(const e in t){const s=t[e];s.type==i&&a.push(s.id)}const l=a[d.getRandom(a.length-1,0)];this.dailys[l]={num:0,recd:!1}}}setTask(t,e){const s=this.tasks[t];let i=0;s&&(i=s.num),e.num=i,this.tasks[t]=e}getTask(t){const e=this.tasks[t];e&&(e.num++,e.num>=4?(e.recd=!0,e.reset=Date.now()+144e5):e.start=e.end=null)}setAchieve(t,e,s,i){this.achieves[t]||(this.achieves[t]={num:0,index:1}),this.achieves[t].index+=e,s&&(this.achieves[t].num+=s),i&&(this.achieves[t].num=i)}getAchieve(t){return this.achieves[t]||(this.achieves[t]={num:0,index:1}),this.achieves[t]}};var D,P,x;!function(t){t[t.Line=1]="Line",t[t.DownCurve=2]="DownCurve",t[t.UpCurve=3]="UpCurve"}(D||(D={})),function(t){t[t.Return=1]="Return",t[t.Repeat=2]="Repeat",t[t.Remove=3]="Remove"}(P||(P={})),function(t){t[t.Top=1]="Top",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Bottom=4]="Bottom"}(x||(x={}));class v{static setEnemys1(t,e){const s=this["enemys"+e],i=this["denemys"+e],a=this.assets,l=this.assets2,n=[],o=[];for(let h=1;h<t.length;h++){const r=t[h],c=r[3];if("number"!=typeof c)continue;let d=1==c?s[r[2]]:i[r[2]];const p=1==c?n:o;d||(1==c?(s[r[2]]=[],d=s[r[2]]):(i[r[2]]=[],d=i[r[2]])),d.push({id:r[0],chapter:r[1],level:r[2],difficulty:r[3],type:r[4],direntry:r[5],entry:r[6],direxit:r[7],exit:r[8],distance:r[9],time:r[10],return:r[11],route:r[12],speed:r[13],att:r[14],hp:r[15],def:r[16],shooting:r[17],atttime:r[18],bulletsp:r[19],bulletstart:r[20],disx:r[21],inflect:r[22],in:this.getPos(r[5],r[6]),out:this.getPos(r[7],r[8])}),a[e+""+c]||(a[e+""+c]={}),a[e+""+c][r[2]]||(a[e+""+c][r[2]]=[]);const u=a[e+""+c][r[2]];p.indexOf(r[4])<0&&(p.push(r[4]),u.push(r[4])),l[e+""+c]||(l[e+""+c]={}),l[e+""+c][r[2]]||(l[e+""+c][r[2]]=[]);const y=l[e+""+c][r[2]];y.indexOf(r[4])<0&&y.push(r[4])}}static getPos(t,e){if("number"!=typeof t||"number"!=typeof e)return null;const s=new Laya.Vector2;return t==x.Top?(s.x=e,s.y=0):t==x.Left?(s.x=0,s.y=e):t==x.Right?(s.x=720,s.y=e):t==x.Bottom&&(s.x=e,s.y=1280),s}}v.enemys0={},v.enemys1={},v.denemys1={},v.enemys2={},v.denemys2={},v.enemys3={},v.denemys3={},v.enemys4={},v.denemys4={},v.enemys5={},v.denemys5={},v.enemys6={},v.denemys6={},v.enemys7={},v.denemys7={},v.enemys8={},v.denemys8={},v.enemys9={},v.denemys9={},v.enemys10={},v.denemys10={},v.enemys11={},v.denemys11={},v.enemys12={},v.denemys12={},v.enemys13={},v.denemys13={},v.enemys14={},v.denemys14={},v.enemys15={},v.denemys15={},v.assets={},v.assets2={};class E{static setDrop(t){const e=this.advDrop;for(let s=1;s<t.length;s++){const i=t[s],a=i[1],l=i[2];e[a]||(e[a]={}),e[a][l]={id:i[0],model:i[1],diff:i[2],drop:i[3],minbox:i[4],maxbox:i[5],mingold:i[6],maxgold:i[7],mindiamond:i[8],maxdiamond:i[9]}}}static setData(t){for(let e=1;e<t.length;e++){const s=t[e],i=s[1];if("number"!=typeof i)continue;const a=s[3],l=s[2],n=1==i?this.equAdv:this.goldAdv;n[a]||(n[a]={}),n[a][l]||(n[a][l]=[]),n[a][l].push({adv:{id:s[0],model:s[1],level:s[2],diff:s[3]},edata:{id:s[0],chapter:0,level:1,difficulty:a,type:s[4],direntry:s[5],entry:s[6],direxit:s[7],exit:s[8],distance:s[9],time:s[10],return:s[11],route:s[12],speed:s[13],att:s[14],hp:s[15],def:s[16],shooting:s[17],atttime:s[18],bulletsp:s[19],bulletstart:s[20],disx:s[21],inflect:s[22],in:this.getPos(s[5],s[6]),out:this.getPos(s[7],s[8])}})}}static getPos(t,e){if("number"!=typeof t||"number"!=typeof e)return null;const s=new Laya.Vector2;return t==x.Top?(s.x=e,s.y=0):t==x.Left?(s.x=0,s.y=e):t==x.Right?(s.x=720,s.y=e):t==x.Bottom&&(s.x=e,s.y=1280),s}}E.equAdv={},E.goldAdv={},E.advDrop={};class w{static setExps(t){for(let e=1;e<t.length;e++){const s=t[e];1==s[1]?this.upLevExps[s[2]]=s[4]:2==s[1]&&(this.levelExps[s[3]]=s[4])}}}w.levelExps={},w.upLevExps={};class T{static setEnemys(t){const e=this.enemys;for(let s=1;s<t.length;s++){const i=t[s];e[i[0]]={id:i[0],nameCN:i[1],icon:i[2],shooting:i[3],bullettype:i[4],skill:i[5],dropgold:i[6],shock:i[7]}}}}var B;T.enemys={},function(t){t[t.Once=1]="Once",t[t.Add=2]="Add",t[t.Always=3]="Always",t[t.Supply=4]="Supply"}(B||(B={}));class A{static setSkills(t){for(let e=1;e<t.length;e++){const i=t[e];this.skills[i[0]]={id:i[0],nameCN:i[1],name:i[2],describeCN:i[3],describe:i[4],skilltype:i[5],fightadd:i[6],value:i[7],bullettype:i[8],buff:i[9],bufftime:i[10],add:i[11],speed:"number"==typeof i[13]?i[13]:0,fspeed:"number"==typeof i[14]?i[14]:0,robotsp:"number"==typeof i[15]?i[15]:0,robotbullet:"number"==typeof i[16]?i[16]:0,weight:i[17],recommend:i[18]};const a=(i[12]+"").split("|"),l=a[0]?parseInt(a[0]):0,n=a[1]?parseInt(a[1]):0;l?1==l?s.comChapters[n-1].unlockskill.push(i[0]):s.difChapters[n-1].unlockskill.push(i[0]):i[11]!=B.Add&&1e3!=i[0]&&s.basChapter.unlockskill.push(i[0])}s.basChapter.unlockskill.push(1020)}}A.skills={};const _={lobby:{LobbySceneBgNode:"prefab/lobby/LobbySceneBgNode.json",BattlePage:"prefab/lobby/BattlePage.json",AdventurePage:"prefab/lobby/AdventurePage.json",HangarPage:"prefab/lobby/HangarPage.json",HangarDialog:"prefab/lobby/HangarDialog.json",HangarPlaneItem:"prefab/lobby/HangarPlaneItem.json",RankDialog:"prefab/lobby/RankDialog.json",SigninDialog:"prefab/lobby/SigninDialog.json",TaskDialog:"prefab/lobby/TaskDialog.json",TaskItem:"prefab/lobby/task/TaskItem.json",AchievementDialog:"prefab/lobby/AchievementDialog.json",DailyDialog:"prefab/lobby/DailyDialog.json",EndlessDialog:"prefab/lobby/EndlessDialog.json",UnlockPlaneDialog:"prefab/lobby/UnlockPlaneDialog.json",EquipmentPage:"prefab/lobby/EquipmentPage.json",ShopPage:"prefab/lobby/ShopPage.json",EquMainItem:"prefab/lobby/equipment/EquMainItem.json",EquMainTogItem:"prefab/lobby/equipment/EquMainTogItem.json",EquSuitDialog:"prefab/lobby/equipment/EquSuitDialog.json",EquSymDialog:"prefab/lobby/equipment/EquSymDialog.json",EquNewAttDialog:"prefab/lobby/equipment/EquNewAttDialog.json",EquOequDialog:"prefab/lobby/equipment/EquOequDialog.json",EquDecDialog:"prefab/lobby/equipment/EquDecDialog.json",EquMatDesDialog:"prefab/lobby/equipment/EquMatDesDialog.json",CommonDialog:"prefab/lobby/common/CommonDialog.json",CommonLoadingDialog:"prefab/lobby/common/CommonLoadingDialog.json",CommonTipDialog:"prefab/lobby/common/CommonTipDialog.json",CommonRewardDialog:"prefab/lobby/common/CommonRewardDialog.json",CommonRewardAdDialog:"prefab/lobby/common/CommonRewardAdDialog.json",UnlockChapterDialog:"prefab/lobby/common/UnlockChapterDialog.json"},battle:{BgNode:"prefab/battle/bg/BgNode.json",PlayerReward:"prefab/battle/bg/PlayerRewardNode.json",Player:"prefab/battle/player/Player.json",Player1:"prefab/battle/player/Player1.json",PlayerHP:"prefab/battle/player/PlayerHP.json",Player1Bullet:"prefab/battle/skill/Player1Bullet.json",Player3Bullet:"prefab/battle/skill/Player3Bullet.json",Player4Bullet:"prefab/battle/skill/Player4Bullet.json",Player4MainBoom:"prefab/battle/skill/Player4MainBoom.json",Player5Bullet:"prefab/battle/skill/Player5Bullet.json",Player6Bullet:"prefab/battle/skill/Player6Bullet.json",Player6Bullet1:"prefab/battle/skill/Player6Bullet1.json",PlayerLaser:"prefab/battle/skill/PlayerLaser.json",PlayerShield:"prefab/battle/skill/PlayerShield.json",PlayerTimeShield:"prefab/battle/skill/PlayerTimeShield.json",PlayerDieShot:"prefab/battle/skill/PlayerDieShot.json",PlayerDieBoom:"prefab/battle/skill/PlayerDieBoom.json",PlayerSkill1:"prefab/battle/skill/PlayerSkill1.json",PlayerSkill2:"prefab/battle/skill/PlayerSkill2.json",PlayerSkill3:"prefab/battle/skill/PlayerSkill3.json",PlayerSkill4:"prefab/battle/skill/PlayerSkill4.json",PlayerSkill5:"prefab/battle/skill/PlayerSkill5.json",PlayerSkill6:"prefab/battle/skill/PlayerSkill6.json",PlayerSkill7:"prefab/battle/skill/PlayerSkill7.json",PlayerSkill8:"prefab/battle/skill/PlayerSkill8.json",PlayerSkill9:"prefab/battle/skill/PlayerSkill9.json",PlayerSkill10:"prefab/battle/skill/PlayerSkill10.json",PlayerSkill2002:"prefab/battle/skill/PlayerSkill2002.json",PlayerSkill2012:"prefab/battle/skill/PlayerSkill2012.json",PlayerSkill2013:"prefab/battle/skill/PlayerSkill2013.json",PlayerWing1:"prefab/battle/wing/PlayerWing1.json",PlayerWing1b:"prefab/battle/wing/PlayerWing1b.json",PlayerWing2:"prefab/battle/wing/PlayerWing2.json",PlayerWing2b:"prefab/battle/wing/PlayerWing2b.json",PlayerWing3:"prefab/battle/wing/PlayerWing3.json",PlayerWing3b:"prefab/battle/wing/PlayerWing3b.json",PlayerWing4:"prefab/battle/wing/PlayerWing4.json",PlayerWing4b:"prefab/battle/wing/PlayerWing4b.json",PlayerWing5:"prefab/battle/wing/PlayerWing5.json",PlayerWing5b:"prefab/battle/wing/PlayerWing5b.json",PlayerWing6:"prefab/battle/wing/PlayerWing6.json",PlayerWing6b:"prefab/battle/wing/PlayerWing6b.json",PlayerRobot1:"prefab/battle/robot/PlayerRobot1.json",PlayerRobot1b:"prefab/battle/robot/PlayerRobot1b.json",PlayerRobot2:"prefab/battle/robot/PlayerRobot2.json",PlayerRobot3:"prefab/battle/robot/PlayerRobot3.json",Enemy1001:"prefab/battle/enemy/Enemy1001.json",Enemy1002:"prefab/battle/enemy/Enemy1002.json",Enemy1004:"prefab/battle/enemy/Enemy1004.json",Enemy1006:"prefab/battle/enemy/Enemy1006.json",Enemy1008:"prefab/battle/enemy/Enemy1008.json",Enemy1010:"prefab/battle/enemy/Enemy1010.json",Enemy1012:"prefab/battle/enemy/Enemy1012.json",Enemy1014:"prefab/battle/enemy/Enemy1014.json",Enemy1016:"prefab/battle/enemy/Enemy1016.json",Enemy1017:"prefab/battle/enemy/Enemy1017.json",Enemy1018:"prefab/battle/enemy/Enemy1018.json",Enemy1019:"prefab/battle/enemy/Enemy1019.json",Enemy1020:"prefab/battle/enemy/Enemy1020.json",Enemy1021:"prefab/battle/enemy/Enemy1021.json",Enemy1023:"prefab/battle/enemy/Enemy1023.json",Enemy1024:"prefab/battle/enemy/Enemy1024.json",Enemy1025:"prefab/battle/enemy/Enemy1025.json",Enemy1026:"prefab/battle/enemy/Enemy1026.json",Enemy1027:"prefab/battle/enemy/Enemy1027.json",Enemy1029:"prefab/battle/enemy/Enemy1029.json",Enemy2001:"prefab/battle/enemy/Enemy2001.json",Enemy2002:"prefab/battle/enemy/Enemy2002.json",Enemy2003:"prefab/battle/enemy/Enemy2003.json",Enemy2004:"prefab/battle/enemy/Enemy2004.json",Enemy2005:"prefab/battle/enemy/Enemy2005.json",Enemy2006:"prefab/battle/enemy/Enemy2006.json",Enemy3001:"prefab/battle/enemy/Enemy3001.json",Enemy3002:"prefab/battle/enemy/Enemy3002.json",EnemyHPTip:"prefab/battle/enemy/EnemyHPTip.json",EnemyLine:"prefab/battle/enemySkill/EnemyLine.json",EnemyLaser:"prefab/battle/enemySkill/EnemyLaser.json",EnemySkill1:"prefab/battle/enemySkill/EnemySkill1.json",EnemySkill3:"prefab/battle/enemySkill/EnemySkill3.json",EnemySkill5:"prefab/battle/enemySkill/EnemySkill5.json",EnemySkill9:"prefab/battle/enemySkill/EnemySkill9.json",EnemySkill10:"prefab/battle/enemySkill/EnemySkill10.json",EnemySkill11:"prefab/battle/enemySkill/EnemySkill11.json",EnemySkill13:"prefab/battle/enemySkill/EnemySkill13.json",EnemySkill15:"prefab/battle/enemySkill/EnemySkill15.json",EnemySkill16:"prefab/battle/enemySkill/EnemySkill16.json",EnemySkill18:"prefab/battle/enemySkill/EnemySkill18.json",EnemySkill2001:"prefab/battle/enemySkill/EnemySkill2001.json",EnemySkill1011:"prefab/battle/enemySkill/EnemySkill1011.json",EnemySkill1022:"prefab/battle/enemySkill/EnemySkill1022.json",EnemySmete:"prefab/battle/enemySkill/EnemySmete.json",EnemyBoom:"prefab/battle/effect/EnemyBoom.json",EnemyBoom2:"prefab/battle/effect/EnemyBoom2.json",EnemyWave:"prefab/battle/effect/EnemyWave.json",PlayerLaserHit:"prefab/battle/effect/PlayerLaserHit.json",PlayerLaserHit2:"prefab/battle/effect/PlayerLaserHit2.json",PlayerLaserHit3:"prefab/battle/effect/PlayerLaserHit3.json",PlayerBlast:"prefab/battle/effect/PlayerBlast.json",PlayerFireBuff:"prefab/battle/effect/PlayerFireBuff.json",PlayerPoisonBuff:"prefab/battle/effect/PlayerPoisonBuff.json",PlayerIceBuff:"prefab/battle/effect/PlayerIceBuff.json",HpBarLight:"prefab/battle/effect/HpBarLight.json",PlayerCoin:"prefab/battle/effect/PlayerCoin.json"},battleUI:{BattleSceneMidNode:"prefab/battle/bg/BattleSceneMidNode.json",BattleFriendNode:"prefab/battle/bg/BattleFriendNode.json",BattleCompareBigNode:"prefab/battle/bg/BattleCompareBigNode.json",BattleCompareSmallNode:"prefab/battle/bg/BattleCompareSmallNode.json",FriendDialog:"prefab/battle/bg/FriendDialog.json",ChooseSkillDialog:"prefab/battle/bg/ChooseSkillDialog.json",ChooseAdvSkillDialog:"prefab/battle/bg/ChooseAdvSkillDialog.json",SupplySkillDialog:"prefab/battle/bg/SupplySkillDialog.json",GamePauseDialog:"prefab/battle/bg/GamePauseDialog.json",GameOverDialog:"prefab/battle/bg/GameOverDialog.json",EndlessOverDialog:"prefab/battle/bg/EndlessOverDialog.json",EndlessOverstepDialog:"prefab/battle/bg/EndlessOverstepDialog.json",RebornDialog:"prefab/battle/bg/RebornDialog.json",PlayerSkillItem:"prefab/battle/bg/PlayerSkillItem.json"}},V={PlaneModel1:"unity/plane1/plane.lh",PlaneModel2:"unity/plane2/plane.lh",PlaneModel3:"unity/plane3/plane.lh",PlaneModel4:"unity/plane4/plane.lh",PlaneModel5:"unity/plane5/plane.lh",PlaneModel6:"unity/plane6/plane.lh",PlaneTrackModel:"unity/track/plane.lh",Coin:"unity/coin/plane.lh",DaoDan:"unity/daodan/plane.lh",Main4:"unity/plane4main/plane.lh",CaiHon:"unity/caihon/plane.lh",DaoDanLiaoJi:"unity/daodanliaoji/plane.lh",DaoDanGui:"unity/daodangui/plane.lh",FuYouPao:"unity/fuyoupao/plane.lh",DaoDanFu:"unity/daodanf/plane.lh",YanHua:"unity/yanhua/plane.lh",E_DaoDan:"unity/e_daodan/plane.lh",E_Hxb:"unity/e_hxb/plane.lh"},R={2001:"battle/enemy/plane/2001/boss01.sk",3001:"battle/enemy/plane/3001/foe3001.sk",3002:"battle/enemy/plane/3002/BuJi.sk",1002:"battle/enemy/plane/1002/foe1002.sk",1004:"battle/enemy/plane/1004/foe1004.sk",1006:"battle/enemy/plane/1006/foe1006.sk",1014:"battle/enemy/plane/1014/foe1014.sk"},N={1001:"prefab/battle/enemy/Enemy1001.json",1002:"prefab/battle/enemy/Enemy1002.json",1003:"prefab/battle/enemy/Enemy1002.json",1004:"prefab/battle/enemy/Enemy1004.json",1005:"prefab/battle/enemy/Enemy1004.json",1006:"prefab/battle/enemy/Enemy1006.json",1007:"prefab/battle/enemy/Enemy1006.json",1008:"prefab/battle/enemy/Enemy1008.json",1009:"prefab/battle/enemy/Enemy1008.json",1010:"prefab/battle/enemy/Enemy1010.json",1011:"prefab/battle/enemy/Enemy1010.json",1012:"prefab/battle/enemy/Enemy1012.json",1013:"prefab/battle/enemy/Enemy1012.json",1014:"prefab/battle/enemy/Enemy1014.json",1015:"prefab/battle/enemy/Enemy1014.json",1016:"prefab/battle/enemy/Enemy1016.json",1017:"prefab/battle/enemy/Enemy1017.json",1018:"prefab/battle/enemy/Enemy1018.json",1019:"prefab/battle/enemy/Enemy1019.json",1020:"prefab/battle/enemy/Enemy1020.json",1021:"prefab/battle/enemy/Enemy1021.json",1022:"prefab/battle/enemy/Enemy1021.json",1023:"prefab/battle/enemy/Enemy1023.json",1024:"prefab/battle/enemy/Enemy1024.json",1025:"prefab/battle/enemy/Enemy1025.json",1026:"prefab/battle/enemy/Enemy1026.json",1027:"prefab/battle/enemy/Enemy1027.json",1028:"prefab/battle/enemy/Enemy1004.json",1029:"prefab/battle/enemy/Enemy1029.json",2001:"prefab/battle/enemy/Enemy2001.json",2002:"prefab/battle/enemy/Enemy2002.json",2003:"prefab/battle/enemy/Enemy2003.json",2004:"prefab/battle/enemy/Enemy2004.json",2005:"prefab/battle/enemy/Enemy2005.json",2006:"prefab/battle/enemy/Enemy2006.json",3001:"prefab/battle/enemy/Enemy3001.json",3002:"prefab/battle/enemy/Enemy3002.json",3003:"prefab/battle/enemy/Enemy3002.json"},I={1:"unity/plane1/plane.lh",2:"unity/plane2/plane.lh",3:"unity/plane3/plane.lh",4:"unity/plane4/plane.lh",5:"unity/plane5/plane.lh",6:"unity/plane6/plane.lh"},M={BlackItalic:"font/DIN-BlackItalic.ttf"},H={Chapter:"chapter.json",Skill:"skill.json",Level0:"level0.json",Level1:"level1.json",Level2:"level2.json",Level3:"level3.json",Level4:"level4.json",Level5:"level5.json",Level6:"level6.json",Level7:"level7.json",Level8:"level8.json",Level9:"level9.json",Level10:"level10.json",Level11:"level11.json",Level12:"level12.json",Level13:"level13.json",Level14:"level14.json",Level15:"level15.json",Enaircraft:"enaircraft.json",Exp:"exp.json",Upaircraft:"upaircraft.json",Upgold:"upgold.json",Aircraft:"aircraft.json",Item:"item.json",Shop:"shop.json",Equip:"equip.json",Addskill:"addskill.json",Upequip:"upequip.json",Task:"task.json",DailyTask:"dailytask.json",Achievement:"achievement.json",Adventurefight:"adventurefight.json",Adventuredrop:"adventuredrop.json"},O={BattleBgMus:"sound/bgbattle.mp3",BattleBoom1Sou:"sound/boom1.ogg",BattleBoom2Sou:"sound/boom2.ogg",BattleBossComSou:"sound/bosscoming.ogg",BattleSucSou:"sound/success.ogg",LobbyBgMus:"sound/bglobby.mp3",ClickSou:"sound/click.ogg",GetFlyCoinSou:"sound/getflycoin.ogg",PlaneLevUpSou:"sound/planelv.ogg"},q={1:"unity/plane1/Assets/Plane_3.jpg",2:"unity/plane2/Assets/Plane_2.jpg",3:"unity/plane3/Assets/Plane_1.jpg",4:"unity/plane4/Assets/Plane4.jpg",5:"unity/plane5/Assets/Plane5.jpg",6:"unity/plane6/Assets/Plane6.jpg"},U={1:"lobby/planes/Plane1.png",2:"lobby/planes/Plane2.png",3:"lobby/planes/Plane3.png",4:"lobby/planes/Plane4.png",5:"lobby/planes/Plane5.png",6:"lobby/planes/Plane6.png"},F={1007:[V.E_DaoDan],1009:[V.E_DaoDan],1027:[V.E_Hxb],1029:[V.E_DaoDan],2003:[V.E_DaoDan],2005:[V.E_DaoDan]},j={1003:[_.battle.EnemySkill1],1004:[_.battle.EnemySkill1],1005:[_.battle.EnemySkill5],1007:[_.battle.EnemySkill3],1009:[_.battle.EnemySkill3],1011:[_.battle.EnemySkill11,_.battle.EnemySkill1],1013:[_.battle.EnemySkill1],1015:[_.battle.EnemyLine,_.battle.EnemySkill1],1016:[_.battle.EnemySkill10],1017:[_.battle.EnemySkill1],1019:[_.battle.EnemySmete],1022:[_.battle.EnemySkill1],1023:[_.battle.EnemySkill9,_.battle.EnemySkill1],1024:[_.battle.EnemySkill10],1025:[_.battle.EnemyLine,_.battle.EnemySkill1],1026:[_.battle.EnemySkill13],1027:[_.battle.EnemySkill15],1028:[_.battle.EnemySkill16],1029:[_.battle.EnemySkill18],2001:[_.battle.EnemySkill1,_.battle.EnemySkill2001],2002:[_.battle.EnemySkill1,_.battle.EnemySkill5,_.battle.EnemySkill11,_.battle.EnemySkill1011],2003:[_.battle.EnemySkill1,_.battle.EnemySkill11,_.battle.EnemySkill1011,_.battle.EnemySkill1022,_.battle.EnemySkill2001],2004:[_.battle.EnemySkill2001,_.battle.EnemySkill9,_.battle.EnemySkill5],2005:[_.battle.EnemySkill2001,_.battle.EnemySkill9,_.battle.EnemySkill3],2006:[_.battle.EnemySkill2001,_.battle.EnemySkill9],3002:[_.battleUI.SupplySkillDialog]},G={2002:[V.DaoDanFu],2004:[V.FuYouPao],2006:[V.CaiHon],2010:[V.DaoDanGui],2012:[V.YanHua],3002:[V.DaoDanLiaoJi]},W={1000:[_.battle.PlayerWing3,_.battle.PlayerWing3b,_.battle.PlayerSkill2,_.battle.PlayerSkill2002,_.battle.PlayerSkill2013,_.battle.PlayerSkill2012,_.battle.PlayerDieShot,_.battle.PlayerShield],1025:[_.battle.PlayerShield],1027:[_.battle.PlayerTimeShield],1028:[_.battle.PlayerDieShot],1034:[_.battle.PlayerDieBoom],2001:[_.battle.PlayerSkill4],2002:[_.battle.PlayerSkill2002],2003:[_.battle.PlayerSkill3,_.battle.PlayerLaserHit3],2004:[_.battle.PlayerSkill1],2005:[_.battle.PlayerSkill2],2006:[_.battle.PlayerSkill5],2007:[_.battle.PlayerSkill6,_.battle.PlayerPoisonBuff],2008:[_.battle.PlayerSkill10,_.battle.PlayerIceBuff],2009:[_.battle.PlayerSkill8,_.battle.PlayerFireBuff],2010:[_.battle.PlayerSkill7],2011:[_.battle.PlayerSkill9],2012:[_.battle.PlayerSkill2012],2013:[_.battle.PlayerSkill2013],3001:[_.battle.PlayerWing5,_.battle.PlayerWing5b],3002:[_.battle.PlayerWing2,_.battle.PlayerWing2b],3003:[_.battle.PlayerWing3,_.battle.PlayerWing3b,_.battle.PlayerLaserHit2],3004:[_.battle.PlayerWing4,_.battle.PlayerWing4b],3005:[_.battle.PlayerWing1,_.battle.PlayerWing1b,_.battle.PlayerBlast],3006:[_.battle.PlayerWing6,_.battle.PlayerWing6b],4001:[_.battle.PlayerRobot1,_.battle.PlayerRobot1b],4002:[_.battle.PlayerRobot3],4003:[_.battle.PlayerRobot2,_.battle.PlayerWing6b]},K={1:[_.battle.Player1Bullet],2:[_.battle.PlayerLaser,_.battle.PlayerLaserHit],3:[_.battle.Player3Bullet],4:[_.battle.Player4Bullet,_.battle.Player4MainBoom],5:[_.battle.Player5Bullet],6:[_.battle.Player6Bullet,_.battle.Player6Bullet1]};const Y=new class{constructor(){this.loaded={}}load3D(t){return new Promise((e,s)=>{if(!t||!t.length)return void e();const i=[];for(let e=0;e<t.length;e++){const s=t[e];this.loaded[s]||i.push(s)}i.length?Laya.loader.create(i.concat(),Laya.Handler.create(this,()=>{for(let t=0;t<i.length;t++)i[t];e()})):e()})}loadGamePre(){const t=[];t.push(_.lobby.CommonDialog,_.lobby.CommonLoadingDialog,"prefab/GuidanceDialog.json"),Laya.loader.create(t.concat(),Laya.Handler.create(this,()=>{this.load(t)}),null,Laya.Loader.PREFAB)}loadPlayerPre(t){const e=[];e.push(_.battle.EnemyBoom,_.battle.EnemyBoom2,_.battle.EnemyWave);const s=K[t];if(s)for(let t=0;t<s.length;t++){const i=s[t];this.loaded[i]||e.push(i)}this.load(e)}loadBattlePre(t){if(t){const t=["prefab/GuidanceDialog.json"];Laya.loader.create(t.concat(),Laya.Handler.create(this,()=>{this.load(t)}),null,Laya.Loader.PREFAB)}const e=[];e.push(_.battleUI.ChooseSkillDialog,_.battleUI.GamePauseDialog,_.battleUI.GameOverDialog,_.battleUI.RebornDialog),this.load(e)}loadSkillPre(t){if(!t||!t.length)return;const e=[],s=[];for(let i=0;i<t.length;i++){const a=t[i],l=W[a];if(l)for(let t=0;t<l.length;t++){const s=l[t];this.loaded[s]||e.push(s)}const n=G[a];if(n)for(let t=0;t<n.length;t++){const e=n[t];this.loaded[e]||s.push(e)}}this.load(e),this.load3D(s)}loadEnemyPre(t){if(!t||!t.length)return;const e=[],s=[];for(let i=0;i<t.length;i++){const a=t[i],l=N[a];l&&!this.loaded[l]&&e.push(l);const n=j[a];if(n)for(let t=0;t<n.length;t++){const s=n[t];this.loaded[s]||e.push(s)}const o=F[a];if(o)for(let t=0;t<o.length;t++){const e=o[t];this.loaded[e]||s.push(e)}}this.load(e),this.load3D(s)}load(t){const e=new Laya.Sprite;e.visible=!1,Laya.stage.addChild(e);for(let s=0;s<t.length;s++){const i=t[s];this.loaded[i]=1;let a=null;if(i.indexOf("prefab/battle")>-1){const t=i.split("/"),e=t[t.length-1],s=Laya.loader.getRes("prefab/battle/merge.json")[e];(a=new Laya.Prefab).json=s}else a=Laya.loader.getRes(i);const l=Laya.Pool.getItemByCreateFun(i,a.create,a);l._components=null,e.addChild(l)}e.removeSelf()}};class z{static playFail(){}static closeInterstitialAd(){}static adLoadNoComplete(){this.RewardFailHandler&&this.RewardFailHandler()}static getReward(){this.RewardHandler&&this.RewardHandler()}}z.RewardHandler=null,z.RewardFailHandler=null,Laya.Browser&&Laya.Browser.window&&(Laya.Browser.window.FBSDK=z);const X={DEBUG:!1};class ${static open(t,e){const s=Laya.Pool.getItemByCreateFun(t,e.create,e);return s.__sign__=t,s}static setClick(t,e,s,i,a,l){t.on(Laya.Event.MOUSE_DOWN,s,()=>{a||Laya.Tween.to(t,{scaleX:.9,scaleY:.9},100)});const n=()=>{Laya.Tween.to(t,{scaleX:1,scaleY:1},100)};{const t=e;e=(()=>{a||n(),l||Laya.SoundManager.playSound(O.ClickSou),t.call(s,i)})}t.on(Laya.Event.MOUSE_OUT,s,n),t.on(Laya.Event.CLICK,s,e,i)}static openDialog(t,e,s,i,a){this.loadPrefab(t).then(l=>{const n=this.open(t,l);n.pos(360,640);const o=n.getChildByName("maskNode");o&&(o.offAllCaller(o),this.setClick(o,()=>{a&&this.closeDialog(n)},o,null,!0,!0)),i||n.scale(0,0),i||(n.alpha=0),e.addChild(n),s&&s(n),i||Laya.Tween.to(n,{scaleX:1,scaleY:1,alpha:1},200,Laya.Ease.quadInOut)})}static closeDialog(t,e){let s=t.owner;t instanceof Laya.Node&&(s=t),s&&Laya.Tween.to(s,{scaleX:0,scaleY:0,alpha:0},100,null,Laya.Handler.create(this,()=>{s.removeSelf(),e&&e()}))}static loadPrefab(t){return new Promise((e,s)=>{const i=Laya.loader.getRes(t);if(i)e(i);else{let s=null;if(!X.DEBUG&&t.indexOf("prefab/battle")>-1){const i=t.split("/"),a=i[i.length-1],l=Laya.loader.getRes("prefab/battle/merge.json")[a];(s=new Laya.Prefab).json=l,e(s)}else Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}),null,Laya.Loader.PREFAB)}})}static loadRes(t){return new Promise((e,s)=>{const i=Laya.loader.getRes(t);i?e(i):Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}))})}}let Z=0;class Q extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){r.offAllCaller(this),Laya.timer.clearAll(this)}loadPrefab(t){return new Promise((e,s)=>{const i=Laya.loader.getRes(t);if(i)e(i);else{let s=null;if(!X.DEBUG&&t.indexOf("prefab/battle")>-1){const i=t.split("/"),a=i[i.length-1],l=Laya.loader.getRes("prefab/battle/merge.json")[a];(s=new Laya.Prefab).json=l,e(s)}else Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}),null,Laya.Loader.PREFAB)}})}loadRes(t){return new Promise((e,s)=>{const i=Laya.loader.getRes(t);i?e(i):Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}))})}getRes(t){let e=Laya.loader.getRes(t);if(!X.DEBUG&&t.indexOf("prefab/battle")>-1){const s=t.split("/"),i=s[s.length-1],a=Laya.loader.getRes("prefab/battle/merge.json")[i];(e=new Laya.Prefab).json=a}return e}open(t,e){const s=Laya.Pool.getItemByCreateFun(t,e.create,e);return s.__sign__=t,s}recover(t){let e=t.__sign__;e&&Laya.Pool.recover(e,t);let s=window.__PoolSigns__;s&&s.indexOf&&s.indexOf(e)<0&&s.push(e)}openDialog(t,e,s,i,a){let l=++Z,n=null,o=null;$.openDialog(_.lobby.CommonLoadingDialog,Laya.stage,t=>{n=t,o&&t.removeSelf(),Laya.timer.once(5e3,this,()=>{n&&(n.removeSelf(),n=null,Z++)})},!1),this.loadPrefab(t).then(h=>{if(n&&(n.removeSelf(),n=null),l!=Z)return;const r=this.open(t,h);o=r,r.pos(360,640);const c=r.getChildByName("maskNode");c&&(c.offAllCaller(c),this.setClick(c,()=>{a&&this.closeDialog(r)},c,null,!0,!0)),i||r.scale(0,0),i||(r.alpha=0),e.addChild(r),s&&s(r),i||Laya.Tween.to(r,{scaleX:1,scaleY:1,alpha:1},200,Laya.Ease.quadInOut)})}closeDialog(t,e){let s=t.owner;t instanceof Laya.Node&&(s=t),s&&Laya.Tween.to(s,{scaleX:0,scaleY:0,alpha:0},100,null,Laya.Handler.create(this,()=>{s.removeSelf(),e&&e()}))}setClick(t,e,s,i,a,l){t.on(Laya.Event.MOUSE_DOWN,s,()=>{a||Laya.Tween.to(t,{scaleX:.9,scaleY:.9},100)});const n=()=>{Laya.Tween.to(t,{scaleX:1,scaleY:1},100)};{const t=e;e=(()=>{a||n(),l||Laya.SoundManager.playSound(O.ClickSou),t.call(s,i)})}t.on(Laya.Event.MOUSE_OUT,s,n),t.on(Laya.Event.CLICK,s,e,i)}schedule(t,e,s,i,a,l,n){const o=e;let h=0;e=(()=>{if(h>=i)return Laya.timer.clear(s,e),void(n&&n.call(s));h++,o.call(s,a)}),l&&Laya.timer.clear(s,e),Laya.timer.loop(t,s,e,a)}getVec2(t=0,e=0){return new Laya.Vector2(t,e)}getVec3(t=0,e=0,s=0){return t instanceof Laya.Vector2&&(e=t.y,t=t.x),new Laya.Vector3(t,e,s)}getVec4(t=0,e=0,s=0,i=0){return new Laya.Vector4(t,e,s,i)}shakeEffect(t){Laya.Tween.clearAll(t),Laya.timer.clearAll(t);Laya.Tween.to(t,{x:5,y:-7},20),Laya.timer.once(20,t,()=>{Laya.Tween.to(t,{x:-6,y:-7},20)}),Laya.timer.once(40,t,()=>{Laya.Tween.to(t,{x:-13,y:-3},20)}),Laya.timer.once(60,t,()=>{Laya.Tween.to(t,{x:3,y:6},20)}),Laya.timer.once(80,t,()=>{Laya.Tween.to(t,{x:-5,y:-5},20)}),Laya.timer.once(100,t,()=>{Laya.Tween.to(t,{x:2,y:8},20)}),Laya.timer.once(120,t,()=>{Laya.Tween.to(t,{x:-8,y:10},20)}),Laya.timer.once(140,t,()=>{Laya.Tween.to(t,{x:3,y:-10},20)}),Laya.timer.once(160,t,()=>{Laya.Tween.to(t,{x:0,y:0},20)}),Laya.timer.once(180,t,()=>{Laya.Tween.clearAll(t),Laya.timer.clearAll(t),t.x=0,t.y=0})}}class J extends Q{constructor(){super(),this.cloBtn=null,this.sureBtn=null,this.canBtn=null,this.titLab=null,this.descLab=null,this.sureHandle=null,this.closeHandle=null}static Tip(t,e){$.openDialog(_.lobby.CommonDialog,e,e=>{e.getComponent(J).setData(t)},!1,!0)}setData(t){this.titLab.text=t.title,this.descLab.text=t.desc,this.sureHandle=t.sure,this.closeHandle=t.close,t.only&&(this.canBtn.visible=!1,this.sureBtn.x=353)}onEnable(){this.setClick(this.cloBtn,()=>{this.closeHandle&&this.closeHandle(),this.closeDialog(this)},this),this.setClick(this.canBtn,()=>{this.closeHandle&&this.closeHandle(),this.closeDialog(this)},this),this.setClick(this.sureBtn,()=>{this.sureHandle&&this.sureHandle(),this.closeDialog(this)},this)}onDisable(){Laya.Tween.clearAll(this),Laya.timer.clearAll(this)}}class tt extends Q{constructor(){super()}static Loading(){this.loading||$.openDialog(_.lobby.CommonLoadingDialog,Laya.stage,t=>{this.loading=t},!1)}static Close(t){this.loading&&($.closeDialog(this.loading,t),this.loading=null)}onEnable(){}onDisable(){}}tt.loading=null;const et=window.PlatformClass?window.PlatformClass.createClass("demo.MainActivity"):"";class st{constructor(){this.mBanner=0,console.log("FaceBookAdvertisement:",this)}initialize(){1!=this.isInit&&(this.isInit=!0,this.isLoadInterstitialAD=!1,this.loadInterstitialADOne=!1,this.isPlayInterstitialAD=!1,this.errorLoadInterstitialCount=0,this.intertitialAdsIds=["1154365871695610_1161637077635156","1154365871695610_1164935183972012","1154365871695610_1164935253972005","1154365871695610_1164935357305328","1154365871695610_1164935510638646"],this.interstitialKeyArr=[],Laya.timer.loop(33,this,this.loadInterstitial))}loadInterstitial(){1!=this.hasRemoveAD&&(1!=this.isPlayInterstitialAD?1!=this.isLoadInterstitialAD&&null==this.loadedInterstitialAD&&(this.errorLoadInterstitialCount>=3?1==this.loadInterstitialADOne&&(this.loadInterstitialADOne=!1,this.preLoadInterstitialAD()):(this.loadInterstitialADOne=!1,this.preLoadInterstitialAD())):this.isPlayInterstitialAD=!1)}preLoadInterstitialAD(){switch(h.gameSDKName){case o.faceBookSDK:this.isLoadInterstitialAD=!0,this.interstitialKeyArr.length<=0&&(this.interstitialKeyArr=this.intertitialAdsIds.slice(),this.interstitialKeyArr.sort(function(t,e){return Math.random()-.5}));var t,e=this.interstitialKeyArr.shift();FBInstant.getInterstitialAdAsync(e).then(function(s){return console.log("加载插屏广告"+e),(t=s).loadAsync()}).then(()=>{console.log("加载插屏广告加载成功"),this.loadedInterstitialAD=t,this.isLoadInterstitialAD=!1}).catch(t=>{this.isLoadInterstitialAD=!1,this.errorLoadInterstitialCount++,console.log("加载插屏广告加载失败"+t.message),console.log(t.code)});break;case o.faceBookSDKTest:}}showInterstitialAD(t,e){if(this.hasRemoveAD)null!=t&&t();else switch(h.gameSDKName){case o.faceBookSDK:this.loadInterstitialADOne=!0,Laya.SoundManager.stopMusic(),null!=this.loadedInterstitialAD?this.loadedInterstitialAD.showAsync().then(()=>{console.log("InterstitialAd广告显示成功"),u.bgCha&&Laya.SoundManager.playMusic(u.bgCha,0),null!=t&&t(),this.loadedInterstitialAD=null,this.isPlayInterstitialAD=!0}).catch(t=>{this.loadedInterstitialAD=null,this.isPlayInterstitialAD=!0,this.errorLoadInterstitialCount++,console.log("加载插屏广告加载失败"+t.message),console.log(t.code),u.bgCha&&Laya.SoundManager.playMusic(u.bgCha,0),null!=e&&e()}):(u.bgCha&&Laya.SoundManager.playMusic(u.bgCha,0),null!=e&&e());break;case o.faceBookSDKTest:et&&et.call("InterstitialAd",""),null!=t&&t()}}showBannerAD(){if(!this.mBanner)switch(this.mBanner=1,h.gameSDKName){case o.faceBookSDKTest:et&&et.call("ShowBannerAd","")}}hideBannerAD(){if(this.mBanner)switch(this.mBanner=0,h.gameSDKName){case o.faceBookSDKTest:et&&et.call("HideBannerAd","")}}showRewardVideoAd(t,e,s){switch(h.gameSDKName){case o.faceBookSDK:var i=null;Laya.SoundManager.stopMusic(),tt.Loading(),FBInstant.getRewardedVideoAsync(t).then(function(t){return console.log("RewardedVideo开始加载"),(i=t).loadAsync()}).then(function(){return console.log("RewardedVideo加载成功回调"),i.showAsync()}).then(function(){r.event("player.watchAd"),console.log("RewardedVideo广告显示成功"),u.bgCha&&Laya.SoundManager.playMusic(u.bgCha,0),tt.Close(()=>{}),null!=e&&e()}).catch(function(){u.bgCha&&Laya.SoundManager.playMusic(u.bgCha,0),tt.Close(()=>{}),J.Tip({title:y.Common[12],desc:y.Common[19],sure:s,close:s,only:!0},Laya.stage),console.log("RewardedVideo广告显示失败")});break;case o.faceBookSDKTest:et?(et.call("showRewardedVideo",""),z.RewardHandler=(()=>{r.event("player.watchAd"),e&&e()}),z.RewardFailHandler=(()=>{J.Tip({title:y.Common[12],desc:y.Common[19],sure:s,close:s,only:!0},Laya.stage)})):(tt.Loading(),setTimeout(()=>{tt.Close(()=>{}),r.event("player.watchAd"),null!=e&&e()},2e3))}}}class it{constructor(){this.friendsList=null,this.rankData=[],this.playerScore=0,this.realRankData=null,this.scoreRankArr=[22e5,18e5,13e5,95e4,5e5,25e4,1e5,55e3,3e4,15e3],this.stepScore=[1e3,5e4],this.msg_fbRankName="CubeManiaRank",this.fbSafeScore=8e6}getRankData(t){let e=0;if(this.rankData.length>0){if(this.realRankData){for(e=0;e<this.rankData.length;e++)this.realRankData[this.rankData[e].playerID]&&(this.rankData[e].score=this.realRankData[this.rankData[e].playerID]);this.rankData.sort((t,e)=>e.score-t.score)}for(e=0;e<this.rankData.length;e++)this.rankData[e].rank=e+1;t(this.rankData)}else setTimeout(()=>{this.getRankData(t)},200)}setScoreAsync(t){this.playerScore=Math.max(this.playerScore,t),this.rankData.length>0&&this._flushRankData(),this.realRankData={},this._getfriendsList(),this._checkNeedSetRealRankData()}getPassPerson(){let t=this.friendsList||[];if(t.length<5){let e=this._getRandomBotArr();t=t.concat(e)}return t=this._shuffleArray(t)}_checkNeedSetRealRankData(){h.gameSDKName==o.faceBookSDK&&null!=FBInstant.context.getID()&&FBInstant.getLeaderboardAsync(this.msg_fbRankName+"."+FBInstant.context.getID()).then(t=>t.setScoreAsync(this.playerScore,"")).then(()=>{console.log("update suc,get leadbord"),this._getRealRank()}).catch(t=>{console.log("update leaderbord fail"),console.log(t)})}_getRealRank(){h.gameSDKName==o.faceBookSDK&&null!=FBInstant.context.getID()&&FBInstant.getLeaderboardAsync(this.msg_fbRankName+"."+FBInstant.context.getID()).then(t=>t.getConnectedPlayerEntriesAsync(0,10)).then(t=>{if(console.log("getEntriesAsync suc:"),this.realRankData={},null!=t&&t.length>0)for(let e=0;e<t.length;e++){let s={};s.playerID=t[e].getPlayer().getID(),s.photo=t[e].getPlayer().getPhoto(),s.name=t[e].getPlayer().getName(),s.score=t[e].getScore(),s.rank=t[e].getRank(),console.log(s.name),Number(s.score)>=this.fbSafeScore||(this.realRankData.playerID=s.score)}console.log("真实rank数据:",this.realRankData)}).catch(t=>{console.log("update leaderbord fail"),console.log(t)})}_getfriendsList(){switch(this._getfriendsList=(()=>{}),h.gameSDKName){case o.faceBookSDK:FBInstant.player.getConnectedPlayersAsync().then(t=>{console.log("获取FB好友：",t),this.friendsList=[];for(let e=0;e<t.length;e++){let s=t[e],i={};i.name=s.getName(),i.playerID=s.getID(),i.photo=s.getPhoto(),this.friendsList.push(i)}this._buildUnrealRank(),console.log("获取好友：",this.friendsList)}).catch(t=>{console.log("get friend fail"),console.log(t)});break;case o.faceBookSDKTest:setTimeout(()=>{this.friendsList=this._getRandomBotArr(),this._buildUnrealRank()},2e3)}}_buildUnrealRank(){let t=[],e=[],s=this.playerScore,i=this.playerScore,a=0,l=0;for(l=0;l<this.scoreRankArr.length&&!(this.playerScore>=this.scoreRankArr[l]);l++);const n=()=>s+=parseInt(this.stepScore[0]+this.stepScore[1]*Math.random()+""),o=()=>(i-=parseInt(this.stepScore[0]+this.stepScore[1]*Math.random()+""),i=Math.max(0,i));for((a=l)===this.scoreRankArr.length&&(a=100),l=a-1;l>=0;l--)t.push(n());for(l=0;l<100;l++)e.push(o());this.friendsList=this._shuffleArray(this.friendsList);let r=this.friendsList;this.rankData.push({playerID:h.gameSDK.sdkInfo.playerID,name:h.gameSDK.sdkInfo.playerName,photo:h.gameSDK.sdkInfo.photo,score:this.playerScore});let c,d=Math.min(r.length,a);for(l=0;l<d;l++)(c=r.shift()).score=t.shift(),this.rankData.push(c);this.rankData.reverse();let p=r.length;for(l=0;l<p;l++)(c=r.shift()).score=e.shift(),this.rankData.push(c);console.log("排行榜数据",this.rankData)}_flushRankData(){for(let t=0;t<this.rankData.length;t++)if(this.rankData[t].playerID===h.gameSDK.sdkInfo.playerID){this.rankData[t].score=this.playerScore;break}this.rankData.sort((t,e)=>e.score-t.score)}getRobotNames(){return["Max Julia","Nathan Anthony","Asa Webb","Phil Harrison","Diana Hoyle","Gloria Nelly","Rodney Warner","Eunice Peggy","Henry Katrine","Oscar Anderson","Glenn Cocker","Kerr Reade","Lindsay Gill,","Vito Hobbes","Andy Hugh","Elroy MacAdam","Ternence Emma","Ruth Harrington","Sam Carmen","Yvette Spenser","Joy Eve","Erin Christ","Omar Maxwell","Devin Theresa","Godfery Collins","Edwiin Becky","Christopher Pop","Aldrich White","June Margery","Dominic Larkin","Jason Carllyle","Armand Flower","Ian Hughes","Rex Burke","Crystal Peg","Quintina Petty","Myron Yule","Kay Noel","Linda Felix","Abel Smith","Irene Fast","Ruth Nell","Wade Kit","Ivy Grant","Tom Pope","Sibyl Rhodes","Noel Lawrence","Charles Edward","Kirk Finn","Ophelia Peter","Candice Wild","Bblythe Eveline","Mary Philemon","Grace Beerbohm","Brian Rayleign","Oscar Mark","Will Carroll","Cora Garcia","Truman Kennedy","Maurice Fanny","Booth Birrell","Eve DuBois","Edwina Theresa","Marsh Roland","Salome Malan","Ryan Ellis","Morgan Chris","Byron Tracy","Eric Bertie","Hazel Evan","Chad Ferguson","Dolores Adolph","Ira Bell","Basil Moses","Eartha Lawson","Lucien Harper","Ivan Bulwer","Gloria Jim","Anna Aldridge","Wilbur Dunlop","Yale Bob","Roberta Dewar","Jo Bruce","Simon Wallace","Abel Christy","Otis Copper","Elva Sheridan","Edison Horatio","Christian Coco","Betty Pater","Janet Beaufort","Norma Matthew","Payne Anto","Bertram Dewey","Vera Ingersoll","Vincent Holmes","Jamie Lucy","Aaron Ramsden","Buck Daisy","Howar Louisa","Yvonne Wallis","Nathan Oliver","Ada Clara","Caesar Henry","Cynthia Noyes","Nathaniel Leo","Griffith Marcus","Tabitha Pulit","Chad Hewlett","Patricia Yerkes","Jennifer Nahum","Alston Sophia","Brian Martin","Leif Hamilton","Mike Conrad","Coral Gus","Matthew Isaac","Broderick Joe","Harold Cover","Orville McCar","Lena Giles","Giles Anna","Sophia Joyce","Clare Carpenter","Tab Yeates","Jacqueline Cra","Alvin MacArthur","Alvis Garcia","Omar Salome","Maud Ferguson","Eudora Cotton","Lennon Dickens","Robin Toby","Zora Buck","Tony Camilla","Hedy Wordsworth","Lesley Morgan","Devin Maud","Isidore Palmer","Benson Scripps","Phil Webster","Hyman Pearson","Magee","Hilary Martha","Grace Noah","Arm Ernest","Wendell Abraham","Adair Acheson","Betsy Larkin","Marshall Walton","Rex Bertha","Nicole Harrod","Arm Elinor","Audrey Swin","Elvira Tommy","Roxanne Eveline","Newman Bess","Dominic Wood","Nat Anderson","Nelly James","Gabriel Grote","Joseph Darwin","Gloria Joan","Hubery Conan","Tyrone Marion","Sabina Dickey","Emma Ernest","Avery Raglan","Maxine Sharp","Sarah Felix","Alfred Isabel","Wright Gall","Evange Lucius","Burnell Gal","Zoe Kennedy","Gwend Oliver","Alexia Ted","Blanche Chaplin","Aries Bell","Dolores Lincoln","Ulysses Guy","Barnett Nick","Yale Julian","Wade Peter","Benjamin Donne","Miranda Douglas","Jim Marshall","Richard Van","Saxon Leopold","Ralap Milton","Dave Surrey","Emily Barney","Thomas Christ","Cliff Thoreau","Jenny Quiller","Marina Aldridge","Augus Abe","Quinn Irving","Alice Zacharias","Winifred Troll","There Euphemia","Mandy Spring","Ida Dewar","Geoffrey Parker","Zenobia Gunther","Raymond Carroll","Jill Wilde","Jacqueline Hugh","Edwiin Eisen","Lucien Henri","Ingrid Patience","Victor Wilhel","Marvin Jennings","Teresa Maria","Faithe Rob","Cherry Morrison","Sandy Wagner"]}getRobotPhotos(){const t=[];for(let e=1;e<21;e++)t.push(e);return t}_getRandomBotArr(){let t=this.getRobotNames(),e=[];for(;e.length<7;){let s=~~(Math.random()*t.length);-1===e.indexOf(t[s])&&e.push(t[s])}let s,i=[];for(s=0;s<7;s++)i.push(s);i=this._shuffleArray(i);let a=[];for(s=0;s<i.length;s++)a.push({playerID:s+100,name:e[s],photo:"robot"+i[s],score:1e3*s+50});return a}_shuffleArray(t){let e,s,i=t.length;for(;i;)s=Math.floor(Math.random()*i--),e=t[i],t[i]=t[s],t[s]=e;return t}}class at{constructor(){this.supplementPropList=[],this.isCanPayment=!0}getPayList(){switch(h.gameSDKName){case o.faceBookSDK:return;case o.faceBookSDKTest:this.isCanPayment=!0,console.log("可以发起支付"),this.checkPaymentStatus()}}checkPaymentStatus(){switch(h.gameSDKName){case o.faceBookSDKTest:break;case o.faceBookSDK:if(0==this.isCanPayment)return void console.log("支付并没有准备好");FBInstant.payments.getPurchasesAsync().then(t=>{t.length>0&&(console.log("有未消费的订单"),this.supplementPropList=t)})}}showPay(t,e,s,i){switch(h.gameSDKName){case o.faceBookSDKTest:if(0==this.isCanPayment)return console.log("支付并没有准备好"),void(null!=s&&s());break;case o.faceBookSDK:if(0==this.isCanPayment)return console.log("支付并没有准备好"),void(null!=s&&s());FBInstant.payments.purchaseAsync({productID:t.payid,developerPayload:t.developerPayload}).then(function(t){console.log("购买成功,使商品生效并保存玩家信息"),null!=e&&(e(t),console.log(t))}).catch(function(t){console.log("支付失败:"),console.log(t),"USER_INPUT"==t.code?null!=i&&i():null!=s&&s()})}}consumeFbItem(t){switch(h.gameSDKName){case o.faceBookSDKTest:console.log("清除对应的消费信息:"+t);break;case o.faceBookSDK:FBInstant.payments.consumePurchaseAsync(t).then(function(){console.log("商品消费掉了："+t)})}}isCanPay(){return 1!=Laya.Browser.onIOS}}class lt{constructor(){}sendFaceBookFriend(t,e,s,i){switch(h.gameSDKName){case o.faceBookSDK:console.log("调用FBInstant.context.chooseAsync方法"),FBInstant.context.chooseAsync({filter:["NEW_CONTEXT_ONLY"]}).then(()=>{console.log("调用FBInstant.context.chooseAsync方法回调");var a=new nt;a.drawCompleteFun=(t=>{console.log("好友图片加载完成，调用FBInstant.updateAsync方法，邀请好友"),FBInstant.updateAsync({action:"CUSTOM",cta:"Play",template:"play_turn",image:t,text:"Come and play together",data:{},strategy:"LAST",notification:"PUSH"}).then(function(){null!=e&&(console.log("邀请好友回调"),e())}).catch(t=>{this.updateAsyncError(s,i,t,"邀请好友")})}),a.initialize(t)}).catch(t=>{this.updateAsyncError(s,i,t,"邀请好友")});break;case o.faceBookSDKTest:console.log("邀请好友。"),null!=e&&e();var a=new nt;a.drawCompleteFun=function(t){console.log(t)},a.initialize(t)}}shareGame(t,e){switch(h.gameSDKName){case o.faceBookSDK:(s=document.createElement("img")).crossOrigin="anonymous",s.src="res/sharebg.jpg",s.onload=function(){var i=document.createElement("canvas");i.width=s.width,i.height=s.height,i.getContext("2d").drawImage(s,0,0,s.width,s.height);var a=i.toDataURL("image/jpeg");FBInstant.shareAsync({intent:"SHARE",image:a,text:"I have passed many levels. Can you surpass me?",data:{myReplayData:"..."}}).then(function(){null!=t&&t()}).catch(function(t){console.log("分享失败。"),console.log(t),null!=e&&e()})};break;case o.faceBookSDKTest:var s;(s=document.createElement("img")).crossOrigin="anonymous",s.src="res/sharebg.jpg",s.onload=function(){var e=document.createElement("canvas");e.width=s.width,e.height=s.height,e.getContext("2d").drawImage(s,0,0,s.width,s.height);e.toDataURL("image/jpeg");null!=t&&t()}}}appointFaceBookFriendOnlyUpdateAsync(t,e,s,i){switch(h.gameSDKName){case o.faceBookSDK:if(null==FBInstant.context.getID())return void(null!=i&&i());console.log("appointFaceBookFriend方法回调"),(a=new nt).initialize(t),a.drawCompleteFun=function(t){console.log("邀请指定玩家图片加载完成，调用FBInstant.updateAsync方法"),FBInstant.updateAsync({action:"CUSTOM",cta:"Play",template:"play_turn",image:t,text:"Come and play together",data:{},strategy:"LAST",notification:"PUSH"}).then(function(){null!=e&&(console.log("指定好友回调！"),e())}).catch(t=>{this.updateAsyncError(s,i,t,"邀请指定好友")})};break;case o.faceBookSDKTest:var a;null!=e&&e(),(a=new nt).initialize(t),a.drawCompleteFun=function(t){var e=new Image;e.crossOrigin="anonymous",e.src=t,e.onload=function(){console.log(t)}}}}appointFaceBookFriendAndUpdateAsync(t,e,s,i){switch(h.gameSDKName){case o.faceBookSDK:console.log("调用appointFaceBookFriend方法,邀请指定玩家id："+t.playerID),FBInstant.context.createAsync(t.playerID).then(()=>{this.appointFaceBookFriendOnlyUpdateAsync(t,e,s,i)}).catch(t=>{this.updateAsyncError(s,i,t,"邀请指定好友")});break;case o.faceBookSDKTest:null!=e&&e();var a=new nt;a.initialize(t),a.drawCompleteFun=function(t){var e=new Image;e.crossOrigin="anonymous",e.src=t,e.onload=function(){console.log(t)}}}}updateAsyncError(t,e,s,i){console.log(s),null!=s?(console.log(i+"失败"),"USER_INPUT"==s.code?null!=t&&t():null!=e&&e()):(console.log(i+"失败"),null!=e&&e())}}class nt{getBase64Image(t){const e=t.pngData;for(let s=0;s<e.length;s++){const i=e[s],a=new Image;i.playImage=a,a.crossOrigin="anonymous",a.imgHeight=i.imgHeight,a.imgWidth=i.imgWidth,a.src=i.url,a.isLoad=!1,a.onload=(()=>{a.width=a.imgWidth,a.height=a.imgHeight,a.isLoad=!0,this.drawImage(t)})}}drawImage(t){for(let e=0;e<t.pngData.length;e++){if(0==t.pngData[e].playImage.isLoad)return}const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");for(let e=0;e<t.pngData.length;e++){const i=t.pngData[e];s.drawImage(i.playImage,i.posX,i.posY,i.playImage.width,i.playImage.height)}for(let e=0;e<t.fontData.length;e++){const i=t.fontData[e];s.font=i.font,s.lineWidth=i.lineWidth,s.fillStyle=i.fillStyle,s.textAlign=i.textAlign,s.strokeStyle=i.strokeStyle,s.strokeText(i.des.toString(),i.posX,i.posY),s.fillText(i.des.toString(),i.posX,i.posY)}const i=e.toDataURL("image/png");null!=this.drawCompleteFun&&this.drawCompleteFun(i)}initialize(t){this.getBase64Image(t)}drawCompleteFun(t){}}class ot{constructor(){this.playerID="0",this.playerName="",this.photo="robot1"}}class ht{constructor(){this.friends=null,this.initialize()}initialize(){1!=this.isInit&&(this.isInit=!0,this.isFirstStartGame=!0,this.sdkPort=new Object,this.sdkInfo=new ot,this.leaderboard=new it,this.faceBookUpdateAsync=new lt,this.faceBookAdvertisement=new st,this.faceBookAdvertisement.initialize(),this.faceBookPayment=new at)}IsIOS(){return 1==Laya.Browser.onIOS}getPlayInfo(t){switch(h.gameSDKName){case o.faceBookSDK:console.log("获取用户登录信息调用:FBInstant.initializeAsync函数"),this.sdkInfo.playerID=FBInstant.player.getID(),this.sdkInfo.photoSpriteFrameFun=function(){return null},console.log("获取用户登录信息:FBInstant.initializeAsync回调:"+this.sdkInfo.playerID),this.getUserData(t);break;case o.faceBookSDKTest:this.getUserData(t)}}getUserData(t){switch(h.gameSDKName){case o.faceBookSDK:FBInstant.player.getDataAsync(h.fbSaveDataKey).then(function(e){if(console.log("取到FB的数据:"),console.log(e),null!=e){var s=0;for(var i in e)s++;0==s&&(e=null)}if(null==e)h.isNewPlayer=!0,t(null);else if(1==h.fbSaveDataKey.length)t(e[h.fbSaveDataKey[0]]);else{for(var a=new Object,l=0;l<h.fbSaveDataKey.length;l++)a[h.fbSaveDataKey[l]]=e[h.fbSaveDataKey[l]];t(a)}});break;case o.faceBookSDKTest:var e=Laya.LocalStorage.getJSON(h.gameSaveDataKey);e&&(e=e[h.fbSaveDataKey[0]]),console.log("取到缓存数据:"),console.log(e),t(null==e?null:e)}}subscribeBotAsync(){switch(h.gameSDKName){case o.faceBookSDK:FBInstant.player.canSubscribeBotAsync().then(function(t){t&&FBInstant.player.subscribeBotAsync().then(function(){}).catch(function(t){console.log("请求玩家订阅游戏机器人err: ",t)})}).catch(t=>{console.log("是否可以与游戏机器人对战err: ",t)})}}saveUserData(t,e){switch(h.gameSDKName){case o.faceBookSDK:FBInstant.player.setDataAsync(t).then(function(){console.log("游戏存档成功！"),console.log(t),null!=e&&e()});break;case o.faceBookSDKTest:try{Laya.LocalStorage.setJSON(h.gameSaveDataKey,t),console.log("保存数据到本地")}catch(t){}null!=e&&e()}}startGame(t){switch(h.gameSDKName){case o.faceBookSDK:var e=this;console.log("获取游戏isFirstStartGame属性，如果true则调用FBInstant.startGameAsync方法"+this.isFirstStartGame),this.getFriendsList(),1==this.isFirstStartGame?(this.isFirstStartGame=!1,FBInstant.startGameAsync().then(function(){const s=FBInstant.getSupportedAPIs().join("|");console.log("fb api: ",s),e.sdkInfo.playerID=FBInstant.player.getID(),e.sdkInfo.playerName=FBInstant.player.getName(),e.sdkInfo.photo=FBInstant.player.getPhoto(),e.sdkInfo.entryPointData=FBInstant.getEntryPointData(),console.log("FBInstant.startGameAsync回调。玩家 name="+e.sdkInfo.playerName+"photo="+e.sdkInfo.photo+"id="+e.sdkInfo.playerID),e.sdkPort=FBInstant.getPlatform(),console.log(e.sdkPort),e.faceBookPayment.getPayList(),null!=t&&t()}),this._startGameFun=t,setTimeout(this._checkStartGameEnd.bind(this),100)):null!=t&&(console.log("callfun"),t());break;case o.faceBookSDKTest:1==this.isFirstStartGame?(this.faceBookPayment.getPayList(),this.isFirstStartGame=!1,this.sdkInfo.photo="",null!=t&&t()):null!=t&&t()}}_checkStartGameEnd(){null!=FBInstant.player.getName()?(this.sdkInfo.playerID=FBInstant.player.getID(),this.sdkInfo.playerName=FBInstant.player.getName(),this.sdkInfo.photo=FBInstant.player.getPhoto(),this.sdkInfo.entryPointData=FBInstant.getEntryPointData(),console.log("FBInstant.startGameAsync回调。玩家 name="+this.sdkInfo.playerName+"photo="+this.sdkInfo.photo),this.sdkPort=FBInstant.getPlatform(),console.log(this.sdkPort),this.faceBookPayment.getPayList(),null!=this._startGameFun&&this._startGameFun()):setTimeout(this._checkStartGameEnd,100)}getFriendsList(){if(this.friends)return this.friends.concat();switch(this.friends=[],h.gameSDKName){case o.faceBookSDK:FBInstant.player.getConnectedPlayersAsync().then(t=>{for(let e=0;e<t.length;e++){let s=t[e],i={};i.name=s.getName(),i.playerID=s.getID(),i.photo=s.getPhoto(),this.friends.push(i)}}).catch(t=>{console.log("get friend fail"),console.log(t)});break;case o.faceBookSDKTest:}}setLoadingProgress(t){switch(h.gameSDKName){case o.faceBookSDK:FBInstant.setLoadingProgress(t);break;case o.faceBookSDKTest:}}logEvent(t,e,s){switch(console.log("打点"+t),h.gameSDKName){case o.faceBookSDK:FBInstant.logEvent(t,e,s);break;case o.faceBookSDKTest:}}logEventByString(t){console.log("打点"+t);var e=new Object;switch(e[t]=t,h.gameSDKName){case o.faceBookSDK:FBInstant.logEvent(t,1,e);break;case o.faceBookSDKTest:}}goToOtherGame(t){switch(h.gameSDKName){case o.faceBookSDK:FBInstant.switchGameAsync(t).then(function(){console.log("跳转其他游戏成功")}).catch(function(t){null!=t&&(console.log("跳转其他游戏失败，失败编码为:"),console.log(t))});break;case o.faceBookSDKTest:console.log("跳转成功。")}}getMessengerRobot(t){switch(h.gameSDKName){case o.faceBookSDK:return null!=t&&t(null),null;case o.faceBookSDK:var e=FBInstant.getEntryPointData();return null!=t&&t(e),e}}createShortcut(t){switch(h.gameSDKName){case o.faceBookSDKTest:console.log("创建桌面快捷方式。"),null!=t&&t(null);break;case o.faceBookSDK:console.log("创建桌面快捷方式sdk。"),FBInstant.player.getDataAsync(["shortcut"]).then(function(e){console.log("获取到的data:"),console.log(e),null!=e&&null!=e.shortcut&&1==e.shortcut||FBInstant.canCreateShortcutAsync().then(function(e){console.log("创建桌面快捷方式canCreateShortcut："+e),e&&FBInstant.createShortcutAsync().then(function(){FBInstant.player.setDataAsync({shortcut:1}).then(function(){}),console.log("创建桌面快捷方式成功。"),null!=t&&t(null)}).catch(function(t){console.log("创建桌面快捷方式失败。"),console.log(t)})}).catch(function(t){console.log("桌面快捷方式不可以创建。"),console.log(t)})}).catch(function(t){console.log("获取创建桌面快捷方式数据失败。"),console.log(t)})}}postScoreToFB(t){console.log("postSessionScore发送分数给FB ",t),h.gameSDKName==o.faceBookSDK&&FBInstant.postSessionScore(t)}}var rt,ct,dt;!function(t){t[t.READY=0]="READY",t[t.START=1]="START",t[t.PAUSE=2]="PAUSE",t[t.END=3]="END"}(rt||(rt={})),function(t){t.LASER="laser",t.POISON="poison",t.FIRE="fire",t.ICE="ice",t.MAGNET="magnet"}(ct||(ct={})),function(t){t.ClosePauseDialog="close_pause_dialog",t.GameStateChange="gamestate_change",t.RateSupply="battle_rate_supply",t.SuitSupply="battle_suit_supply",t.AdvRateSupply="battle_advrate_supply",t.RateStart="battle_rate_start",t.RateEnd="battle_rate_end",t.CoinInPlayer="coin_in_player",t.GameOver="game_over",t.AddPlayer="add_player",t.PlayerDie="player_die",t.PlayerReborn="player_reborn",t.StudySkill="study_skill",t.RewardNum="reward_num",t.EndlessCompare="endless_compare",t.EndlessScore="endless_score",t.LevelEnemy="make_level_enemy",t.LevelEnemyEnd="make_level_enemy_end",t.PlayerBullet="player_main_bullet",t.PlayerHP="player_hp",t.PlayerMaxHP="player_max_hp",t.PlayerSpeed="player_speed",t.LaserHide="player_laser_hide",t.LaserCross="player_laser_cross",t.LaserTrack="player_laser_track",t.LaserTrackTar="player_laser_track_tar",t.EnemyLaserHide="enemy_laser_hide",t.GuidSkill="player_1000_baseskill",t.BaseSkill1="player_1001_baseskill",t.BaseSkill1a="player_1002_baseskill",t.BaseSkill1b="player_1003_baseskill",t.BaseSkill2="player_1005_baseskill",t.BaseSkill2a="player_1006_baseskill",t.BaseSkill2b="player_1007_baseskill",t.BaseSkill3="player_1013_baseskill",t.BaseSkill4="player_1009_baseskill",t.BaseSkill4a="player_1010_baseskill",t.BaseSkill4b="player_1011_baseskill",t.BaseSkill5="player_1016_baseskill",t.BaseSkill5a="player_1017_baseskill",t.BaseSkill5b="player_1018_baseskill",t.BaseSkill6="player_1020_baseskill",t.BaseSkill6a="player_1021_baseskill",t.BaseSkill6b="player_1022_baseskill",t.BaseSkill7="player_1024_baseskill",t.BaseSkill9="player_1023_baseskill",t.Shield="player_1025_baseskill",t.TimeShield="player_1027_baseskill",t.DieShot="player_1028_baseskill",t.BaseSkill11="player_1029_baseskill",t.BaseSkill13="player_1030_baseskill",t.BaseSkill14="player_1031_baseskill",t.BaseSkill15="player_1032_baseskill",t.SuckBlood="player_1033_baseskill",t.DieBoom="player_1034_baseskill",t.BulSkill1="player_2004_bulskill",t.BulSkill1_Start="player_2004_bulskill_start",t.BulSkill2="player_2005_bulskill",t.BulSkill3="player_2003_bulskill",t.BulSkill4="player_2001_bulskill",t.BulSkill2002="player_2002_bulskill",t.BulSkill5="player_2006_bulskill",t.BulSkill6="player_2007_bulskill",t.BulSkill7="player_2010_bulskill",t.BulSkill7_Start="player_2010_bulskill_start",t.BulSkill8="player_2009_bulskill",t.BulSkill9="player_2011_bulskill",t.BulSkill10="player_2008_bulskill",t.BulSkill2012="player_2012_bulskill",t.BulSkill2013="player_2013_bulskill",t.WingSkill1="player_3005_wingskill",t.WingSkill2="player_3002_wingskill",t.WingSkill3="player_3003_wingskill",t.WingSkill4="player_3004_wingskill",t.WingSkill5="player_3001_wingskill",t.WingSkill6="player_3006_wingskill",t.RobSkill1="player_4001_robskill",t.RobSkill2="player_4003_robskill",t.RobSkill3="player_4002_robskill",t.Sup_HP="player_1004_supply",t.Sup_Att="player_1008_supply",t.Sup_Speed="player_1012_supply",t.Sup_HPRec1="player_1014_supply",t.Sup_HPRec2="player_1015_supply",t.Sup_Crit="player_1019_supply",t.EnemyDead="enemy_dead",t.EnemyPause="enemy_pause",t.EnemyReturn="enemy_return",t.EnemyHit="enemy_hit",t.EnemyEnd="enemy_end"}(dt||(dt={}));const pt=[];var ut;window.__PoolSigns__=pt,function(t){t[t.HP1=1001]="HP1",t[t.Attack1=1005]="Attack1",t[t.HPRec1=1013]="HPRec1",t[t.Speed=1009]="Speed",t[t.Crit=1016]="Crit",t[t.MainStr=1020]="MainStr",t[t.MainCross=1024]="MainCross",t[t.MainTrack=1023]="MainTrack",t[t.Shield=1025]="Shield",t[t.TimeShield=1027]="TimeShield",t[t.DieShot=1028]="DieShot",t[t.Back=1029]="Back",t[t.Anger=1030]="Anger",t[t.Cri=1031]="Cri",t[t.Fearless=1032]="Fearless",t[t.SuckBlood=1033]="SuckBlood",t[t.DieBoom=1034]="DieBoom",t[t.Shotgun=2001]="Shotgun",t[t.Missile=2002]="Missile",t[t.Laser=2003]="Laser",t[t.SwimShell=2004]="SwimShell",t[t.ShockWave=2005]="ShockWave",t[t.RainbowMissile=2006]="RainbowMissile",t[t.RotatePoison=2007]="RotatePoison",t[t.RotateIce=2008]="RotateIce",t[t.RotateFire=2009]="RotateFire",t[t.NaughtyGhost=2010]="NaughtyGhost",t[t.Magnet=2011]="Magnet",t[t.Fireworks=2012]="Fireworks",t[t.Brid=2013]="Brid",t[t.ShotWing=3001]="ShotWing",t[t.MissileWing=3002]="MissileWing",t[t.LaserWing=3003]="LaserWing",t[t.AutoWing=3004]="AutoWing",t[t.BlastWing=3005]="BlastWing",t[t.ShieldWing=3006]="ShieldWing",t[t.BlastRobot=4001]="BlastRobot",t[t.LaserRobot=4002]="LaserRobot",t[t.ShieldRobot=4003]="ShieldRobot",t[t.Sup_HP=1004]="Sup_HP",t[t.Sup_Att=1008]="Sup_Att",t[t.Sup_Speed=1012]="Sup_Speed",t[t.Sup_HPRec1=1014]="Sup_HPRec1",t[t.Sup_HPRec2=1015]="Sup_HPRec2",t[t.Sup_Crit=1019]="Sup_Crit"}(ut||(ut={}));const yt={1000:"battle/skillicon/1000.png",1001:"battle/skillicon/1001.png",1002:"battle/skillicon/1001.png",1003:"battle/skillicon/1001.png",1004:"battle/skillicon/1004.png",1005:"battle/skillicon/1005.png",1006:"battle/skillicon/1005.png",1007:"battle/skillicon/1005.png",1008:"battle/skillicon/1008.png",1009:"battle/skillicon/1009.png",1010:"battle/skillicon/1009.png",1011:"battle/skillicon/1009.png",1012:"battle/skillicon/1012.png",1013:"battle/skillicon/1013.png",1014:"battle/skillicon/1013.png",1015:"battle/skillicon/1013.png",1016:"battle/skillicon/1016.png",1017:"battle/skillicon/1016.png",1018:"battle/skillicon/1016.png",1019:"battle/skillicon/1019.png",1020:"battle/skillicon/1020.png",1021:"battle/skillicon/1020.png",1022:"battle/skillicon/1020.png",1023:"battle/skillicon/1023.png",1024:"battle/skillicon/1024.png",1025:"battle/skillicon/1025.png",1026:"battle/skillicon/1026.png",1027:"battle/skillicon/1027.png",1028:"battle/skillicon/1028.png",1029:"battle/skillicon/1029.png",1030:"battle/skillicon/1030.png",1031:"battle/skillicon/1031.png",1032:"battle/skillicon/1032.png",1033:"battle/skillicon/1033.png",1034:"battle/skillicon/1034.png",2001:"battle/skillicon/2001.png",2002:"battle/skillicon/2002.png",2003:"battle/skillicon/2003.png",2004:"battle/skillicon/2004.png",2005:"battle/skillicon/2005.png",2006:"battle/skillicon/2006.png",2007:"battle/skillicon/2007.png",2008:"battle/skillicon/2008.png",2009:"battle/skillicon/2009.png",2010:"battle/skillicon/2010.png",2011:"battle/skillicon/2011.png",2012:"battle/skillicon/2012.png",2013:"battle/skillicon/2013.png",3001:"battle/skillicon/3001.png",3002:"battle/skillicon/3002.png",3003:"battle/skillicon/3003.png",3004:"battle/skillicon/3004.png",3005:"battle/skillicon/3005.png",3006:"battle/skillicon/3006.png",4001:"battle/skillicon/4001.png",4002:"battle/skillicon/4002.png",4003:"battle/skillicon/4003.png"},mt={1000:{path:"battle/skillsk/1000/ultimate.sk",ppos:[73,139],pscale:.25},1001:{path:"battle/skillsk/1001/life.sk",ppos:[73,120],pscale:.25},1002:{path:"battle/skillsk/1001/life.sk",ppos:[73,120],pscale:.25},1003:{path:"battle/skillsk/1001/life.sk",ppos:[73,120],pscale:.25},1004:{path:"battle/skillsk/1001/life.sk",ppos:[73,120],pscale:.25},1005:{path:"battle/skillsk/1005/attack.sk",ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1006:{path:"battle/skillsk/1005/attack.sk",ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1007:{path:"battle/skillsk/1005/attack.sk",ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1008:{path:"battle/skillsk/1005/attack.sk",ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1009:{path:"battle/skillsk/1009/attackspeed.sk",ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1010:{path:"battle/skillsk/1009/attackspeed.sk",ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1011:{path:"battle/skillsk/1009/attackspeed.sk",ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1012:{path:"battle/skillsk/1009/attackspeed.sk",ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1013:{path:"battle/skillsk/1013/lifeback.sk",ppos:[73,113],pscale:.25},1014:{path:"battle/skillsk/1013/lifeback.sk",ppos:[73,113],pscale:.25},1015:{path:"battle/skillsk/1013/lifeback.sk",ppos:[73,113],pscale:.25},1016:{path:"battle/skillsk/1016/critical.sk",ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1017:{path:"battle/skillsk/1016/critical.sk",ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1018:{path:"battle/skillsk/1016/critical.sk",ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1019:{path:"battle/skillsk/1016/critical.sk",ppos:[38,147],ppos2:[109,147],pscale:.25,arate:.5},1020:{path:"battle/skillsk/1020/",ani:0},1021:{path:"battle/skillsk/1020/",ani:1},1022:{path:"battle/skillsk/1020/",ani:2},1024:{path:"battle/skillsk/1024/cross.sk",ppos:[73,166],pscale:.25},1025:{path:"battle/skillsk/1025/rotateshield.sk",ppos:[73,141],pscale:.25},1027:{path:"battle/skillsk/1027/timeshield.sk",ppos:[73,139],pscale:.25},1028:{path:"battle/skillsk/1028/danmakudeath.sk",ppos:[73,166],pscale:.25},1029:{path:"battle/skillsk/1029/nirvana.sk"},1030:{path:"battle/skillsk/1030/rage.sk",ppos:[73,166],pscale:.25},1031:{path:"battle/skillsk/1031/seckill.sk",ppos:[73,166],pscale:.25},1032:{path:"battle/skillsk/1032/fearless.sk",ppos:[73,166],pscale:.25},1033:{path:"battle/skillsk/1033/suckblood.sk",ppos:[73,166],pscale:.25},1034:{path:"battle/skillsk/1034/deathexplosion.sk",ppos:[73,166],pscale:.25},2001:{path:"battle/skillsk/2001/shot.sk",ppos:[73,147],pscale:.25},2002:{path:"battle/skillsk/2002/missile.sk",ppos:[73,155],pscale:.25},2003:{path:"battle/skillsk/2003/laser.sk",ppos:[73,153],pscale:.25},2004:{path:"battle/skillsk/2004/swimcannon.sk",ppos:[73,93],pscale:.25},2005:{path:"battle/skillsk/2005/shockwave.sk",ppos:[75,141],pscale:.25},2006:{path:"battle/skillsk/2006/rainbowguided_a.sk",ppos:[75,136],pscale:.25},2007:{path:"battle/skillsk/2007/poisonball.sk",ppos:[73,97],pscale:.2},2008:{path:"battle/skillsk/2008/iceball.sk",ppos:[73,97],pscale:.2},2009:{path:"battle/skillsk/2009/fireball.sk",ppos:[73,97],pscale:.2},2010:{path:"battle/skillsk/2010/troublemaker.sk",ppos:[73,143],pscale:.25},2011:{path:"battle/skillsk/2011/electric.sk",ppos:[73,97],pscale:.25},2012:{path:"battle/skillsk/2012/fireworkguided.sk",ppos:[73,140],pscale:.25},2013:{path:"battle/skillsk/2013/flyerguided.sk",ppos:[73,138],pscale:.25},3001:{path:"battle/skillsk/3001/shotwingman.sk",ppos:[73,138],pscale:.25},3002:{path:"battle/skillsk/3002/missilewingman.sk",ppos:[73,138],pscale:.25},3003:{path:"battle/skillsk/3003/laserwingman.sk",ppos:[73,138],pscale:.25},3004:{path:"battle/skillsk/3004/rungunwingman.sk",ppos:[73,138],pscale:.25},3005:{path:"battle/skillsk/3005/burstwingman.sk",ppos:[73,138],pscale:.25},3006:{path:"battle/skillsk/3006/shieldwingman.sk",ppos:[73,138],pscale:.25},4001:{path:"battle/skillsk/4001/blastrobot.sk",ppos:[73,166],pscale:.25},4002:{path:"battle/skillsk/4002/laserrobot.sk",ppos:[73,166],pscale:.25},4003:{path:"battle/skillsk/4003/shieldrobot.sk",ppos:[73,166],pscale:.25}},gt={1:[[-20,0,20],[-50,-30,-10,10,30,50],[-80,-60,-40,-20,0,20,40,60,80],[-110,-90,-70,-50,-30,-10,10,30,50,70,90,110]],2:[[0],[-15,15],[-50,0,50],[-50,-15,15,50]],3:[[45,135,-135,-45],[40,50,130,140,-140,-130,-50,-40],[35,45,55,125,135,145,-145,-135,-125,-55,-45,-35],[30,40,50,60,120,130,140,150,-150,-140,-130,-120,-60,-50,-40,-30]],4:[[0],[-20,20],[-40,0,40],[-60,-20,20,60]],5:[[-10,10],[-30,30,-10,10],[-50,50,-30,30,-10,10],[-70,70,-50,50,-30,30,-10,10]],6:[[43,-43,65,-65,23,-23,0],[86,-86,110,-110,43,-43,65,-65,23,-23,0],[131,-131,156,-156,86,-86,110,-110,43,-43,65,-65,23,-23,0],[176,-176,201,-201,131,-131,156,-156,86,-86,110,-110,43,-43,65,-65,23,-23,0]]},bt=[[{dx:-80,dy:60,v:-1},{dx:80,dy:60,v:1}],[{dx:-160,dy:60,v:-1},{dx:160,dy:60,v:1}],[{dx:-240,dy:60,v:-1},{dx:240,dy:60,v:1}]],ft={2001:{self:{x:50,y:75},b1:[{x:-221,y:261},{x:221,y:261}],b2:[{x:-130,y:240},{x:130,y:240}],b3:[{x:-83,y:195},{x:83,y:195}]},2002:{b1:[{x:-178,y:181},{x:178,y:181}],b2:[{x:-100,y:141},{x:100,y:141}],b3:[{x:0,y:181}]},2003:{b1:[{x:-137,y:-148},{x:137,y:-148},{x:-197,y:151},{x:197,y:151}],b2:[{x:-137,y:-148},{x:137,y:-148},{x:-197,y:151},{x:197,y:151}],b3:[{x:-137,y:-148},{x:137,y:-148},{x:-197,y:151},{x:197,y:151}]},2004:{b3:[{x:-150,y:145},{x:150,y:145}]},2005:{b1:[{x:-91,y:51},{x:91,y:51}],b2:[{x:-164,y:90},{x:144,y:90}],b3:[{x:-50,y:91},{x:50,y:91}]},2006:{b3:[{x:-75,y:60},{x:75,y:60}]},3002:{self:{x:312,y:908}},1002:{self:{x:43.5,y:81},b1:[{x:0,y:0}]},1003:{b1:[{x:0,y:40}]},1004:{self:{x:65,y:70},b1:[{x:0,y:35}]},1005:{b1:[{x:0,y:0}]},1006:{self:{x:51.5,y:80},b1:[{x:0,y:0}]},1007:{b1:[{x:0,y:-50}]},1008:{b1:[{x:0,y:0}]},1009:{b1:[{x:0,y:20}]},1010:{b1:[{x:0,y:0}]},1011:{b1:[{x:-5,y:10}]},1012:{b1:[{x:0,y:0}]},1013:{b1:[{x:0,y:75}]},1014:{self:{x:43.5,y:83},b1:[{x:0,y:0}]},1015:{b1:[{x:0,y:0}]},1016:{b1:[{x:0,y:0}]},1017:{b1:[{x:0,y:0}]},1018:{b1:[{x:0,y:0}]},1019:{b1:[{x:0,y:0}]},1020:{b1:[{x:0,y:0}]},1021:{b1:[{x:0,y:0}]},1022:{b1:[{x:0,y:35}]},1023:{b1:[{x:0,y:110}]},1024:{b1:[{x:0,y:50}]},1025:{b1:[{x:0,y:0}]},1026:{b1:[{x:0,y:0}]},1027:{b1:[{x:0,y:0}]},1028:{b1:[{x:0,y:35}]},1029:{b1:[{x:0,y:55}]}};class kt extends Q{constructor(){super(),this.width2=50,this.height2=50,this.deltaY=0,this.aabb=null,this.bid=null,this.bids=[],kt.__bid__++,this.bid=kt.__bid__}onEnable(){this.aabb={x:0,y:0,width:this.width2,height:this.height2}}onDisable(){this.bids.length=0}onLateUpdate(){const t=this.owner;t&&(this.aabb.x=t.x-this.width2/2,this.aabb.y=t.y-this.height2/2+this.deltaY)}}kt.__bid__=0;class St extends Q{constructor(){super(),this.speed=.1,this.endx=.1,this.stax=.1,this.top1=null,this.top2=null,this.bot1=null,this.bot2=null,this.blinkNode=null}onEnable(){}onDisable(){}onUpdate(){let t=Laya.timer.delta*this.speed;this.top1&&this.top2&&(this.top1.x>=this.endx&&(this.top1.x=this.stax+(this.top1.x-this.endx)),this.top2.x>=this.endx&&(this.top2.x=this.stax+(this.top2.x-this.endx)),this.top1.x+=t,this.top2.x+=t),this.bot1&&this.bot2&&(this.bot1.x<=this.stax&&(this.bot1.x=this.endx+(this.bot1.x-this.stax)),this.bot2.x<=this.stax&&(this.bot2.x=this.endx+(this.bot2.x-this.stax)),this.bot1.x-=t,this.bot2.x-=t)}}class Ct extends Q{constructor(){super(),this.closeBtn=null,this.ins=null,this.han1=null,this.han2=null,this.cloHan=null,this.tar=null,this.timer=1e3,this.isClose=!1}onEnable(){this.ins=ee.instance,this.isClose=!1;const t=this.owner,e=this.ins;this.closeBtn.visible=!1,this.setClick(this.closeBtn,()=>{this.onCloseClick()},this);const s=t.getChildByName("s1"),i=t.getChildByName("s2"),a=t.getChildByName("topNode");let l=e.playerData.supUnlock.concat();const n=e.playerData;if(n.currHP>=n.hp){const t=l.indexOf(1014);t>-1&&l.splice(t,1);const e=l.indexOf(1015);e>-1&&l.splice(e,1)}const o=l.length-1,r=[];for(;r.length<2;){let t=Math.floor(Math.random()*(o-0+1)+0);r.indexOf(t)<0&&r.push(t)}let c=l[r[0]],d=l[r[1]];this.setSkill(s,c,0),this.setSkill(i,d,1),this.setClick(s,()=>{this.han1&&this.han1(),this.onCloseClick()},this),this.setClick(i,()=>{this.han2&&this.han2(),this.onCloseClick()},this),s.scale(0,0),i.scale(0,0),a.y=-600,a.visible=!1,Laya.timer.once(200,this,()=>{a.visible=!0,Laya.Tween.to(a,{y:84},500,Laya.Ease.circOut,Laya.Handler.create(this,()=>{Laya.Tween.to(s,{scaleX:1,scaleY:1},200,Laya.Ease.circOut),Laya.Tween.to(i,{scaleX:1,scaleY:1},200,Laya.Ease.circOut)})),h.gameSDK.faceBookAdvertisement.showInterstitialAD(()=>{},()=>{})}),h.gameSDK.faceBookAdvertisement.hideBannerAD()}setSkill(t,e,s){const i=U,a=t.getChildByName("name"),l=t.getChildByName("desc"),n=t.getChildByName("icon"),o=A.skills[e];a.text=o.name,l.text=o.describe,n.skin=yt[o.id],s?this.han2=(()=>{r.event(`player_${o.id}_supply`)}):this.han1=(()=>{r.event(`player_${o.id}_supply`)});const h=t.getChildAt(0).getChildByName("ske"),c=t.getChildAt(0).getChildByName("picon"),d=t.getChildAt(0).getChildByName("picon2"),p=mt[e];p?(c.visible=d.visible=!1,h.load(p.path,Laya.Handler.create(this,()=>{n.visible=!1,h.templet&&(h.playbackRate(p.arate||.85),h.play(p.ani||0,!0)),c.visible=d.visible=!0})),h.visible=!0,p.pos?h.pos(p.pos[0],p.pos[1]):h.pos(73,190),p.ppos&&(c.skin=i[this.ins.playerData.id],c.pos(p.ppos[0],p.ppos[1]),c.scale(p.pscale,p.pscale)),p.ppos2&&(d.skin=i[this.ins.playerData.id],d.pos(p.ppos2[0],p.ppos2[1]),d.scale(p.pscale,p.pscale))):(h.visible=!1,c.visible=!1,d.visible=!1,n.visible=!0)}onCloseClick(){this.owner;this.closeDialog(this,()=>{const t=this.ins,e=this.tar;Laya.timer.once(500,this,()=>{Laya.Tween.to(e,{y:0-e.height},this.timer,Laya.Ease.backIn,Laya.Handler.create(this,()=>{this.cloHan&&!this.isClose&&(this.isClose=!0,this.cloHan()),t.eneBulNode.alpha=1,t.player2Node.alpha=1,t.playerNode.alpha=1,t.effectNode.alpha=1,t.bgTopNode.alpha=1,t.modSceneV3.getChildByName("coins").active=!0;const s=t.otherPlayer;for(let t=0;t<s.length;t++){s[t].v3.active=!0}e.removeSelf()}))})}),h.gameSDK.faceBookAdvertisement.showBannerAD()}onDisable(){Laya.Tween.clearAll(this),Laya.timer.clearAll(this)}onUpdate(){this.ins.gameState,rt.START}}class Lt extends Q{constructor(){super(),this.ins=null,this.ske=null,this.cloHan=null,this.edata=null,this.inited=!1}onEnable(){this.ins=ee.instance;const t=this.owner,e=this.ins;this.inited=!1;const s=1e3*(this.edata.speed||1);Laya.Tween.to(t,{y:640},s,Laya.Ease.backOut,Laya.Handler.create(this,()=>{Laya.timer.once(1e3,this,()=>{this.openDialog(_.battleUI.SupplySkillDialog,e.dialogNode,e=>{const i=e.getComponent(Ct);i.cloHan=this.cloHan,i.tar=t,i.timer=s})})}))}parseComplete(){const t=this.ske;t.on(Laya.Event.STOPPED,this,this.completeHandler),this.ske&&this.ske.templet&&t.play(0,!1)}completeHandler(){this.ske.play(1,!0)}onDisable(){this.ske&&(this.ske.offAllCaller(this),this.ske.stop()),Laya.Tween.clearAll(this),Laya.timer.clearAll(this),this.recover(this.owner)}onUpdate(){const t=this.ske;!this.inited&&t&&t.templet&&(this.inited=!0,this.parseComplete())}}class Dt extends Q{constructor(){super(),this.headIma=null,this.nameLab=null,this.scoreLab=null}onEnable(){this.initNode()}initNode(){const t=ee.instance.compareData,e=t.photo,s=this.headIma;e.indexOf("http")>-1?s.loadImage(e):s.skin=e,this.nameLab.text=t.name,this.scoreLab.text=d.formatNumber(t.score)}updateNode(){const t=this.owner;Laya.Tween.to(t,{x:-180},1e3,Laya.Ease.backIn,Laya.Handler.create(this,()=>{this.initNode(),Laya.Tween.to(t,{x:0},1e3,Laya.Ease.backOut)}))}onDisable(){super.onDisable()}onUpdate(){}}class Pt extends Laya.Script{constructor(){super()}onEnable(){}onDisable(){}}class xt extends Laya.Script{constructor(){super(),this.interactable=!0,this.isChecked=!0,this.checkMark=null,this.clickHandle=null,this.cantHandle=null}onClick(){if(this.interactable){if(this.isChecked=!this.isChecked,this.checkMark&&(this.checkMark.visible=this.isChecked),this.clickHandle&&this.clickHandle(this.isChecked),Laya.SoundManager.playSound(O.ClickSou),this.owner&&this.owner.parent&&this.owner.parent.getComponent(Pt)){let t=this.owner.parent.numChildren,e=this.owner.parent.getChildIndex(this.owner);for(let s=0;s<t;s++){const t=this.owner.parent.getChildAt(s).getComponent(xt);if(!t)return;s==e?t.isChecked||(t.isChecked=!0):t.isChecked=!1,t.checkMark&&(t.checkMark.visible=t.isChecked)}}}else this.cantHandle&&this.cantHandle()}onEnable(){this.checkMark&&(this.checkMark.visible=this.isChecked),this.initLockNode()}initLockNode(){const t=this.owner.getChildByName("lockNode");t&&(t.visible=!this.interactable)}onDisable(){}}class vt extends Q{constructor(){super(),this.ins=null,this.sureBtn=null,this.allBtn=null,this.maskNode=null,this.parentNode=null,this.bgSke=null,this.skills=[]}onEnable(){this.ins=ee.instance,this.bgSke.alpha=0,this.parentNode.alpha=0;const t=[],e=[],s=this.sureBtn.getChildByName("title");this.setClick(this.maskNode,()=>{},this,null,!0),this.setClick(this.sureBtn,()=>{if(3==t.length){for(let t=0;t<e.length;t++){const s=e[t],i=this.skills[s].han;i&&i()}this.hide()}},this),this.setClick(this.allBtn,()=>{h.gameSDK.faceBookAdvertisement.showRewardVideoAd(h.rewardedVideoID,()=>{const t=this.skills;for(let e=0;e<t.length;e++){const s=t[e].han;s&&s()}this.hide()})},this);for(let i=0;i<4;i++){const a=this.parentNode.getChildAt(i),l=a.getChildByName("tit1"),n=a.getChildByName("icon"),o=a.getChildByName("ske"),h=a.getChildByName("picon"),r=a.getChildByName("picon2"),c=a.getChildByName("desc1");this.skills.push({title:l,icon:n,desc:c,han:null,id:null,ske:o,picon:h,picon2:r}),a.getComponent(xt).clickHandle=(a=>{const l=this.skills[i].id;if(l){if(a){t.indexOf(l)<0&&t.length<3&&(t.push(l),e.push(i))}else{const s=t.indexOf(l);s>=0&&(t.splice(s,1),e.splice(e.indexOf(i),1))}s.text=`${y.AdventurePage[8]} ${t.length}/3`,3==t.length&&(s.text=y.AdventurePage[9]),this.sureBtn.gray=3!=t.length,this.initItem(t,e)}})}Laya.timer.once(200,this,()=>{this.bgSke.templet&&(this.bgSke.play(0,!1),this.bgSke.alpha=1,Laya.timer.once(2e3,this,()=>{this.bgSke.alpha=0}))}),Laya.Tween.to(this.parentNode,{alpha:1},500,Laya.Ease.circIn),h.gameSDK.faceBookAdvertisement.hideBannerAD()}initItem(t,e){if(3==t.length)for(let t=0;t<4;t++){const s=this.parentNode.getChildAt(t).getComponent(xt);e.indexOf(t)<0&&(s.interactable=!1)}else for(let t=0;t<4;t++){this.parentNode.getChildAt(t).getComponent(xt).interactable=!0}}setData(t){const e=this.skills,s=U;for(let i=0;i<t.length;i++){const a=t[i],l=e[i];if(!l)continue;const n=A.skills[a];l.title.text=n.name,l.desc.text=n.describe.replace("$",ee.instance.playerData.planeData.weapon+""),l.icon.skin=yt[n.id],l.han=(()=>{let t="";a<2e3?t=`player_${a}_baseskill`:a>2e3&&a<3e3?t=`player_${a}_bulskill`:a>3e3&&a<4e3?t=`player_${a}_wingskill`:a>4e3&&(t=`player_${a}_robskill`),r.event(t)}),l.id=a;const o=l.ske,h=l.picon,c=l.picon2,d=mt[a];if(d){let t=d.path;if(null!=d.ani){const e=this.ins.playerData.id;t+=`${e}/intensify${1==e?"":"_"+e}.sk`}h.visible=c.visible=!1,o.load(t,Laya.Handler.create(this,()=>{l.icon.visible=!1,o.templet&&(o.playbackRate(d.arate||.85),o.play(d.ani||0,!0)),h.visible=c.visible=!0})),o.visible=!0,d.pos?o.pos(d.pos[0],d.pos[1]):o.pos(73,190),d.ppos&&(h.skin=s[this.ins.playerData.id],h.pos(d.ppos[0],d.ppos[1]),h.scale(d.pscale,d.pscale),h.visible=!0),d.ppos2&&(c.skin=s[this.ins.playerData.id],c.pos(d.ppos2[0],d.ppos2[1]),c.scale(d.pscale,d.pscale),c.visible=!0)}else o.visible=!1,h.visible=!1,c.visible=!1,l.icon.visible=!0}Y.loadSkillPre(t)}hide(){r.event("player.selSkill");(()=>{Laya.Tween.to(this.owner,{scaleX:0,scaleY:0,alpha:0},100,null,Laya.Handler.create(this,()=>{r.event(dt.StudySkill),this.owner.removeSelf()}))})(),h.gameSDK.faceBookAdvertisement.showBannerAD()}onDisable(){this.bgSke.offAllCaller(this)}}class Et extends Q{constructor(){super(),this.ske=null,this.jt=null,this.hitArea=null,this.cirMask=null,this.inited=!1}onUpdate(){const t=this.ske;!this.inited&&t&&t.templet&&(this.inited=!0,t&&t.templet&&t.playbackRate(.8))}onEnable(){const t=Laya.stage.width,e=Laya.stage.height;this.inited=!1;const s=this.owner;s.size(t,e),s.cacheAs="bitmap",s.on("click",this,()=>{});const i=s.getChildByName("bg");this.jt=s.getChildByName("jt");const a=new Laya.Sprite;a.alpha=.5,a.graphics.drawRect(0,0,t,e,"#000000"),i.addChild(a);const l=new Laya.Sprite;l.blendMode="destination-out",i.addChild(l),this.cirMask=l;const n=new Laya.HitArea;n.hit.drawRect(0,0,t,e,"#000000"),s.hitArea=n,s.mouseEnabled=!0,this.hitArea=n}setData(t){if(this.hitArea&&this.cirMask){const e=this.hitArea,s=this.cirMask;if(e.unHit.clear(),e.unHit.drawCircle(t.x,t.y,t.radius,"#000000"),s.graphics.clear(),s.graphics.drawCircle(t.x,t.y,t.radius,"#000000"),this.ske){this.ske.pos(t.x,t.y);const e=t.radius/40;this.ske.scale(e,e)}if(this.jt){const e=t.radius/40||1,s=this.jt;if(Laya.timer.clearAll(s),Laya.Tween.clearAll(s),1==(t.arrow||1)){s.pos(t.x,t.y+100*e),s.scaleY=1;const i=()=>{Laya.Tween.to(s,{y:t.y+50*e},1e3,Laya.Ease.circOut,Laya.Handler.create(s,()=>{Laya.Tween.to(s,{y:t.y+100*e},1e3,Laya.Ease.circIn)}))};i(),Laya.timer.loop(2e3,s,i)}else{s.pos(t.x,t.y-100*e),s.scaleY=-1;const i=()=>{Laya.Tween.to(s,{y:t.y-50*e},1e3,Laya.Ease.circOut,Laya.Handler.create(s,()=>{Laya.Tween.to(s,{y:t.y-100*e},1e3,Laya.Ease.circIn)}))};i(),Laya.timer.loop(2e3,s,i)}}}}onDisable(){}}const wt=new class{constructor(){this.guidIns=null,this.steps=null,this.step=0}init(t,e){if(this.guidIns)return console.warn("已存在引导实例"),void t.removeSelf();this.guidIns=t,this.steps=e,this.nextStep()}nextStep(){if(this.steps&&this.guidIns)if(this.step==this.steps.length)this.guidIns.removeSelf(),this.guidIns=null,this.step=0;else{const t=this.steps[this.step++];this.guidIns.getComponent(Et).setData(t)}}};class Tt extends Q{constructor(){super(),this.ins=null,this.maskNode=null,this.chaBtn=null,this.parentNode=null,this.bgSke=null,this.titleLab=null,this.skill1Tit=null,this.skill1Icon=null,this.skill1Desc=null,this.skill2Tit=null,this.skill2Icon=null,this.skill2Desc=null,this.skill3Tit=null,this.skill3Icon=null,this.skill3Desc=null,this.skill4Tit=null,this.skill4Icon=null,this.skill4Desc=null,this.skills=[],this.handle=null}onEnable(){this.ins=ee.instance;this.owner;this.bgSke.alpha=0,this.parentNode.alpha=0,this.setClick(this.chaBtn,()=>{h.gameSDK.faceBookAdvertisement.showRewardVideoAd(h.AllSkillVideoID,()=>{Laya.timer.once(0,this,()=>{const t=this.skills;for(let e=0;e<t.length;e++){const s=t[e],i=s.han;i&&i();const a=s.id;this.handle&&a&&this.handle(a)}this.hide()})})},this),this.setClick(this.skill1Icon,()=>{const t=this.skills[0].han;t&&t(),this.hide(this.skills[0].id)},this),this.setClick(this.skill2Icon,()=>{const t=this.skills[1].han;t&&t(),this.hide(this.skills[1].id)},this),this.setClick(this.skill3Icon,()=>{const t=this.skills[2].han;t&&t(),this.hide(this.skills[2].id)},this),this.setClick(this.skill4Icon,()=>{const t=this.skills[3].han;t&&t(),this.hide(this.skills[3].id)},this),this.setClick(this.maskNode,()=>{},this,null,!0),this.skills.length||(this.skills.push({title:this.skill1Tit,icon:this.skill1Icon,desc:this.skill1Desc,han:null,id:null}),this.skills.push({title:this.skill2Tit,icon:this.skill2Icon,desc:this.skill2Desc,han:null,id:null}),this.skills.push({title:this.skill3Tit,icon:this.skill3Icon,desc:this.skill3Desc,han:null,id:null}),this.skills.push({title:this.skill4Tit,icon:this.skill4Icon,desc:this.skill4Desc,han:null,id:null})),Laya.timer.once(200,this,()=>{this.bgSke.templet&&(this.bgSke.play(0,!1),this.bgSke.alpha=1,Laya.timer.once(2e3,this,()=>{this.bgSke.alpha=0})),this.ins.playerData.chapter<1&&this.loadPrefab("prefab/GuidanceDialog.json").then(t=>{const e=this.open("prefab/GuidanceDialog.json",t);this.ins.guidNode.addChild(e),wt.init(e,[{x:217,y:374,radius:80}]),c("新手引导","选择技能")})}),Laya.Tween.to(this.parentNode,{alpha:1},500,Laya.Ease.circIn),h.gameSDK.faceBookAdvertisement.hideBannerAD()}setData(t,e){const s=this.skills,i=U;let a=0,l=null;for(let e=0;e<t.length;e++){const s=t[e],i=A.skills[s].recommend;i&&(!a||i&&i<a)&&(a=i,l=e)}for(let a=0;a<t.length;a++){const n=t[a],o=s[a];if(!o)continue;const h=A.skills[n];o.title.text=h.name,o.desc.text=h.describe.replace("$",ee.instance.playerData.planeData.weapon+"");const c=o.icon.getChildAt(0),d=c.getChildByName("icon");if(d.visible=!0,d.skin=yt[h.id],o.han=(()=>{let t="";n<2e3?t=`player_${n}_baseskill`:n>2e3&&n<3e3?t=`player_${n}_bulskill`:n>3e3&&n<4e3?t=`player_${n}_wingskill`:n>4e3&&(t=`player_${n}_robskill`),r.event(t)}),o.id=n,e&&a<2||!e){const t=c.getChildByName("ske"),s=c.getChildByName("picon"),o=c.getChildByName("picon2"),h=mt[n];if(h){let e=h.path;if(null!=h.ani){const t=this.ins.playerData.id;e+=`${t}/intensify${1==t?"":"_"+t}.sk`}s.visible=o.visible=!1,t.load(e,Laya.Handler.create(this,()=>{d.visible=!1,t.templet&&(t.playbackRate(h.arate||.85),t.play(h.ani||0,!0)),s.visible=o.visible=!0})),t.visible=!0,h.pos?t.pos(h.pos[0],h.pos[1]):t.pos(73,190),h.ppos&&(s.skin=i[this.ins.playerData.id],s.pos(h.ppos[0],h.ppos[1]),s.scale(h.pscale,h.pscale)),h.ppos2&&(o.skin=i[this.ins.playerData.id],o.pos(h.ppos2[0],h.ppos2[1]),o.scale(h.pscale,h.pscale))}else t.visible=!1,s.visible=!1,o.visible=!1,d.visible=!0;const r=c.getChildByName("rec");if(r.visible=!1,this.ins.playerData.level<=3&&null!=l&&a==l){r.visible=!0;const t=r.getChildAt(0);t&&t.templet?t.play(0,!0):Laya.timer.once(200,this,()=>{t&&t.templet&&t.play(0,!0)})}const p=c.getChildByName("new");p.visible=!1;const u=S.nunlock.indexOf(n);u>-1&&(p.visible=!0,e?a<2&&S.nunlock.splice(u,1):S.nunlock.splice(u,1))}e&&(a<2||(o.title.visible=o.desc.visible=o.icon.visible=!1))}if(e){this.titleLab.text=e;const t=this.parentNode.parent;t.height=600,t.y=200,this.bgSke.scaleY=2.1,this.bgSke.y=607}this.chaBtn.visible=!e&&this.ins.playerData.rate>2,Y.loadSkillPre(e?[t[0],t[1]]:t)}hide(t){r.event("player.selSkill"),this.handle&&t&&this.handle(t);(()=>{Laya.Tween.to(this.owner,{scaleX:0,scaleY:0,alpha:0},100,null,Laya.Handler.create(this,()=>{r.event(dt.StudySkill),this.owner.removeSelf()}))})(),h.gameSDK.faceBookAdvertisement.showBannerAD()}onDisable(){this.bgSke.offAllCaller(this)}}class Bt extends Q{constructor(){super(),this.conBtn=null,this.shaBtn=null,this.rankNode=null,this.lightNode=null,this.selfNode=null,this.otherNode=null,this.closeHandler=null}onEnable(){const t=ee.instance;let e=t.lastCompareData;if(!e){const s=h.gameSDK.leaderboard.getRobotNames(),i=h.gameSDK.leaderboard.getRobotPhotos();e={name:s[d.getRandom(s.length-1,0)],photo:`head/${i[d.getRandom(i.length-1,0)]}.png`,score:t.playerData.score-d.getRandom(200,100)}}let s=h.gameSDK.sdkInfo.photo;s.indexOf("http")<0&&(s.indexOf("robot")>-1&&(s=s.replace("robot","")),s||(s="1"),s=`head/${s}.png`);const i={name:h.gameSDK.sdkInfo.playerName||"Self",photo:s,score:t.playerData.score},a=this.selfNode,l=this.otherNode,n=this.rankNode,o=this.lightNode,r=this.conBtn,c=this.shaBtn;this.initPlayerNode(a,i),this.initPlayerNode(l,e),r.visible=c.visible=o.visible=n.visible=!1,this.setClick(c,()=>{h.gameSDK.faceBookUpdateAsync.shareGame()},this),this.setClick(r,()=>{this.closeDialog(this,()=>{this.closeHandler&&this.closeHandler()})},this);Laya.timer.once(1e3,this,()=>{Laya.Tween.to(a,{y:154},500,Laya.Ease.backIn),Laya.Tween.to(l,{y:546},500,Laya.Ease.backIn),Laya.timer.once(1e3,this,()=>{n.scale(3,3),n.visible=!0,Laya.Tween.to(n,{scaleX:1,scaleY:1},500,Laya.Ease.backIn),Laya.timer.once(500,this,()=>{r.visible=c.visible=o.visible=!0})})})}initPlayerNode(t,e){const s=t.getChildByName("head"),i=t.getChildByName("nameLab"),a=t.getChildByName("powLab"),l=e.photo;l.indexOf("http")>-1?s.loadImage(l):s.skin=l,i.text=e.name,a.text=d.formatNumber(e.score)}onDisable(){super.onDisable()}onUpdate(){}}class At extends Q{constructor(){super(),this.rebBtn=null,this.timeLab=null,this.diaLab=null,this.ins=null,this.closeHandler=null}onEnable(){this.ins=ee.instance;this.owner,this.ins;let t=5;this.timeLab.text=t+"",this.diaLab.text=y.Battle[15];const e=()=>{t--,this.timeLab.text=t+""},s=()=>{this.schedule(1e3,e,this,t,null,!0,()=>{this.closeHandler&&this.closeHandler(),this.closeDialog(this)})};s(),this.setClick(this.rebBtn,()=>{Laya.timer.clearAll(this),h.gameSDK.faceBookAdvertisement.showRewardVideoAd(h.RebornVideoID,()=>{r.event(dt.PlayerReborn),this.closeDialog(this),h.gameSDK.faceBookAdvertisement.showBannerAD()},()=>{s()})},this),h.gameSDK.faceBookAdvertisement.hideBannerAD()}onDisable(){Laya.timer.clearAll(this)}onUpdate(){}}class _t extends Q{constructor(){super(),this.ins=null,this.midNode=null,this.hitNode=null,this.pauseBtn=null,this.lvPro=null,this.lvSke=null,this.lvLab=null,this.rateLab=null,this.coinLab=null,this.rewardLab=null,this.scoreLab=null,this.winSke=null,this.rateTipLab=null,this.bossComNode=null,this.rewTimeNode=null,this.supplyData=null,this.coinNum=0,this.rewNum=0,this.isEnd=!1,this.isEnding=!1,this.isPausing=!1,_t.insUI=this}onEnable(){this.ins=ee.instance;Laya.SoundManager.playMusic(O.BattleBgMus,0);u.bgCha=O.BattleBgMus;const t=this.getRes(_.battleUI.BattleSceneMidNode),e=this.open(_.battleUI.BattleSceneMidNode,t);this.midNode.addChild(e),this.winSke=e.getChildByName("winSke"),this.rateTipLab=e.getChildByName("rateTipLab"),this.bossComNode=e.getChildByName("bossComNode"),this.rewTimeNode=e.getChildByName("rewTimeNode");const i=this.ins,a=i.playerData;let l;a.chapter<1?l=s.basChapter:(l=s.comChapters[a.chapter-1],2==S.diff&&(l=s.difChapters[a.chapter-1])),this.rateLab.text=`${a.rate}/${l.level}`,i.isEndless&&(this.rateLab.text=y.EndlessDialog[7]+a.rate);const n=window.__Adventure__;let o=0;if(n){this.rateLab.text="1/1";const t=n[0].adv.model,e=n[0].adv.diff;let s=E.advDrop[t][e];o=d.getRandom(s.maxgold,s.mingold)}else i.isEndless?c("进入无尽模式",a.rate):c("进入章节",a.chapter);this.coinLab.text=d.formatNumber(a.coin),this.rewardLab.text=a.reward+"",this.scoreLab.text=y.EndlessDialog[9]+d.formatNumber(a.score),this.rewardLab.visible=!i.isEndless,this.scoreLab.visible=!!i.isEndless,this.lvSke.alpha=0,this.winSke.visible=!1,this.hitNode.width=Laya.stage.width,this.hitNode.height=Laya.stage.height,this.hitNode.visible=!1;const h=new Laya.Sprite;h.graphics.drawRect(0,0,720,186,"");const p=new Laya.Sprite;p.graphics.drawRect(0,0,720,292,""),this.bossComNode.mask=p,this.rewTimeNode.mask=h,this.lvSke.on(Laya.Event.STOPPED,this,()=>{Laya.timer.once(200,this,()=>{this.lvSke.alpha=0,this.lvPro.alpha=1,this.lvPro.value=1,this.getRandomSkill()})}),a.chapter<1&&(this.pauseBtn.visible=!1),this.setClick(this.pauseBtn,()=>{i.gameState!=rt.START||this.isEnding||(i.gameState=rt.PAUSE,this.isPausing=!0,this.loadPrefab(_.battleUI.PlayerSkillItem).then(()=>{this.openDialog(_.battleUI.GamePauseDialog,i.dialogNode)}))},this),r.on(dt.RewardNum,this,()=>{this.rewardLab.text=a.reward+""});let g=!1;r.on(dt.CoinInPlayer,this,t=>{if("coin"==t){if(this.coinNum>0&&(this.coinNum--,a.coin+=1*i.coinRate,this.coinLab.text=d.formatNumber(Math.floor(a.coin)),!g)){g=!0,Laya.SoundManager.playSound(O.GetFlyCoinSou),Laya.timer.once(100,this,()=>{g=!1});const t=this.getRes(_.battle.PlayerCoin),e=this.open(_.battle.PlayerCoin,t);e.pos(i.playerPosV2.x,i.playerPosV2.y),i.effectNode.addChild(e)}}else"rew"==t&&this.rewNum>0&&this.rewNum--;this.coinNum<=0&&this.rewNum<=0&&this.isEnd&&r.event(dt.RateEnd)}),r.on(dt.ClosePauseDialog,this,()=>{this.isPausing=!1,this.coinNum<=0&&this.rewNum<=0&&this.isEnd&&r.event(dt.RateEnd)}),r.on(dt.RateSupply,this,()=>{this.getRandomSkill(y.Battle[19])}),r.on(dt.SuitSupply,this,()=>{this.getRandomSkill(y.EquThunder2[6])}),r.on(dt.AdvRateSupply,this,()=>{this.getRandomSkill2()});let b=null,f=null;r.on(dt.EndlessCompare,this,()=>{if(i.initCompareData(),!b){const t=this.getRes(_.battleUI.BattleCompareBigNode),e=this.open(_.battleUI.BattleCompareBigNode,t);b=e,e.pos(360,640),e.scale(.2,.2),this.midNode.addChild(e),Laya.Tween.to(e,{scaleX:1,scaleY:1},300,Laya.Ease.backOut,Laya.Handler.create(this,()=>{Laya.timer.once(1e3,this,()=>{Laya.Tween.to(e,{y:-e.height/2},700,Laya.Ease.backIn,Laya.Handler.create(this,()=>{e.visible=!1;const t=this.getRes(_.battleUI.BattleCompareSmallNode),s=this.open(_.battleUI.BattleCompareSmallNode,t);f=s,s.x=-180,this.midNode.addChild(s),Laya.Tween.to(s,{x:0},1e3,Laya.Ease.backOut),i.selSkill&&1==i.playerData.rate?(i.selSkill--,r.event(dt.SuitSupply)):r.event(dt.RateStart)}))})}))}}),r.on(dt.EndlessScore,this,()=>{if(this.scoreLab.text=y.EndlessDialog[9]+d.formatNumber(a.score),i.compareData){const t=i.compareData.score;a.score>t&&(i.lastCompareData=Object.assign({},i.compareData),i.initCompareData(),f&&f.getComponent(Dt).updateNode())}});let C=null;r.on(dt.AddPlayer,this,()=>{C&&Laya.Tween.to(C,{x:750},1e3,Laya.Ease.backIn,Laya.Handler.create(this,()=>{C.visible=!1}))}),r.on(dt.RateStart,this,()=>{if(!C){const t=this.getRes(_.battleUI.BattleFriendNode),e=this.open(_.battleUI.BattleFriendNode,t);C=e,e.pos(750,1186),this.midNode.addChild(e),Laya.Tween.to(e,{x:619},1e3,Laya.Ease.backOut)}this.isEnd=!1,this.isEnding=!1,i.gameState=rt.START,i.levelBox=0;let t=w.levelExps[a.level],e=a.exp/t,s=a.level,o=l.maxair;if(i.isEndless&&(o=15),a.level>=o+1&&(e=1,s=o),this.lvPro.value=e,this.lvLab.text=`${s}`,this.rateLab.text=`${a.rate}/${l.level}`,i.isEndless&&(this.rateLab.text=y.EndlessDialog[7]+a.rate),n){this.rateLab.text="1/1";const t=n[0].adv.model,e=n[0].adv.diff;c(`进入${1==t?"装备":"钻石"}冒险`,t),c(`进入${1==t?"装备":"钻石"}冒险难度${e}`,e)}else i.isEndless?c("进入无尽模式关卡",a.rate):1==S.diff?c("进入普通模式关卡",100*a.chapter+a.rate):c("进入困难模式关卡",100*a.chapter+a.rate);const h=()=>{if(i.isEndless&&a.rate>1&&(m.endlessData.lastData=Object.assign({},a),m.endlessData.lastEnemy=i.endlessThisEnemy),i.isEndless&&i.endlessNextEnemy){const t=v.assets2[i.endlessNextEnemy[0]+""+i.endlessNextEnemy[1]];t&&Y.loadEnemyPre(t[i.endlessNextEnemy[2]])}},d=()=>{let t=this.rewTimeNode;t.visible=!0,t.x=1080;const e=t.getComponent(St).blinkNode;Laya.Tween.to(t,{x:360},300,Laya.Ease.quadIn,Laya.Handler.create(this,()=>{this.schedule(400,()=>{Laya.Tween.to(e,{alpha:0},200,null,Laya.Handler.create(this,()=>{Laya.Tween.to(e,{alpha:1},200)}))},this,3,null,!0,()=>{Laya.Tween.to(t,{x:-360},300,Laya.Ease.quadIn,Laya.Handler.create(this,()=>{t.visible=!1,r.event(dt.LevelEnemy),h()}))})}))},p=()=>{let t=this.bossComNode;t.visible=!0,t.x=1080;const e=t.getComponent(St).blinkNode;Laya.Tween.to(t,{x:360},300,Laya.Ease.quadIn,Laya.Handler.create(this,()=>{this.schedule(400,()=>{Laya.Tween.to(e,{alpha:0},200,null,Laya.Handler.create(this,()=>{Laya.Tween.to(e,{alpha:1},200)}))},this,3,null,!0,()=>{Laya.Tween.to(t,{x:-360},300,Laya.Ease.quadIn,Laya.Handler.create(this,()=>{t.visible=!1,r.event(dt.LevelEnemy),h()}))})})),Laya.SoundManager.playSound(O.BattleBossComSou)},u=()=>{let t=this.rateTipLab;t.text=`Level ${a.rate}`,t.x=1080,Laya.Tween.to(t,{x:380},300,Laya.Ease.quadIn,Laya.Handler.create(this,()=>{Laya.Tween.to(t,{x:340},1e3,null,Laya.Handler.create(this,()=>{Laya.Tween.to(t,{x:-360},150,Laya.Ease.quadIn,Laya.Handler.create(this,()=>{r.event(dt.LevelEnemy),h()}))}))}))};if(i.isEndless?a.rate>=16&&a.rate%10==6?d():a.rate%5==0?p():u():a.rate%5==0&&a.rate%10!=0&&a.chapter>0?d():a.rate%10==0||a.rate%5==0&&a.chapter<1?p():u(),i.isEndless||a.rate>1&&a.chapter>0&&(S.lastData=a),!i.isEndless){const t=v.assets[a.chapter+""+S.diff];t&&Y.loadEnemyPre(t[a.rate+1])}}),r.on(dt.RateEnd,this,()=>{if(this.isEnd=!0,this.rewNum>0||this.coinNum>0||this.isPausing)return;const t=()=>{this.isEnding=!0;const t=a.chapter;let e=a.rate;const s=a.rate+1;let h=v["enemys"+t];2==S.diff&&(h=v["denemys"+t]);let p=h[s],u=l;if(n){p=null;const t=n[0].adv.model,e=n[0].adv.diff;c(`${1==t?"装备":"钻石"}冒险成功`,t),c(`${1==t?"装备":"钻石"}冒险难度${e}成功`,e)}else i.isEndless||(1==S.diff?c("普通模式关卡成功",100*a.chapter+a.rate):c("困难模式关卡成功",100*a.chapter+a.rate));let y=a.coin,m=0;n?(a.coin+=o*i.coinRate,m=o*i.coinRate):i.isEndless?e%10==0?(a.coin+=300*i.coinRate,m=300*i.coinRate):(a.coin+=100*i.coinRate,m=100*i.coinRate):e%5==0?(a.coin+=u.extragold*i.coinRate,m=u.extragold*i.coinRate):(a.coin+=u.addgold*i.coinRate,m=u.addgold*i.coinRate);const g=this.coinLab;if(Laya.Tween.to(g,{scaleX:1.3,scaleY:1.3},200,Laya.Ease.circOut,Laya.Handler.create(this,()=>{let t=m/20;this.schedule(50,()=>{y+=t,g.text=d.formatNumber(Math.floor(y))},this,20,null,!0,()=>{g.text=d.formatNumber(a.coin),Laya.Tween.to(g,{scaleX:1,scaleY:1},200,Laya.Ease.circOut)})})),!p&&!i.isEndless)return void Laya.timer.once(1e3,this,()=>{i.playerNode.alpha=0,i.player2Node.alpha=0,i.eneBulNode.alpha=0,i.effectNode.alpha=0,i.bgTopNode.alpha=0,i.gameState=rt.END,i.modSceneV3.getChildByName("trails").active=!1});a.rate=s;let b=w.upLevExps[e]||1,f=w.levelExps[a.level];a.exp+=b;let k=a.exp/f,C=u.maxair;i.isEndless&&(C=15),a.level>=C+1&&(k=1),Laya.Tween.to(this.lvPro,{value:k},500,Laya.Ease.cubicIn,Laya.Handler.create(this,()=>{a.level<C+1&&a.exp>=f?(a.level+=1,a.exp=0,this.lvSke.templet?(this.lvPro.value=0,this.lvSke.play(0,!1),this.lvSke.alpha=1):(this.lvPro.alpha=1,this.getRandomSkill())):r.event(dt.StudySkill,!0)}))};t()}),r.on(dt.StudySkill,this,()=>{if(this.supplyData){i.gameState=rt.PAUSE,i.playerNode.alpha=0,i.eneBulNode.alpha=0;const t=i.player2Node;for(let e=t.numChildren-1;e>=0;e--){t.getChildAt(e).removeSelf()}i.player2Node.alpha=0,i.effectNode.alpha=0,i.bgTopNode.alpha=0,i.playerV3.transform.localRotationEuler=this.getVec3();const e=i.otherPlayer;for(let t=0;t<e.length;t++){e[t].v3.active=!1}const s=124,a=i.playerV3;let l=this.getVec3();i.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,640+s),l),Laya.timer.once(0,this,()=>{Laya.Tween.to(a.transform,{localPositionX:l.x,localPositionZ:l.z},500,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{i.playerPosV3=l,i.playerPosV2=this.getVec3(360,640+s),i.playerV2.pos(360,640+s),Laya.timer.once(500,this,()=>{const t=this.supplyData;this.supplyData=null;const e=this.open(N[t.type],i.eneMgr.enemyPres[t.type]),s=e.getComponent(Lt);e.pos(360,1280+e.height/2),s.edata=t,s.cloHan=(()=>{i.gameState=rt.START,Laya.timer.once(1e3,this,()=>{r.event(dt.RateStart)})}),this.ins.bgSceneV2.addChild(e)})}))})}else i.selSkill&&1==a.rate?(i.selSkill--,r.event(dt.SuitSupply)):(i.gameState=rt.START,Laya.timer.once(1e3,this,()=>{r.event(dt.RateStart)}))}),this.winSke.on(Laya.Event.STOPPED,this,()=>{this.winSke.templet&&this.winSke.play(0,!0)});let L=!1,D=!1,P=!1;r.on(dt.GameStateChange,this,()=>{if(this.ins.gameState==rt.END&&!L){i.isEndless?(m.endlessData.lastData=null,m.endlessData.lastEnemy=null):S.lastData=null;const t=i.otherPlayer;for(let e=0;e<t.length;e++){t[e];r.event(dt.PlayerDie,e+1)}if(L=!0,a.currHP>0)Laya.timer.once(1e3,this,()=>{const t=i.playerV3;let e=this.getVec3(),s=i.playerPosV2.y>1e3?1e3:840;i.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,s),e),Laya.Tween.to(t.transform,{localPositionX:e.x,localPositionZ:e.z},500,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{Laya.timer.once(500,this,()=>{this.winSke.templet&&(this.winSke.visible=!0,this.winSke.play(1,!1),Laya.SoundManager.playSound(O.BattleSucSou)),Laya.Tween.to(t.transform,{localPositionZ:e.z-10},500,null,Laya.Handler.create(this,()=>{Laya.timer.once(1e3,this,()=>{i.isEndless||this.loadPrefab(_.battleUI.PlayerSkillItem).then(()=>{this.openDialog(_.battleUI.GameOverDialog,i.dialogNode)})})}))})}))}),n||i.isEndless||S.setChapter(),n||i.isEndless||(1==S.diff?c("普通模式章节成功",a.chapter):c("困难模式章节成功",a.chapter));else{let t=a.skills[ut.Back],e=!!(S.specialSuit.indexOf(7)>-1);if(Laya.timer.once(1e3,this,()=>{e&&!P?(P=!0,r.event(dt.PlayerReborn)):t&&!D?(D=!0,r.event(dt.PlayerReborn)):this.openDialog(_.battleUI.RebornDialog,i.dialogNode,t=>{t.getComponent(At).closeHandler=(()=>{if(i.isEndless){const t=()=>{this.loadPrefab(_.battleUI.PlayerSkillItem).then(()=>{this.openDialog(_.battleUI.EndlessOverDialog,i.dialogNode)})};t()}else this.loadPrefab(_.battleUI.PlayerSkillItem).then(()=>{this.openDialog(_.battleUI.GameOverDialog,i.dialogNode)}),n||k.updateRate(a.chapter,a.rate)})})}),n){const t=n[0].adv.model,e=n[0].adv.diff;c(`${1==t?"装备":"钻石"}冒险失败`,t),c(`${1==t?"装备":"钻石"}冒险难度${e}失败`,e)}else i.isEndless?c("无尽模式关卡失败",a.rate):1==S.diff?(c("普通模式关卡失败",100*a.chapter+a.rate),c("普通模式章节失败",a.chapter)):(c("困难模式关卡失败",100*a.chapter+a.rate),c("困难模式章节失败",a.chapter))}}}),r.on(dt.PlayerReborn,this,()=>{r.event("player.reborn"),L=!1,i.playerV2.visible=!0,i.playerV2.__bgIma__.visible=!0,i.playerHPV2.visible=!0;for(let t=0;t<i.plaLassV2.length;t++)i.plaLassV2[t].visible=!0;for(let t=0;t<i.plaWingsV2.length;t++)i.plaWingsV2[t].visible=!0;i.playerNode.alpha=1,i.modSceneV3.active=!0,a.hp/=2,a.hp=Math.floor(a.hp),a.currHP=a.hp,r.event(dt.PlayerHP),i.gameState=rt.START,i.isMakingEnemy||i.enemyCols.length||Laya.timer.once(1e3,this,()=>{r.event(dt.RateEnd)})}),r.on(dt.GameOver,this,()=>{i.gameState=rt.END}),Laya.timer.once(500,this,()=>{Y.loadBattlePre(!!(a.chapter<1))})}getRandomSkill(t){const e=this.ins,s=e.playerData;e.gameState=rt.PAUSE;const i=s.unlock,a=A.skills,l=(()=>{let t=i.concat();for(let e=t.length-1;e>=0;e--){const s=t[e];a[s].weight<=0&&t.splice(e,1)}const l=t.indexOf(1013);s.currHP/s.hp>.7&&l>=0&&t.splice(l,1);const n=t.indexOf(1023);if(3==s.id&&n>-1&&t.splice(n,1),e.plaWingsV2.length>=4)for(let e=t.length-1;e>=0;e--){const s=t[e];3==a[s].skilltype&&t.splice(e,1)}else{let e=null;for(const t in s.skills)3==a[t].skilltype&&(e=parseInt(t));if(e)for(let s=t.length-1;s>=0;s--){const i=t[s];3==a[i].skilltype&&i!=e&&t.splice(s,1)}}return t})();if(l.length<4)return void r.event(dt.RateStart);const n=[];for(let t=0;t<l.length;t++){const e=l[t],s=a[e];if(n.push(e),"number"==typeof s.weight)for(let t=1;t<s.weight/1e3;t++)n.push(e)}const o=[],h=[],c=n.length-1;for(;o.length<4;){let t=Math.floor(Math.random()*(c-0+1)+0);o.indexOf(t)<0&&h.indexOf(n[t])<0&&(o.push(t),h.push(n[t]))}let d=h[0],p=h[1],u=h[2],y=h[3];s.chapter<1&&(d=1e3,p=1005,u=1001,y=1009),this.openDialog(_.battleUI.ChooseSkillDialog,e.dialogNode,e=>{const s=e.getComponent(Tt);s.handle=(t=>{const e=a[t],s=i.indexOf(t);e.add==B.Once&&i.splice(s,1),e.add==B.Add&&(a[t+1]&&a[t+1].add==B.Add?i[s]=t+1:i.splice(s,1))}).bind(this),s.setData([d,p,u,y],t)})}getRandomSkill2(){const t=this.ins,e=t.playerData;t.gameState=rt.PAUSE;const s=e.unlock,i=A.skills,a=[1020];let l=null,n=[],o=null,h=[];for(let t=0;t<s.length;t++){const e=s[t];2==i[e].skilltype&&n.push(e),3==i[e].skilltype&&h.push(e)}l=n[d.getRandom(n.length-1,0)],o=h[d.getRandom(h.length-1,0)],a.push(l,o);const c=(()=>{let t=s.concat();for(let e=t.length-1;e>=0;e--){const s=t[e];i[s].weight<=0&&t.splice(e,1)}const a=t.indexOf(1020);a>=0&&t.splice(a,1);const n=t.indexOf(l);n>=0&&t.splice(n,1);const o=t.indexOf(1013);o>=0&&t.splice(o,1);const h=t.indexOf(1023);3==e.id&&h>-1&&t.splice(h,1);for(let e=t.length-1;e>=0;e--){const s=t[e];3==i[s].skilltype&&t.splice(e,1)}return t})();if(c.length<1)return void r.event(dt.RateStart);const p=[];for(let t=0;t<c.length;t++){const e=c[t],s=i[e];if(p.push(e),"number"==typeof s.weight)for(let t=1;t<s.weight/1e3;t++)p.push(e)}const u=[],y=[],m=p.length-1;for(;u.length<1;){let t=Math.floor(Math.random()*(m-0+1)+0);u.indexOf(t)<0&&y.indexOf(p[t])<0&&(u.push(t),y.push(p[t]))}let g=y[0];a.push(g),a.sort((t,e)=>.5-Math.random()),this.openDialog(_.battleUI.ChooseAdvSkillDialog,t.dialogNode,t=>{t.getComponent(vt).setData(a)})}onDisable(){r.offAllCaller(this),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),Laya.SoundManager.stopMusic(),u.bgCha=null,this.winSke&&(this.winSke.offAllCaller(this),this.winSke.stop()),this.lvSke&&(this.lvSke.offAllCaller(this),this.lvSke.stop())}}_t.insUI=null;class Vt extends Q{constructor(){super(),this.ins=null,this.move=!0,this.nor=null,this.spec=!1,this.speed=.3}onEnable(){this.ins=ee.instance,this.move=!0;const t=this.owner;t.scale(1,1),t.alpha=1,(t.x<=0||t.y>=720||t.y<=0||t.y>=1280)&&(this.move=!1,this.moveCoin())}onDisable(){this.recover(this.owner)}moveCoin(){const t=this.owner,e=this.ins.playerPosV2;Laya.Tween.to(t,{x:e.x,y:e.y,alpha:0},300,null,Laya.Handler.create(this,()=>{this.spec||r.event(dt.RewardNum),r.event(dt.CoinInPlayer,"rew"),t.removeSelf()}))}onUpdate(){const t=this.ins;if(t.gameState!=rt.START)return;let e=Laya.timer.delta*this.speed;const s=this.owner;this.move&&((s.x<=0||s.x>=720)&&(this.nor.x*=-1),(s.y<=0||s.y>=1280)&&(this.nor.y*=-1),Math.abs(s.y-t.playerV2.y)<=400&&(this.move=!1,this.moveCoin()),s.x+=e*this.nor.x,s.y+=e*this.nor.y)}}class Rt extends Q{constructor(){super(),this.ins=null,this.tar=null,this.dex=this.getVec2()}onEnable(){this.ins=ee.instance}onDisable(){const t=this.owner;t.height=0,t.rotation=0,this.recover(this.owner)}onLateUpdate(){if(this.ins.gameState!=rt.START)return;const t=this.owner,e=this.tar,s=-e.rotation/180*Math.PI,i=this.dex,a=i.x*Math.cos(s)+i.y*Math.sin(s),l=i.y*Math.cos(s)-i.x*Math.sin(s),n=e.x+a,o=e.y+l;t.pos(n,o);let h=this.ins.playerV2,r=n-(h.x+this.dex.x),c=o-h.y;t.height=Math.sqrt(r*r+c*c),t.rotation=Math.atan2(r,-c)/Math.PI*180}}class Nt{constructor(t){this._tree=new Quadtree(t)}check(t,e){let s=[];if(this._tree){this._tree.clear();for(let e=0,s=t.length;e<s;e++){const s=t[e],i=s.aabb,a={x:i.x,y:i.y,height:i.height,width:i.width,collider:s};this._tree.insert(a)}if(this._tree.retrieve(e.aabb).forEach(t=>{(function(t,e){const s=t.owner,i=e.owner,a=s.y+t.deltaY,l=i.y+e.deltaY;return Math.abs(s.x-i.x)<=(t.width2+e.width2)/2&&Math.abs(a-l)<=(t.height2+e.height2)/2})(t.collider,e)&&s.push(t.collider)}),this._collisions)for(let t=0;t<this._collisions.length;t++){const i=this._collisions[t];if(s.indexOf(i)<0){let t=i.bids.indexOf(e.bid);if(t>-1&&(i.bids.splice(t,1),i.owner)){const t=i.owner._components||[];for(let s=0;s<t.length;s++){const a=t[s];if(a&&a.onCollisionExit){a.onCollisionExit(e,i);break}}}let s=e.bids.indexOf(i.bid);if(s>-1&&(e.bids.splice(s,1),e.owner)){const t=e.owner._components||[];for(let s=0;s<t.length;s++){const a=t[s];if(a&&a.onCollisionExit){a.onCollisionExit(i,e);break}}}}}for(let t=0;t<s.length;t++){const i=s[t];if(i.bids.indexOf(e.bid)<0&&(i.bids.push(e.bid),i.owner)){const t=i.owner._components||[];for(let s=0;s<t.length;s++){const a=t[s];if(a&&a.onCollisionEnter){a.onCollisionEnter(e,i);break}}}if(e.bids.indexOf(i.bid)<0&&(e.bids.push(i.bid),e.owner)){const t=e.owner._components||[];for(let s=0;s<t.length;s++){const a=t[s];if(a&&a.onCollisionEnter){a.onCollisionEnter(i,e);break}}}}this._collisions=s}}}function Quadtree(t,e,s,i){this.max_objects=e||10,this.max_levels=s||4,this.level=i||0,this.bounds=t,this.objects=[],this.nodes=[]}Quadtree.prototype.split=function(){var t=this.level+1,e=this.bounds.width/2,s=this.bounds.height/2,i=this.bounds.x,a=this.bounds.y;this.nodes[0]=new Quadtree({x:i+e,y:a,width:e,height:s},this.max_objects,this.max_levels,t),this.nodes[1]=new Quadtree({x:i,y:a,width:e,height:s},this.max_objects,this.max_levels,t),this.nodes[2]=new Quadtree({x:i,y:a+s,width:e,height:s},this.max_objects,this.max_levels,t),this.nodes[3]=new Quadtree({x:i+e,y:a+s,width:e,height:s},this.max_objects,this.max_levels,t)},Quadtree.prototype.getIndex=function(t){var e=[],s=this.bounds.x+this.bounds.width/2,i=this.bounds.y+this.bounds.height/2,a=t.y<i,l=t.x<s,n=t.x+t.width>s,o=t.y+t.height>i;return a&&n&&e.push(0),l&&a&&e.push(1),l&&o&&e.push(2),n&&o&&e.push(3),e},Quadtree.prototype.insert=function(t){var e,s=0;if(this.nodes.length)for(e=this.getIndex(t),s=0;s<e.length;s++)this.nodes[e[s]].insert(t);else if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels){for(this.nodes.length||this.split(),s=0;s<this.objects.length;s++){e=this.getIndex(this.objects[s]);for(var i=0;i<e.length;i++)this.nodes[e[i]].insert(this.objects[s])}this.objects=[]}},Quadtree.prototype.retrieve=function(t){var e=this.getIndex(t),s=this.objects;if(this.nodes.length)for(var i=0;i<e.length;i++)s=s.concat(this.nodes[e[i]].retrieve(t));return s=s.filter(function(t,e){return s.indexOf(t)>=e})},Quadtree.prototype.clear=function(){this.objects=[];for(var t=0;t<this.nodes.length;t++)this.nodes.length&&this.nodes[t].clear();this.nodes=[]};class It extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this._norV3=null,this.ratio=2,this.state=rt.READY,this.speed=.5,this.trailIma=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280}));const t=this.trailIma;t&&(t.scaleY=0,t.y=26,Laya.Tween.to(t,{scaleY:1,y:79},100))}onDisable(){r.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=-360||t.x>=1080||t.y<=-640||t.y>=1920)&&this.owner.removeSelf(),this.quadTree.check(this.ins.playerCols,this.selfCol)}}class Mt extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this._norV3=null,this.going=!0,this.currDis=0,this.state=rt.START,this.speed=.5,this.distance=500,this.tar=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.currDis=0,this.going=!0}onDisable(){r.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed,s=this.ins.playerV2;if(this.going&&s&&s.parent){let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(s.x,s.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}if(!this.going&&this.tar&&this.tar.parent){let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}if(this.currDis>=this.distance&&this.going)if(this.going=!1,this.tar&&this.tar.parent){let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}else this.tar=null,this.norV3.x*=-1,this.norV3.y*=-1;!this.going&&this.tar&&this.tar.parent&&Math.abs(this.tar.x-t.x)<=3*e&&Math.abs(this.tar.y-t.y)<=3*e&&t.removeSelf(),t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180);let i=e*this.norV3.x,a=e*this.norV3.y;t.x+=i,t.y+=a,this.going&&(this.currDis+=Math.sqrt(i*i+a*a)),(t.x<=-360||t.x>=1080||t.y<=-640||t.y>=1920)&&this.owner.removeSelf(),this.quadTree.check(this.ins.playerCols,this.selfCol)}}class Ht extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this._norV3=null,this.angle=0,this.state=rt.READY,this.js=!1,this.tar=null,this.pangle=0,this.speed=.4,this.xv=1,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.angle=0,this.js=!1,this.state=rt.START;const t=this.ins,e=this.owner,s=new Laya.Sprite3D,i=this.getRes(V.E_DaoDan),a=Laya.Sprite3D.instantiate(i);s.addChild(a),t.modSceneV3.getChildByName("trails").addChild(s);let l=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),l),s.transform.position=l,this.s3d=s}onDisable(){this.s3d&&Laya.timer.once(200,this,()=>{this.s3d.removeSelf(),this.recover(this.owner)}),r.offAllCaller(this)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed,s=this.ins.ratio3D;if(this.js){if(this.tar){let s=this.getVec3(),i=this.getVec3(),a=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i),Laya.Vector3.lerp(this.norV3,i,e/50,a),this.norV3=a,e*=2}}else{if(this.tar){let s=this.getVec3(),i=this.getVec3(),a=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let l=Math.atan2(-i.y,i.x);Laya.Vector3.lerp(this.getVec3(this.pangle),this.getVec3(l),e/100,a),this.pangle=a.x}this.angle+=6;let s=-Math.sin(this.angle/180*Math.PI),i=.4*Math.tan(s),a=new Laya.Vector3(0,0,0),l=this.pangle,n=1*Math.cos(l)+i*Math.sin(l);n*=this.xv;let o=i*Math.cos(l)-1*Math.sin(l);Laya.Vector3.normalize(this.getVec3(n,o),a),this.norV3=a}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d.transform.translate(this.getVec3(this.norV3.x/s*e,0,this.norV3.y/s*e)),(t.x<=-360||t.x>=1080||t.y<=-640||t.y>=1920)&&this.owner.removeSelf(),this.quadTree.check(this.ins.playerCols,this.selfCol)}}class Ot extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this._norV3=null,this.circle=!0,this.state=rt.READY,this.ranax=1,this.tar=null,this.angle=0,this.xv=1,this.speed=.5,this.trail=V.E_DaoDan,this.aspeed=1,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.state=rt.START,this.circle=!0;const t=this.ins,e=this.owner;if(1==this.aspeed?this.ranax=Math.floor(3*Math.random()+8)/10:this.ranax=1,this.trail&&t.modCameraV3.transform){const s=new Laya.Sprite3D,i=this.getRes(this.trail),a=Laya.Sprite3D.instantiate(i);s.addChild(a),t.modSceneV3.getChildByName("trails").addChild(s);let l=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),l),s.transform.position=l,this.s3d=s}}onDisable(){this.s3d&&Laya.timer.once(200,this,()=>{this.s3d.removeSelf(),this.recover(this.owner)}),r.offAllCaller(this)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed,s=this.ins.ratio3D;if(this.tar&&this.circle){let s=this.getVec3(),i=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let a=Math.atan2(-i.y,i.x)-Math.atan2(-this.norV3.y,this.norV3.x);if(a<0&&(a+=2*Math.PI),a<=.2){this.circle=!1;let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3),this.tar=null}else{this.angle-=this.xv*e/2*this.ranax*this.aspeed,this.angle%=360;let t=Math.tan(this.angle/180*Math.PI),s=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,-t,0),s),(this.angle>90&&this.angle<270||this.angle<-90&&this.angle>-270)&&(s.x=-s.x,s.y=-s.y),this.norV3.x=s.x,this.norV3.y=s.y}}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d&&this.s3d.transform.translate(this.getVec3(this.norV3.x/s*e,0,this.norV3.y/s*e)),(t.x<=-360||t.x>=1080||t.y<=-640||t.y>=1920)&&this.owner.removeSelf(),this.quadTree.check(this.ins.playerCols,this.selfCol)}}class qt{constructor(){this.attack=0,this.crit=0,this.critHurt=0,this.eneHurtStr=0,this.bosHurtStr=0}}class Ut extends Q{constructor(){super(),this.data=new qt}onEnable(){}onDisable(){}setData(t,e,s,i,a){this.data.attack=t,this.data.crit=e,this.data.critHurt=s,this.data.eneHurtStr=i,this.data.bosHurtStr=a}}class Ft extends Q{constructor(){super(),this.ins=null,this.enemyCom=null,this.inited=!1,this.skill1Pre=null,this.skill3Pre=null,this.skill5Pre=null,this.skillLinePre=null,this.skillRotatePre=null,this.skill10Pre=null,this.skill11Pre=null,this.skill13Pre=null,this.skill15Pre=null,this.skill16Pre=null,this.skill18Pre=null,this.lines=[],this.skill1Pre=this.getRes(_.battle.EnemySkill1),this.skill3Pre=this.getRes(_.battle.EnemySkill3),this.skill5Pre=this.getRes(_.battle.EnemySkill5),this.skillLinePre=this.getRes(_.battle.EnemyLine),this.skillRotatePre=this.getRes(_.battle.EnemySkill9),this.skill10Pre=this.getRes(_.battle.EnemySkill10),this.skill11Pre=this.getRes(_.battle.EnemySkill11),this.skill13Pre=this.getRes(_.battle.EnemySkill13),this.skill15Pre=this.getRes(_.battle.EnemySkill15),this.skill16Pre=this.getRes(_.battle.EnemySkill16),this.skill18Pre=this.getRes(_.battle.EnemySkill18)}onEnable(){if(this.ins=ee.instance,this.inited=!1,this.enemyCom=this.owner.getComponent(Gt),!this.enemyCom||!this.enemyCom.edata)return;1026==this.enemyCom.edata.type&&this.initSkill()}initSkill(){if(this.inited)return;this.inited=!0;const t=this.enemyCom.edata,e=T.enemys[t.type];if(e.skill){const s=e.skill,i=t.shooting,a=t.bulletstart;if("number"==typeof s)if(7!=s&&14!=s&&16!=s||(this.enemyCom.isRotate=!0),12==s)this.enemyCom.isRotSelf=!0,this.enemyCom.isPauseSelf=!0,r.on(dt.EnemyPause,this,this.skill12);else if(17==s)this.enemyCom.isRotSelf=!0,r.on(dt.EnemyReturn,this,this.skill17);else{const e=()=>{if(this.ins.gameState!=rt.START)return;const e=this["skill"+s];r.event(dt.EnemyHit,[t.type,this.enemyCom.eid,s,e?e.bind(this):null]),t.type};a&&"number"==typeof a?(Laya.timer.once(1e3*a,this,e),Laya.timer.once(1e3*a,this,()=>{Laya.timer.loop(1e3*i,this,()=>{e()})})):Laya.timer.loop(1e3*i,this,()=>{e()})}else if("string"==typeof s){const e=s.split("|"),i=t.shooting.split("|"),l=t.att.split("|"),n=t.bulletsp.split("|");let o=0;const h=()=>{if(this.ins.gameState!=rt.START)return;const s=this["skill"+e[o]];r.event(dt.EnemyHit,[t.type,this.enemyCom.eid,e[o],s?s.bind(this,parseFloat(l[o]),parseFloat(n[o])):null]),t.type,++o>=e.length&&(o=0)},c=()=>{Laya.timer.once(1e3*parseFloat(i[o]),this,()=>{h(),c()})};a&&"number"==typeof a?(Laya.timer.once(1e3*a,this,h),Laya.timer.once(1e3*a,this,()=>{c()})):c()}}}onDisable(){for(let t=0;t<this.lines.length;t++){this.lines[t].removeSelf()}this.lines.length=0,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this)}skill1(t,e){const s=this.owner,i=this.enemyCom.edata,a=[-10,10],l=i.atttime||1,n=ft[i.type].b1;for(let o=0;o<l;o++)for(let l=0;l<a.length;l++){const h=this.open(_.battle.EnemySkill1,this.skill1Pre);let r=h.getComponent(Ut);r||(r=h.addComponent(Ut)),r.setData(t||i.att,0,0,0,0);const c=h.getComponent(It);c.norV3=this.getVec3(0,1),c.state=rt.START,c.speed=e||i.bulletsp,h.pos(s.x+n[0].x+a[l],s.y+n[0].y+20*o),this.ins.eneBulNode.addChild(h)}}skill2(t,e){this.ins;const s=this.enemyCom.edata,i=this.owner,a=[-20,20],l=ft[s.type].b1;let n=0;this.schedule(50,()=>{const o=this.open(_.battle.EnemySkill1,this.skill1Pre);let h=o.getComponent(Ut);h||(h=o.addComponent(Ut)),h.setData(t||s.att,0,0,0,0);const r=o.getComponent(It);r.norV3=this.getVec3(0,1),r.state=rt.START,r.speed=e||s.bulletsp,o.pos(i.x+l[0].x+a[n],i.y+l[0].y),this.ins.eneBulNode.addChild(o),++n>1&&(n=0)},this,10)}skill3(t,e){const s=this.ins,i=this.enemyCom.edata,a=this.owner,l=[110,70,100,80],n=ft[i.type].b1;let o=0;this.schedule(200,()=>{if(!this.getRes(V.E_DaoDan))return void Y.load3D([V.E_DaoDan]);const h=this.open(_.battle.EnemySkill3,this.skill3Pre);let r=h.getComponent(Ut);r||(r=h.addComponent(Ut)),r.setData(t||i.att,0,0,0,0);const c=h.getComponent(Ot);c.norV3=this.getVec3(0,-1),c.angle=l[o],c.xv=l[o]>90?-1:1,c.tar=this.getVec2(s.playerV2.x,s.playerV2.y),c.speed=e||i.bulletsp,h.pos(a.x+n[0].x,a.y+n[0].y),this.ins.eneBulNode.addChild(h),o++},this,4)}skill4(t,e){this.ins;const s=this.enemyCom.edata,i=this.owner,a=[this.getVec3(-.34,.94),this.getVec3(-.17,.98),this.getVec3(.17,.98),this.getVec3(.34,.94)],l=ft[s.type].b1;for(let n=0;n<4;n++){if(!this.getRes(V.E_DaoDan))return void Y.load3D([V.E_DaoDan]);const o=this.open(_.battle.EnemySkill3,this.skill3Pre);let h=o.getComponent(Ut);h||(h=o.addComponent(Ut)),h.setData(t||s.att,0,0,0,0);const r=o.getComponent(Ot);r.norV3=a[n].clone(),r.angle=0,r.xv=1,r.tar=null,r.speed=e||s.bulletsp,o.pos(i.x+l[0].x,i.y+10+l[0].y),this.ins.eneBulNode.addChild(o)}}skill5(t,e){const s=this.owner,i=this.enemyCom.edata,a=[-40,-20,20,40],l=i.atttime||1,n=ft[i.type].b1;for(let o=0;o<l;o++)for(let l=0;l<a.length;l++){const h=this.open(_.battle.EnemySkill5,this.skill5Pre);let r=h.getComponent(Ut);r||(r=h.addComponent(Ut)),r.setData(t||i.att,0,0,0,0);const c=h.getComponent(It);c.norV3=this.getVec3(0,1),c.state=rt.READY,c.speed=e||i.bulletsp,h.pos(s.x+a[l]+n[0].x,s.y+n[0].y+20*o),this.ins.eneBulNode.addChild(h),Laya.Tween.to(h,{y:s.y+n[0].y+100+20*o},500,null,Laya.Handler.create(this,()=>{const t=this.ins.playerV2;Laya.timer.once(1e3,this.ins,()=>{let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(t.x+a[l],t.y),this.getVec3(h.x,h.y),e),Laya.Vector3.normalize(e,c.norV3),c.state=rt.START})}))}}skill6(t,e){const s=this.owner,i=this.enemyCom.edata,a=[this.getVec3(-.17,.98),this.getVec3(0,1),this.getVec3(.17,.98)],l=ft[i.type].b1;this.schedule(100,()=>{for(let n=0;n<a.length;n++){const o=this.open(_.battle.EnemySkill1,this.skill1Pre);let h=o.getComponent(Ut);h||(h=o.addComponent(Ut)),h.setData(t||i.att,0,0,0,0);const r=o.getComponent(It);r.norV3=a[n].clone(),r.state=rt.START,r.speed=e||i.bulletsp,o.pos(s.x+l[0].x,s.y+l[0].y),this.ins.eneBulNode.addChild(o)}},this,5)}skill7(t,e){const s=this.owner,i=this.enemyCom.edata,a=[[0,0],[-1,1],[1,1],[-2,2],[0,2],[2,2]],l=ft[i.type].b1,n=this.open(_.battle.EnemyLine,this.skillLinePre),o=n.getComponent(Rt);o.dex=this.getVec2(),o.tar=s,n.pos(s.x,s.y),this.ins.bgTopNode.addChild(n),this.lines.push(n),Laya.timer.once(1500,this,()=>{if(n.removeSelf(),this.lines.splice(this.lines.indexOf(n),1),this.ins.gameState==rt.START)for(let n=0;n<a.length;n++){const o=this.open(_.battle.EnemySkill1,this.skill1Pre);let h=o.getComponent(Ut);h||(h=o.addComponent(Ut)),h.setData(t||i.att,0,0,0,0);const r=o.getComponent(It);r.speed=e||i.bulletsp,r.norV3=this.getVec3(0,1);let c=this.getVec3();const d=this.ins.playerV2;let p=10*a[n][0],u=20*a[n][1];o.pos(s.x+p+l[0].x,s.y+u+l[0].y),Laya.Vector3.subtract(this.getVec3(d.x+p,d.y+u),this.getVec3(o.x,o.y),c),Laya.Vector3.normalize(c,r.norV3),r.state=rt.START,this.ins.eneBulNode.addChild(o)}})}skill8(t,e){const s=this.owner,i=this.enemyCom.edata,a=[[0,0],[-1,1],[1,1],[-2,2],[2,2],[-3,3],[3,3],[-2,4],[2,4],[-1,5],[1,5],[0,6]],l=i.atttime||1,n=ft[i.type].b1;for(let o=0;o<l;o++)for(let l=0;l<a.length;l++){const h=this.open(_.battle.EnemySkill1,this.skill1Pre);let r=h.getComponent(Ut);r||(r=h.addComponent(Ut)),r.setData(t||i.att,0,0,0,0);const c=h.getComponent(It);c.norV3=this.getVec3(0,1),c.speed=e||i.bulletsp;let d=20*a[l][0],p=20*a[l][1];h.pos(s.x+d+n[0].x,s.y+p+n[0].y+140*o),c.state=rt.START,this.ins.eneBulNode.addChild(h)}}skill9(t,e){const s=this.owner,i=this.enemyCom.edata,a=[this.getVec3(0,-1),this.getVec3(.03,-1),this.getVec3(.07,-1),this.getVec3(.1,-.99),this.getVec3(.14,-.99),this.getVec3(.17,-.98),this.getVec3(.98,-.17),this.getVec3(.99,-.14),this.getVec3(.99,-.1),this.getVec3(.99,-.07),this.getVec3(1,-.03),this.getVec3(1,0),this.getVec3(.5,.87),this.getVec3(.47,.88),this.getVec3(.44,.9),this.getVec3(.41,.91),this.getVec3(.37,.93),this.getVec3(.34,.94),this.getVec3(-.5,.87),this.getVec3(-.53,.85),this.getVec3(-.56,.83),this.getVec3(-.59,.81),this.getVec3(-.62,.79),this.getVec3(-.64,.77),this.getVec3(-.98,-.17),this.getVec3(-.98,-.21),this.getVec3(-.97,-.24),this.getVec3(-.96,-.28),this.getVec3(-.95,-.31),this.getVec3(-.94,-.34)],l=ft[i.type].b1,n=this.open(_.battle.EnemySkill9,this.skillRotatePre);n.pos(s.x+l[0].x,s.y+l[0].y),this.ins.eneBulNode.addChild(n),Laya.Tween.to(n,{y:s.y+200+l[0].y},1e3),Laya.timer.once(2e3,this.ins,()=>{if(n.removeSelf(),this.ins.gameState==rt.START)for(let s=0;s<a.length;s++){const l=this.open(_.battle.EnemySkill1,this.skill1Pre);let o=l.getComponent(Ut);o||(o=l.addComponent(Ut)),o.setData(t||i.att,0,0,0,0);const h=l.getComponent(It);let r,c;if(h.speed=e||i.bulletsp,h.norV3=a[s],s<=5){let t=25*a[0].x,e=25*a[0].y;r=t+=10*(s-0),c=e-=10*(s-0)}else if(s>5&&s<=11){let t=25*a[6].x,e=25*a[6].y;r=t+=10*(s-6),c=e+=5*(s-6)}else if(s>11&&s<=17){let t=25*a[12].x,e=25*a[12].y;r=t-=5*(s-12),c=e+=10*(s-12)}else if(s>17&&s<=23){let t=25*a[18].x,e=25*a[18].y;r=t-=10*(s-18),c=e-=2*(s-18)}else if(s>23&&s<=29){let t=25*a[24].x,e=25*a[24].y;r=t-=5*(s-24),c=e-=10*(s-24)}l.pos(n.x+r,n.y+c),h.state=rt.START,this.ins.eneBulNode.addChild(l)}})}skill10(t,e){const s=this.owner,i=this.enemyCom.edata,a=[[-110,100],[-60,115],[0,130],[60,115],[110,100]],l=[.65,.8,1,.8,.65],n=i.atttime||1,o=ft[i.type].b1;for(let h=0;h<n;h++)for(let n=0;n<a.length;n++){const r=this.open(_.battle.EnemySkill10,this.skill10Pre);let c=r.getComponent(Ut);c||(c=r.addComponent(Ut)),c.setData(t||i.att,0,0,0,0);const d=r.getComponent(It);d.norV3=this.getVec3(0,1),d.state=rt.READY,d.speed=e||i.bulletsp,r.alpha=l[n],r.scale(l[n],l[n]),r.pos(s.x+a[n][0]+o[0].x,s.y+o[0].y+50*h),this.ins.eneBulNode.addChild(r),Laya.Tween.to(r,{y:s.y+a[n][1]+50*h+o[0].y},200,null,Laya.Handler.create(this,()=>{this.ins.playerV2;Laya.timer.once(1e3,this.ins,()=>{let t=this.getVec3(),e=this.ins.playerV2;Laya.Vector3.subtract(this.getVec3(e.x,e.y),this.getVec3(r.x,r.y),t),Laya.Vector3.normalize(t,d.norV3),d.state=rt.START})}))}}skill11(t,e){const s=this.owner,i=this.enemyCom.edata,a=[this.getVec3(.87,-.5),this.getVec3(-.5,-.87),this.getVec3(-.87,.5),this.getVec3(.5,.87)],l=[-150,150],n=ft[i.type].b1;for(let o=0;o<l.length;o++){const h=this.open(_.battle.EnemySkill11,this.skill11Pre);h.pos(s.x+n[0].x,s.y+n[0].y),this.ins.eneBulNode.addChild(h),Laya.Tween.to(h,{x:s.x+l[o]+n[0].x,y:s.y+200+n[0].y},1e3),Laya.timer.once(6e3,this.ins,()=>{h.removeSelf()}),Laya.timer.once(2e3,this.ins,()=>{let s=0;this.schedule(250,()=>{if(this.ins.gameState!=rt.START)return;const l=this.open(_.battle.EnemySkill1,this.skill1Pre);let n=l.getComponent(Ut);n||(n=l.addComponent(Ut)),n.setData(t||i.att,0,0,0,0);const r=l.getComponent(It);r.speed=e||i.bulletsp,r.norV3=a[s].clone(),o&&(r.norV3.x*=-1),l.pos(h.x,h.y),r.state=rt.START,this.ins.eneBulNode.addChild(l),++s>=a.length&&(s=0)},this,12)})}}skill12(t){if(t!=this.enemyCom.eid)return;const e=this.owner,s=this.enemyCom.edata,i=this.enemyCom.norV3;let a=Math.atan2(-i.y,i.x);for(let t=0;t<2;t++){const i=this.open(_.battle.EnemySkill13,this.skill13Pre);let l=i.getComponent(Ut);l||(l=i.addComponent(Ut)),l.setData(s.att,0,0,0,0);let n=a+(t?Math.PI/2:-Math.PI/2),o=e.x+100*Math.cos(n),h=e.y-100*Math.sin(n);i.pos(o,h),this.ins.eneBulNode.addChild(i)}}skill14(t,e){const s=this.owner,i=this.enemyCom.edata,a=[-25,25],l=[this.getVec2(-25,100),this.getVec2(25,100)],n=[];for(let t=0;t<2;t++){const e=this.open(_.battle.EnemyLine,this.skillLinePre),i=e.getComponent(Rt);i.dex=l[t],i.tar=s,e.pos(s.x+a[t],s.y),this.ins.bgTopNode.addChild(e),n.push(e),this.lines.push(e)}Laya.timer.once(1e3,this,()=>{for(let t=0;t<n.length;t++){const e=n[t];e.removeSelf(),this.lines.splice(this.lines.indexOf(e),1)}if(this.ins.gameState!=rt.START)return;let e=500,o=0;const h=()=>{for(let e=0;e<a.length;e++){const n=this.open(_.battle.EnemySkill1,this.skill1Pre);let o=n.getComponent(Ut);o||(o=n.addComponent(Ut)),o.setData(t||i.att,0,0,0,0);const h=n.getComponent(It);h.norV3=this.getVec3(0,1);let r=this.getVec3(),c=this.getVec3();const d=this.ins.playerV2,p=-s.rotation/180*Math.PI,u=l[e].x*Math.cos(p)+l[e].y*Math.sin(p),y=l[e].y*Math.cos(p)-l[e].x*Math.sin(p);n.pos(s.x+u,s.y+y),Laya.Vector3.subtract(this.getVec3(d.x+a[e],d.y),this.getVec3(n.x,n.y),r),Laya.Vector3.normalize(r,c),h.norV3=c,h.state=rt.START,this.ins.eneBulNode.addChild(n)}e>100&&(e-=50),e<=100&&o++,o>15?Laya.timer.clear(this,h):Laya.timer.once(e,this,h)};h()})}skill15(t,e){const s=this.owner,i=this.ins,a=this.enemyCom.edata,l=[[-40,-10],[40,-10],[-40,55],[40,55]],n=[135,45,-135,-45];this.schedule(100,()=>{if(this.ins.gameState!=rt.START)return;if(this.getRes(V.E_Hxb))for(let o=0;o<l.length;o++){const h=this.open(_.battle.EnemySkill15,this.skill15Pre);let r=h.getComponent(Ut);r||(r=h.addComponent(Ut)),r.setData(t||a.att,0,0,0,0);const c=h.getComponent(Ot);c.trail=V.E_Hxb,c.xv=Math.abs(n[o])>90?-1:1;let d=Math.tan(n[o]/180*Math.PI),p=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,-d,0),p),p.x*=c.xv,c.norV3=p,c.angle=n[o],c.tar=this.getVec2(i.playerV2.x,i.playerV2.y),c.speed=e||a.bulletsp,h.pos(s.x+l[o][0],s.y+l[o][1]),this.ins.eneBulNode.addChild(h)}else Y.load3D([V.E_Hxb])},this,3)}skill16(t,e){const s=this.owner,i=this.ins,a=this.enemyCom.edata,l=ft[a.type].b1;if(this.ins.gameState==rt.START)for(let n=0;n<1;n++){const n=this.open(_.battle.EnemySkill16,this.skill16Pre);let o=n.getComponent(Ut);o||(o=n.addComponent(Ut)),o.setData(t||a.att,0,0,0,0);const h=n.getComponent(Mt);h.tar=s,h.norV3=this.getVec3(0,1);let r=this.getVec3();h.speed=e||a.bulletsp,n.pos(s.x+l[0].x,s.y+l[0].y),Laya.Vector3.subtract(this.getVec3(i.playerV2.x,i.playerV2.y),this.getVec3(n.x,n.y),r),Laya.Vector3.normalize(r,h.norV3),this.ins.eneBulNode.addChild(n)}}skill17(t){if(!t)return;const e=this.owner,s=this.enemyCom.edata,i=ft[s.type].b1;for(let t=0;t<1;t++){const t=this.open(_.battle.EnemySkill10,this.skill10Pre);let a=t.getComponent(Ut);a||(a=t.addComponent(Ut)),a.setData(s.att,0,0,0,0);const l=t.getComponent(It);t.pos(e.x+i[0].x,e.y+i[0].y),l.norV3=this.getVec3(0,1);let n=this.getVec3(),o=this.ins.playerV2;Laya.Vector3.subtract(this.getVec3(o.x,o.y),this.getVec3(t.x,t.y),n),Laya.Vector3.normalize(n,l.norV3),l.state=rt.START,l.speed=s.bulletsp,this.ins.eneBulNode.addChild(t)}}skill18(t,e){const s=this.owner,i=this.enemyCom.edata,a=[-10,10],l=[1,-1,-1,1],n=i.atttime||1;let o=null,h=0;const r=ft[i.type].b1;this.schedule(300,()=>{if(this.getRes(V.E_DaoDan)){o||(o=this.getVec3(s.x,s.y));for(let s=0;s<a.length;s++){const n=this.open(_.battle.EnemySkill18,this.skill18Pre);let c=n.getComponent(Ut);c||(c=n.addComponent(Ut)),c.setData(t||i.att,0,0,0,0);const d=n.getComponent(Ht);d.speed=e||i.bulletsp,d.xv=l[h],d.pangle=-Math.PI/2,d.tar=null,n.pos(o.x+a[s]+r[0].x,o.y+r[0].y),this.ins.eneBulNode.addChild(n),++h>=l.length&&(h=0)}}else Y.load3D([V.E_DaoDan])},this,2*n)}}var jt;!function(t){t[t.Move=0]="Move",t[t.Pause=1]="Pause",t[t.End=2]="End"}(jt||(jt={}));class Gt extends Q{constructor(){super(),this.ins=null,this.timer=0,this._norV3=null,this.btimer=0,this.start=null,this.end=null,this.pt=null,this.bspeed=.02,this.endMsg=!1,this.endMsg2=!1,this.going=!0,this.moveTime=0,this.pauseTime=0,this.pauseMsg=!1,this.eskillCom=null,this.randed=!1,this.randnm=0,this.randty=0,this.randpy=0,this.ske=null,this.eid=null,this.hpBar=null,this.barNums=3,this.state=rt.START,this.moveState=jt.Move,this.edata=null,this.isRotate=!1,this.isRotSelf=!1,this.isRotSelf2=!1,this.startAng=0,this.isPauseSelf=!1,Gt.__eid__++,this.eid=Gt.__eid__}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&this.isRotSelf&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){if(this.ins=ee.instance,this.state=rt.START,this.moveState=jt.Move,this.timer=0,this.btimer=0,this.moveTime=0,this.pauseTime=0,this.pauseMsg=!1,this.endMsg=!1,this.endMsg2=!1,this.going=!0,this.barNums=3,this.isRotSelf2=!1,this.ske&&(this.ske.filters=[new Laya.ColorFilter]),!this.edata)return;this.eskillCom=this.owner.getComponent(Ft);const t=this.edata,e=this.owner;e.rotation=0,this.hpBar=e.getChildByName("hpBar"),1017==t.type&&(this.state=rt.PAUSE,Laya.timer.once(2e3,this,()=>{this.state=rt.START}));const s=T.enemys[t.type];if(s.skill){const t=s.skill;12==t&&(this.isRotSelf=!0,this.isPauseSelf=!0),17==t&&(this.isRotSelf=!0)}this.start=t.in.clone(),t.direntry==x.Top?this.start.y-=e.height:t.direntry==x.Left?this.start.x-=e.width:t.direntry==x.Right?this.start.x+=e.width:t.direntry==x.Bottom&&(this.start.y+=e.height);const i=this.start;if(e.pos(i.x,i.y),t.out){this.end=t.out.clone(),t.return!=P.Repeat&&t.return!=P.Remove||(t.direxit==x.Top?this.end.y-=e.height:t.direxit==x.Left?this.end.x-=e.width:t.direxit==x.Right?this.end.x+=e.width:t.direxit==x.Bottom&&(this.end.y+=e.height));const s=this.end;if(t.route==D.Line){let t=this.getVec3(),e=this.getVec3();Laya.Vector3.subtract(this.getVec3(s.x,s.y),this.getVec3(i.x,i.y),t),Laya.Vector3.normalize(t,e),this.norV3=e}else if(t.route==D.DownCurve){let t=this.getVec2(s.x-i.x,s.y-i.y),e=this.getVec2(i.x+t.x/2,i.y+t.y/2),a=this.getVec2(-t.y,t.x);t.x<0&&(a=this.getVec2(t.y,-t.x));let l=this.getVec2(e.x+a.x/4,e.y+a.y/4),n=2*l.x-(i.x+s.x)/2,o=2*l.y-(i.y+s.y)/2,h=this.getVec2(n,o);this.pt=h}else if(t.route==D.UpCurve){let t=this.getVec2(s.x-i.x,s.y-i.y),e=this.getVec2(i.x+t.x/2,i.y+t.y/2),a=this.getVec2(t.y,-t.x);t.x<0&&(a=this.getVec2(-t.y,t.x));let l=this.getVec2(e.x+a.x/4,e.y+a.y/4),n=2*l.x-(i.x+s.x)/2,o=2*l.y-(i.y+s.y)/2,h=this.getVec2(n,o);this.pt=h}}else{let e="number"==typeof t.disx&&t.disx?t.disx:0;this.end=this.getVec2(t.in.x+e,t.in.y+t.distance);let s=this.end,a=this.getVec3(),l=this.getVec3();Laya.Vector3.subtract(this.getVec3(s.x,s.y),this.getVec3(i.x,i.y),a),Laya.Vector3.normalize(a,l),this.norV3=l}let a=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.end.x,this.end.y),this.getVec3(i.x,i.y),a);let l=Math.sqrt(a.x*a.x+a.y*a.y);if(this.bspeed=300/l*.02*(t.speed||1),this.randed=!1,this.randty=0,this.randty=0,this.randnm=0,t.type>2e3&&t.type<3e3&&this.isThreeBar(),"number"==typeof t.inflect&&t.inflect){this.isRotSelf2=!0,e.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180);let t=e.rotation;t%=360,Math.abs(t)>180&&(t<0?t=360+t:t-=360),this.startAng=t}}isThreeBar(t){const e=["battle/main/bar/xue_max.png","battle/main/bar/xue_max1.png","battle/main/bar/xue_max2.png"];if(null==t)this.hpBar.skin=e[0];else{const s=this.edata.hp;let i=0;t>s/3*1&&t<=s/3*2?(3==this.barNums&&(this.barNums--,this.hpBar.value=1),i=1):t<=s/3&&(2==this.barNums&&(this.barNums--,this.hpBar.value=1),i=2),this.hpBar.skin=e[i]}}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),this.recover(this.owner)}bezier(t,e,s,i,a){a?(t.x=(1-e)*(1-e)*s.x+2*e*(1-e)*a.x+e*e*i.x,t.y=(1-e)*(1-e)*s.y+2*e*(1-e)*a.y+e*e*i.y):(t.x=s.x+(i.x-s.x)*e,t.y=s.y+(i.y-s.y)*e)}easeOutQuart(t){return-((t-=1)*t*t*t-1)}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;if(!this.edata)return;const t=this.owner,e=this.edata;let s=Laya.timer.delta;if(this.moveState==jt.Move){if(this.btimer>=.2&&(this.endMsg2||(this.endMsg2=!0,r.event(dt.EnemyEnd))),this.btimer>=1){if(this.endMsg||(this.endMsg=!0,this.eskillCom&&1026!=e.type&&(e.type<2e3||e.type>3e3)&&this.eskillCom.initSkill(),this.edata.return==P.Remove&&(r.event(dt.EnemyDead,[t.getComponent(kt),!0]),t.removeSelf())),"number"==typeof e.return){const t=e.return;if(t==P.Return){const t=this.start.clone();this.start=this.end.clone(),this.end=t,this.norV3&&(this.norV3=this.getVec3(-this.norV3.x,-this.norV3.y)),this.going&&r.event(dt.EnemyReturn,this.going),this.going=!this.going}else P.Repeat;this.btimer=0}else this.moveState=jt.End;return}if(this.moveTime>=1e3)return this.moveState=jt.Pause,void(this.moveTime=0);const i=this.start,a=this.end;if(e.route==D.Line){let l=this.bspeed;this.going||(l*=2),this.btimer+=l;let n=this.btimer;"null"===e.return&&(n=this.easeOutQuart(n)),t.x=i.x+(a.x-i.x)*n,t.y=i.y+(a.y-i.y)*n,this.isPauseSelf&&(this.moveTime+=s),this.isRotSelf2&&(t.rotation=this.startAng+(0-this.startAng)*n)}else this.btimer+=this.bspeed,this.bezier(t,this.btimer,this.start,this.end,this.pt),this.isRotSelf2&&(t.rotation=this.startAng+(0-this.startAng)*this.btimer)}if(this.moveState==jt.Pause){if(this.pauseTime>=500)return this.moveState=jt.Move,this.pauseTime=0,void(this.pauseMsg=!1);this.pauseMsg||(this.pauseMsg=!0,r.event(dt.EnemyPause,this.eid)),this.pauseTime+=s}if(this.moveState==jt.End){this.timer+=Laya.timer.delta/1e3;let s=Math.cos(this.timer);if(Math.abs(s)>=.999){if(!this.randed)if(this.randed=!0,this.randnm>=0){let t=[-1,0,1],e=d.getRandom(2,0);this.randty=t[e],this.randpy=d.getRandom(4,2)/10,this.randnm=0}else this.randnm++}else this.randed=!1;2003!=e.type&&(t.x+=s);const i=2003==e.type?5:1;t.y+=s*this.randpy*this.randty*i}if(this.isRotate){let e=this.ins.playerV2,i=t.x-e.x,a=t.y-e.y,l=Math.atan2(i,-a)/Math.PI*180,n=this.getVec3();Laya.Vector3.lerp(this.getVec3(t.rotation),this.getVec3(l),s/500,n),t.rotation=n.x}}}Gt.__eid__=0;class Wt extends Q{constructor(){super(),this.delta=250}onEnable(){const t=this.owner.__$type$__;let e={1001:1,1002:1,1003:1,1004:1,1005:1,1006:1,1007:1,1008:1,1009:1,1010:1,1011:1,1012:1,1013:1,1014:1,1015:1,1016:1,2001:10,2002:10,2003:10,3001:1,3002:1,hit:1.2}[t]||1;const s=this.owner.getChildByName("boom");s.scale(e,e),s.blendMode=Laya.BlendMode.LIGHTER,s.on(Laya.Event.STOPPED,this,()=>{this.owner.removeSelf()}),s.templet?(s.playbackRate(1),t>2e3&&t<3e3&&s.playbackRate(.3),s.play(0,!1)):Laya.timer.once(this.delta,this,()=>{this.owner.removeSelf()})}onDisable(){const t=this.owner.getChildByName("boom");t.offAllCaller(this),t.stop(),Laya.timer.clearAll(this),this.recover(this.owner)}}class Kt extends Q{constructor(){super(),this.ins=null,this.move=!1,this.cspeed=0,this.nsub=null}onEnable(){this.ins=ee.instance;const t=this.owner.getChildAt(0).meshRenderer.material;t.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,t.albedoColorA=1,this.cspeed=0}onDisable(){}startMove(t){const e=this.owner,s=(this.getVec3(),this.getVec3());Laya.Vector3.subtract(t,e.transform.position,s),this.nsub=this.getVec3(s.x/2,s.y/2,s.z/1),this.move=!0,Laya.Tween.to(this.nsub,{x:0,y:0,z:.04},300,Laya.Ease.circOut,Laya.Handler.create(this,()=>{}))}moveCoin(){const t=this.owner,e=this.ins.playerPosV3,s=(_t.insUI,t.getChildAt(0).meshRenderer.material);s.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,s.albedoColorA=1,Laya.timer.once(200,this,()=>{Laya.Tween.to(s,{albedoColorA:0},200)}),Laya.Tween.to(t.transform,{localPositionX:e.x,localPositionY:e.y,localPositionZ:e.z},400,null,Laya.Handler.create(this,()=>{r.event(dt.CoinInPlayer,"coin"),t.removeSelf()}))}onUpdate(){const t=this.ins;if(t.gameState!=rt.START)return;const e=this.owner;e.transform.rotate(this.getVec3(0,.08,0)),this.move&&(e.transform.position.z>=t.playerPosV3.z&&(this.move=!1,this.moveCoin()),e.transform.translate(this.nsub,!1),Math.abs(e.transform.position.z-t.playerPosV3.z)<=3&&(this.move=!1,this.moveCoin()))}}class Yt extends Q{constructor(){super(),this.xp=null,this.yp=null}onEnable(){const t=this.owner;t.blendMode=Laya.BlendMode.LIGHTER,Laya.timer.once(100,this,()=>{t.templet&&t.play(1,!0)})}onDisable(){this.xp=null,this.yp=null,this.recover(this.owner)}onLateUpdate(){if(this.xp&&this.yp){const t=this.owner;t.x=this.xp.x,t.y=this.yp.y}}}class zt extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=rt.READY,this.tar=null,this.speed=1.5,this.cross=!1,this.addSpeed=1,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),r.on(dt.BulSkill1_Start,this,()=>{this.state=rt.START});const t=this.ins,e=this.owner;if(e.__type__){const s=new Laya.Sprite3D,i=this.getRes(V.FuYouPao),a=Laya.Sprite3D.instantiate(i);s.addChild(a),t.modSceneV3.getChildByName("trails").addChild(s);let l=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),l),s.transform.position=l,this.s3d=s;let n=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x+150*this.norV3.x,e.y+150*this.norV3.y),n),Laya.Tween.to(s.transform,{localPositionX:n.x,localPositionZ:n.z},100),"fyp"==e.__type__&&Laya.timer.loop(50,this,()=>{a&&a.transform&&Laya.Tween.to(a.transform,{localPositionX:.05},25,null,Laya.Handler.create(this,()=>{a&&a.transform&&Laya.Tween.to(a.transform,{localPositionX:-.05},25)}))})}}onDisable(){this.s3d&&Laya.timer.once(200,this,()=>{this.s3d.removeSelf(),this.recover(this.owner)}),this.s3d=null,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this)}onCollisionEnter(t,e){this.cross||this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed*this.addSpeed,s=this.ins.ratio3D;if(this.tar&&!this.tar.parent&&(this.tar=null),this.tar&&this.tar.parent)if(t.y<=this.tar.y||this.tar.x<=0||this.tar.x>=720||this.tar.y<=0||this.tar.y>=1280)this.tar=null;else{let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d&&this.s3d.transform.translate(this.getVec3(this.norV3.x/s*e,0,this.norV3.y/s*e)),(t.x<=-360||t.x>=1080||t.y<=-640||t.y>=1920)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class Xt extends Q{constructor(){super(),this.ins=null,this.enemyCom=null,this.eskillCom=null,this.skePath="",this.skeCon=null,this.templet=null,this.ske=null,this.skn=null,this.spec=!1}onEnable(){if(this.ins=ee.instance,this.skn=null,this.spec=!1,this.enemyCom=this.owner.getComponent(Gt),this.eskillCom=this.owner.getComponent(Ft),!this.enemyCom||!this.enemyCom.edata)return;const t=this.enemyCom.edata,e=new Laya.Templet;this.templet=e,e.on(Laya.Event.COMPLETE,this,this.parseComplete),e.loadAni(R[this.skePath]),r.on(dt.EnemyHit,this,(e,s,i,a)=>{if(s!=this.enemyCom.eid)return;if(e!=t.type)return;this.skn=a,this.spec=!1;let l=0;7==i&&(l=1500,this.spec=!0),14==i&&(l=1e3,this.spec=!0),this.ske&&(this.spec&&a(),Laya.timer.once(l,this,()=>{this.ske.play(0,!1)}))})}onDisable(){this.ske&&(this.ske.offAllCaller(this),this.ske.stop(),this.ske.removeSelf()),this.templet&&(this.templet.offAllCaller(this),this.templet.destroy())}parseComplete(){this.ske=this.templet.buildArmature(0);const t=this.ske,e=ft[this.skePath];t.pos(e.self.x,e.self.y),t.on(Laya.Event.LABEL,this,this.onEvent),t.on(Laya.Event.STOPPED,this,this.completeHandler),t.play(1,!0),t.filters=[new Laya.ColorFilter],this.skeCon.addChild(t)}completeHandler(){this.ske.play(1,!0)}onEvent(t){this.ins.gameState==rt.START&&!this.spec&&this.skn&&this.skn()}onUpdate(){}}class $t extends Q{constructor(){super(),this.ins=null,this.enemyCom=null,this.eskillCom=null,this.ske=null,this.skn=null,this.spec=!1,this.inited=!1}onEnable(){if(this.ins=ee.instance,this.skn=null,this.spec=!1,this.inited=!1,this.enemyCom=this.owner.getComponent(Gt),this.eskillCom=this.owner.getComponent(Ft),!this.enemyCom||!this.enemyCom.edata)return;const t=this.enemyCom.edata;this.ske.on(Laya.Event.LABEL,this,this.onEvent),this.ske.on(Laya.Event.STOPPED,this,this.completeHandler),r.on(dt.EnemyHit,this,(e,s,i,a)=>{if(s!=this.enemyCom.eid)return;if(e!=t.type)return;this.skn=a,this.spec=!1;let l=0;7==i&&(l=1500,this.spec=!0),14==i&&(l=1e3,this.spec=!0),this.ske&&this.ske.templet&&(this.spec&&a(),Laya.timer.once(l,this,()=>{this.ske.play(0,!1)}))}),this.ske.filters=[new Laya.ColorFilter]}onDisable(){this.ske&&(this.ske.offAllCaller(this),this.ske.stop())}parseComplete(){this.ske&&this.ske.templet&&this.ske.play(1,!0)}completeHandler(){this.ske&&this.ske.templet&&this.ske.play(1,!0)}onEvent(t){this.ins.gameState==rt.START&&!this.spec&&this.skn&&this.skn()}onUpdate(){const t=this.ske;!this.inited&&t&&t.templet&&(this.inited=!0,this.parseComplete())}}class Zt extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.enemyCom=null,this.buffNode=null,this.buff2Node=null,this.buff3Node=null,this.boomPre=null,this.boomPre2=null,this.hits={},this.hiting=!1,this.e1002=null,this.hitnum=0,this.add=!0,this.invincible=!1,this.hpBar=null,this.barPor=1,this.hp=0,this.timers={},this.boomPre=this.getRes(_.battle.EnemyBoom),this.boomPre2=this.getRes(_.battle.EnemyBoom2)}onEnable(){this.ins=ee.instance;const t=this.owner;this.hpBar=t.getChildByName("hpBar"),this.selfCol=this.owner.getComponent(kt),this.enemyCom=this.owner.getComponent(Gt),this.hp=this.enemyCom.edata.hp,this.hpBar.value=1,this.hpBar.visible=!1,this.barPor=1,this.hits={},this.hiting=!1,this.hitnum=0,this.add=!0,this.e1002=this.owner.getComponent(Xt),this.e1002||(this.e1002=this.owner.getComponent($t)),this.e1002||(this.e1002=this.owner.getComponent(Gt)),r.on(dt.LaserHide,this,t=>{let e=this.selfCol.bids.indexOf(t.bid);e>-1&&(this.selfCol.bids.splice(e,1),this.onCollisionExit(t,this.selfCol))}),r.on(dt.GameStateChange,this,()=>{if(this.ins.gameState==rt.PAUSE)for(const t in this.timers){const e=this.timers[t];e&&e.hit&&e.hit.removeSelf()}}),Laya.timer.once(1e4,this,()=>{this.invincible=!1})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this),this.buffNode&&this.buffNode.removeSelf(),this.buffNode=null,this.buff2Node&&this.buff2Node.removeSelf(),this.buff2Node=null,this.buff3Node&&this.buff3Node.removeSelf(),this.buff3Node=null;for(const t in this.timers){const e=this.timers[t];e&&e.timer&&clearInterval(e.timer),e&&e.hit&&e.hit.removeSelf()}this.timers={}}onUpdate(){if(this.hiting){const t=this.e1002;if(t){const e=t.ske;if(e){const t=e.filters[0];if(this.add)t.adjustBrightness(10),this.hitnum+=10;else if(t.adjustBrightness(-10),this.hitnum-=10,this.hitnum<=0)return this.hiting=!1,this.hitnum=0,void(this.add=!0);this.hitnum>=50&&this.add&&(this.add=!1),this.hitnum<=0&&!this.add&&(this.add=!0)}}}}onCollision(t,e,s){const i=this.ins.playerData,a=this.enemyCom.edata;if(this.ins.gameState!=rt.START)return;const l=this.owner;if(!l||!l.parent)return void this.onDisable();if(l.x<=-10||l.x>=730||l.y<=-10||l.y>=1290)return;if(!e||!e.owner||!e.owner.getComponent(Ut))return;const n=e.owner.getComponent(Ut).data,o=this.ins.playerData.skills;let h=!1;if(o[ut.Cri]&&a.type<2e3){let t=100*A.skills[ut.Cri].value||0;d.getRandom(100,1)<=t&&(h=!0,this.hp=0)}let c=n.attack,p=!1;const u=i.crit;d.getRandom(100,1)<=u&&(c*=i.critHurt,p=!0),(c=Math.floor(c))<=0&&(c=1),this.hiting||(this.hiting=!0),s&&this.makeBoom("hit",e.owner);const y=e.owner.__bulType__;if(!this.invincible&&(!y||y&&!this.hits[y])){this.hp-=c,y&&!this.hits[y]&&(this.hits[y]=1,Laya.timer.once(100,this,()=>{this.hits[y]=0}));let e=this.hp>=0?this.hp:0;if(a.type>2e3&&a.type<3e3){this.enemyCom.isThreeBar(this.hp);let t=this.enemyCom.edata.hp/3,s=e-(this.enemyCom.barNums-1)*t;this.barPor=s/t}else this.barPor=e/this.enemyCom.edata.hp;const s=this.hpBar.value,i=this.getRes(_.battle.HpBarLight),l=this.open(_.battle.HpBarLight,i),n=275,o=22+275*this.barPor,r=44+s*n-o;l.width=r<44?44:r,l.x=o,this.hpBar.addChild(l),this.hpBar.visible||1017==a.type||(this.hpBar.visible=!0);const u=this.open(_.battle.EnemyHPTip,this.ins.eneHPTipPre);h?(u.__color__=h,u.text="Seckill"):(u.__color__=p,u.text=`-${d.formatNumber(Math.floor(c))}`),u.pos(t.x,this.owner.y),this.ins.effectNode.addChild(u)}if(this.hp<=0){1019==a.type&&this.makeSmete(),this.onDisable(),this.owner.removeSelf();const t=T.enemys[a.type].shock;if(t&&1==t&&(this.shakeEffect(this.ins.owner),this.shakeEffect(this.ins.bgSceneV2)),r.event(dt.EnemyDead,this.selfCol),this.makeBoom(this.enemyCom.edata.type),this.makeCoin(),o[ut.DieBoom]&&this.makeDieBoom(),o[ut.DieShot]&&this.makeDieShot(),this.ins.suckBlood){let t=a.hp*this.ins.suckBlood;i.currHP+t<i.hp?i.currHP+=t:i.currHP=i.hp,r.event(dt.PlayerHP)}if(o[ut.SuckBlood]){let t=100*A.skills[ut.SuckBlood].value||0,e=a.hp*t;i.currHP+e<i.hp?i.currHP+=e:i.currHP=i.hp,r.event(dt.PlayerHP)}if(this.ins.isEndless){const t=[1002,1003,1014,1015,1018,1019],e=[1004,1005,1006,1007,1008,1009,1010,1011,1016,1017,1020,1021,1022,1024,1026,1028,1029],s=[1012,1013,1023,1025,1027],l=[2001,2002,2003];let n=0;[1001,3001].indexOf(a.type)>-1?n=1:l.indexOf(a.type)>-1?n=150:s.indexOf(a.type)>-1?n=50:e.indexOf(a.type)>-1?n=30:t.indexOf(a.type)>-1&&(n=15),i.score+=n,r.event(dt.EndlessScore)}}}makeBoom(t,e){const s=e?this.boomPre:this.boomPre2,i=e?_.battle.EnemyBoom:_.battle.EnemyBoom2,a=this.open(i,s);a.__$type$__=t;let l=this.owner;if(e)a.x=e.x,a.y=e.y,a.getComponent(Wt).delta=250,this.ins.effectNode.addChild(a);else{a.x=l.x,a.y=l.y,Zt.booming||(Zt.booming=!0,Laya.SoundManager.playSound(O.BattleBoom1Sou),setTimeout(()=>{Zt.booming=!1},300));const t=this.getRes(_.battle.EnemyWave),e=this.open(_.battle.EnemyWave,t);e.pos(l.x,l.y),this.ins.bgTopNode.addChild(a),this.ins.effectNode.addChild(e)}}makeCoin(t){const e=this.ins,s=this.enemyCom.edata,i=T.enemys[s.type],a=e.modSceneV3.getChildByName("coins"),l=this.owner,n=this.getRes(V.Coin);let o=i.dropgold||1;const h=[];let r=l.width/2;r>250&&(r=100);let c=Math.PI/180*Math.round(360/o);if(1==o){const t=Math.random(),e=Math.random();c=Math.PI/180*d.getRandom(135,45);let s=l.x+r*Math.cos(c)*t,i=l.y-r*Math.sin(c)*e;h.push(this.getVec3(s,i))}else if(2==o)for(let t=0;t<2;t++){const e=Math.random(),s=Math.random();c=Math.PI/180*(t?135:45);let i=l.x+r*Math.cos(c)*e,a=l.y-r*Math.sin(c)*s;h.push(this.getVec3(i,a))}else for(let t=0;t<o;t++){const e=Math.random()*r,s=Math.random()*r;let i=l.x+Math.cos(c*t)*e,a=l.y-Math.sin(c*t)*s;h.push(this.getVec3(i,a))}for(let t=0;t<o;t++){const s=Laya.Sprite3D.instantiate(n);let i=this.getVec3(),o=this.getVec3();e.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(h[t].x,h[t].y),i),e.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(l.x,l.y),o),s.transform.position=o,s.transform.localScale=this.getVec3(9,9,15),s.transform.rotationEuler=this.getVec3(-90,0,0),s.addComponent(Kt);const r=s.getComponent(Kt);a.addChild(s),r.startMove(i),_t.insUI.coinNum++}}makeDieBoom(){const t=this.ins.playerData,e=this.getRes(_.battle.PlayerDieBoom),s=this.open(_.battle.PlayerDieBoom,e),i=this.owner;s.x=i.x,s.y=i.y;let a=s.getComponent(Ut);a||(a=s.addComponent(Ut));const l=A.skills[ut.DieBoom].value||1;a.setData(Math.floor(t.attack*l),t.crit,t.critHurt,t.eneHurtStr,t.bosHurtStr),this.ins.effectNode.addChild(s)}makeSmete(){const t=this.owner,e=this.enemyCom.edata,s=[];let i=d.getRandom(90,30),a=-d.getRandom(90,30),l=d.getRandom(60,0)-30,n=l+10;const o=(t,e)=>{let s=Math.tan(t/180*Math.PI),i=new Laya.Vector3(0,0,0);return Laya.Vector3.normalize(new Laya.Vector3(1,-s,0),i),e&&(i.x*=-1),i};let h=o(i),r=o(a),c=o(l),p=o(n);s.push(h,r,c,p,o(i,!0),o(a,!0),o(l,!0),o(n,!0));const u=this.getRes(_.battle.EnemySmete);for(let i=0;i<8;i++){const a=this.open(_.battle.EnemySmete,u),l=a.getComponent(It);let n=a.getComponent(Ut);n||(n=a.addComponent(Ut)),n.setData(e.att||1,0,0,0,0),l.speed=e.bulletsp||1.2,l.norV3=s[i].clone(),l.state=rt.START,a.pos(t.x,t.y),this.ins.eneBulNode.addChild(a)}}makeDieShot(){const t=this.owner,e=this.ins.playerData,s=[this.getVec3(0,-1),this.getVec3(.71,-.71),this.getVec3(1,0),this.getVec3(.71,.71),this.getVec3(0,1),this.getVec3(-.71,.71),this.getVec3(-1,0),this.getVec3(-.71,-.71)],i=this.getRes(_.battle.PlayerDieShot),a=A.skills[ut.DieShot];for(let l=0;l<8;l++){const n=this.open(_.battle.PlayerDieShot,i),o=n.getComponent(zt);let h=n.getComponent(Ut);h||(h=n.addComponent(Ut));const r=A.skills[ut.DieShot].value||1;h.setData(Math.floor(e.attack*r),e.crit,e.critHurt,e.eneHurtStr,e.bosHurtStr),o.speed=a.fspeed,o.norV3=s[l].clone(),o.state=rt.START,o.tar=null,n.pos(t.x,t.y),this.ins.playerNode.addChild(n)}}onCollisionEnter(t,e,s){if(!(t.owner&&t.owner.parent&&e.owner&&e.owner.parent))return;let i=t.owner;const a=this.owner;let l=t.owner.__type__,n=!0;if((s||l&&l==ct.MAGNET)&&(i=e.owner,n=!1),l&&(l==ct.POISON||l==ct.FIRE)){if(n=!1,this.schedule(1e3,()=>{this.onCollision(e.owner,t)},this,4,null,!0),l==ct.POISON&&!this.buffNode){const t=_.battle.PlayerPoisonBuff,e=this.getRes(t),s=this.open(t,e),i=a.getChildAt(0);s.pos(i.x,i.y),this.owner.addChild(s),this.buffNode=s,Laya.timer.once(4e3,this,()=>{s.removeSelf(),this.buffNode=null})}if(l==ct.FIRE&&!this.buff2Node){const t=_.battle.PlayerFireBuff,e=this.getRes(t),s=this.open(t,e),i=a.getChildAt(0);s.pos(i.x,i.y),this.owner.addChild(s),this.buff2Node=s,Laya.timer.once(4e3,this,()=>{s.removeSelf(),this.buff2Node=null})}}if(l&&l==ct.ICE&&(n=!1,this.enemyCom.state=rt.PAUSE,!this.buff3Node)){const t=_.battle.PlayerIceBuff,e=this.getRes(t),s=this.open(t,e),i=a.getChildAt(0);s.pos(i.x,i.y),this.owner.addChild(s),this.buff3Node=s,Laya.timer.once(3e3,this,()=>{s.removeSelf(),this.buff3Node=null,this.enemyCom.state=rt.START})}if(l&&l==ct.LASER&&(n=!1),this.onCollision(i,t,n),this.timers&&l&&l==ct.LASER){let e=setInterval(()=>{this.onCollision(i,t)},100);const s=()=>{if(this.ins.gameState!=rt.START)return;const e=t.owner.__spicol__;let s=_.battle.PlayerLaserHit;1==e&&(s=_.battle.PlayerLaserHit3),2==e&&(s=_.battle.PlayerLaserHit2);const a=this.getRes(s),l=this.open(s,a);l.x=i.x,l.y=this.owner.y;const n=l.getComponent(Yt);return n.xp=i,n.yp=this.owner,this.ins.effectNode.addChild(l),l},a=this.timers[t.bid];if(a)if(a.timer&&clearInterval(a.timer),this.timers[t.bid].timer=e,a.hit){const t=a.hit.getComponent(Yt);t.xp=i,t.yp=this.owner}else{const e=s();this.timers[t.bid].hit=e}else{const i=s();this.timers[t.bid]={timer:e,hit:i}}}}onCollisionExit(t,e){if(!(t.owner&&t.owner.parent&&e.owner&&e.owner.parent))return;let s=t.owner.__type__;if(s&&s==ct.LASER){if(!this.timers)return;const e=this.timers[t.bid];e&&(e.timer&&clearInterval(e.timer),e&&e.hit&&e.hit.removeSelf(),this.timers[t.bid]=null)}}onLateUpdate(){let t=this.getVec3();Laya.Vector3.lerp(this.getVec3(this.hpBar.value),this.getVec3(this.barPor),.01*Laya.timer.delta,t),this.hpBar.value=t.x}}Zt.booming=!1;class Qt extends Q{constructor(){super(),this.ins=null,this.timer=0,this.eneQue={},this.start=!1,this.insUI=null,this.enemyPres={},this.shipEnemys=[],this.currShipEnemys=[],this.bossEnemys=[],this.currBossEnemys=[],this.otherEnemys=[],this.currOtherEnemys=[],this.rewardEnemys=[],this.endlessStartAtt={},this.powRatio=0;for(const t in N){const e=N[t];this.enemyPres[t]=this.getRes(e)}}onEnable(){if(this.ins=ee.instance,this.insUI=this.ins.owner.getComponent(_t),r.on(dt.LevelEnemy,this,this.makeLevelEnemy),this.ins.isEndless){for(let t=1;t<16;t++){let e=v["enemys"+t],s=v["denemys"+t];for(const t in e){const s=e[t],i=parseInt(t);i%10==0?this.bossEnemys.push(s):i%5==0&&i%10!=0?this.rewardEnemys.push(s):i%10==3||i%10==8?this.shipEnemys.push(s):this.otherEnemys.push(s)}for(const t in s){const e=s[t],i=parseInt(t);i%10==0?this.bossEnemys.push(e):i%5==0&&i%10!=0?this.rewardEnemys.push(e):i%10==3||i%10==8?this.shipEnemys.push(e):this.otherEnemys.push(e)}}this.powRatio=1.4;const t=[[[1001],[100,50]],[[3001],[0,200]],[[1002,1003,1014,1015,1018,1019],[100,250]],[[1004,1005,1006,1007,1008,1009,1010,1011,1016,1017,1020,1021,1022,1024,1026,1028,1029],[100,550]],[[1012,1013,1023,1025,1027],[100,750]],[[2001,2002,2003],[300,8500]]];for(let e=0;e<t.length;e++){const s=t[e][0],i=t[e][1];for(let t=0;t<s.length;t++){const e=s[t];this.endlessStartAtt[e]=i.concat()}}}}onDisable(){r.offAllCaller(this)}makeLevelEnemy(){const t=this.ins,e=t.playerData,s=e.chapter,i=e.rate;t.isMakingEnemy=!0;let a=null;const l=window.__Adventure__;if(l){a=[];for(let t=0;t<l.length;t++){const e=l[t];a.push(e.edata)}}else if(t.isEndless){a=[],t.endlessNextEnemy||(t.endlessNextEnemy=t.isEndless.concat());const e=t.endlessNextEnemy[0],s=t.endlessNextEnemy[1];let i=v["enemys"+e];2==s&&(i=v["denemys"+e]);const l=i[t.endlessNextEnemy[2]];for(let t=0;t<l.length;t++){const e=l[t];a.push(Object.assign({},e))}this.setEndlessAtt(a)}else{let t=v["enemys"+s];2==S.diff&&(t=v["denemys"+s]),a=t[i]}if(a){for(let t=0;t<a.length;t++){const e=a[t];if(this.enemyPres[e.type])if(3002==e.type||3003==e.type)this.insUI.supplyData=e;else if(1001==e.type){const t=6,s=e.time;for(let i=0;i<t;i++){let t=s+.2*i;if(this.eneQue[1e3*t]){let s=.2;for(;this.eneQue[1e3*t+s];)s+=.2;this.eneQue[1e3*t+s]=e}else this.eneQue[1e3*t]=e}}else if(this.eneQue[1e3*e.time]){let t=1;for(;this.eneQue[1e3*e.time+t];)t++;this.eneQue[1e3*e.time+t]=e}else this.eneQue[1e3*e.time]=e}if(this.start=!0,this.timer=0,t.isEndless){t.endlessThisEnemy=t.endlessNextEnemy.concat();const s=e.rate+1;if(s%5==0){this.currBossEnemys.length||(this.currBossEnemys=this.bossEnemys.concat()),this.currBossEnemys.sort((t,e)=>Math.random()-.5);const e=this.currBossEnemys.shift();t.endlessNextEnemy=[e[0].chapter,e[0].difficulty,e[0].level]}else if(s>=16&&s%10==6){this.rewardEnemys.sort((t,e)=>Math.random()-.5);const e=this.rewardEnemys[0];t.endlessNextEnemy=[e[0].chapter,e[0].difficulty,e[0].level]}else if(s>=13&&(s%10==3||s%10==8)){this.currShipEnemys.length||(this.currShipEnemys=this.shipEnemys.concat()),this.currShipEnemys.sort((t,e)=>Math.random()-.5);const e=this.currShipEnemys.shift();t.endlessNextEnemy=[e[0].chapter,e[0].difficulty,e[0].level]}else{this.currOtherEnemys.length||(this.currOtherEnemys=this.otherEnemys.concat()),this.currOtherEnemys.sort((t,e)=>Math.random()-.5);const e=this.currOtherEnemys.shift();t.endlessNextEnemy=[e[0].chapter,e[0].difficulty,e[0].level]}}}}setEndlessAtt(t){const e=this.ins.playerData,s=this.powRatio||1.08;for(let i=0;i<t.length;i++){const a=t[i],l=this.endlessStartAtt[a.type]||[350,8e3],n=l[0],o=l[1];if(a.type<3e3&&a.type>2e3){const t=e.rate>135?130:e.rate-5,i=Math.floor(n*Math.pow(s,t));a.att="number"==typeof a.att?i:`${i}|${i}|${i}`,a.hp=Math.floor(o*Math.pow(s,t))}else{const t=e.rate>131?130:e.rate-1,i=Math.floor(n*Math.pow(s,t));a.att="number"==typeof a.att?i:`${i}|${i}|${i}`,a.hp=Math.floor(o*Math.pow(s,t))}}}enemy(t){const e=this.open(N[t.type],this.enemyPres[t.type]),s=e.getComponent(Gt);s.edata=t,s.isRotate=!1,s.isRotSelf=!1,s.isPauseSelf=!1,e.pos(0,-1e3),this.ins.enemyNode.addChild(e);const i=e.getComponent(kt);this.ins.enemyCols.push(i),Object.keys(this.eneQue).length||(r.event(dt.LevelEnemyEnd),this.ins.isMakingEnemy=!1)}onLateUpdate(){if(this.ins.gameState==rt.START&&this.start){this.timer+=Laya.timer.delta;for(const t in this.eneQue)if(this.timer>=parseInt(t)){const e=this.eneQue[t];delete this.eneQue[t],this.enemy(e)}Object.keys(this.eneQue).length||(this.start=!1,this.timer=0)}}}class Jt{constructor(){this.attack=0,this.crit=0,this.critHurt=0,this.speed=0,this.fspeed=0,this.eneHurtStr=0,this.bosHurtStr=0,this.planeData=null,this.hp=0,this.currHP=0,this.defense=0,this.subHurt=0,this.id=0,this.chapter=1,this.rate=1,this.exp=0,this.level=1,this.skills={},this.skills2={},this.rewards={},this.track=!1,this.cross=!1,this.unlock=[],this.supUnlock=[],this.coin=0,this.reward=0,this.score=0,this.laserSta=0,this.trackTar=null,this.trackBox=null,this.trackCol=null,this.mainNum=0,this.diff=1}init(){this.id=S.id,this.diff=S.diff,S.chapter<1&&(this.id=2),this.planeData=n.planes[this.id],this.attack=1*S.attack,this.crit=S.crit,this.critHurt=S.critHurt,this.speed=S.speed,this.fspeed=S.fspeed,this.eneHurtStr=S.eneHurtStr,this.bosHurtStr=S.bosHurtStr,this.hp=S.hp,this.currHP=1*S.hp,this.defense=S.defense,this.subHurt=S.subHurt,this.chapter=S.chapter,this.rate=S.rate,this.coin=S.coin,this.reward=S.reward,this.exp=0,this.level=1,this.skills={},this.skills2={},this.rewards={},2==this.id&&(this.attack*=1.3),3==this.id&&(this.skills[1023]=1);const t=S.unlock;for(let e=0;e<t.length;e++){if(1026==t[e]||1023==t[e])continue;A.skills[t[e]].add!=B.Supply?this.unlock.push(t[e]):this.supUnlock.push(t[e])}const e=window["__continue.battle__"],s=S.lastData;e&&s&&this.chapter==s.chapter&&(window["__continue.battle__"]=null,this.currHP*=s.currHP/s.hp,this.rate=s.rate,this.exp=s.exp,this.level=s.level,this.skills=s.skills,this.skills2=s.skills2,this.unlock=s.unlock,this.supUnlock=s.supUnlock,this.coin=s.coin,this.reward=s.reward),window["__endless.battle__"]&&(this.rate=m.endlessData.startLevel);const i=window["__continue.endless__"],a=m.endlessData.lastData;i&&a&&(window["__continue.endless__"]=null,this.currHP*=a.currHP/a.hp,this.rate=a.rate,this.exp=a.exp,this.level=a.level,this.skills=a.skills,this.skills2=a.skills2||{},this.unlock=a.unlock,this.supUnlock=a.supUnlock,this.coin=a.coin,this.reward=a.reward,this.score=a.score)}init2(t,e){this.id=e,this.diff=t.diff,this.planeData=n.planes[this.id];const s=this.planeData;this.attack=.5*t.attack,this.crit=t.crit,this.critHurt=t.critHurt,this.speed=s.shooting,this.fspeed=s.bulletsp,this.eneHurtStr=t.eneHurtStr,this.bosHurtStr=t.bosHurtStr,this.hp=.5*t.hp,this.currHP=.5*t.hp,this.defense=t.defense,this.subHurt=t.subHurt,this.chapter=t.chapter,this.rate=t.rate,this.coin=0,this.reward=0,this.exp=0,this.level=1,this.skills={},this.skills2={},this.rewards={};const i=S.unlock;for(let t=0;t<i.length;t++){if(1026==i[t]||1023==i[t])continue;A.skills[i[t]].add!=B.Supply?this.unlock.push(i[t]):this.supUnlock.push(i[t])}}setSkill(t){this.skills[t]?this.skills[t]++:this.skills[t]=1}setSkill22(t){this.skills2[t]?this.skills2[t]++:this.skills2[t]=1}setSkill2(t){const e=this.skills;let s=null;for(let i=0;i<3;i++){const a=t+i;if(e[a]){s=a;break}}s?(e[s+1]=e[s]+1,delete e[s]):e[t]=1}}class te extends Q{constructor(){super(),this.ins=null,this.stuSke=null,this.pid=0,this.timer=0,this.tapos=null}onEnable(){if(this.ins=ee.instance,this.stuSke.alpha=0,this.stuSke.blendMode=Laya.BlendMode.LIGHTER,this.stuSke.on(Laya.Event.STOPPED,this,()=>{this.stuSke.alpha=0}),r.on(dt.StudySkill,this,t=>{t||(this.stuSke.templet&&(this.stuSke.play(0,!1),this.stuSke.alpha=1),this.pid||Laya.SoundManager.playSound(O.PlaneLevUpSou))}),this.pid){let t=0,e=!1,s=!1;const i=()=>{const t=d.getRandom(200,500),e=d.getRandom(700,1100);this.tapos=this.getVec3(t,e)};Laya.timer.loop(2e3,this,()=>{s||i()}),r.on("player.killEnemy",this,a=>{const l=a.bid;if(!(e||t&&l!=t)){const e=this.ins.getMaxidEnemy();if(e){s=!0,t=e.getComponent(kt).bid;const i=(e.y<640?640:e.y)+d.getRandom(450,50),a=i>1200?1200:i;let l=e.x-20+d.getRandom(40,0);l>700&&(l=700),l<20&&(l=20),this.tapos=this.getVec3(l,a)}else t=0,s=!1,i()}})}}onDisable(){r.offAllCaller(this),this.stuSke.offAllCaller(this),Laya.timer.clearAll(this),Laya.timer.clearAll(this.owner)}onLateUpdate(){if(this.ins.gameState!=rt.START)return;const t=this.owner,e=this.ins,s=this.pid;let i=Laya.timer.delta/1e3,a=this.getVec3(t.x,t.y),l=this.getVec3();const n=s?e.otherPlayer[s-1].posv2:e.playerPosV2;if(Laya.Vector3.lerp(a,n,15*i,l),t.pos(l.x,l.y),s){const t=e.otherPlayer[s-1];if(this.tapos){const e=t.posv2;Laya.Vector3.lerp(e,this.tapos,5*i,t.posv2)}e.modCameraV3.convertScreenCoordToOrthographicCoord(t.posv2,t.posv3)}}}class ee extends Q{constructor(){super(),this.touchDown=!1,this.bgPre=null,this.eneHPTipPre=null,this.enemyNode=null,this.bgTopNode=null,this.eneBulNode=null,this.playerNode=null,this.player2Node=null,this.effectNode=null,this.dialogNode=null,this.guidNode=null,this.handNode=null,this.bgSceneV2=null,this.modSceneV3=null,this.modCameraV3=null,this.playerV3=null,this.playerV2=null,this.playerHPV2=null,this.plaLassV2=[],this.plaWingsV2=[],this.playerPosV3=new Laya.Vector3(0,0,0),this.playerPosV2=new Laya.Vector3(360,1e3,0),this.plaBallsV2=[],this.touchX=0,this.touchY=0,this.rotationZ=0,this.lastX=0,this.ratio3D=128,this.isMakingEnemy=!1,this.vibrate=!0,this.isEndless=null,this.endlessNextEnemy=null,this.endlessThisEnemy=null,this.coinRate=1,this.suckBlood=0,this.selSkill=0,this.playerData=null,this._gameState=rt.READY,this.eneMgr=null,this.levelBox=0,this.enemyCols=[],this.playerCols=[],this.otherPlayer=[],this.friends=[],this.robotNames=[],this.robotPhotos=[],this.lastCompareData=null,this.compareData=null,ee.instance=this;const t=Laya.stage.addChild(new Laya.Scene);t.zOrder=-2,this.bgSceneV2=t;const e=Laya.stage.addChild(new Laya.Scene3D);e.zOrder=-1,this.modSceneV3=e;const s=new Laya.Camera(0,.1,1e3);e.addChild(s),this.modCameraV3=s,s.clearFlag=Laya.CameraClearFlags.Nothing,s.clearColor=new Laya.Vector4(0,0,0,0),s.transform.rotate(new Laya.Vector3(-90,0,0),!1,!1),s.orthographic=!0,s.orthographicVerticalSize=10;const i=e.addChild(new Laya.DirectionLight);i.color=new Laya.Vector3(1,1,1),i.transform.worldMatrix.setForward(new Laya.Vector3(1,-1,0)),this.bgPre=this.getRes(_.battle.BgNode),this.eneHPTipPre=this.getRes(_.battle.EnemyHPTip)}set gameState(t){this._gameState=t,r.event(dt.GameStateChange)}get gameState(){return this._gameState}onEnable(){h.gameSDK.startGame(()=>{h.gameSDK.subscribeBotAsync(),h.gameSDK.createShortcut(()=>{})});const t=this.open(_.battle.BgNode,this.bgPre);this.bgSceneV2.addChild(t);const e=new Laya.Sprite3D;e.name="coins",this.modSceneV3.addChild(e);const i=new Laya.Sprite3D;i.name="trails",this.modSceneV3.addChild(i),this.enemyNode=this.bgSceneV2.addChild(new Laya.Sprite),this.bgTopNode=this.bgSceneV2.addChild(new Laya.Sprite),this.player2Node=this.bgSceneV2.addChild(new Laya.Sprite),this.eneMgr=this.owner.getChildByName("enemyManager").getComponent(Qt),this.isEndless=window["__endless.battle__"],this.endlessNextEnemy=null,this.endlessThisEnemy=null,this.friends=h.gameSDK.getFriendsList(),this.gameState=rt.READY,this.playerData=new Jt,this.playerData.init();const a=this.playerData,l=window.__Adventure__;let n=0;if(l){const t=l[0].adv.model,e=l[0].adv.diff;let s=E.advDrop[t][e];n=d.getRandom(s.maxbox,s.minbox)}let o,c=Laya.LocalStorage.getItem("Plane.Vibrate");c||(c="1"),c=parseInt(c),this.vibrate=!!c,this.handNode.visible=!(a.chapter>0),this.coinRate=S.specialSuit.indexOf(4)>-1?1.5:1,this.suckBlood=S.specialSuit.indexOf(8)>-1?.3:0,this.selSkill=S.specialSuit.indexOf(13)>-1?1:0,r.on(dt.LaserTrack,this,this.getTrackEnemy),S.chapter<1?o=s.basChapter:(o=s.comChapters[a.chapter-1],2==S.diff&&(o=s.difChapters[a.chapter-1]));const p=o.maxbox,u=o.levelbox,y=o.bossbox,m=this.getRes(_.battle.PlayerReward),g=_t.insUI;r.on(dt.EnemyDead,this,(t,e)=>{const s=t.owner;this.enemyCols.splice(this.enemyCols.indexOf(t),1),r.event("player.killEnemy",t);const i=t=>{g.rewNum++,this.levelBox++;const e=this.open(_.battle.PlayerReward,m),i=e.getComponent(Vt),a=d.getRandom(80,45),l=d.getRandom(1,0),n=Math.tan(a/180*Math.PI);let o=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,-n,0),o),l&&(o.x*=-1),i.nor=o,i.spec=t,i.speed=t?.6:.3,e.pos(s.x,s.y),this.playerNode.addChild(e)};if(l){const t=l[0].adv.model;if(1==t){a.reward+=n;for(let t=0;t<n;t++)i(!1)}else 2==t&&this.levelBox<n&&(a.reward++,i(!1))}else if(this.isEndless);else{if(a.rate%5!=0&&!e&&a.reward<p&&this.levelBox<u){d.getRandom(100,1)<=10&&(a.reward++,i(!1))}if(a.rate%10==0){a.reward+=y,r.event(dt.RewardNum);for(let t=0;t<y;t++)i(!0)}}console.log(`%c${a.chapter+"."+a.level} 剩余敌机 -> ${this.enemyCols.length}`,"color: green"),this.isMakingEnemy||this.enemyCols.length||(Laya.timer.once(2e3,this,()=>{r.event(dt.RateEnd)}),a.rate%10==0&&(this.isEndless||r.event("player.killBoss")),this.isEndless||r.event("player.rated")),2==this.playerData.laserSta&&this.playerData.trackBox&&t.bid==this.playerData.trackBox.bid&&Laya.timer.once(150,this,()=>{this.playerData.trackTar=null,this.playerData.trackBox=null,this.playerData.trackCol=null})}),r.on(dt.GameOver,this,()=>{this.playerV2.visible=!1,this.playerV2.__bgIma__.visible=!1,this.playerHPV2.visible=!1;for(let t=0;t<this.plaLassV2.length;t++)this.plaLassV2[t].visible=!1;for(let t=0;t<this.plaWingsV2.length;t++)this.plaWingsV2[t].visible=!1;this.playerNode.alpha=0;const t=this.player2Node;for(let e=t.numChildren-1;e>=0;e--){t.getChildAt(e).removeSelf()}this.modSceneV3.active=!1}),r.on(dt.PlayerDie,this,t=>{const e=this.otherPlayer[t-1];if(e){e.v2.pos(1e4,1e4),e.posv2=this.getVec3(1e4,1e4,1e4),this.playerCols.splice(this.playerCols.indexOf(e.v2.getComponent(kt)),1),e.v3.active=!1,e.v2.__bgIma__.removeSelf(),e.v2.removeSelf(),e.hpv2.removeSelf();for(let t=0;t<e.lassv2.length;t++)e.lassv2[t].removeSelf();for(let t=0;t<e.wingsv2.length;t++)e.wingsv2[t].removeSelf();for(let t=0;t<e.ballsv2.length;t++)e.ballsv2[t].removeSelf();this.otherPlayer.splice(t-1,1)}}),h.gameSDK.faceBookAdvertisement.showBannerAD()}onDisable(){this.bgSceneV2.destroy(!0),this.modSceneV3.destroy(!0),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this)}initCompareData(){this.compareData||(this.compareData={});const t=this.compareData,e=this.friends;e&&e.length?(e.sort((t,e)=>Math.random()-.5),t.name=e[0].name,t.photo=e[0].photo,e.splice(0,1)):(this.robotNames.length||(this.robotNames=h.gameSDK.leaderboard.getRobotNames()),this.robotPhotos.length||(this.robotPhotos=h.gameSDK.leaderboard.getRobotPhotos()),this.robotNames.sort((t,e)=>Math.random()-.5),this.robotPhotos.sort((t,e)=>Math.random()-.5),t.name=this.robotNames[0],t.photo=`head/${this.robotPhotos[0]}.png`,this.robotNames.splice(0,1),this.robotPhotos.splice(0,1)),t.score?t.score=t.score+d.getRandom(2e3,800):t.score=this.playerData.score+d.getRandom(1e3,500)}getTrackEnemy(){let t=this.getMinEnemy(this.playerV2);t?(this.playerData.trackTar=t,this.playerData.trackBox=t.getComponent(kt),this.playerData.trackCol=t.getComponent(Zt)):(this.playerData.trackTar=null,this.playerData.trackBox=null,this.playerData.trackCol=null)}getMaxidEnemy(){let t=null,e=null;for(let s=0;s<this.enemyCols.length;s++){const i=this.enemyCols[s].owner;if(!i||!i.parent)continue;const a=i.getComponent(Gt).edata.type;(!t||a>t)&&(t=a,e=i)}return e}getMinEnemy(t){let e=null,s=null;for(let i=0;i<this.enemyCols.length;i++){const a=this.enemyCols[i].owner;if(!a||!a.parent)continue;a.getComponent(Gt);let l=a.x-t.x,n=a.y-t.y,o=l*l+n*n;(!e||o<e)&&(e=o,s=a)}return s}getMinEnemy2(t,e){let s=null,i=null,a=null;for(let l=0;l<this.enemyCols.length;l++){const n=this.enemyCols[l].owner;if(!n||!n.parent)continue;let o=n.x-t.x,h=n.y-t.y,r=o*o+h*h;e[l]&&e[l]>=2||(!s||r<s)&&(s=r,i=n,a=l)}if("number"==typeof a&&(e[a]||(e[a]=0),e[a]++),!i&&this.enemyCols.length)for(let e=0;e<this.enemyCols.length;e++){const l=this.enemyCols[e].owner;if(!l||!l.parent)continue;let n=l.x-t.x,o=l.y-t.y,h=n*n+o*o;(!s||h<s)&&(s=h,i=l,a=e)}return i}onStageMouseDown(t){this.touchDown=!0,this.handNode.visible&&(this.handNode.visible=!1,r.event(dt.RateStart),r.event(dt.PlayerBullet,this.playerData.id)),this.gameState==rt.START&&(this.touchX=t.stageX,this.touchY=t.stageY)}onStageMouseMove(t){if(!this.touchDown)return;if(this.gameState!=rt.START)return;let e=t.stageX-this.touchX,s=t.stageY-this.touchY;this.rotationZ-=e/8,Math.abs(this.rotationZ)>45&&(this.rotationZ*=.7),this.touchX=t.stageX,this.touchY=t.stageY;let i=this.playerPosV2.x+e,a=this.playerPosV2.y+s;i>=0&&i<=720&&(this.playerPosV2.x=i),a>=0&&a<=1280&&(this.playerPosV2.y=a),this.modCameraV3.convertScreenCoordToOrthographicCoord(this.playerPosV2,this.playerPosV3)}onStageMouseUp(t){this.touchDown=!1,this.gameState==rt.START&&(this.touchX=0,this.touchY=0,this.rotationZ=0,this.playerV3.transform.localRotationEulerZ=0)}onLateUpdate(){if(this.gameState!=rt.START)return;let t=Laya.timer.delta/1e3;if(this.playerV3){let e=this.playerV3.transform.position,s=new Laya.Vector3(0,0,0);Laya.Vector3.lerp(e,this.playerPosV3,15*t,s),this.playerV3.transform.position=s,Math.abs(this.playerV3.transform.position.x-this.lastX)<=.02&&(this.rotationZ=0);let i=new Laya.Vector3(0,0,0);Laya.Vector3.lerp(this.playerV3.transform.localRotationEuler,this.getVec3(0,0,this.rotationZ),15*t,i),this.playerV3.transform.localRotationEuler=i,this.lastX=this.playerV3.transform.position.x}for(let e=0;e<this.otherPlayer.length;e++){const s=this.otherPlayer[e];let i=s.v3.transform.position,a=new Laya.Vector3(0,0,0);Laya.Vector3.lerp(i,s.posv3,15*t,a),s.v3.transform.position=a}}}class se extends Q{constructor(){super(),this.ins=null,this.laser=null,this.laser2=null,this.deltaX=0,this.deltaY=0,this.pid=0}onEnable(){this.ins=ee.instance,this.laser&&(this.laser.blendMode=Laya.BlendMode.LIGHTER),this.laser2&&(this.laser2.blendMode=Laya.BlendMode.LIGHTER);const t=this.owner;r.on(dt.RateStart,this,()=>{t.visible||(t.visible=!0)})}onDisable(){}onLateUpdate(){const t=this.ins,e=this.pid;if(t.gameState!=rt.START)return;const s=this.owner;let i=e?t.otherPlayer[e-1].v2:t.playerV2;s.pos(i.x+this.deltaX,i.y+this.deltaY)}}class ie extends Q{constructor(){super(),this.laser=null,this.ins=null,this.selfCol=null,this.quadTree=null,this.target=null,this.startH=1500,this.pid=0}set currH(t){this.laser.scaleY=t/1e3}onEnable(){this.ins=ee.instance;const t=this.ins,e=this.pid,s=this.owner;s.__type__=ct.LASER,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),this.selfCol=this.owner.getComponent(kt),this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2,this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.target=null,this.currH=this.startH,s.alpha=1;const i=this.laser,a=s.getChildByName("laser2");let l=e?t.otherPlayer[e-1].playerData:t.playerData;const n=()=>{if(r.event(dt.LaserHide,this.selfCol),l.trackTar&&l.trackBox&&l.trackCol&&s.visible){const t=l.trackBox;t.bids.indexOf(this.selfCol.bid)<0&&(t.bids.push(this.selfCol.bid),l.trackCol.onCollisionEnter(this.selfCol,l.trackBox,!0))}};let o=1e3*(l.fspeed+l.speed+1),h=1e3*l.speed+500;Laya.timer.loop(o,this,()=>{Laya.Tween.to(i,{alpha:0},500,null,Laya.Handler.create(this,()=>{this.clearBids(),Laya.Tween.to(a,{alpha:0},100)})),Laya.timer.once(h,this,()=>{2==l.laserSta&&(t.getTrackEnemy(),n()),Laya.Tween.to(i,{alpha:1},500,null,Laya.Handler.create(this,()=>{})),Laya.Tween.to(a,{alpha:1},200)})}),r.on(dt.GameStateChange,this,()=>{t.gameState==rt.START?s.visible=!0:s.visible=!1}),r.on(dt.LaserCross,this,()=>{this.target=null,this.currH=this.startH,this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2}),r.on(dt.LaserTrack,this,()=>{this.selfCol.bids=[],this.target=null}),r.on(dt.LaserTrackTar,this,n)}onDisable(){this.clearBids(),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this)}clearBids(){this.owner;this.selfCol.bids=[],this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2,this.target=null,this.currH=this.startH,r.event(dt.LaserHide,this.selfCol)}onCollisionEnter(t,e){const s=t.owner,i=e.owner,a=this.ins,l=this.pid,n=l?a.otherPlayer[l-1].playerData:a.playerData;if(s&&i&&!n.laserSta){let t=Math.abs(s.y-i.y);this.selfCol.height2>t&&(this.currH=t,this.selfCol.height2=t,this.selfCol.deltaY=-t/2,this.target=s)}}onCollisionExit(t,e){const s=t.owner,i=e.owner,a=this.ins,l=this.pid,n=l?a.otherPlayer[l-1].playerData:a.playerData;s&&i&&!n.laserSta&&(this.selfCol.bids.length||(this.currH=this.startH,this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2,this.target=null))}laserTrack(){const t=this.owner,e=this.ins,s=this.pid,i=s?e.otherPlayer[s-1].playerData:e.playerData;if(2==i.laserSta)if(i.trackTar){const e=i.trackTar;if(e.x>=0&&e.x<=720&&e.y>=0&&e.y<=1280){let e=i.trackTar.x-t.x,s=i.trackTar.y-t.y,a=Math.sqrt(e*e+s*s);this.currH=a,t.rotation=Math.atan2(e,-s)/Math.PI*180}}else t.rotation=0,this.currH=this.startH,this.selfCol.height2=this.startH,this.selfCol.deltaY=-this.startH/2}onUpdate(){const t=this.owner,e=this.ins,s=this.pid,i=s?e.otherPlayer[s-1].playerData:e.playerData;if(e.gameState==rt.START){if(t.visible=!0,this.laserTrack(),(2!=i.laserSta||!i.trackTar)&&t.visible&&this.laser.alpha>=.1&&this.quadTree.check(ee.instance.enemyCols,this.selfCol),!i.laserSta&&this.target){const t=this.owner;let e=Math.abs(this.target.y-t.y);this.currH=e,this.selfCol.height2=e,this.selfCol.deltaY=-e/2}}else t.visible=!1}}class ae extends Q{constructor(){super(),this.ins=null,this._norV3=null,this.speed=.1}get norV3(){return this._norV3}set norV3(t){this._norV3=t}onEnable(){this.ins=ee.instance}onDisable(){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=-360||t.x>=1080||t.y<=0||t.y>=1280)&&this.owner.removeSelf()}}class le extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this._norV3=null,this.speed=2.5,this.state=rt.READY,this.delta=0}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.state=rt.START}onDisable(){r.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=-360||t.x>=1080||t.y<=-640||t.y>=1920)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class ne extends Q{constructor(){super(),this.ins=null,this.robot1BPre=null,this.pid=0,this.robot1BPre=this.getRes(_.battle.PlayerRobot1b)}onEnable(){this.ins=ee.instance;const t=this.ins,e=this.pid,s=this.owner,i=e?t.otherPlayer[e-1].playerData:t.playerData,a=[this.getVec3(.87,-.5),this.getVec3(.98,-.17),this.getVec3(.98,.17),this.getVec3(.87,.5),this.getVec3(-.87,-.5),this.getVec3(-.98,-.17),this.getVec3(-.98,.17),this.getVec3(-.87,.5)],l=A.skills[ut.BlastRobot],n=l.robotbullet||5,o=l.fspeed||.2;Laya.timer.loop(1e3*n,this,()=>{if(t.gameState==rt.START)for(let e=0;e<8;e++){const n=this.open(_.battle.PlayerRobot1b,this.robot1BPre);let h=n.getComponent(Ut);h||(h=n.addComponent(Ut));const r=l.value||1;h.setData(i.attack*r,i.crit,i.critHurt,i.eneHurtStr,i.bosHurtStr);let c=n.getComponent(le);c||(c=n.addComponent(le)),c.speed=o,c.delta=294,c.norV3=a[e].clone(),n.pos(s.x,s.y),t.player2Node.addChild(n);const d=n.getChildByName("bi");d.height=0,Laya.Tween.clearAll(d),Laya.Tween.to(d,{height:294},300)}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this),this.recover(this.owner)}onLateUpdate(){}}class oe extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.state=rt.READY,this._norV3=null,this.speed=.2}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance;this.owner;this.state=rt.START,this.selfCol=this.owner.getComponent(kt),this.ins.playerCols.indexOf(this.selfCol)<0&&this.ins.playerCols.push(this.selfCol)}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this);const t=this.ins.playerCols;let e=t.indexOf(this.selfCol);e>-1&&t.splice(e,1),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=-360||t.x>=1080||t.y<=-640||t.y>=1920)&&this.owner.removeSelf()}}class he extends Q{constructor(){super(),this.ins=null,this.robot2BPre=null,this.pid=0,this.robot2BPre=this.getRes(_.battle.PlayerWing6b)}onEnable(){this.ins=ee.instance;const t=this.owner,e=this.ins,s=this.pid,i=(s?e.otherPlayer[s-1].playerData:e.playerData,[this.getVec3(.87,-.5),this.getVec3(1,0),this.getVec3(.87,.5),this.getVec3(-.87,-.5),this.getVec3(-1,0),this.getVec3(-.87,.5)]),a=A.skills[ut.ShieldRobot],l=a.robotbullet||5,n=a.fspeed||.2;Laya.timer.loop(1e3*l,this,()=>{if(e.gameState==rt.START)for(let s=0;s<6;s++){const a=this.open(_.battle.PlayerWing6b,this.robot2BPre),l=a.getComponent(oe);l.speed=n,l.norV3=i[s].clone(),a.pos(t.x,t.y),e.player2Node.addChild(a)}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this),this.recover(this.owner)}onLateUpdate(){}}class re extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this._norV3=null,this.state=rt.READY,this.radius=50,this.angle=0,this.speed=1,this.pid=0}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance;const t=this.ins;this.owner;this.selfCol=this.owner.getComponent(kt),t.playerCols.indexOf(this.selfCol)<0&&this.ins.playerCols.push(this.selfCol),this.state=rt.START}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this);const t=this.ins.playerCols;let e=t.indexOf(this.selfCol);e>-1&&t.splice(e,1),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){const t=this.ins,e=this.pid,s=this.owner;let i=Laya.timer.delta/200*this.speed;this.angle+=i,s.rotation=-180-this.angle/Math.PI*180;let a=e?t.otherPlayer[e-1].v2:t.playerV2;s.x=a.x+this.radius*Math.cos(this.angle),s.y=a.y-this.radius*Math.sin(this.angle)}}class ce extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this._norV3=null,this.circle=!0,this.state=rt.READY,this.tar=null,this.angle=0,this.xv=1,this.speed=1,this.trail=null,this.cross=!1,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.state=rt.START,this.circle=!0;const t=this.ins,e=this.owner,s=new Laya.Sprite3D,i=this.getRes(this.trail||V.DaoDanLiaoJi),a=Laya.Sprite3D.instantiate(i);s.addChild(a),t.modSceneV3.getChildByName("trails").addChild(s);let l=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),l),s.transform.position=l,this.s3d=s}onDisable(){this.s3d&&Laya.timer.once(200,this,()=>{this.s3d.removeSelf(),this.recover(this.owner)}),r.offAllCaller(this)}onCollisionEnter(t,e){this.cross?this.tar=null:this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed,s=this.ins.ratio3D;if(this.tar&&this.tar.parent)if(t.y<=this.tar.y||this.tar.x<=0||this.tar.x>=720||this.tar.y<=0||this.tar.y>=1280)this.tar=null;else if(this.circle){let s=this.getVec3(),i=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let a=Math.atan2(-i.y,i.x)-Math.atan2(-this.norV3.y,this.norV3.x);if(a<0&&(a+=2*Math.PI),a<=.3)this.circle=!1;else{this.angle+=this.xv*e/2;let t=Math.tan(this.angle/180*Math.PI),s=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,-t,0),s),(this.angle>90&&this.angle<270||this.angle<-90&&this.angle>-270)&&(s.x=-s.x,s.y=-s.y),this.norV3.x=s.x,this.norV3.y=s.y}}else{let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),e),Laya.Vector3.normalize(e,this.norV3)}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d.transform.translate(this.getVec3(this.norV3.x/s*e,0,this.norV3.y/s*e)),(t.x<=-360||t.x>=1080||t.y<=-640||t.y>=1920)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class de extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this._norV3=null,this.beil=2,this.state=rt.READY,this.speed=.8}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.state=rt.START,this.beil=2}onDisable(){r.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;const t=this.owner;this.beil>1&&(this.beil-=.06);let e=this.speed*this.beil,s=Laya.timer.delta*e;t.x+=s*this.norV3.x,t.y+=s*this.norV3.y,(t.x<=-360||t.x>=1080||t.y<=-640||t.y>=1920)&&this.owner.removeSelf(),this.quadTree.check(ee.instance.enemyCols,this.selfCol)}}class pe extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this._norV3=null,this.angle=0,this.state=rt.READY,this.js=!1,this.tar=null,this.pangle=0,this.speed=.5,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.angle=0,this.js=!1,this.state=rt.START;const t=this.ins,e=this.owner,s=new Laya.Sprite3D,i=this.getRes(V.YanHua),a=Laya.Sprite3D.instantiate(i);s.addChild(a),t.modSceneV3.getChildByName("trails").addChild(s);let l=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),l),s.transform.position=l,this.s3d=s}onDisable(){this.s3d&&Laya.timer.once(200,this,()=>{this.s3d.removeSelf(),this.recover(this.owner)}),r.offAllCaller(this)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed,s=this.ins.ratio3D;if(this.js){if(this.tar&&this.tar.parent&&t.y-this.tar.y>=50){let s=this.getVec3(),i=this.getVec3(),a=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i),Laya.Vector3.lerp(this.norV3,i,e/50,a),this.norV3=a}}else{if(this.tar&&this.tar.parent&&t.y-this.tar.y>=50){let s=this.getVec3(),i=this.getVec3(),a=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let l=Math.atan2(-i.y,i.x);Laya.Vector3.lerp(this.getVec3(this.pangle),this.getVec3(l),e/200,a),this.pangle=a.x;let n=this.tar.x-t.x,o=this.tar.y-t.y;n*n+o*o<=9e4&&(this.js=!0)}this.angle+=20;let s=Math.atan(Math.cos(this.angle/180*Math.PI)),i=.4*Math.tan(s),a=new Laya.Vector3(0,0,0),l=this.pangle,n=1*Math.cos(l)+i*Math.sin(l),o=i*Math.cos(l)-1*Math.sin(l);Laya.Vector3.normalize(this.getVec3(n,o),a),this.norV3=a}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d.transform.translate(this.getVec3(this.norV3.x/s*e,0,this.norV3.y/s*e)),(t.x<=-360||t.x>=1080||t.y<=-640||t.y>=1920)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class ue extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this._norV3=null,this.angle=0,this.state=rt.READY,this.js=!1,this.timer=0,this.tar=null,this.pangle=0,this.speed=.5,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.angle=0,this.js=!1,this.timer=0,this.state=rt.START;const t=this.ins,e=this.owner,s=new Laya.Sprite3D,i=this.getRes(V.CaiHon),a=Laya.Sprite3D.instantiate(i);s.addChild(a),t.modSceneV3.getChildByName("trails").addChild(s);let l=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y-30),l),s.transform.position=l,this.s3d=s}onDisable(){this.s3d&&Laya.timer.once(0,this,()=>{this.s3d.removeSelf(),this.recover(this.owner)}),r.offAllCaller(this)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed,s=this.ins.ratio3D;if(this.js){if(this.tar&&this.tar.parent&&t.y-this.tar.y>=50){let s=this.getVec3(),i=this.getVec3(),a=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i),Laya.Vector3.lerp(this.norV3,i,e/50,a),this.norV3=a}e*=2}else{if(this.tar&&this.tar.parent&&t.y-this.tar.y>=200){let s=this.getVec3(),i=this.getVec3(),a=this.getVec3();Laya.Vector3.subtract(this.getVec3(this.tar.x,this.tar.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,i);let l=Math.atan2(-i.y,i.x);Laya.Vector3.lerp(this.getVec3(this.pangle),this.getVec3(l),e/100,a),this.pangle=a.x;let n=this.tar.x-t.x,o=this.tar.y-t.y;n*n+o*o<=9e4&&(this.js=!0)}this.timer>=1500&&(this.js=!0),this.timer+=Laya.timer.delta,this.angle+=5;let s=Math.atan(Math.cos(this.angle/180*Math.PI)),i=.7*Math.tan(s),a=new Laya.Vector3(0,0,0),l=this.pangle,n=1*Math.cos(l)+i*Math.sin(l),o=i*Math.cos(l)-1*Math.sin(l);Laya.Vector3.normalize(this.getVec3(n,o),a),this.norV3=a}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d.transform.translate(this.getVec3(this.norV3.x/s*e,0,this.norV3.y/s*e)),(t.x<=-360||t.x>=1080||t.y<=-640||t.y>=1920)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class ye extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=rt.READY,this.angle=0,this.type=null,this.speed=1,this.pid=0}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-180-Math.atan2(-t.y,t.x)/Math.PI*180)}onEnable(){this.ins=ee.instance,this.owner.__type__=this.type?this.type:ct.POISON,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.state=rt.START}onDisable(){r.offAllCaller(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){const t=this.ins;if(t.gameState!=rt.START)return;if(this.state!=rt.START)return;const e=this.pid,s=this.owner;let i=e?t.otherPlayer[e-1].v2:t.playerV2,a=Laya.timer.delta/200*this.speed;this.angle+=a,s.rotation=-180-this.angle/Math.PI*180,s.x=i.x+200*Math.cos(this.angle),s.y=i.y-200*Math.sin(this.angle),this.quadTree.check(ee.instance.enemyCols,this.selfCol)}}class me extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=rt.READY,this.move=!0,this.getTar=!1,this.timer=0,this.startGet=0,this.timer2=0,this.staPos=this.getVec3(),this.staPosV3=this.getVec3(),this.endPos=this.getVec3(),this.endPosV3=this.getVec3(),this.speed=.5,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.move=!0,this.getTar=!1,this.timer=0,this.startGet=0,this.state=rt.READY,r.on(dt.BulSkill7_Start,this,()=>{this.state=rt.START});const t=this.ins,e=this.owner,s=new Laya.Sprite3D,i=this.getRes(V.DaoDanGui),a=Laya.Sprite3D.instantiate(i);s.addChild(a),t.modSceneV3.getChildByName("trails").addChild(s);let l=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),l),s.transform.position=l,this.s3d=s,this.timer2=0,this.setStaEndPos()}setStaEndPos(){const t=this.owner,e=this.ins;this.staPos=this.getVec3(t.x,t.y),this.endPos=this.getVec3(t.x+200*this.norV3.x,t.y+200*this.norV3.y),e.modCameraV3.convertScreenCoordToOrthographicCoord(this.staPos,this.staPosV3),e.modCameraV3.convertScreenCoordToOrthographicCoord(this.endPos,this.endPosV3),this.staPos=this.norV3.clone()}onDisable(){this.s3d&&Laya.timer.once(200,this,()=>{this.s3d.removeSelf(),this.recover(this.owner)}),r.offAllCaller(this)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}easeOutQuart(t){return-((t-=1)*t*t*t-1)}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed*2,s=this.ins.ratio3D;if(this.move)if(this.timer2>=1)this.move=!1,this.timer2=0,this.startGet++;else{let t=this.staPos;this.staPosV3,this.endPos,this.endPosV3,this.s3d;this.timer2+=.003*e/2;let s=this.easeOutQuart(this.timer2);this.norV3.x=t.x+(.2*t.x-t.x)*s,this.norV3.y=t.y+(.2*t.y-t.y)*s}else if(this.timer>=1)this.move=!0,this.getTar=!1,this.timer=0;else{if(!this.getTar){this.getTar=!0;let e=this.ins.getMinEnemy(this.owner);if(this.startGet>=2&&e&&e.parent){let s=this.getVec3();Laya.Vector3.subtract(this.getVec3(e.x,e.y),this.getVec3(t.x,t.y),s),Laya.Vector3.normalize(s,this.norV3)}else 1!=this.startGet?(this.norV3.x=-this.staPos.x,this.norV3.y=this.staPos.y):(this.norV3.x=this.staPos.x,this.norV3.y=this.staPos.y);this.setStaEndPos()}this.timer+=Laya.timer.delta}t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,this.s3d&&this.s3d.transform.translate(this.getVec3(this.norV3.x/s*e,0,this.norV3.y/s*e)),(t.x<=-360||t.x>=1080||t.y<=-640||t.y>=1920)&&this.owner.removeSelf(),this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class ge extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this.skeNode=null,this.state=rt.READY,this.pid=0}onEnable(){this.ins=ee.instance;const t=this.owner;t.__type__=ct.MAGNET,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),t.visible=!1,this.skeNode&&(this.skeNode.blendMode=Laya.BlendMode.LIGHTER),this.state=rt.START;const e=A.skills[ut.Magnet];Laya.timer.loop(1e3*e.speed,this,()=>{this.ins.gameState==rt.START&&(this.skeNode.templet&&(this.skeNode.play(0,!0),this.skeNode.playbackRate(.8)),t.visible=!0,this.schedule(250,()=>{this.quadTree.check(ee.instance.enemyCols,this.selfCol),this.selfCol.bids=[],r.event(dt.LaserHide,this.selfCol)},this,2,null,!0,()=>{t.visible=!1}))})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){const t=this.ins;if(t.gameState!=rt.START)return;if(this.state!=rt.START)return;const e=this.pid,s=this.owner;let i=e?t.otherPlayer[e-1].v2:t.playerV2;s.x=i.x,s.y=i.y}}class be extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this._norV3=null,this.t=0,this.circle=!1,this.bezierd=!1,this.start=null,this.pt=null,this.lastPos=null,this.state=rt.START,this.tar=null,this.speed=1,this.cross=!1,this.deltaY=0,this.tspeed=.05,this.trail=null,this.att=0,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.t=0,this.circle=!1,this.bezierd=!1;const t=this.owner;if(this.lastPos=this.getVec3(t.x,t.y),this.trail){const e=new Laya.Sprite3D,s=this.getRes(this.trail),i=Laya.Sprite3D.instantiate(s);e.addChild(i),this.ins.modSceneV3.getChildByName("trails").addChild(e);let a=this.getVec3();this.ins.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(t.x,t.y),a),e.transform.position=a,this.s3d=e}}onDisable(){this.s3d?Laya.timer.once(200,this,()=>{this.s3d.removeSelf(),this.recover(this.owner)}):this.recover(this.owner)}bezier(t,e,s,i,a){t.x=(1-e)*(1-e)*s.x+2*e*(1-e)*a.x+e*e*i.x,t.y=(1-e)*(1-e)*s.y+2*e*(1-e)*a.y+e*e*i.y;const l=this.getVec3();let n=this.ins.ratio3D;Laya.Vector3.subtract(this.getVec3(t.x,t.y),this.lastPos,l),this.lastPos=this.getVec3(t.x,t.y),this.s3d&&this.s3d.transform&&this.s3d.transform.translate(this.getVec3(l.x/n,0,l.y/n));let o=2*((1-e)*(a.x-s.x)+e*(i.x-a.x)),h=2*((1-e)*(a.y-s.y)+e*(i.y-a.y)),r=this.getVec3();Laya.Vector3.normalize(this.getVec3(o,h,0),r),h<=0&&(this.norV3=r)}onCollisionEnter(t,e){if(this.cross||this.owner.removeSelf(),this.trail==V.Main4){const t=this.ins.playerData,e=this.getRes(_.battle.Player4MainBoom),s=this.open(_.battle.Player4MainBoom,e),i=this.owner;s.x=i.x,s.y=i.y;let a=s.getComponent(Ut);a||(a=s.addComponent(Ut)),a.setData(Math.floor(this.att),t.crit,t.critHurt,t.eneHurtStr,t.bosHurtStr),this.ins.effectNode.addChild(s)}}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;let t=this.ins.ratio3D;this.quadTree.check(this.ins.enemyCols,this.selfCol);const e=this.owner;let s=Laya.timer.delta*this.speed;if(this.tar&&this.tar.parent)if(this.tar.x<=0||this.tar.x>=720||this.tar.y<=0||this.tar.y>=1280)this.t=1,this.tar=null;else if(Math.abs(e.y-this.tar.y)<=500&&!this.bezierd){this.bezierd=!0,this.start=this.getVec3(e.x,e.y);let t=this.start;const s=e.x>=this.tar.x?-1:1;let i=this.getVec3(this.tar.x,this.tar.y+this.deltaY*s),a=2*(t.x+(i.x-t.x)/4)-(t.x+i.x)/2,l=2*(t.y+(i.y-t.y)/4*3)-(t.y+i.y)/2;this.pt=this.getVec3(a,l),this.circle=!0}if(this.circle&&this.tar&&this.tar.parent){if(this.t>=1)return void(this.circle=!1);this.t+=this.tspeed;const t=e.x>=this.tar.x?-1:1;this.bezier(e,this.t,this.start,this.getVec3(this.tar.x,this.tar.y+this.deltaY*t),this.pt)}if(!this.circle||!this.tar||!this.tar.parent){e.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180);const i=s*this.norV3.x,a=s*this.norV3.y;e.x+=i,e.y+=a,this.s3d&&this.s3d.transform&&this.s3d.transform.translate(this.getVec3(i/t,0,a/t))}(e.x<=-360||e.x>=1080||e.y<=-640||e.y>=1920)&&this.owner.removeSelf()}}class fe extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.state=rt.READY,this.shield1=null,this.shield2=null,this.pid=0}onEnable(){this.ins=ee.instance;this.owner;this.state=rt.START,this.selfCol=this.owner.getComponent(kt);const t=this.ins.playerCols;this.shield1.blendMode=Laya.BlendMode.LIGHTER,this.shield2.blendMode=Laya.BlendMode.LIGHTER,this.shield1.playbackRate(.2);const e=A.skills[ut.TimeShield];let s=1e3*(e.fspeed+e.speed+1),i=1e3*e.fspeed;this.shield2.alpha=0,this.shield1.alpha=0,Laya.timer.loop(s,this,()=>{this.shield1.templet&&(this.shield1.playbackRate(.5),this.shield1.play(0,!1)),this.shield2.templet&&this.shield2.playbackRate(.5),this.shield1.alpha=1,Laya.timer.once(600,this,()=>{this.shield1.alpha=0}),this.shield2.scaleX=this.shield2.scaleY=0,Laya.Tween.to(this.shield2,{alpha:1,scaleX:1,scaleY:1},600,null,Laya.Handler.create(this,()=>{t.indexOf(this.selfCol)<0&&this.ins.playerCols.push(this.selfCol)})),Laya.timer.once(i,this,()=>{let e=t.indexOf(this.selfCol);e>-1&&t.splice(e,1),Laya.Tween.to(this.shield2,{alpha:0},500)})})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this);const t=this.ins.playerCols;let e=t.indexOf(this.selfCol);e>-1&&t.splice(e,1),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){const t=this.ins,e=this.pid;let s=e?t.otherPlayer[e-1].v2:t.playerV2;this.owner.pos(s.x,s.y)}}class ke extends Q{constructor(){super(),this.ins=null,this.deltaX=0,this.deltaY=0,this.pid=0}onEnable(){this.ins=ee.instance}onDisable(){}onLateUpdate(){const t=this.ins,e=this.pid;if(t.gameState!=rt.START)return;const s=this.owner;let i=e?t.otherPlayer[e-1].posv2:t.playerPosV2,a=Laya.timer.delta/1e3,l=this.getVec3(s.x,s.y),n=this.getVec3(i.x+this.deltaX,i.y+this.deltaY),o=this.getVec3();Laya.Vector3.lerp(l,n,8*a,o),s.pos(o.x,o.y)}}class Se extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this.state=rt.READY,this._norV3=null,this.speed=.6}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance;const t=this.owner,e=this.ins;t.__type__=ct.MAGNET,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.state=rt.START;const s=this.getRes(_.battle.PlayerBlast);Laya.timer.loop(100,this,()=>{if(e.gameState!=rt.START)return;this.quadTree.check(e.enemyCols,this.selfCol);const i=this.open(_.battle.PlayerBlast,s);i.pos(t.x,t.y),e.effectNode.addChild(i),this.selfCol.bids=[],r.event(dt.LaserHide,this.selfCol)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;const t=this.owner;let e=Laya.timer.delta*this.speed;t.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180),t.x+=e*this.norV3.x,t.y+=e*this.norV3.y,(t.x<=-360||t.x>=1080||t.y<=-640||t.y>=1920)&&this.owner.removeSelf()}}class Ce extends Q{constructor(){super(),this.ins=null,this.wing1BPre=null,this.pid=0,this.wing1BPre=this.getRes(_.battle.PlayerWing1b)}onEnable(){this.ins=ee.instance;const t=this.ins,e=this.pid,s=this.owner,i=e?t.otherPlayer[e-1].playerData:t.playerData,a=A.skills[ut.BlastWing],l=a.speed||5,n=a.fspeed||.2;Laya.timer.loop(1e3*l,this,()=>{if(t.gameState!=rt.START)return;const e=this.open(_.battle.PlayerWing1b,this.wing1BPre);let l=e.getComponent(Ut);l||(l=e.addComponent(Ut));const o=a.value||1;let h=i.attack*o;i.skills[ut.BlastWing]&&(h+=i.attack*o*(i.skills[ut.BlastWing]-1)*2.4),l.setData(h,i.crit,i.critHurt,i.eneHurtStr,i.bosHurtStr);const r=e.getComponent(Se);r.speed=n,r.norV3=this.getVec3(0,-1),e.pos(s.x,s.y),t.player2Node.addChild(e)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this)}onLateUpdate(){}}class Le extends Q{constructor(){super(),this.ins=null,this.wing2BPre=null,this.xv=1,this.pid=0,this.wing2BPre=this.getRes(_.battle.PlayerWing2b)}onEnable(){this.ins=ee.instance;const t=this.ins,e=this.pid,s=this.owner,i=e?t.otherPlayer[e-1].playerData:t.playerData,a=A.skills[ut.MissileWing],l=a.speed||5,n=a.fspeed||.2;Laya.timer.loop(1e3*l,this,()=>{if(t.gameState!=rt.START)return;if(!this.getRes(V.DaoDanLiaoJi))return void Y.load3D([V.DaoDanLiaoJi]);let e=0;const l={};for(let o=0;o<6;o++){let o=Math.floor(89*Math.random()+1),h=Math.tan(o/180*Math.PI),r=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,h,0),r),r.x*=this.xv,e+=Math.floor(251*Math.random()+50),Laya.timer.once(e,this,()=>{const e=this.open(_.battle.PlayerWing2b,this.wing2BPre);let h=e.getComponent(Ut);h||(h=e.addComponent(Ut));const c=a.value||1;let d=i.attack*c;i.skills[ut.MissileWing]&&(d+=i.attack*c*(i.skills[ut.MissileWing]-1)*2.4),h.setData(d,i.crit,i.critHurt,i.eneHurtStr,i.bosHurtStr);const p=e.getComponent(ce);p.speed=n,p.norV3=r,p.angle=this.xv>0?-o:o+180,p.xv=this.xv,p.tar=t.getMinEnemy2(s,l),e.pos(s.x,s.y+20),t.player2Node.addChild(e)})}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this)}onLateUpdate(){}}class De extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this.animNode=null,this.bid=ut.Laser}onEnable(){this.ins=ee.instance;const t=this.owner;t.__type__=ct.LASER,t.__spicol__=this.bid==ut.Laser?1:2,Laya.timer.clearAll(this),Laya.Tween.clearAll(this),this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),t.alpha=1;const e=A.skills[this.bid];let s=1e3*(e.fspeed+e.speed+1),i=1e3*e.speed+500;Laya.timer.loop(s,this,()=>{Laya.Tween.to(t,{alpha:0},500,null,Laya.Handler.create(this,()=>{this.clearBids()})),Laya.timer.once(i,this,()=>{Laya.Tween.to(t,{alpha:1},500)})}),r.on(dt.GameStateChange,this,()=>{this.ins.gameState==rt.START?t.visible=!0:t.visible=!1});const a=this.animNode;a&&Laya.timer.loop(300,this,()=>{a&&Laya.Tween.to(a,{scaleX:1.5},150,null,Laya.Handler.create(this,()=>{a&&Laya.Tween.to(a,{scaleX:1},150,null)}))})}onDisable(){this.clearBids(),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this)}clearBids(){this.selfCol.bids.length=0,r.event(dt.LaserHide,this.selfCol)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;const t=this.owner;t.visible&&t.alpha>=.1&&this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class Pe extends Q{constructor(){super(),this.ins=null,this.laser=null,this.tar=null,this.deltaX=0,this.deltaY=0}onEnable(){this.ins=ee.instance,this.laser&&(this.laser.blendMode=Laya.BlendMode.LIGHTER)}onDisable(){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;if(!this.tar)return;const t=this.owner;let e=this.tar;t.pos(e.x+this.deltaX,e.y+this.deltaY)}}class xe extends Q{constructor(){super(),this.ins=null,this.wing3BPre=null,this.xv=1,this.pid=0,this.wing3BPre=this.getRes(_.battle.PlayerWing3b)}onEnable(){this.ins=ee.instance;const t=this.ins,e=this.pid,s=(this.owner,e?t.otherPlayer[e-1].playerData:t.playerData),i=e?t.otherPlayer[e-1].ballsv2:t.plaBallsV2,a=this.open(_.battle.PlayerWing3b,this.wing3BPre);Laya.timer.once(500,this,()=>{let e=a.getComponent(Ut);e||(e=a.addComponent(Ut));const l=A.skills[ut.LaserWing].value||1;let n=s.attack*l;s.skills[ut.LaserWing]&&(n+=s.attack*l*(s.skills[ut.LaserWing]-1)*2.4),e.setData(n,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);let o=this.owner;a.getComponent(Pe).tar=o,a.getComponent(De).bid=ut.LaserWing,a.pos(o.x,o.y),t.playerNode.addChild(a),i.push(a)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this)}onLateUpdate(){}}class ve extends Q{constructor(){super(),this.ins=null,this.wing4BPre=null,this.pid=0,this.wing4BPre=this.getRes(_.battle.PlayerWing4b)}onEnable(){this.ins=ee.instance;const t=this.ins,e=this.pid,s=this.owner,i=e?t.otherPlayer[e-1].playerData:t.playerData,a=A.skills[ut.AutoWing],l=a.speed||.2,n=a.fspeed||.2;Laya.timer.once(500,this,()=>{Laya.timer.loop(1e3*l,this,()=>{if(t.gameState!=rt.START)return;const e=this.open(_.battle.PlayerWing4b,this.wing4BPre);let l=e.getComponent(Ut);l||(l=e.addComponent(Ut));const o=a.value||1;let h=i.attack*o;i.skills[ut.AutoWing]&&(h+=i.attack*o*(i.skills[ut.AutoWing]-1)*2.4),l.setData(h,i.crit,i.critHurt,i.eneHurtStr,i.bosHurtStr);const r=e.getComponent(zt);r.speed=n,r.state=rt.START,r.norV3=this.getVec3(0,-1);let c=t.getMinEnemy(s),d=180;if(c&&c.parent){r.tar=c;let t=this.getVec3(0,-1),i=this.getVec3();Laya.Vector3.subtract(this.getVec3(c.x,c.y),this.getVec3(s.x,s.y),i),Laya.Vector3.normalize(i,t),r.norV3=t,d=e.rotation}const p=(90-e.rotation)/180*Math.PI;s.rotation=d,e.pos(s.x-30*Math.cos(p),s.y+30*Math.sin(p)),t.player2Node.addChild(e)})})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this)}onLateUpdate(){}}class Ee extends Q{constructor(){super(),this.ins=null,this.wing5BPre=null,this.xv=1,this.pid=0,this.wing5BPre=this.getRes(_.battle.PlayerWing5b)}onEnable(){this.ins=ee.instance;const t=this.ins,e=this.pid,s=this.owner,i=e?t.otherPlayer[e-1].playerData:t.playerData,a=A.skills[ut.ShotWing],l=a.speed||.2,n=a.fspeed||.2,o=[this.getVec3(.03,-1),this.getVec3(.07,-1),this.getVec3(.1,-.99),this.getVec3(.14,-.99),this.getVec3(.17,-.98),this.getVec3(.21,-.98)];let h=0;Laya.timer.once(500,this,()=>{Laya.timer.loop(1e3*l,this,()=>{if(t.gameState!=rt.START)return;h>=6&&(h=0);const e=this.open(_.battle.PlayerWing5b,this.wing5BPre);e.__bulType__="shotWing";let l=e.getComponent(Ut);l||(l=e.addComponent(Ut));const r=a.value||1;let c=i.attack*r;i.skills[ut.ShotWing]&&(c+=i.attack*r*(i.skills[ut.ShotWing]-1)*2.4),l.setData(c,i.crit,i.critHurt,i.eneHurtStr,i.bosHurtStr);const d=e.getComponent(le);let p=o[h];d.norV3=this.getVec3(p.x*this.xv,p.y),d.speed=n,e.pos(s.x,s.y),t.player2Node.addChild(e);const u=e.getChildByName("bi");u.height=0,Laya.Tween.clearAll(u),Laya.Tween.to(u,{height:66},100),h++})})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this)}onLateUpdate(){}}class we extends Q{constructor(){super(),this.ins=null,this.wing6BPre=null,this.pid=0,this.wing6BPre=this.getRes(_.battle.PlayerWing6b)}onEnable(){this.ins=ee.instance;const t=this.ins,e=this.pid,s=this.owner,i=(e?t.otherPlayer[e-1].playerData:t.playerData,A.skills[ut.ShieldWing]),a=i.speed||5,l=i.fspeed||.2;Laya.timer.loop(1e3*a,this,()=>{if(t.gameState!=rt.START)return;const e=this.open(_.battle.PlayerWing6b,this.wing6BPre),i=e.getComponent(oe);i.norV3=this.getVec3(0,-1),i.speed=l,e.pos(s.x,s.y-30),t.player2Node.addChild(e)})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this)}onLateUpdate(){}}class Te extends Q{constructor(){super(),this.ins=null,this.plaBul1Pre=null,this.plaBul3Pre=null,this.plaBul4Pre=null,this.plaBul5Pre=null,this.plaBul6Pre=null,this.plaBul6Pre1=null,this.plaBulPre=null,this.skill1Pre=null,this.skill2Pre=null,this.skill3Pre=null,this.skill4Pre=null,this.skill5Pre=null,this.skill6Pre=null,this.skill7Pre=null,this.skill8Pre=null,this.skill9Pre=null,this.skill10Pre=null,this.skill2012Pre=null,this.skill2013Pre=null,this.skill2002Pre=null,this.plaWing1Pre=null,this.plaWing2Pre=null,this.plaWing3Pre=null,this.plaWing4Pre=null,this.plaWing5Pre=null,this.plaWing6Pre=null,this.plaRob1Pre=null,this.plaRob2Pre=null,this.plaRob3Pre=null,this.plaBul1Pre=this.getRes(_.battle.Player1Bullet),this.plaBul3Pre=this.getRes(_.battle.Player3Bullet),this.plaBul4Pre=this.getRes(_.battle.Player4Bullet),this.plaBul5Pre=this.getRes(_.battle.Player5Bullet),this.plaBul6Pre=this.getRes(_.battle.Player6Bullet),this.plaBul6Pre1=this.getRes(_.battle.Player6Bullet1),this.plaBulPre=this.getRes(_.battle.PlayerLaser),this.skill1Pre=this.getRes(_.battle.PlayerSkill1),this.skill2Pre=this.getRes(_.battle.PlayerSkill2),this.skill3Pre=this.getRes(_.battle.PlayerSkill3),this.skill4Pre=this.getRes(_.battle.PlayerSkill4),this.skill5Pre=this.getRes(_.battle.PlayerSkill5),this.skill6Pre=this.getRes(_.battle.PlayerSkill6),this.skill7Pre=this.getRes(_.battle.PlayerSkill7),this.skill8Pre=this.getRes(_.battle.PlayerSkill8),this.skill9Pre=this.getRes(_.battle.PlayerSkill9),this.skill10Pre=this.getRes(_.battle.PlayerSkill10),this.skill2002Pre=this.getRes(_.battle.PlayerSkill2002),this.skill2012Pre=this.getRes(_.battle.PlayerSkill2012),this.skill2013Pre=this.getRes(_.battle.PlayerSkill2013),this.plaWing1Pre=this.getRes(_.battle.PlayerWing1),this.plaWing2Pre=this.getRes(_.battle.PlayerWing2),this.plaWing3Pre=this.getRes(_.battle.PlayerWing3),this.plaWing4Pre=this.getRes(_.battle.PlayerWing4),this.plaWing5Pre=this.getRes(_.battle.PlayerWing5),this.plaWing6Pre=this.getRes(_.battle.PlayerWing6),this.plaRob1Pre=this.getRes(_.battle.PlayerRobot1),this.plaRob2Pre=this.getRes(_.battle.PlayerRobot2),this.plaRob3Pre=this.getRes(_.battle.PlayerRobot3)}onEnable(){this.ins=ee.instance,r.on(dt.PlayerBullet,this,this.playerMainBullet),r.on(dt.GuidSkill,this,this.guidSkill),r.on(dt.BaseSkill1,this,this.baseSkill1),r.on(dt.BaseSkill1a,this,this.baseSkill1),r.on(dt.BaseSkill1b,this,this.baseSkill1),r.on(dt.BaseSkill2,this,this.baseSkill2),r.on(dt.BaseSkill2a,this,this.baseSkill2),r.on(dt.BaseSkill2b,this,this.baseSkill2),r.on(dt.BaseSkill3,this,this.baseSkill3),r.on(dt.BaseSkill4,this,this.baseSkill4),r.on(dt.BaseSkill4a,this,this.baseSkill4),r.on(dt.BaseSkill4b,this,this.baseSkill4),r.on(dt.BaseSkill5,this,this.baseSkill5),r.on(dt.BaseSkill5a,this,this.baseSkill5),r.on(dt.BaseSkill5b,this,this.baseSkill5),r.on(dt.BaseSkill6,this,this.baseSkill6),r.on(dt.BaseSkill6a,this,this.baseSkill6),r.on(dt.BaseSkill6b,this,this.baseSkill6),r.on(dt.BaseSkill7,this,this.baseSkill7),r.on(dt.BaseSkill9,this,this.baseSkill9),r.on(dt.BaseSkill11,this,this.baseSkill11),r.on(dt.BaseSkill13,this,this.baseSkill13),r.on(dt.BaseSkill14,this,this.baseSkill14),r.on(dt.BaseSkill15,this,this.baseSkill15),r.on(dt.Shield,this,this.shield),r.on(dt.TimeShield,this,this.timeShield),r.on(dt.DieShot,this,this.dieShot),r.on(dt.SuckBlood,this,this.suckBlood),r.on(dt.DieBoom,this,this.dieBoom),r.on(dt.BulSkill1,this,this.skill),r.on(dt.BulSkill2,this,this.skill2),r.on(dt.BulSkill3,this,this.skill3),r.on(dt.BulSkill4,this,this.skill4),r.on(dt.BulSkill5,this,this.skill5),r.on(dt.BulSkill6,this,this.skill6),r.on(dt.BulSkill7,this,this.skill7),r.on(dt.BulSkill8,this,this.skill8),r.on(dt.BulSkill9,this,this.skill9),r.on(dt.BulSkill10,this,this.skill10),r.on(dt.BulSkill2012,this,this.skill2012),r.on(dt.BulSkill2013,this,this.skill2013),r.on(dt.BulSkill2002,this,this.skill2002),r.on(dt.WingSkill1,this,this.wing1),r.on(dt.WingSkill2,this,this.wing2),r.on(dt.WingSkill3,this,this.wing3),r.on(dt.WingSkill4,this,this.wing4),r.on(dt.WingSkill5,this,this.wing5),r.on(dt.WingSkill6,this,this.wing6),r.on(dt.RobSkill1,this,this.robot1),r.on(dt.RobSkill2,this,this.robot2),r.on(dt.RobSkill3,this,this.robot3),r.on(dt.Sup_HP,this,this.supSkill1),r.on(dt.Sup_Att,this,this.supSkill2),r.on(dt.Sup_HPRec1,this,this.supSkill3),r.on(dt.Sup_HPRec2,this,this.supSkill4),r.on(dt.Sup_Crit,this,this.supSkill5)}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this)}guidSkill(){r.event(dt.WingSkill3),r.event(dt.WingSkill3),r.event(dt.BulSkill2),r.event(dt.BulSkill2002),r.event(dt.BulSkill2013),r.event(dt.BulSkill2012),r.event(dt.DieShot),r.event(dt.Shield),r.event(dt.BaseSkill6),r.event(dt.BaseSkill6),r.event(dt.BaseSkill6)}playerMainBullet(t,e){switch(e||(e=0),t){case 1:this.player1Bullet(e);break;case 2:this.player2Bullet(e);break;case 3:this.player3Bullet(e);break;case 4:this.player4Bullet(e);break;case 5:this.player5Bullet(e);break;case 6:this.player6Bullet(e)}}player1Bullet(t){const e=this.ins,s=t?1e3*e.otherPlayer[t-1].playerData.speed:1e3*e.playerData.speed,i=t?e.otherPlayer[t-1].v2:e.playerV2;Laya.timer.clear(i,this.player1BulletCall),Laya.timer.loop(s,i,this.player1BulletCall,[t,this])}player1BulletCall(t,e){const s=e.ins,i=t?s.otherPlayer[t-1].v2:s.playerV2;if(s.gameState!=rt.START)return;const a=t?s.otherPlayer[t-1].playerData:s.playerData;let l=3,n=a.mainNum*a.planeData.weapon,o=gt[a.id][a.mainNum];n&&(l+=n);for(let t=0;t<l;t++){const l=e.open(_.battle.Player1Bullet,e.plaBul1Pre);l.__bulType__="1.main";let h=l.getComponent(Ut);h||(h=l.addComponent(Ut));let r=a.attack*a.planeData.att/(n+1);h.setData(Math.floor(r),a.crit,a.critHurt,a.eneHurtStr,a.bosHurtStr);let c=l.getComponent(be);c||(c=l.addComponent(be)),c.norV3=e.getVec3(0,-1),c.state=rt.START,c.tar=null,c.speed=a.fspeed,c.cross=a.cross,c.deltaY=o[t],l.pos(i.x+o[t],i.y-30),a.track&&(c.cross=!1,c.tar=s.getMinEnemy(l)),s.player2Node.addChild(l)}}player2Bullet(t){const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=this.open(_.battle.PlayerLaser,this.plaBulPre),a=t?e.otherPlayer[t-1].v2:e.playerV2;let l=i.getComponent(Ut);l||(l=i.addComponent(Ut));let n=s.attack*s.planeData.att/(s.mainNum+1)/9;l.setData(Math.floor(n),s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr),i.getComponent(ie).pid=t;const o=i.getComponent(se);o.deltaY=-40,o.pid=t,i.pos(a.x,a.y-40),e.playerNode.addChild(i),(t?e.otherPlayer[t-1].lassv2:e.plaLassV2).push(i)}player3Bullet(t){const e=this.ins,s=t?1e3*e.otherPlayer[t-1].playerData.speed:1e3*e.playerData.speed,i=t?e.otherPlayer[t-1].v2:e.playerV2;Laya.timer.clear(i,this.player3BulletCall),Laya.timer.loop(s,i,this.player3BulletCall,[t,this])}player3BulletCall(t,e){const s=e.ins,i=t?s.otherPlayer[t-1].v2:s.playerV2;if(s.gameState!=rt.START)return;const a=t?s.otherPlayer[t-1].playerData:s.playerData,l=gt[3][a.mainNum],n=1+a.mainNum*a.planeData.weapon,o={};for(let t=0;t<l.length;t++){const h=e.open(_.battle.Player3Bullet,e.plaBul3Pre);let r=h.getComponent(Ut);r||(r=h.addComponent(Ut));let c=a.attack*a.planeData.att/n;r.setData(Math.floor(c),a.crit,a.critHurt,a.eneHurtStr,a.bosHurtStr);let d=h.getComponent(ce);d.trail=V.DaoDan,d.angle=l[t],d.xv=Math.abs(l[t])>90?-1:1,d.tar=e.ins.getMinEnemy2(i,o),d.cross=a.cross;let p=Math.tan(l[t]/180*Math.PI),u=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,-p,0),u),u.x*=d.xv,d.norV3=u,h.pos(i.x,i.y),s.player2Node.addChild(h)}}player4Bullet(t){const e=this.ins,s=t?1e3*e.otherPlayer[t-1].playerData.speed:1e3*e.playerData.speed,i=t?e.otherPlayer[t-1].v2:e.playerV2;Laya.timer.clear(i,this.player4BulletCall),Laya.timer.loop(s,i,this.player4BulletCall,[t,this])}player4BulletCall(t,e){const s=e.ins,i=t?s.otherPlayer[t-1].v2:s.playerV2;if(s.gameState!=rt.START)return;const a=t?s.otherPlayer[t-1].playerData:s.playerData,l=[[e.getVec3(0,-1)],[e.getVec3(-.09,-1),e.getVec3(.09,-1)],[e.getVec3(-.17,-.98),e.getVec3(0,-1),e.getVec3(.17,-.98)],[e.getVec3(-.26,-.97),e.getVec3(-.09,-1),e.getVec3(.09,-1),e.getVec3(.26,-.97)]];let n=1,o=a.mainNum*a.planeData.weapon,h=gt[a.id][a.mainNum],r=l[a.mainNum];o&&(n+=o);for(let t=0;t<n;t++){const l=e.open(_.battle.Player4Bullet,e.plaBul4Pre);let n=l.getComponent(Ut);n||(n=l.addComponent(Ut));let o=a.attack*a.planeData.att;n.setData(Math.floor(o),a.crit,a.critHurt,a.eneHurtStr,a.bosHurtStr);let c=l.getComponent(be);c||(c=l.addComponent(be)),c.att=o,c.trail=V.Main4,c.norV3=r[t],c.state=rt.START,c.tar=null,c.speed=a.fspeed,c.tspeed=.02,c.cross=a.cross,c.deltaY=h[t],l.pos(i.x+h[t],i.y+0),a.track&&(c.cross=!1,c.tar=s.getMinEnemy(l)),s.player2Node.addChild(l)}}player5Bullet(t){const e=this.ins,s=t?1e3*e.otherPlayer[t-1].playerData.speed:1e3*e.playerData.speed,i=t?e.otherPlayer[t-1].v2:e.playerV2;Laya.timer.clear(i,this.player5BulletCall),Laya.timer.loop(s,i,this.player5BulletCall,[t,this])}player5BulletCall(t,e){const s=e.ins,i=t?s.otherPlayer[t-1].v2:s.playerV2;if(s.gameState!=rt.START)return;const a=t?s.otherPlayer[t-1].playerData:s.playerData,l=[[e.getVec3(.0039,-1),e.getVec3(-.0039,-1)],[e.getVec3(.0117,-.9999),e.getVec3(-.0117,-.9999),e.getVec3(.0039,-1),e.getVec3(-.0039,-1)],[e.getVec3(.0195,-.9998),e.getVec3(-.0195,-.9998),e.getVec3(.0117,-.9999),e.getVec3(-.0117,-.9999),e.getVec3(.0039,-1),e.getVec3(-.0039,-1)],[e.getVec3(.0273,-.9996),e.getVec3(-.0273,-.9996),e.getVec3(.0195,-.9998),e.getVec3(-.0195,-.9998),e.getVec3(.0117,-.9999),e.getVec3(-.0117,-.9999),e.getVec3(.0039,-1),e.getVec3(-.0039,-1)]];let n=2,o=a.mainNum*a.planeData.weapon,h=gt[a.id][a.mainNum],r=l[a.mainNum];o&&(n+=o);for(let t=0;t<n;t++){const l=e.open(_.battle.Player5Bullet,e.plaBul5Pre);l.__bulType__="5.main";let n=l.getComponent(Ut);n||(n=l.addComponent(Ut));let c=a.attack*a.planeData.att/(o+1);n.setData(Math.floor(c),a.crit,a.critHurt,a.eneHurtStr,a.bosHurtStr);let d=l.getComponent(be);d||(d=l.addComponent(be)),d.norV3=r[t],d.state=rt.START,d.tar=null,d.speed=a.fspeed,d.tspeed=.05,d.cross=a.cross,d.deltaY=h[t],l.pos(i.x+h[t],i.y-40),a.track&&(d.cross=!1,d.tar=s.getMinEnemy(l)),s.player2Node.addChild(l)}}player6Bullet(t){const e=this.ins,s=t?1e3*e.otherPlayer[t-1].playerData.speed:1e3*e.playerData.speed,i=t?e.otherPlayer[t-1].v2:e.playerV2;Laya.timer.clear(i,this.player6BulletCall),Laya.timer.loop(s,i,this.player6BulletCall,[t,this])}player6BulletCall(t,e){const s=e.ins,i=t?s.otherPlayer[t-1].v2:s.playerV2;if(s.gameState!=rt.START)return;const a=t?s.otherPlayer[t-1].playerData:s.playerData;let l=7,n=4*a.mainNum,o=gt[a.id][a.mainNum],h=[[16,16,20,20,-13,-13,-40],[76,76,74,74,16,16,20,20,-13,-13,-40],[127,127,126,126,76,76,74,74,16,16,20,20,-13,-13,-40],[181,181,180,180,127,127,126,126,76,76,74,74,16,16,20,20,-13,-13,-40]][a.mainNum],r=[[0,0,1,1,0,0,1],[0,0,1,1,0,0,1,1,0,0,1],[0,0,1,1,0,0,1,1,0,0,1,1,0,0,1],[0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1]][a.mainNum];n&&(l+=n);for(let t=0;t<l;t++){let l=null;if(!(l=r[t]?e.open(_.battle.Player6Bullet1,e.plaBul6Pre1):e.open(_.battle.Player6Bullet,e.plaBul6Pre)))return;let c=l.getComponent(Ut);c||(c=l.addComponent(Ut));let d=a.attack*a.planeData.att/(n+1);c.setData(Math.floor(d),a.crit,a.critHurt,a.eneHurtStr,a.bosHurtStr);let p=l.getComponent(be);p||(p=l.addComponent(be)),p.norV3=e.getVec3(0,-1),p.state=rt.START,p.tar=null,p.speed=a.fspeed,p.tspeed=.05,p.cross=a.cross,p.deltaY=o[t],l.pos(i.x+o[t],i.y+h[t]),a.track&&(p.cross=!1,p.tar=s.getMinEnemy(l)),s.player2Node.addChild(l)}}baseSkill1(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;let i=A.skills[ut.HP1].value+1;s.hp=Math.floor(s.hp*i),s.currHP=Math.floor(s.currHP*i),s.setSkill(ut.HP1),r.event(dt.PlayerMaxHP,t)}supSkill1(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;let i=A.skills[ut.Sup_HP].value+1;s.hp=Math.floor(s.hp*i),s.currHP=Math.floor(s.currHP*i),s.setSkill22(ut.Sup_HP),r.event(dt.PlayerMaxHP,t)}baseSkill2(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;let i=A.skills[ut.Attack1].value+1;s.attack*=i,s.attack=Math.floor(s.attack),s.setSkill(ut.Attack1)}supSkill2(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;let i=A.skills[ut.Sup_Att].value+1;s.attack*=i,s.attack=Math.floor(s.attack),s.setSkill22(ut.Sup_Att)}baseSkill3(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;let i=A.skills[ut.HPRec1].value||.1,a=Math.floor(s.hp*i);s.currHP+a>s.hp?s.currHP=s.hp:s.currHP+=a,s.setSkill(ut.HPRec1),r.event(dt.PlayerHP,t)}supSkill3(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;let i=A.skills[ut.Sup_HPRec1].value||.1,a=Math.floor(s.hp*i);s.currHP+a>s.hp?s.currHP=s.hp:s.currHP+=a,s.setSkill22(ut.Sup_HPRec1),r.event(dt.PlayerHP,t)}supSkill4(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;let i=A.skills[ut.Sup_HPRec2].value||.1,a=Math.floor(s.hp*i);s.currHP+a>s.hp?s.currHP=s.hp:s.currHP+=a,s.setSkill22(ut.Sup_HPRec2),r.event(dt.PlayerHP,t)}baseSkill4(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;let i=A.skills[ut.Speed].value+1;if(s.speed/=i,s.setSkill(ut.Speed),1!=s.id&&3!=s.id&&4!=s.id&&5!=s.id&&6!=s.id||this.playerMainBullet(s.id,t),2==s.id){const i=t?e.otherPlayer[t-1].lassv2:e.plaLassV2;let a=i.length;const l=[[-40],[-40,-40],[10,-40,10],[10,-40,-40,10]];let n=t?e.otherPlayer[t-1].posv2:e.playerPosV2;for(let t=0;t<i.length;t++){i[t].removeSelf()}i.length=0;let o=gt[2][a-1],h=l[a-1];for(let l=0;l<a;l++){const a=this.open(_.battle.PlayerLaser,this.plaBulPre);let r=a.getComponent(Ut);r||(r=a.addComponent(Ut));let c=s.attack*s.planeData.att/(s.mainNum+1)/9;r.setData(Math.floor(c),s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr),a.getComponent(ie).pid=t;const d=a.getComponent(se);d.deltaX=o[l],d.deltaY=h[l],d.pid=t,a.pos(n.x+o[l],n.y+h[l]),e.playerNode.addChild(a),i.push(a)}}}baseSkill5(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;let i=A.skills[ut.Crit].value+1;s.crit*=i,s.critHurt*=i,s.setSkill(ut.Crit)}supSkill5(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;let i=A.skills[ut.Sup_Crit].value+1;s.crit*=i,s.critHurt*=i,s.setSkill22(ut.Sup_Crit)}baseSkill6(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;if(!(s.mainNum>=3))switch(s.mainNum++,s.attack*=1.4,s.attack=Math.floor(s.attack),s.setSkill2(ut.MainStr),s.id){case 1:break;case 2:const i=t?e.otherPlayer[t-1].lassv2:e.plaLassV2;let a=s.mainNum;const l=[[-40],[-40,-40],[10,-40,10],[10,-40,-40,10]];if(a>=4)return;let n=t?e.otherPlayer[t-1].posv2:e.playerPosV2;for(let t=0;t<i.length;t++){i[t].removeSelf()}i.length=0;let o=gt[2][a],h=l[a];for(let l=0;l<a+1;l++){const a=this.open(_.battle.PlayerLaser,this.plaBulPre);let r=a.getComponent(Ut);r||(r=a.addComponent(Ut));let c=s.attack*s.planeData.att/(s.mainNum+1)/9;r.setData(Math.floor(c),s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr),a.getComponent(ie).pid=t;const d=a.getComponent(se);d.deltaX=o[l],d.deltaY=h[l],d.pid=t,a.pos(n.x+o[l],n.y+h[l]),e.playerNode.addChild(a),i.push(a)}}}baseSkill7(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;switch(s.id){case 1:s.cross=!0;break;case 2:s.laserSta||(s.laserSta=1,r.event(dt.LaserCross));break;case 3:case 4:case 5:case 6:s.cross=!0}s.setSkill(ut.MainCross)}baseSkill9(t){t||(t=0);const e=this.ins;(t?e.otherPlayer[t-1].playerData:e.playerData).setSkill(ut.MainTrack)}shield(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].v2:e.playerV2,i=t?e.otherPlayer[t-1].playerData:e.playerData,a=t?e.otherPlayer[t-1].ballsv2:e.plaBallsV2,l=[this.getVec3(1,0),this.getVec3(-1,0)],n=this.getRes(_.battle.PlayerShield),o=A.skills[ut.Shield];Laya.timer.once(1e3*o.speed,s,()=>{for(let i=0;i<2;i++){const h=this.open(_.battle.PlayerShield,n),r=h.getComponent(re);r.pid=t,r.norV3=l[i].clone(),r.angle=i*Math.PI,r.speed=o.fspeed,h.rotation=-180-r.angle/Math.PI*180,h.pos(s.x+50*l[i].x,s.y+50*l[i].y),e.playerNode.addChild(h),a.push(h)}}),i.setSkill(ut.Shield)}timeShield(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;if(s.skills[ut.TimeShield])return;const i=this.getRes(_.battle.PlayerTimeShield),a=this.open(_.battle.PlayerTimeShield,i);a.getComponent(fe).pid=t;let l=t?e.otherPlayer[t-1].v2:e.playerV2;a.pos(l.x,l.y),e.playerNode.addChild(a),s.setSkill(ut.TimeShield),(t?e.otherPlayer[t-1].ballsv2:e.plaBallsV2).push(a)}dieShot(t){if(t||(t=0),t)return;this.ins.playerData.setSkill(ut.DieShot)}baseSkill11(t){if(t||(t=0),t)return;this.ins.playerData.setSkill(ut.Back)}baseSkill13(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;A.skills[ut.Anger].value;let i=s.hp/s.currHP;i>1.5&&(i=1.5),s.attack*=i,s.attack=Math.floor(s.attack),s.setSkill(ut.Anger)}baseSkill14(t){if(t||(t=0),t)return;this.ins.playerData.setSkill(ut.Cri)}baseSkill15(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;let i=s.hp/s.currHP;i>1.5&&(i=1.5),s.crit*=i,s.critHurt*=i,s.setSkill(ut.Fearless)}suckBlood(t){if(t||(t=0),t)return;this.ins.playerData.setSkill(ut.SuckBlood)}dieBoom(t){if(t||(t=0),t)return;this.ins.playerData.setSkill(ut.DieBoom)}skill(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=[this.getVec3(0,-1),this.getVec3(.71,-.71),this.getVec3(1,0),this.getVec3(.71,.71),this.getVec3(0,1),this.getVec3(-.71,.71),this.getVec3(-1,0),this.getVec3(-.71,-.71)],l=A.skills[ut.SwimShell];Laya.timer.loop(1e3*l.speed,i,()=>{if(e.gameState!=rt.START)return;if(this.getRes(V.FuYouPao))for(let t=0;t<8;t++){const n=this.open(_.battle.PlayerSkill1,this.skill1Pre);let o=n.getComponent(Ut);o||(o=n.addComponent(Ut));const h=A.skills[ut.SwimShell].value||1;o.setData(Math.floor(s.attack*h),s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);const c=n.getComponent(zt);n.__type__="fyp",c.speed=l.fspeed,c.norV3=a[t].clone(),c.state=rt.READY,c.tar=null,n.pos(i.x,i.y),e.player2Node.addChild(n),Laya.Tween.to(n,{x:i.x+150*a[t].x,y:i.y+150*a[t].y},80,null,Laya.Handler.create(this,()=>{const s=e.getMinEnemy(n);c.tar=s,7==t&&Laya.timer.once(500,this,()=>{r.event(dt.BulSkill1_Start)})}))}else Y.load3D([V.FuYouPao])}),s.setSkill(ut.SwimShell)}skill2(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=[this.getVec3(-.53,-.85),this.getVec3(.53,-.85),this.getVec3(-.41,-.91),this.getVec3(.41,-.91),this.getVec3(-.28,-.96),this.getVec3(.28,-.96),this.getVec3(-.14,-.99),this.getVec3(.14,-.99),this.getVec3(0,-1)],l=[.8,.8,.9,.9,1,.9,.9,.8,.8],n=A.skills[ut.ShockWave];Laya.timer.loop(1e3*n.speed,i,()=>{if(e.gameState==rt.START)for(let t=0;t<9;t++){const o=this.open(_.battle.PlayerSkill2,this.skill2Pre);o.alpha=l[t];let h=o.getComponent(Ut);h||(h=o.addComponent(Ut));const r=A.skills[ut.ShockWave].value||1;h.setData(Math.floor(s.attack*r),s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);const c=o.getComponent(de);c.speed=n.fspeed,c.norV3=a[t].clone(),o.pos(i.x+100*a[t].x,i.y+100*a[t].y),e.player2Node.addChild(o)}}),s.setSkill(ut.ShockWave)}skill3(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=this.open(_.battle.PlayerSkill3,this.skill3Pre);let a=i.getComponent(Ut);a||(a=i.addComponent(Ut));const l=A.skills[ut.Laser].value||1;a.setData(s.attack*l,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr),i.getComponent(se).pid=t;let n=t?e.otherPlayer[t-1].v2:e.playerV2;i.pos(n.x,n.y),e.playerNode.addChild(i),s.setSkill(ut.Laser),(t?e.otherPlayer[t-1].ballsv2:e.plaBallsV2).push(i)}skill4(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=[this.getVec3(.1,-.99),this.getVec3(-.1,-.99),this.getVec3(.31,-.95),this.getVec3(-.31,-.95),this.getVec3(.5,-.87),this.getVec3(-.5,-.87)],l=A.skills[ut.Shotgun];Laya.timer.loop(1e3*l.speed,i,()=>{e.gameState==rt.START&&this.schedule(200,()=>{for(let t=0;t<6;t++){const n=this.open(_.battle.PlayerSkill4,this.skill4Pre);let o=n.getComponent(Ut);o||(o=n.addComponent(Ut));const h=A.skills[ut.Shotgun].value||1;o.setData(s.attack*h,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);const r=n.getComponent(le);r.speed=l.fspeed,r.norV3=a[t].clone(),n.pos(i.x,i.y-30),e.player2Node.addChild(n)}},i,3)}),s.setSkill(ut.Shotgun)}skill5(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=A.skills[ut.RainbowMissile];Laya.timer.loop(1e3*a.speed,i,()=>{if(e.gameState!=rt.START)return;if(!this.getRes(V.CaiHon))return void Y.load3D([V.CaiHon]);let t=Math.floor(2*Math.random()+3),l=[];l.push(Math.floor(26*Math.random()+20)/180*Math.PI),l.push(Math.floor(91*Math.random()+45)/180*Math.PI),4==t&&l.push(Math.floor(91*Math.random()+45)/180*Math.PI),l.push(Math.floor(26*Math.random()+135)/180*Math.PI);let n=0;this.schedule(500,()=>{const t=this.open(_.battle.PlayerSkill5,this.skill5Pre);let o=t.getComponent(Ut);o||(o=t.addComponent(Ut));const h=A.skills[ut.RainbowMissile].value||1;o.setData(s.attack*h,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);const r=t.getComponent(ue);t.pos(i.x,i.y),r.speed=a.fspeed,r.pangle=l[n],r.tar=null,e.player2Node.addChild(t),Laya.timer.once(500,i,()=>{const s=e.getMinEnemy(t);r.tar=s}),n++},i,t)}),s.setSkill(ut.RainbowMissile)}skill6(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=t?e.otherPlayer[t-1].ballsv2:e.plaBallsV2,l=[this.getVec3(1,0),this.getVec3(-1,0)],n=A.skills[ut.RotatePoison];Laya.timer.once(1e3*n.speed,i,()=>{for(let o=0;o<2;o++){const h=this.open(_.battle.PlayerSkill6,this.skill6Pre);let r=h.getComponent(Ut);r||(r=h.addComponent(Ut));const c=A.skills[ut.RotatePoison].value||1;r.setData(s.attack*c,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);const d=h.getComponent(ye);d.pid=t,d.speed=n.fspeed,d.norV3=l[o].clone(),d.angle=o*Math.PI,d.type=ct.POISON,h.pos(i.x+200*l[o].x,i.y+200*l[o].y),a.push(h),e.playerNode.addChild(h)}this.initPlaBall(t)}),s.setSkill(ut.RotatePoison)}skill7(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=[this.getVec3(0,-1),this.getVec3(-.71,-.71),this.getVec3(.71,-.71)],l=A.skills[ut.NaughtyGhost];Laya.timer.loop(1e3*l.speed,i,()=>{if(e.gameState!=rt.START)return;if(this.getRes(V.DaoDanGui))for(let t=0;t<3;t++){const n=this.open(_.battle.PlayerSkill7,this.skill7Pre);let o=n.getComponent(Ut);o||(o=n.addComponent(Ut));const h=A.skills[ut.NaughtyGhost].value||1;o.setData(s.attack*h,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);const c=n.getComponent(me);c.speed=l.fspeed,c.norV3=a[t].clone(),n.pos(i.x,i.y),e.player2Node.addChild(n),r.event(dt.BulSkill7_Start)}else Y.load3D([V.DaoDanGui])}),s.setSkill(ut.NaughtyGhost)}skill8(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=t?e.otherPlayer[t-1].ballsv2:e.plaBallsV2,l=[this.getVec3(1,0),this.getVec3(-1,0)],n=A.skills[ut.RotateFire];Laya.timer.once(1e3*n.speed,i,()=>{for(let o=0;o<2;o++){const h=this.open(_.battle.PlayerSkill8,this.skill8Pre);let r=h.getComponent(Ut);r||(r=h.addComponent(Ut));const c=A.skills[ut.RotateFire].value||1;r.setData(s.attack*c,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);const d=h.getComponent(ye);d.pid=t,d.speed=n.fspeed,d.norV3=l[o].clone(),d.angle=o*Math.PI,d.type=ct.FIRE,h.pos(i.x+200*l[o].x,i.y+200*l[o].y),a.push(h),e.playerNode.addChild(h)}this.initPlaBall(t)}),s.setSkill(ut.RotateFire)}skill9(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=this.open(_.battle.PlayerSkill9,this.skill9Pre);let l=a.getComponent(Ut);l||(l=a.addComponent(Ut));const n=A.skills[ut.Magnet].value||1;l.setData(s.attack*n,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr),a.getComponent(ge).pid=t,a.pos(i.x,i.y),e.bgTopNode.addChild(a),s.setSkill(ut.Magnet),(t?e.otherPlayer[t-1].ballsv2:e.plaBallsV2).push(a)}skill10(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=t?e.otherPlayer[t-1].ballsv2:e.plaBallsV2,l=[this.getVec3(1,0),this.getVec3(-1,0)],n=A.skills[ut.RotateIce];Laya.timer.once(1e3*n.speed,i,()=>{for(let o=0;o<2;o++){const h=this.open(_.battle.PlayerSkill10,this.skill10Pre);let r=h.getComponent(Ut);r||(r=h.addComponent(Ut));const c=A.skills[ut.RotateIce].value||1;r.setData(s.attack*c,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);const d=h.getComponent(ye);d.pid=t,d.speed=n.fspeed,d.norV3=l[o].clone(),d.angle=o*Math.PI,d.type=ct.ICE,h.pos(i.x+200*l[o].x,i.y+200*l[o].y),a.push(h),e.playerNode.addChild(h)}this.initPlaBall(t)}),s.setSkill(ut.RotateIce)}initPlaBall(t){const e=this.ins,s=t?e.otherPlayer[t-1].v2:e.playerV2,i=t?e.otherPlayer[t-1].ballsv2:e.plaBallsV2,a={2:[0,Math.PI],4:[0,Math.PI,Math.PI/2,Math.PI/2*3],6:[0,Math.PI,Math.PI/3,Math.PI/3*4,Math.PI/3*2,Math.PI/3*5]}[i.length];if(a)for(let t=0;t<i.length;t++){const e=i[t],l=e.getComponent(ye);l.angle=a[t],e.rotation=-180-l.angle/Math.PI*180,e.x=s.x+200*Math.cos(l.angle),e.y=s.y-200*Math.sin(l.angle)}}skill2012(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=[150,120,90,60,30],l=(this.getVec3(-.71,-.71),this.getVec3(-.34,-.94),this.getVec3(0,-1),this.getVec3(.34,-.94),this.getVec3(.71,-.71),A.skills[ut.Fireworks]);Laya.timer.loop(1e3*l.speed,i,()=>{if(e.gameState!=rt.START)return;if(this.getRes(V.YanHua))for(let t=0;t<a.length;t++){const n=this.open(_.battle.PlayerSkill2012,this.skill2012Pre);let o=n.getComponent(Ut);o||(o=n.addComponent(Ut));const h=A.skills[ut.Fireworks].value||1;o.setData(s.attack*h,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);let r=n.getComponent(pe);r.speed=l.fspeed,r.pangle=a[t]/180*Math.PI,r.tar=null,n.pos(i.x,i.y),e.player2Node.addChild(n),Laya.timer.once(500,i,()=>{const t=e.getMinEnemy(n);r.tar=t})}else Y.load3D([V.YanHua])}),s.setSkill(ut.Fireworks)}skill2002(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=A.skills[ut.Missile];Laya.timer.loop(1e3*a.speed,i,()=>{if(e.gameState!=rt.START)return;if(!this.getRes(V.DaoDanFu))return void Y.load3D([V.DaoDanFu]);const t={};for(let l=0;l<2;l++){let n=l?1:-1,o=0;const h=[60,45,30];for(let l=0;l<3;l++){let r=h[l],c=Math.tan(r/180*Math.PI),d=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,c,0),d),d.x*=n,o+=Math.floor(251*Math.random()+50),Laya.timer.once(1,this,()=>{const l=this.open(_.battle.PlayerSkill2002,this.skill2002Pre);let o=l.getComponent(Ut);o||(o=l.addComponent(Ut));const h=a.value||1;o.setData(s.attack*h,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);const c=l.getComponent(ce);c.trail=V.DaoDanFu,c.speed=a.fspeed,c.norV3=d,c.angle=n>0?-r:-(r+90),c.xv=n,c.tar=e.getMinEnemy2(i,t),l.pos(i.x,i.y),e.player2Node.addChild(l)})}}}),s.setSkill(ut.Missile)}skill2013(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=[this.getVec3(-.87,-.5),this.getVec3(-.77,-.64),this.getVec3(-.64,-.77),this.getVec3(-.5,-.87),this.getVec3(-.34,-.94),this.getVec3(-.17,-.98),this.getVec3(0,-1),this.getVec3(.17,-.98),this.getVec3(.34,-.94),this.getVec3(.5,-.87),this.getVec3(.64,-.77),this.getVec3(.77,-.64),this.getVec3(.87,-.5)],l=A.skills[ut.Brid];let n=0,o=!0;Laya.timer.loop(1e3*l.speed,i,()=>{if(e.gameState!=rt.START)return;n<=0&&!o&&(o=!0),n>=a.length-1&&o&&(o=!1);const t=this.open(_.battle.PlayerSkill2013,this.skill2013Pre);let h=t.getComponent(Ut);h||(h=t.addComponent(Ut));const r=l.value||1;h.setData(s.attack*r,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);const c=t.getComponent(zt);c.speed=l.fspeed,c.norV3=a[n].clone(),c.cross=!1,c.tar=null,c.state=rt.START,c.addSpeed=1.3,t.pos(i.x+150*a[n].x,i.y+150*a[n].y),e.player2Node.addChild(t),o?n++:n--}),s.setSkill(ut.Brid)}wing1(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=t?e.otherPlayer[t-1].wingsv2:e.plaWingsV2;let l=a.length;if(l>=4)return;let n=i,o=bt[l/2];for(let s=0;s<2;s++){const i=this.open(_.battle.PlayerWing1,this.plaWing1Pre),l=i.getComponent(ke);i.getComponent(Ce).pid=t,l.pid=t,l.deltaX=o[s].dx,l.deltaY=o[s].dy,i.pos(n.x+o[s].dx,n.y+o[s].dy+1e3),a.push(i),e.bgTopNode.addChild(i)}s.setSkill(ut.BlastWing)}wing2(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=t?e.otherPlayer[t-1].wingsv2:e.plaWingsV2;let l=a.length;if(l>=4)return;let n=i,o=bt[l/2];for(let s=0;s<2;s++){const i=this.open(_.battle.PlayerWing2,this.plaWing2Pre),l=i.getComponent(ke),h=i.getComponent(Le);h.pid=t,l.pid=t,l.deltaX=o[s].dx,l.deltaY=o[s].dy,h.xv=o[s].v,i.pos(n.x+o[s].dx,n.y+o[s].dy+1e3),a.push(i),e.bgTopNode.addChild(i)}s.setSkill(ut.MissileWing)}wing3(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=t?e.otherPlayer[t-1].wingsv2:e.plaWingsV2;let l=a.length;if(l>=6)return;let n=i,o=bt[l/2];for(let s=0;s<2;s++){const i=this.open(_.battle.PlayerWing3,this.plaWing3Pre),l=i.getComponent(ke),h=i.getComponent(xe);h.pid=t,l.pid=t,l.deltaX=o[s].dx,l.deltaY=o[s].dy,h.xv=o[s].v,i.pos(n.x+o[s].dx,n.y+o[s].dy+1e3),a.push(i),e.bgTopNode.addChild(i)}s.setSkill(ut.LaserWing)}wing4(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=t?e.otherPlayer[t-1].wingsv2:e.plaWingsV2;let l=a.length;if(l>=4)return;let n=i,o=bt[l/2];for(let s=0;s<2;s++){const i=this.open(_.battle.PlayerWing4,this.plaWing4Pre),l=i.getComponent(ke);i.getComponent(ve).pid=t,l.pid=t,l.deltaX=o[s].dx,l.deltaY=o[s].dy,i.pos(n.x+o[s].dx,n.y+o[s].dy+1e3),a.push(i),e.bgTopNode.addChild(i)}s.setSkill(ut.AutoWing)}wing5(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=t?e.otherPlayer[t-1].wingsv2:e.plaWingsV2;let l=a.length;if(l>=4)return;let n=i,o=bt[l/2];for(let s=0;s<2;s++){const i=this.open(_.battle.PlayerWing5,this.plaWing5Pre),l=i.getComponent(ke),h=i.getComponent(Ee);h.pid=t,l.pid=t,l.deltaX=o[s].dx,l.deltaY=o[s].dy,h.xv=o[s].v,i.pos(n.x+o[s].dx,n.y+o[s].dy+1e3),a.push(i),e.bgTopNode.addChild(i)}s.setSkill(ut.ShotWing)}wing6(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=t?e.otherPlayer[t-1].wingsv2:e.plaWingsV2;let l=a.length;if(l>=4)return;let n=i,o=bt[l/2];for(let s=0;s<2;s++){const i=this.open(_.battle.PlayerWing6,this.plaWing6Pre),l=i.getComponent(ke);i.getComponent(we).pid=t,l.pid=t,l.deltaX=o[s].dx,l.deltaY=o[s].dy,i.pos(n.x+o[s].dx,n.y+o[s].dy+1e3),a.push(i),e.bgTopNode.addChild(i)}s.setSkill(ut.ShieldWing)}robot1(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=A.skills[ut.BlastRobot],l=a.speed||5,n=a.robotsp||.2;Laya.timer.loop(1e3*l,i,()=>{if(e.gameState!=rt.START)return;const s=this.open(_.battle.PlayerRobot1,this.plaRob1Pre),a=s.getComponent(ae);s.getComponent(ne).pid=t,a.norV3=this.getVec3(0,-1),a.speed=n,s.pos(i.x,i.y-100),e.bgTopNode.addChild(s)}),s.setSkill(ut.BlastRobot)}robot2(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=A.skills[ut.ShieldRobot],l=a.speed||5,n=a.robotsp||.2;Laya.timer.loop(1e3*l,i,()=>{if(e.gameState!=rt.START)return;const s=this.open(_.battle.PlayerRobot2,this.plaRob2Pre),a=s.getComponent(ae);s.getComponent(he).pid=t,a.norV3=this.getVec3(0,-1),a.speed=n,s.pos(i.x,i.y-100),e.bgTopNode.addChild(s)}),s.setSkill(ut.ShieldRobot)}robot3(t){t||(t=0);const e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData,i=t?e.otherPlayer[t-1].v2:e.playerV2,a=A.skills[ut.LaserRobot],l=a.speed||5,n=a.robotsp||.2;Laya.timer.loop(1e3*l,i,()=>{if(e.gameState!=rt.START)return;const t=this.open(_.battle.PlayerRobot3,this.plaRob3Pre);let l=t.getComponent(Ut);l||(l=t.addComponent(Ut));const o=a.value||1;l.setData(s.attack*o,s.crit,s.critHurt,s.eneHurtStr,s.bosHurtStr);const h=t.getComponent(ae);h.norV3=this.getVec3(0,-1),h.speed=n,t.pos(i.x,i.y-100),e.bgTopNode.addChild(t)}),s.setSkill(ut.LaserRobot)}}var Be='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n\tprecision highp int;\r\n#else\r\n\tprecision mediump float;\r\n\tprecision mediump int;\r\n#endif\r\n#include "Lighting.glsl";\r\n#include "LayaUtile.glsl"\r\n#include "Shadow.glsl";\r\n\r\n\r\nattribute vec4 a_Position;\r\n\r\n#ifdef GPU_INSTANCE\r\n\tattribute mat4 a_MvpMatrix;\r\n#else\r\n\tuniform mat4 u_MvpMatrix;\r\n#endif\r\n\r\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\r\n\tattribute vec2 a_Texcoord0;\r\n\tvarying vec2 v_Texcoord0;\r\n#endif\r\n\r\n#if defined(LIGHTMAP)&&defined(UV1)\r\n\tattribute vec2 a_Texcoord1;\r\n#endif\r\n\r\n#ifdef LIGHTMAP\r\n\tuniform vec4 u_LightmapScaleOffset;\r\n\tvarying vec2 v_LightMapUV;\r\n#endif\r\n\r\n#ifdef COLOR\r\n\tattribute vec4 a_Color;\r\n\tvarying vec4 v_Color;\r\n#endif\r\n\r\n#ifdef BONE\r\n\tconst int c_MaxBoneCount = 24;\r\n\tattribute vec4 a_BoneIndices;\r\n\tattribute vec4 a_BoneWeights;\r\n\tuniform mat4 u_Bones[c_MaxBoneCount];\r\n#endif\r\n\r\nattribute vec3 a_Normal;\r\nvarying vec3 v_Normal; \r\n\r\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\tuniform vec3 u_CameraPos;\r\n\tvarying vec3 v_ViewDir; \r\n#endif\r\n\r\n#if defined(NORMALMAP)\r\n\tattribute vec4 a_Tangent0;\r\n\tvarying vec3 v_Tangent;\r\n\tvarying vec3 v_Binormal;\r\n#endif\r\n\r\n#ifdef GPU_INSTANCE\r\n\tattribute mat4 a_WorldMat;\r\n#else\r\n\tuniform mat4 u_WorldMat;\r\n#endif\r\n\r\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\tvarying vec3 v_PositionWorld;\r\n#endif\r\n\r\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\r\n\tvarying vec4 v_ShadowCoord;\r\n#endif\r\n\r\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\tvarying vec4 v_SpotShadowCoord;\r\n#endif\r\n\r\n#ifdef TILINGOFFSET\r\n\tuniform vec4 u_TilingOffset;\r\n#endif\r\n\r\n\r\n\r\nvoid main()\r\n{\r\n\tvec4 position;\r\n\t#ifdef BONE\r\n\t\tmat4 skinTransform;\r\n\t \t#ifdef SIMPLEBONE\r\n\t\t\tfloat currentPixelPos;\r\n\t\t\t#ifdef GPU_INSTANCE\r\n\t\t\t\tcurrentPixelPos = a_SimpleTextureParams.x+a_SimpleTextureParams.y;\r\n\t\t\t#else\r\n\t\t\t\tcurrentPixelPos = u_SimpleAnimatorParams.x+u_SimpleAnimatorParams.y;\r\n\t\t\t#endif\r\n\t\t\tfloat offset = 1.0/u_SimpleAnimatorTextureSize;\r\n\t\t\tskinTransform =  loadMatFromTexture(currentPixelPos,int(a_BoneIndices.x),offset) * a_BoneWeights.x;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.y),offset) * a_BoneWeights.y;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.z),offset) * a_BoneWeights.z;\r\n\t\t\tskinTransform += loadMatFromTexture(currentPixelPos,int(a_BoneIndices.w),offset) * a_BoneWeights.w;\r\n\t\t#else\r\n\t\t\tskinTransform =  u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\r\n\t\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\r\n\t\t#endif\r\n\t\tposition=skinTransform*a_Position;\r\n\t #else\r\n\t\tposition=a_Position;\r\n\t#endif\r\n\r\n\t#ifdef GPU_INSTANCE\r\n\t\tgl_Position = a_MvpMatrix * position;\r\n\t#else\r\n\t\tgl_Position = u_MvpMatrix * position;\r\n\t#endif\r\n\t\r\n\tmat4 worldMat;\r\n\t#ifdef GPU_INSTANCE\r\n\t\tworldMat = a_WorldMat;\r\n\t#else\r\n\t\tworldMat = u_WorldMat;\r\n\t#endif\r\n\r\n\tmat3 worldInvMat;\r\n\t#ifdef BONE\r\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat*skinTransform));\r\n\t#else\r\n\t\tworldInvMat=INVERSE_MAT(mat3(worldMat));\r\n\t#endif  \r\n\tv_Normal=normalize(a_Normal*worldInvMat);\r\n\t#if defined(NORMALMAP)\r\n\t\tv_Tangent=normalize(a_Tangent0.xyz*worldInvMat);\r\n\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\r\n\t#endif\r\n\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\t\tvec3 positionWS=(worldMat*position).xyz;\r\n\t\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\t\tv_ViewDir = u_CameraPos-positionWS;\r\n\t\t#endif\r\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\t\t\tv_PositionWorld = positionWS;\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\r\n\t\t#ifdef TILINGOFFSET\r\n\t\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\r\n\t\t#else\r\n\t\t\tv_Texcoord0=a_Texcoord0;\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t#ifdef LIGHTMAP\r\n\t\t#ifdef UV1\r\n\t\t\tv_LightMapUV=vec2(a_Texcoord1.x,1.0-a_Texcoord1.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\r\n\t\t#else\r\n\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,1.0-a_Texcoord0.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\r\n\t\t#endif \r\n\t\tv_LightMapUV.y=1.0-v_LightMapUV.y;\r\n\t#endif\r\n\r\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\r\n\t\tv_Color=a_Color;\r\n\t#endif\r\n\r\n\t#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\r\n\t\tv_ShadowCoord =getShadowCoord(vec4(positionWS,1.0));\r\n\t#endif\r\n\r\n\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\tv_SpotShadowCoord = u_SpotViewProjectMatrix*vec4(positionWS,1.0);\r\n\t#endif\r\n\r\n\tgl_Position=remapGLPositionZ(gl_Position);\r\n}',Ae='#if defined(GL_FRAGMENT_PRECISION_HIGH)// 原来的写法会被我们自己的解析流程处理，而我们的解析是不认内置宏的，导致被删掉，所以改成 if defined 了\r\n\tprecision highp float;\r\n\tprecision highp int;\r\n#else\r\n\tprecision mediump float;\r\n\tprecision mediump int;\r\n#endif\r\n\r\n#include "Lighting.glsl";\r\n#include "Shadow.glsl"\r\n\r\nuniform sampler2D u_NoiseTex;\r\nuniform float u_Time;\r\nuniform vec4 u_DiffuseColor;\r\n\r\n#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\r\n\tvarying vec4 v_Color;\r\n#endif\r\n\r\n#ifdef ALPHATEST\r\n\tuniform float u_AlphaTestValue;\r\n#endif\r\n\r\n#ifdef DIFFUSEMAP\r\n\tuniform sampler2D u_DiffuseTexture;\r\n#endif\r\n\r\n\r\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\r\n\tvarying vec2 v_Texcoord0;\r\n#endif\r\n\r\n#ifdef LIGHTMAP\r\n\tvarying vec2 v_LightMapUV;\r\n\tuniform sampler2D u_LightMap;\r\n#endif\r\n\r\nvarying vec3 v_Normal;\r\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\tvarying vec3 v_ViewDir; \r\n\r\n\tuniform vec3 u_MaterialSpecular;\r\n\tuniform float u_Shininess;\r\n\r\n\t#ifdef LEGACYSINGLELIGHTING\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tuniform DirectionLight u_DirectionLight;\r\n\t\t#endif\r\n\t\t#ifdef POINTLIGHT\r\n\t\t\tuniform PointLight u_PointLight;\r\n\t\t#endif\r\n\t\t#ifdef SPOTLIGHT\r\n\t\t\tuniform SpotLight u_SpotLight;\r\n\t\t#endif\r\n\t#else\r\n\t\tuniform mat4 u_View;\r\n\t\tuniform vec4 u_ProjectionParams;\r\n\t\tuniform vec4 u_Viewport;\r\n\t\tuniform int u_DirationLightCount;\r\n\t\tuniform sampler2D u_LightBuffer;\r\n\t\tuniform sampler2D u_LightClusterBuffer;\r\n\t#endif\r\n\r\n\t#ifdef SPECULARMAP \r\n\t\tuniform sampler2D u_SpecularTexture;\r\n\t#endif\r\n#endif\r\n\r\n#ifdef NORMALMAP \r\n\tuniform sampler2D u_NormalTexture;\r\n\tvarying vec3 v_Tangent;\r\n\tvarying vec3 v_Binormal;\r\n#endif\r\n\r\n#ifdef FOG\r\n\tuniform float u_FogStart;\r\n\tuniform float u_FogRange;\r\n\tuniform vec3 u_FogColor;\r\n#endif\r\n\r\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||(defined(CALCULATE_SHADOWS)&&defined(SHADOW_CASCADE))||defined(CALCULATE_SPOTSHADOWS)\r\n\tvarying vec3 v_PositionWorld;\r\n#endif\r\n\r\n\r\n#include "GlobalIllumination.glsl";//"GlobalIllumination.glsl use uniform should at front of this\r\n\r\n#if defined(CALCULATE_SHADOWS)&&!defined(SHADOW_CASCADE)\r\n\tvarying vec4 v_ShadowCoord;\r\n#endif\r\n\r\n#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\tvarying vec4 v_SpotShadowCoord;\r\n#endif\r\n\r\n\r\nvoid main()\r\n{\r\n\tvec3 normal;//light and SH maybe use normal\r\n\t#if defined(NORMALMAP)\r\n\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\r\n\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\r\n\t#else\r\n\t\tnormal = normalize(v_Normal);\r\n\t#endif\r\n\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\tvec3 viewDir= normalize(v_ViewDir);\r\n\t#endif\r\n\r\n\tLayaGIInput giInput;\r\n\t#ifdef LIGHTMAP\t\r\n\t\tgiInput.lightmapUV=v_LightMapUV;\r\n\t#endif\r\n\tvec3 globalDiffuse=layaGIBase(giInput,1.0,normal);\r\n\t\r\n\tvec4 mainColor=u_DiffuseColor;\r\n\t#ifdef DIFFUSEMAP\r\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\r\n\t\tmainColor=mainColor*difTexColor;\r\n\t#endif \r\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\r\n\t\tmainColor=mainColor*v_Color;\r\n\t#endif \r\n    \r\n\t#ifdef ALPHATEST\r\n\t\tif(mainColor.a<u_AlphaTestValue)\r\n\t\t\tdiscard;\r\n\t#endif\r\n  \r\n\t\r\n\tvec3 diffuse = vec3(0.0);\r\n\tvec3 specular= vec3(0.0);\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\tvec3 dif,spe;\r\n\t\t#ifdef SPECULARMAP\r\n\t\t\tvec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\r\n\t\t#else\r\n\t\t\t#ifdef DIFFUSEMAP\r\n\t\t\t\tvec3 gloss=vec3(difTexColor.a);\r\n\t\t\t#else\r\n\t\t\t\tvec3 gloss=vec3(1.0);\r\n\t\t\t#endif\r\n\t\t#endif\r\n\t#endif\r\n\r\n\t\r\n\t\r\n\t#ifdef LEGACYSINGLELIGHTING\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,dif,spe);\r\n\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\t#ifdef SHADOW_CASCADE\r\n\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\r\n\t\t\t\t#else\r\n\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\r\n\t\t\t\t#endif\r\n\t\t\t\tfloat shadowAttenuation=sampleShadowmap(shadowCoord);\r\n\t\t\t\tdif *= shadowAttenuation;\r\n\t\t\t\tspe *= shadowAttenuation;\r\n\t\t\t#endif\r\n\t\t\tdiffuse+=dif;\r\n\t\t\tspecular+=spe;\r\n\t\t#endif\r\n\t\r\n\t\t#ifdef POINTLIGHT\r\n\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,dif,spe);\r\n\t\t\tdiffuse+=dif;\r\n\t\t\tspecular+=spe;\r\n\t\t#endif\r\n\r\n\t\t#ifdef SPOTLIGHT\r\n\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,dif,spe);\r\n\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\r\n\t\t\t\tfloat spotShadowAttenuation = sampleSpotShadowmap(spotShadowcoord);\r\n\t\t\t\tdif *= spotShadowAttenuation;\r\n\t\t\t\tspe *= spotShadowAttenuation;\r\n\t\t\t#endif\r\n\t\t\tdiffuse+=dif;\r\n\t\t\tspecular+=spe;\r\n\t\t#endif\r\n\t#else\r\n\t\t#ifdef DIRECTIONLIGHT\r\n\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t{\r\n\t\t\t\tif(i >= u_DirationLightCount)\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tDirectionLight directionLight = getDirectionLight(u_LightBuffer,i);\r\n\t\t\t\t#if defined(CALCULATE_SHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\t\tif(i == 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t#ifdef SHADOW_CASCADE\r\n\t\t\t\t\t\t\tvec4 shadowCoord = getShadowCoord(vec4(v_PositionWorld,1.0));\r\n\t\t\t\t\t\t#else\r\n\t\t\t\t\t\t\tvec4 shadowCoord = v_ShadowCoord;\r\n\t\t\t\t\t\t#endif\r\n\t\t\t\t\t\tdirectionLight.color *= sampleShadowmap(shadowCoord);\r\n\t\t\t\t\t}\r\n\t\t\t\t#endif\r\n\t\t\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,directionLight,dif,spe);\r\n\t\t\t\tdiffuse+=dif;\r\n\t\t\t\tspecular+=spe;\r\n\t\t\t}\r\n\t\t#endif\r\n\t\t#if defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\t\tivec4 clusterInfo =getClusterInfo(u_LightClusterBuffer,u_View,u_Viewport, v_PositionWorld,gl_FragCoord,u_ProjectionParams);\r\n\t\t\t#ifdef POINTLIGHT\r\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t\t{\r\n\t\t\t\t\tif(i >= clusterInfo.x)//PointLightCount\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tPointLight pointLight = getPointLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\r\n\t\t\t\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,pointLight,dif,spe);\r\n\t\t\t\t\tdiffuse+=dif;\r\n\t\t\t\t\tspecular+=spe;\r\n\t\t\t\t}\r\n\t\t\t#endif\r\n\t\t\t#ifdef SPOTLIGHT\r\n\t\t\t\tfor (int i = 0; i < MAX_LIGHT_COUNT; i++) \r\n\t\t\t\t{\r\n\t\t\t\t\tif(i >= clusterInfo.y)//SpotLightCount\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tSpotLight spotLight = getSpotLight(u_LightBuffer,u_LightClusterBuffer,clusterInfo,i);\r\n\t\t\t\t\t#if defined(CALCULATE_SPOTSHADOWS)//shader中自定义的宏不可用ifdef 必须改成if defined\r\n\t\t\t\t\t\tif(i == 0)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvec4 spotShadowcoord = v_SpotShadowCoord;\r\n\t\t\t\t\t\t\tspotLight.color *= sampleSpotShadowmap(spotShadowcoord);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t#endif\r\n\t\t\t\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,spotLight,dif,spe);\r\n\t\t\t\t\tdiffuse+=dif;\r\n\t\t\t\t\tspecular+=spe;\r\n\t\t\t\t}\r\n\t\t\t#endif\r\n\t\t#endif\r\n\t#endif\r\n\r\n\tgl_FragColor =vec4(mainColor.rgb*(globalDiffuse + diffuse),mainColor.a);\r\n\r\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\r\n\t\tgl_FragColor.rgb+=specular;\r\n\t#endif\r\n\t  \r\n\t#ifdef FOG\r\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\r\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\r\n\t#endif\r\n\r\n\tvec3 nor = texture2D(u_NoiseTex, vec2(v_Texcoord0.x - u_Time * 0.5, v_Texcoord0.y)).rgb;\r\n\tvec4 fra = gl_FragColor;\r\n\tgl_FragColor = vec4(nor.r + fra.r * 0.8, nor.g + fra.g * 0.8, nor.b + fra.b * 0.8, gl_FragColor.a);\r\n}\r\n\r\n';const _e=Laya.Shader3D,Ve=Laya.Material,Re=Laya.RenderState;class Ne extends Ve{constructor(){super(),this.NOISE_TEX=_e.propertyNameToID("u_NoiseTex"),this._enableVertexColor=!1,this.setShaderName("MYShaderMaterial"),this._albedoIntensity=1,this._albedoColor=new Laya.Vector4(1,1,1,1);var t=this._shaderValues;t.setVector(Ne.ALBEDOCOLOR,new Laya.Vector4(1,1,1,1)),t.setVector(Ne.MATERIALSPECULAR,new Laya.Vector4(1,1,1,1)),t.setNumber(Ne.SHININESS,.078125),t.setNumber(Ve.ALPHATESTVALUE,.5),t.setVector(Ne.TILINGOFFSET,new Laya.Vector4(1,1,0,0)),this._enableLighting=!0,this.renderMode=Ne.RENDERMODE_OPAQUE}static __initDefine__(){Ne.SHADERDEFINE_DIFFUSEMAP=_e.getDefineByName("DIFFUSEMAP"),Ne.SHADERDEFINE_NORMALMAP=_e.getDefineByName("NORMALMAP"),Ne.SHADERDEFINE_SPECULARMAP=_e.getDefineByName("SPECULARMAP"),Ne.SHADERDEFINE_TILINGOFFSET=_e.getDefineByName("TILINGOFFSET"),Ne.SHADERDEFINE_ENABLEVERTEXCOLOR=_e.getDefineByName("ENABLEVERTEXCOLOR")}get _ColorR(){return this._albedoColor.x}set _ColorR(t){this._albedoColor.x=t,this.albedoColor=this._albedoColor}get _ColorG(){return this._albedoColor.y}set _ColorG(t){this._albedoColor.y=t,this.albedoColor=this._albedoColor}get _ColorB(){return this._albedoColor.z}set _ColorB(t){this._albedoColor.z=t,this.albedoColor=this._albedoColor}get _ColorA(){return this._albedoColor.w}set _ColorA(t){this._albedoColor.w=t,this.albedoColor=this._albedoColor}get _Color(){return this._shaderValues.getVector(Ne.ALBEDOCOLOR)}set _Color(t){this.albedoColor=t}get _SpecColorR(){return this._shaderValues.getVector(Ne.MATERIALSPECULAR).x}set _SpecColorR(t){this._shaderValues.getVector(Ne.MATERIALSPECULAR).x=t}get _SpecColorG(){return this._shaderValues.getVector(Ne.MATERIALSPECULAR).y}set _SpecColorG(t){this._shaderValues.getVector(Ne.MATERIALSPECULAR).y=t}get _SpecColorB(){return this._shaderValues.getVector(Ne.MATERIALSPECULAR).z}set _SpecColorB(t){this._shaderValues.getVector(Ne.MATERIALSPECULAR).z=t}get _SpecColorA(){return this._shaderValues.getVector(Ne.MATERIALSPECULAR).w}set _SpecColorA(t){this._shaderValues.getVector(Ne.MATERIALSPECULAR).w=t}get _SpecColor(){return this._shaderValues.getVector(Ne.MATERIALSPECULAR)}set _SpecColor(t){this.specularColor=t}get _AlbedoIntensity(){return this._albedoIntensity}set _AlbedoIntensity(t){if(this._albedoIntensity!==t){var e=this._shaderValues.getVector(Ne.ALBEDOCOLOR);Laya.Vector4.scale(this._albedoColor,t,e),this._albedoIntensity=t,this._shaderValues.setVector(Ne.ALBEDOCOLOR,e)}}get _Shininess(){return this._shaderValues.getNumber(Ne.SHININESS)}set _Shininess(t){t=Math.max(0,Math.min(1,t)),this._shaderValues.setNumber(Ne.SHININESS,t)}get _MainTex_STX(){return this._shaderValues.getVector(Ne.TILINGOFFSET).x}set _MainTex_STX(t){var e=this._shaderValues.getVector(Ne.TILINGOFFSET);e.x=t,this.tilingOffset=e}get _MainTex_STY(){return this._shaderValues.getVector(Ne.TILINGOFFSET).y}set _MainTex_STY(t){var e=this._shaderValues.getVector(Ne.TILINGOFFSET);e.y=t,this.tilingOffset=e}get _MainTex_STZ(){return this._shaderValues.getVector(Ne.TILINGOFFSET).z}set _MainTex_STZ(t){var e=this._shaderValues.getVector(Ne.TILINGOFFSET);e.z=t,this.tilingOffset=e}get _MainTex_STW(){return this._shaderValues.getVector(Ne.TILINGOFFSET).w}set _MainTex_STW(t){var e=this._shaderValues.getVector(Ne.TILINGOFFSET);e.w=t,this.tilingOffset=e}get _MainTex_ST(){return this._shaderValues.getVector(Ne.TILINGOFFSET)}set _MainTex_ST(t){this.tilingOffset=t}get _Cutoff(){return this.alphaTestValue}set _Cutoff(t){this.alphaTestValue=t}set renderMode(t){switch(t){case Ne.RENDERMODE_OPAQUE:this.alphaTest=!1,this.renderQueue=Ve.RENDERQUEUE_OPAQUE,this.depthWrite=!0,this.cull=Re.CULL_BACK,this.blend=Re.BLEND_DISABLE,this.depthTest=Re.DEPTHTEST_LESS;break;case Ne.RENDERMODE_CUTOUT:this.renderQueue=Ve.RENDERQUEUE_ALPHATEST,this.alphaTest=!0,this.depthWrite=!0,this.cull=Re.CULL_BACK,this.blend=Re.BLEND_DISABLE,this.depthTest=Re.DEPTHTEST_LESS;break;case Ne.RENDERMODE_TRANSPARENT:this.renderQueue=Ve.RENDERQUEUE_TRANSPARENT,this.alphaTest=!1,this.depthWrite=!1,this.cull=Re.CULL_BACK,this.blend=Re.BLEND_ENABLE_ALL,this.blendSrc=Re.BLENDPARAM_SRC_ALPHA,this.blendDst=Re.BLENDPARAM_ONE_MINUS_SRC_ALPHA,this.depthTest=Re.DEPTHTEST_LESS;break;default:throw new Error("Material:renderMode value error.")}}get enableVertexColor(){return this._enableVertexColor}set enableVertexColor(t){this._enableVertexColor=t,t?this._shaderValues.addDefine(Ne.SHADERDEFINE_ENABLEVERTEXCOLOR):this._shaderValues.removeDefine(Ne.SHADERDEFINE_ENABLEVERTEXCOLOR)}get tilingOffsetX(){return this._MainTex_STX}set tilingOffsetX(t){this._MainTex_STX=t}get tilingOffsetY(){return this._MainTex_STY}set tilingOffsetY(t){this._MainTex_STY=t}get tilingOffsetZ(){return this._MainTex_STZ}set tilingOffsetZ(t){this._MainTex_STZ=t}get tilingOffsetW(){return this._MainTex_STW}set tilingOffsetW(t){this._MainTex_STW=t}get tilingOffset(){return this._shaderValues.getVector(Ne.TILINGOFFSET)}set tilingOffset(t){t&&(1!=t.x||1!=t.y||0!=t.z||0!=t.w)?this._shaderValues.addDefine(Ne.SHADERDEFINE_TILINGOFFSET):this._shaderValues.removeDefine(Ne.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(Ne.TILINGOFFSET,t)}get albedoColorR(){return this._ColorR}set albedoColorR(t){this._ColorR=t}get albedoColorG(){return this._ColorG}set albedoColorG(t){this._ColorG=t}get albedoColorB(){return this._ColorB}set albedoColorB(t){this._ColorB=t}get albedoColorA(){return this._ColorA}set albedoColorA(t){this._ColorA=t}get albedoColor(){return this._albedoColor}set albedoColor(t){var e=this._shaderValues.getVector(Ne.ALBEDOCOLOR);Laya.Vector4.scale(t,this._albedoIntensity,e),this._albedoColor=t,this._shaderValues.setVector(Ne.ALBEDOCOLOR,e)}get albedoIntensity(){return this._albedoIntensity}set albedoIntensity(t){this._AlbedoIntensity=t}get specularColorR(){return this._SpecColorR}set specularColorR(t){this._SpecColorR=t}get specularColorG(){return this._SpecColorG}set specularColorG(t){this._SpecColorG=t}get specularColorB(){return this._SpecColorB}set specularColorB(t){this._SpecColorB=t}get specularColorA(){return this._SpecColorA}set specularColorA(t){this._SpecColorA=t}get specularColor(){return this._shaderValues.getVector(Ne.MATERIALSPECULAR)}set specularColor(t){this._shaderValues.setVector(Ne.MATERIALSPECULAR,t)}get shininess(){return this._Shininess}set shininess(t){this._Shininess=t}get albedoTexture(){return this._shaderValues.getTexture(Ne.ALBEDOTEXTURE)}set albedoTexture(t){t?this._shaderValues.addDefine(Ne.SHADERDEFINE_DIFFUSEMAP):this._shaderValues.removeDefine(Ne.SHADERDEFINE_DIFFUSEMAP),this._shaderValues.setTexture(Ne.ALBEDOTEXTURE,t)}get normalTexture(){return this._shaderValues.getTexture(Ne.NORMALTEXTURE)}set normalTexture(t){t?this._shaderValues.addDefine(Ne.SHADERDEFINE_NORMALMAP):this._shaderValues.removeDefine(Ne.SHADERDEFINE_NORMALMAP),this._shaderValues.setTexture(Ne.NORMALTEXTURE,t)}get specularTexture(){return this._shaderValues.getTexture(Ne.SPECULARTEXTURE)}set specularTexture(t){t?this._shaderValues.addDefine(Ne.SHADERDEFINE_SPECULARMAP):this._shaderValues.removeDefine(Ne.SHADERDEFINE_SPECULARMAP),this._shaderValues.setTexture(Ne.SPECULARTEXTURE,t)}get depthWrite(){return this._shaderValues.getBool(Ne.DEPTH_WRITE)}set depthWrite(t){this._shaderValues.setBool(Ne.DEPTH_WRITE,t)}get cull(){return this._shaderValues.getInt(Ne.CULL)}set cull(t){this._shaderValues.setInt(Ne.CULL,t)}get blend(){return this._shaderValues.getInt(Ne.BLEND)}set blend(t){this._shaderValues.setInt(Ne.BLEND,t)}get blendSrc(){return this._shaderValues.getInt(Ne.BLEND_SRC)}set blendSrc(t){this._shaderValues.setInt(Ne.BLEND_SRC,t)}get blendDst(){return this._shaderValues.getInt(Ne.BLEND_DST)}set blendDst(t){this._shaderValues.setInt(Ne.BLEND_DST,t)}get depthTest(){return this._shaderValues.getInt(Ne.DEPTH_TEST)}set depthTest(t){this._shaderValues.setInt(Ne.DEPTH_TEST,t)}static initShader(){const t=Laya.VertexMesh;var e={a_Position:t.MESH_POSITION0,a_Color:t.MESH_COLOR0,a_Normal:t.MESH_NORMAL0,a_Texcoord0:t.MESH_TEXTURECOORDINATE0,a_Texcoord1:t.MESH_TEXTURECOORDINATE1,a_BoneWeights:t.MESH_BLENDWEIGHT0,a_BoneIndices:t.MESH_BLENDINDICES0,a_Tangent0:t.MESH_TANGENT0,a_MvpMatrix:t.MESH_MVPMATRIX_ROW0,a_WorldMat:t.MESH_WORLDMATRIX_ROW0},s={u_Bones:_e.PERIOD_CUSTOM,u_DiffuseTexture:_e.PERIOD_MATERIAL,u_NoiseTex:_e.PERIOD_MATERIAL,u_SpecularTexture:_e.PERIOD_MATERIAL,u_NormalTexture:_e.PERIOD_MATERIAL,u_AlphaTestValue:_e.PERIOD_MATERIAL,u_DiffuseColor:_e.PERIOD_MATERIAL,u_MaterialSpecular:_e.PERIOD_MATERIAL,u_Shininess:_e.PERIOD_MATERIAL,u_WaterScale:_e.PERIOD_MATERIAL,u_TilingOffset:_e.PERIOD_MATERIAL,u_WorldMat:_e.PERIOD_SPRITE,u_MvpMatrix:_e.PERIOD_SPRITE,u_LightmapScaleOffset:_e.PERIOD_SPRITE,u_LightMap:_e.PERIOD_SPRITE,u_LightMapDirection:_e.PERIOD_SPRITE,u_SimpleAnimatorTexture:_e.PERIOD_SPRITE,u_SimpleAnimatorParams:_e.PERIOD_SPRITE,u_SimpleAnimatorTextureSize:_e.PERIOD_SPRITE,u_CameraPos:_e.PERIOD_CAMERA,u_Viewport:_e.PERIOD_CAMERA,u_ProjectionParams:_e.PERIOD_CAMERA,u_View:_e.PERIOD_CAMERA,u_ViewProjection:_e.PERIOD_CAMERA,u_ReflectTexture:_e.PERIOD_SCENE,u_ReflectIntensity:_e.PERIOD_SCENE,u_FogStart:_e.PERIOD_SCENE,u_FogRange:_e.PERIOD_SCENE,u_FogColor:_e.PERIOD_SCENE,u_DirationLightCount:_e.PERIOD_SCENE,u_LightBuffer:_e.PERIOD_SCENE,u_LightClusterBuffer:_e.PERIOD_SCENE,u_AmbientColor:_e.PERIOD_SCENE,u_ShadowBias:_e.PERIOD_SCENE,u_ShadowLightDirection:_e.PERIOD_SCENE,u_ShadowMap:_e.PERIOD_SCENE,u_ShadowParams:_e.PERIOD_SCENE,u_ShadowSplitSpheres:_e.PERIOD_SCENE,u_ShadowMatrices:_e.PERIOD_SCENE,u_ShadowMapSize:_e.PERIOD_SCENE,u_SpotShadowMap:_e.PERIOD_SCENE,u_SpotViewProjectMatrix:_e.PERIOD_SCENE,u_ShadowLightPosition:_e.PERIOD_SCENE,u_AmbientSHAr:_e.PERIOD_SCENE,u_AmbientSHAg:_e.PERIOD_SCENE,u_AmbientSHAb:_e.PERIOD_SCENE,u_AmbientSHBr:_e.PERIOD_SCENE,u_AmbientSHBg:_e.PERIOD_SCENE,u_AmbientSHBb:_e.PERIOD_SCENE,u_AmbientSHC:_e.PERIOD_SCENE,"u_DirectionLight.color":_e.PERIOD_SCENE,"u_DirectionLight.direction":_e.PERIOD_SCENE,"u_PointLight.position":_e.PERIOD_SCENE,"u_PointLight.range":_e.PERIOD_SCENE,"u_PointLight.color":_e.PERIOD_SCENE,"u_SpotLight.position":_e.PERIOD_SCENE,"u_SpotLight.direction":_e.PERIOD_SCENE,"u_SpotLight.range":_e.PERIOD_SCENE,"u_SpotLight.spot":_e.PERIOD_SCENE,"u_SpotLight.color":_e.PERIOD_SCENE,u_Time:_e.PERIOD_SCENE},i={s_Cull:_e.RENDER_STATE_CULL,s_Blend:_e.RENDER_STATE_BLEND,s_BlendSrc:_e.RENDER_STATE_BLEND_SRC,s_BlendDst:_e.RENDER_STATE_BLEND_DST,s_DepthTest:_e.RENDER_STATE_DEPTH_TEST,s_DepthWrite:_e.RENDER_STATE_DEPTH_WRITE},a=_e.add("MYShaderMaterial",null,null,!0),l=new Laya.SubShader(e,s);a.addSubShader(l),l.addShaderPass(Be,Ae,i)}clone(){var t=new Ne;return this.cloneTo(t),t}cloneTo(t){super.cloneTo(t);var e=t;e._enableLighting=this._enableLighting,e._albedoIntensity=this._albedoIntensity,e._enableVertexColor=this._enableVertexColor,this._albedoColor.cloneTo(e._albedoColor)}set noiseTex(t){this._shaderValues.setTexture(this.NOISE_TEX,t)}}Ne.RENDERMODE_OPAQUE=0,Ne.RENDERMODE_CUTOUT=1,Ne.RENDERMODE_TRANSPARENT=2,Ne.ALBEDOTEXTURE=_e.propertyNameToID("u_DiffuseTexture"),Ne.NORMALTEXTURE=_e.propertyNameToID("u_NormalTexture"),Ne.SPECULARTEXTURE=_e.propertyNameToID("u_SpecularTexture"),Ne.ALBEDOCOLOR=_e.propertyNameToID("u_DiffuseColor"),Ne.MATERIALSPECULAR=_e.propertyNameToID("u_MaterialSpecular"),Ne.SHININESS=_e.propertyNameToID("u_Shininess"),Ne.TILINGOFFSET=_e.propertyNameToID("u_TilingOffset"),Ne.CULL=_e.propertyNameToID("s_Cull"),Ne.BLEND=_e.propertyNameToID("s_Blend"),Ne.BLEND_SRC=_e.propertyNameToID("s_BlendSrc"),Ne.BLEND_DST=_e.propertyNameToID("s_BlendDst"),Ne.DEPTH_TEST=_e.propertyNameToID("s_DepthTest"),Ne.DEPTH_WRITE=_e.propertyNameToID("s_DepthWrite");class Ie extends Q{constructor(){super(),this.bgIma=null,this.nameLab=null,this.pid=0,this.ins=null}onEnable(){this.ins=ee.instance;const t=this.ins,e=this.pid,s=e?t.otherPlayer[e-1].playerData:t.playerData;this.bgIma.skin="battle/player/plane/p"+s.id+".png",this.nameLab.visible=!1}setName(t){this.nameLab.text=t,this.nameLab.visible=!0}onDisable(){}onLateUpdate(){const t=this.ins,e=this.pid;if(t.gameState!=rt.START)return;const s=this.owner;let i=e?t.otherPlayer[e-1].v2:t.playerV2;s.pos(i.x,i.y)}}class Me extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this.pid=0,this.wudi1=null,this.wudi2=null,this.iswudi=!1,this.iswudi2=!1,this.isblink=!1}onEnable(){this.ins=ee.instance,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.iswudi=!1,this.iswudi2=!1,this.isblink=!1,this.wudi1.alpha=0,this.wudi2.alpha=0,r.on(dt.PlayerReborn,this,()=>{if(this.pid)return;this.iswudi2=!0,this.wudiAnim(2700),Laya.timer.once(3e3,this,()=>{this.iswudi2=!1}),this.isblink=!1,_t.insUI.hitNode.visible=!1});const t=this.ins.playerData,e=()=>{if(this.isblink&&t.currHP/t.hp>.1){this.isblink=!1,_t.insUI.hitNode.visible=!1}};r.on(dt.PlayerHP,this,e),r.on(dt.PlayerMaxHP,this,e),r.on(dt.EnemyLaserHide,this,t=>{let e=this.selfCol.bids.indexOf(t.bid);e>-1&&this.selfCol.bids.splice(e,1)})}wudiAnim(t){this.iswudi=!0,!this.pid&&this.ins.vibrate&&window.navigator&&window.navigator.vibrate&&window.navigator.vibrate(100),this.wudi1.templet&&(this.wudi1.playbackRate(.5),this.wudi1.play(0,!1)),this.wudi2.templet&&this.wudi2.playbackRate(.5),this.wudi1.alpha=1,Laya.timer.once(600,this,()=>{this.wudi1.alpha=0}),this.wudi2.alpha=1,this.wudi2.scaleX=this.wudi2.scaleY=0,Laya.Tween.to(this.wudi2,{alpha:1,scaleX:1,scaleY:1},600),Laya.timer.once(t,this,()=>{this.iswudi=!1,Laya.Tween.to(this.wudi2,{alpha:0},300)})}onCollisionEnter(t,e){const s=t.owner;if(!s||!s.parent)return;const i=this.ins,a=this.pid,l=s.getComponent(Ut),n=s.getComponent(Gt),o=a?i.otherPlayer[a-1].playerData:i.playerData;if(this.iswudi||this.iswudi2||o.currHP<=0)return;let h=null;n&&n.edata&&(h="number"==typeof n.edata.att?n.edata.att:n.edata.att.split("|")[0]||0),l&&l.data&&(h=l.data.attack),o.currHP-=h,r.event(dt.PlayerHP,a);const c=_t.insUI.hitNode,d=t=>{Laya.Tween.to(c,{alpha:1},500,Laya.Ease.circOut,Laya.Handler.create(this,()=>{Laya.timer.once(100,this,()=>{Laya.Tween.to(c,{alpha:0},500,Laya.Ease.circIn,Laya.Handler.create(this,()=>{t||(c.visible=!1)}))})}))};a||(o.currHP/o.hp<=.1?this.isblink||(this.isblink=!0,Laya.Tween.clearAll(c),c.alpha=0,c.visible=!0,d(!0),Laya.timer.loop(1100,this,()=>{d(!0)})):c&&!c.visible&&(c.alpha=0,c.visible=!0,Laya.Tween.clearAll(c),d())),this.iswudi||this.wudiAnim(1700),o.currHP<=0&&(this.makeBoom(2001),a?r.event(dt.PlayerDie,a):r.event(dt.GameOver))}onCollisionExit(t,e){}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this)}makeBoom(t){const e=this.getRes(_.battle.EnemyBoom2),s=this.open(_.battle.EnemyBoom2,e);s.__$type$__=t;const i=this.owner;s.x=i.x,s.y=i.y,this.ins.effectNode.addChild(s)}onLateUpdate(){this.quadTree.check(this.ins.enemyCols,this.selfCol)}}class He extends Q{constructor(){super(),this.ins=null,this.pid=0,this.line=null,this.bgBar=null,this.bar=null,this.hpLab=null,this.baseWidth=12,this.currBarWidth=60,this.currBaseNum=5}onEnable(){this.ins=ee.instance;const t=this.pid,e=this.ins,s=t?e.otherPlayer[t-1].playerData:e.playerData;let i=this.currBaseNum*this.baseWidth;this.bgBar.width=i,this.currBarWidth=i,r.on(dt.PlayerHP,this,e=>{if(e||(e=0),e!=t)return;let a=s.currHP/s.hp*i;this.currBarWidth=a,this.hpLab.text=(Math.floor(s.currHP/s.hp*100)||1)+"%"}),r.on(dt.PlayerMaxHP,this,e=>{if(e||(e=0),e!=t)return;this.currBaseNum++,i=this.currBaseNum*this.baseWidth,this.bgBar.width=i;let a=s.currHP/s.hp*i;this.currBarWidth=a,this.hpLab.text=(Math.floor(s.currHP/s.hp*100)||1)+"%"}),r.event(dt.PlayerHP)}onDisable(){r.offAllCaller(this)}onLateUpdate(){const t=this.ins,e=this.pid;if(t.gameState!=rt.START)return;const s=this.owner;let i=Laya.timer.delta/1e3,a=this.getVec3(s.x,s.y);const l=e?t.otherPlayer[e-1].posv2:t.playerPosV2;let n=this.getVec3(l.x+40,l.y-40),o=this.getVec3();Laya.Vector3.lerp(a,n,8*i,o),s.pos(o.x,o.y);let h=e?t.otherPlayer[e-1].v2:t.playerV2,r=o.x-h.x,c=o.y-h.y;this.line.height=Math.sqrt(r*r+c*c),this.line.rotation=Math.atan2(r,-c)/Math.PI*180;let d=this.getVec3();Laya.Vector3.lerp(this.getVec3(this.bar.width),this.getVec3(this.currBarWidth),.01*Laya.timer.delta,d),this.bar.width=d.x}}class Oe extends Q{constructor(){super(),this.ins=null,this.playerPre=null,this.playerPre1=null,this.plaHPPre=null,this.playerMods={},this.playerPre=this.getRes(_.battle.Player),this.playerPre1=this.getRes(_.battle.Player1),this.plaHPPre=this.getRes(_.battle.PlayerHP);for(const t in I){const e=I[t];this.playerMods[t]=this.getRes(e)}}onEnable(){this.ins=ee.instance,r.on("player.selSkill",this,()=>{this.ins.otherPlayer.length&&this.getRandomSkill(1)}),r.on(dt.AddPlayer,this,(t,e)=>{e&&this.initOtherPlayer(e,t)}),this.initPlayerModel()}initPlayerModel(){const t=this.ins,e=t.playerData.id,s=q;let i=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,1280),i);const a=Laya.Sprite3D.instantiate(this.playerMods[e]);a.transform.position=i,a.transform.localScale=this.getVec3(1.55,1.55,1.55);const l=new Ne;l.albedoIntensity=1.4,l.shininess=.25;const n=a.getChildAt(0),o=this.getRes(s[e]);l.albedoTexture=o,Laya.Texture2D.load("res/lg.png",Laya.Handler.create(null,function(t){l.noiseTex=t,n.meshRenderer.material=l})),t.playerV3=a,t.modSceneV3.addChild(a);const h=this.getRes(V.PlaneTrackModel),c=Laya.ShuriKenParticle3D.instantiate(h);c.transform.position=this.getVec3(0,0,.1),a.addChild(c);const d=this.open(_.battle.Player,this.playerPre);d.pos(360,1280),t.playerNode.addChild(d),t.playerV2=d,t.playerCols.push(d.getComponent(kt));const p=this.open(_.battle.Player1,this.playerPre1);p.pos(360,1280),t.bgTopNode.addChild(p),d.__bgIma__=p;const u=this.open(_.battle.PlayerHP,this.plaHPPre);u.pos(400,1240),t.effectNode.addChild(u),t.playerHPV2=u;const y=window.__Adventure__;t.modCameraV3.convertScreenCoordToOrthographicCoord(t.playerPosV2,i),t.playerPosV3=i,Laya.Tween.to(d,{y:t.playerPosV2.y},500,Laya.Ease.cubicOut),Laya.Tween.to(p,{y:t.playerPosV2.y},500,Laya.Ease.cubicOut),Laya.Tween.to(u,{y:t.playerPosV2.y-40},500,Laya.Ease.cubicOut),Laya.Tween.to(a.transform,{localPositionZ:i.z},500,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{if(y)r.event(dt.AdvRateSupply);else{const e=t.playerData.unlock;if(L.shopLims&&L.shopLims.skill){const t=L.shopLims.skill.bskills;if(t)for(const s in t){const i=t[s].id;this.getSkill(i);const a=e.indexOf(i);a>-1&&e.splice(a,1)}}const s=t.playerData.skills;t.playerData.skills={};for(const e in s){const i=s[e],a=parseInt(e);if(1023!=a||3==t.playerData.id)for(let t=0;t<i;t++)this.getSkill(a)}const i=t.playerData.skills2;t.playerData.skills2={};for(const t in i){const e=i[t],s=parseInt(t);for(let t=0;t<e;t++)this.getSkill2(s)}t.playerData.chapter>1&&1==t.playerData.rate&&!t.isEndless?r.event(dt.RateSupply):t.playerData.chapter<1||(t.selSkill&&1==t.playerData.rate?(t.selSkill--,r.event(dt.SuitSupply)):r.event(dt.RateStart))}t.playerData.chapter>0&&r.event(dt.PlayerBullet,e)}));let m=this.getVec3(),g=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,640),m),t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(360,641),g),t.ratio3D=1/(g.z-m.z)}initOtherPlayer(t,e){const s=this.ins,i=q,a=s.playerPosV2.x,l=a+200<=670?a+200:a-200;let n=this.getVec3();s.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(l,1280),n);const o=Laya.Sprite3D.instantiate(this.playerMods[t]);o.transform.position=n,o.transform.localScale=this.getVec3(1.55,1.55,1.55);const h=new Ne;h.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,h.albedoColorA=.4,h.albedoIntensity=1.4,h.shininess=.25;const c=o.getChildAt(0),d=this.getRes(i[t]);h.albedoTexture=d,Laya.Texture2D.load("res/lg.png",Laya.Handler.create(null,function(t){h.noiseTex=t,c.meshRenderer.material=h})),s.modSceneV3.addChild(o);const p=this.getRes(V.PlaneTrackModel),u=Laya.ShuriKenParticle3D.instantiate(p);u.transform.position=this.getVec3(0,0,.1),u.getChildAt(0).particleSystem.startColorConstant=this.getVec4(1,1,1,.2),o.addChild(u);const y=this.open(_.battle.Player,this.playerPre);y.pos(l,1280),s.playerCols.push(y.getComponent(kt));const m=this.open(_.battle.Player1,this.playerPre1);m.pos(l,1280),y.__bgIma__=m;const g=this.open(_.battle.PlayerHP,this.plaHPPre);g.pos(l+40,1240);const b=this.getVec3(l,1e3);s.modCameraV3.convertScreenCoordToOrthographicCoord(b,n);const f=s.otherPlayer.length+1;y.getComponent(te).pid=f,y.getComponent(Me).pid=f;const k=m.getComponent(Ie);k.pid=f,g.getComponent(He).pid=f;const S={v2:y,v3:o,hpv2:g,posv2:this.getVec3(l,1e3),posv3:n,lassv2:[],wingsv2:[],ballsv2:[],playerData:new Jt};S.playerData.init2(s.playerData,t),s.otherPlayer.push(S),s.playerNode.addChild(y),s.bgTopNode.addChild(m),s.effectNode.addChild(g),k.setName(e),Laya.Tween.to(y,{y:b.y},500,Laya.Ease.cubicOut),Laya.Tween.to(m,{y:b.y},500,Laya.Ease.cubicOut),Laya.Tween.to(g,{y:b.y-40},500,Laya.Ease.cubicOut);const C=()=>{Laya.Tween.to(h,{albedoColorA:.1},250),Laya.timer.once(250,this,()=>{Laya.Tween.to(h,{albedoColorA:.4},250)})};Laya.Tween.to(o.transform,{localPositionZ:n.z},500,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{C(),Laya.timer.once(500,this,C),Laya.timer.once(1e3,this,()=>{if(!s.otherPlayer[f-1])return;r.event(dt.PlayerBullet,[t,f]);let e=Object.keys(s.playerData.skills).length;3==s.playerData.id&&e>=1&&e--;for(let t=0;t<e;t++)this.getRandomSkill(f)})}))}getRandomSkill(t){if(!t)return;const e=this.ins,s=e.otherPlayer[t-1].playerData,i=e.otherPlayer[t-1],a=s.unlock,l=A.skills,n=(()=>{let t=a.concat();for(let e=t.length-1;e>=0;e--){const s=t[e];l[s].weight<=0&&t.splice(e,1)}const e=t.indexOf(1013);s.currHP/s.hp>.7&&e>=0&&t.splice(e,1);const n=t.indexOf(1023);if(3==s.id&&n>-1&&t.splice(n,1),i.wingsv2.length>=4)for(let e=t.length-1;e>=0;e--){const s=t[e];3==l[s].skilltype&&t.splice(e,1)}else{let e=null;for(const t in s.skills)3==l[t].skilltype&&(e=parseInt(t));if(e)for(let s=t.length-1;s>=0;s--){const i=t[s];3==l[i].skilltype&&i!=e&&t.splice(s,1)}}return t})();if(n.length<4)return;const o=[];for(let t=0;t<n.length;t++){const e=n[t],s=l[e];if(o.push(e),"number"==typeof s.weight)for(let t=1;t<s.weight/1e3;t++)o.push(e)}const h=[],r=[],c=o.length-1;for(;h.length<1;){let t=Math.floor(Math.random()*(c-0+1)+0);h.indexOf(t)<0&&r.indexOf(o[t])<0&&(h.push(t),r.push(o[t]))}let d=r[0];s.chapter<1||((t=>{const e=l[t],s=a.indexOf(t);e.add==B.Once&&a.splice(s,1),e.add==B.Add&&(l[t+1]&&l[t+1].add==B.Add?a[s]=t+1:a.splice(s,1))})(d),this.getSkill(d,t))}getSkill(t,e){e||(e=0);let s="";t<2e3?s=`player_${t}_baseskill`:t>2e3&&t<3e3?s=`player_${t}_bulskill`:t>3e3&&t<4e3?s=`player_${t}_wingskill`:t>4e3&&(s=`player_${t}_robskill`),r.event(s,e)}getSkill2(t){r.event(`player_${t}_supply`)}onDisable(){r.offAllCaller(this),Laya.timer.clearAll(this)}}class qe extends Q{constructor(){super(),this.qhBtn=null,this.gcBtn=null,this.zzBtn=null,this.fypBtn=null,this.cjbBtn=null,this.jgBtn=null,this.sdBtn=null,this.chddBtn=null,this.ddgBtn=null,this.xzdqBtn=null,this.xzhqBtn=null,this.cbdcBtn=null,this.xzbqBtn=null,this.sdljBtn=null,this.ddljBtn=null,this.jgljBtn=null,this.bpljBtn=null,this.hdljBtn=null,this.zzpljBtn=null,this.bpjqrBtn=null,this.hdjqrBtn=null,this.jgjqrBtn=null,this.fnBtn=null,this.yhBtn=null,this.ddBtn=null,this.xshdBtn=null,this.xzhdBtn=null,this.swdmBtn=null,this.swbzBtn=null}onEnable(){this.setClick(this.qhBtn,this.baseSkill6.bind(this),this),this.setClick(this.gcBtn,this.baseSkill7.bind(this),this),this.setClick(this.zzBtn,this.baseSkill9.bind(this),this),this.setClick(this.fypBtn,this.skill1.bind(this),this),this.setClick(this.cjbBtn,this.skill2.bind(this),this),this.setClick(this.jgBtn,this.skill3.bind(this),this),this.setClick(this.sdBtn,this.skill4.bind(this),this),this.setClick(this.chddBtn,this.skill5.bind(this),this),this.setClick(this.xzdqBtn,this.skill6.bind(this),this),this.setClick(this.ddgBtn,this.skill7.bind(this),this),this.setClick(this.xzhqBtn,this.skill8.bind(this),this),this.setClick(this.cbdcBtn,this.skill9.bind(this),this),this.setClick(this.xzbqBtn,this.skill10.bind(this),this),this.setClick(this.sdljBtn,this.wing5.bind(this),this),this.setClick(this.ddljBtn,this.wing2.bind(this),this),this.setClick(this.jgljBtn,this.wing3.bind(this),this),this.setClick(this.bpljBtn,this.wing1.bind(this),this),this.setClick(this.hdljBtn,this.wing6.bind(this),this),this.setClick(this.zzpljBtn,this.wing4.bind(this),this),this.setClick(this.bpjqrBtn,this.robot1.bind(this),this),this.setClick(this.hdjqrBtn,this.robot2.bind(this),this),this.setClick(this.jgjqrBtn,this.robot3.bind(this),this),this.setClick(this.fnBtn,this.fnSkill.bind(this),this),this.setClick(this.yhBtn,this.yhSkill.bind(this),this),this.setClick(this.ddBtn,this.ddSkill.bind(this),this),this.setClick(this.xshdBtn,this.xshdSkill.bind(this),this),this.setClick(this.xzhdBtn,this.xzhdSkill.bind(this),this),this.setClick(this.swdmBtn,this.swdmSkill.bind(this),this),this.setClick(this.swbzBtn,this.swbzSkill.bind(this),this)}swdmSkill(){r.event(dt.DieShot)}swbzSkill(){r.event(dt.DieBoom)}xshdSkill(){r.event(dt.TimeShield)}xzhdSkill(){r.event(dt.Shield)}fnSkill(){r.event(dt.BulSkill2013)}yhSkill(){r.event(dt.BulSkill2012)}ddSkill(){r.event(dt.BulSkill2002)}baseSkill6(){r.event(dt.BaseSkill6)}baseSkill7(){r.event(dt.BaseSkill7)}baseSkill9(){r.event(dt.BaseSkill9)}skill1(){r.event(dt.BulSkill1)}skill2(){r.event(dt.BulSkill2)}skill3(){r.event(dt.BulSkill3)}skill4(){r.event(dt.BulSkill4)}skill5(){r.event(dt.BulSkill5)}skill6(){r.event(dt.BulSkill6)}skill7(){r.event(dt.BulSkill7)}skill8(){r.event(dt.BulSkill8)}skill9(){r.event(dt.BulSkill9)}skill10(){r.event(dt.BulSkill10)}wing1(){r.event(dt.WingSkill1)}wing2(){r.event(dt.WingSkill2)}wing3(){r.event(dt.WingSkill3)}wing4(){r.event(dt.WingSkill4)}wing5(){r.event(dt.WingSkill5)}wing6(){r.event(dt.WingSkill6)}robot1(){r.event(dt.RobSkill1)}robot2(){r.event(dt.RobSkill2)}robot3(){r.event(dt.RobSkill3)}onDisable(){r.offAllCaller(this)}}class Ue extends Q{constructor(){super(),this.hand=null,this.cen1=this.getVec2(295,326),this.cen2=this.getVec2(425,326),this.vec=1,this.angle=0}onEnable(){this.hand.pos(360,326),this.vec=1,this.angle=0}onUpdate(){if(this.owner.visible){const t=this.hand;if(1==this.vec&&this.angle>=360&&(this.angle=180,this.vec=2),2==this.vec&&this.angle<=-180&&(this.angle=0,this.vec=1),1==this.vec){const e=this.cen1;this.angle+=2;const s=this.angle/180*Math.PI;t.x=e.x+65*Math.cos(s),t.y=e.y-65*Math.sin(s)}else{const e=this.cen2;this.angle-=2;const s=this.angle/180*Math.PI;t.x=e.x+65*Math.cos(s),t.y=e.y-65*Math.sin(s)}}}}var Fe,je=Laya.View,Ge=Laya.Scene,We=Laya.ClassUtils.regClass;!function(t){class e extends Ge{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("BattleScene")}}t.BattleSceneUI=e,We("ui.BattleSceneUI",e);class s extends je{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("LobbyScene")}}t.LobbySceneUI=s,We("ui.LobbySceneUI",s)}(Fe||(Fe={}));class Ke extends Fe.LobbySceneUI{constructor(){super(),Ke.instance=this}onEnable(){Laya.SoundManager.playMusic(O.LobbyBgMus,0);u.bgCha=O.LobbyBgMus}onDisable(){Laya.SoundManager.stopMusic(),u.bgCha=null}}Ke.instance=null;class Ye extends Q{constructor(){super(),this.str=null}onEnable(){const t=this.str;if(t){const e=t.split(".");this.owner.text=y[e[0]][e[1]]}}onDisable(){}}class ze{static Register(t,e){this.Handlers[t]||(this.Handlers[t]=e)}}ze.Handlers={};class Xe extends Q{constructor(){super(),this.timer=0,this.str=null,this.redDotIma=null}onEnable(){this.redDotIma||(this.redDotIma=this.owner.getChildByName("red.dot")),this.onLongUpdate()}onDisable(){}onLongUpdate(){if(this.redDotIma&&ze.Handlers[this.str]){const t=ze.Handlers[this.str]();this.redDotIma.visible=t}}onUpdate(){this.timer+=Laya.timer.delta,this.timer>=1e3&&(this.timer=0,this.onLongUpdate())}}class $e extends Q{constructor(){super()}onEnable(){this.owner.on("click",this,this.nextStep)}nextStep(){wt&&wt.nextStep()}onDisable(){this.owner.off("click",this,this.nextStep)}}class Ze extends Q{constructor(){super(),this.list=null,this.tabIndex=0}onEnable(){r.on(Ss.OpenPage,this,this.onOpen);const t=[y.AdventureData[1],y.AdventureData[2]],e=this.list;e.vScrollBarSkin="",e.renderHandler=Laya.Handler.create(this,(e,s)=>{this.setData(e,t[s])},null,!1),e.array=t}initPage(){const t=[y.AdventureData[1],y.AdventureData[2]];this.list.array=t}setData(t,e){t.skin=1==e.id?"lobby/adventure/bg_trial_yellow.png":"lobby/adventure/bg_trial_green.png",t.getChildByName("titIma").skin=e.title;const s=t.getChildByName("difBtn"),i=s.getChildAt(0),a=t.getChildByName("difLab"),l=a.getChildAt(1),n=t.getChildByName("difNode"),o=n.getChildAt(1),h=n.getChildAt(2),r=n.getChildAt(3);n.visible=!1,s.offAllCaller(s),o.offAllCaller(s),h.offAllCaller(s),r.offAllCaller(s);const c=s=>{a.text=e.diff[s-1],i.text=e.diff[s-1];l.skin=["lobby/adventure/icon_ordinary.png","lobby/adventure/icon_difficulty.png","lobby/adventure/icon_infernal.png"][s-1],t.__dif__=s,t.getChildByName("powLab").text=d.formatNumber(e.pow[s-1])},p=m.unlockAdv[e.id];c(t.__dif__||p),this.setClick(s,()=>{n.visible=!n.visible},s),o.text=e.diff[0],this.setClick(o,()=>{n.visible=!1,c(1)},o),h.text=e.diff[1],this.setClick(h,()=>{n.visible=!1,c(2)},h),r.text=e.diff[2],this.setClick(r,()=>{n.visible=!1,c(3)},r);const u=t.getChildByName("rewNode");for(let t=0;t<3;t++){const s=u.getChildAt(t),i=e.reward[t];if(i){const t=i[0],a=s.getChildAt(0);a.visible=!!t,t&&(a.skin=`lobby/itembg/${t-1}.png`),s.getChildAt(1).skin=i[1],s.getChildAt(2).visible=1==e.id,s.getChildAt(3).text=i[2]}else s.visible=!1}const g=t.getChildByName("staBtn");g.offAllCaller(g),this.setClick(g,()=>{this.startAdv(e.id,t.__dif__||1)},g);const b=g.getChildByName("title");t.getChildByName("powtitle").text=y.AdventurePage[2],t.getChildByName("powLab").text=d.formatNumber(e.pow[t.__dif__-1]),t.getChildByName("diftitle").text=y.AdventurePage[3],t.getChildByName("rewtitle").text=y.AdventurePage[4];const f=t.getChildByName("numLab");let k=m.advData[e.id];"number"!=typeof k&&(k=e.num),f.text=`${y.AdventurePage[5]} ${k}/${e.num}`,b.text=k>0?y.AdventurePage[11]:y.AdventurePage[12]}startAdv(t,e){const s=1==t?E.equAdv:E.goldAdv;if(m.advData[t]<=0)return void h.gameSDK.faceBookAdvertisement.showRewardVideoAd(h.rewardedVideoID,()=>{"number"!=typeof m.advData[t]&&(m.advData[t]=0),m.advData[t]++,this.initPage()});const i=s[e];if(i){const t=d.getRandom(Object.keys(i).length-1,0),e=i[Object.keys(i)[t]];window.__Adventure__=e,r.event("adventure.start")}}onDisable(){r.offAllCaller(this)}onOpen(t){const e=this.owner;t==this.tabIndex?(e.visible=!0,this.onEnActive()):e.visible=!1}onEnActive(){}onDestroy(){}}class Qe extends Laya.Script{constructor(){super(),this.selectIndex=0,this.itemScale=1,this.space=25,this.moveEndHandle=null,this.startY=0,this.selectDistance=0,this.itemX=[],this.dragRegion=null}onEnable(){const t=this.owner;this.startY=t.y;const e=t.getChildAt(0),s=t.x,i=this.space,a=e.width,l=e.x;this.selectDistance=(a+i)/2;let n=this.owner.numChildren;const o=a*n+i*(n-1);t.width=o;for(let e=0;e<n;e++){let n=-e*(a+i)+s;this.itemX[e]=n;const o=t.getChildAt(e);o.x=l+e*(a+i);let h=e==this.selectIndex?1:this.itemScale;o.scaleX=h,o.scaleY=h}this.dragRegion=new Laya.Rectangle(t.x-o+a,t.y,o-a,0),t.on(Laya.Event.MOUSE_DOWN,this,this.onBoxMove),t.on(Laya.Event.MOUSE_MOVE,this,this.onBoxMoving),t.on(Laya.Event.MOUSE_UP,this,this.onBoxMoveEnd),t.on(Laya.Event.MOUSE_OUT,this,this.onBoxMoveEnd),t.x=this.itemX[this.selectIndex]}onBoxMove(){this.owner.startDrag(this.dragRegion,!1,100)}onBoxMoving(){const t=this.owner;if(t.x>=this.itemX[0]){const e=t.getChildAt(0);let s=1-Math.abs(t.x-this.itemX[0])/100*.15;return e.scaleX=s,e.scaleY=s,void(e.getChildAt(0).getChildAt(0).alpha=(s-this.itemScale)/(1-this.itemScale))}if(t.x<=this.itemX[this.itemX.length-1]){const e=t.getChildAt(this.itemX.length-1);let s=1-Math.abs(this.itemX[this.itemX.length-1]-t.x)/100*.15;return e.scaleX=s,e.scaleY=s,void(e.getChildAt(0).getChildAt(0).alpha=(s-this.itemScale)/(1-this.itemScale))}for(let e=0;e<this.itemX.length;e++){let s=t.getChildAt(e),i=t.getChildAt(e+1),a=this.itemX[e],l=this.itemX[e+1];if(t.x>=l&&t.x<=a){let n=1-Math.abs(t.x-a)/Math.abs(a-l)*(1-this.itemScale),o=this.itemScale+1-n;s.scaleX=n,s.scaleY=n,i.scaleX=o,i.scaleY=o;const h=s.getChildAt(0).getChildAt(0),r=i.getChildAt(0).getChildAt(0);h.alpha=(n-this.itemScale)/(1-this.itemScale),r.alpha=(o-this.itemScale)/(1-this.itemScale),e++}else{s.scaleX=this.itemScale,s.scaleY=this.itemScale,s.getChildAt(0).getChildAt(0).alpha=0}}}onBoxMoveEnd(){const t=this.owner;if(t.x>=this.itemX[0]){const e=t.getChildAt(0);Laya.Tween.to(e,{scaleX:1,scaleY:1},100);const s=e.getChildAt(0).getChildAt(0);return Laya.Tween.to(s,{alpha:1},100),this.selectIndex=0,void(this.moveEndHandle&&this.moveEndHandle(this.selectIndex))}if(t.x<=this.itemX[this.itemX.length-1]){const e=t.getChildAt(this.itemX.length-1);Laya.Tween.to(e,{scaleX:1,scaleY:1},100);const s=e.getChildAt(0).getChildAt(0);return Laya.Tween.to(s,{alpha:1},100),this.selectIndex=this.itemX.length-1,void(this.moveEndHandle&&this.moveEndHandle(this.selectIndex))}Laya.SoundManager.playSound(O.ClickSou),t.stopDrag();for(let e=0;e<this.itemX.length;e++){const s=this.itemX[e];if(t.x!=s&&Math.abs(t.x-s)<=this.selectDistance){Laya.Tween.to(t,{x:s},100),this.selectIndex=e;break}}let e=this.owner.numChildren;for(let s=0;s<e;s++){const e=t.getChildAt(s);let i=s==this.selectIndex?1:this.itemScale;Laya.Tween.to(e,{scaleX:i,scaleY:i},100);const a=e.getChildAt(0).getChildAt(0);Laya.Tween.to(a,{alpha:(i-this.itemScale)/(1-this.itemScale)},100)}this.moveEndHandle&&this.moveEndHandle(this.selectIndex)}onDisable(){const t=this.owner;t.off(Laya.Event.MOUSE_DOWN,this,this.onBoxMove),t.off(Laya.Event.MOUSE_MOVE,this,this.onBoxMoving),t.off(Laya.Event.MOUSE_UP,this,this.onBoxMoveEnd),t.off(Laya.Event.MOUSE_OUT,this,this.onBoxMoveEnd)}onUpdate(){const t=this.owner;t.y!=this.startY&&(t.y=this.startY)}}class Je extends Q{constructor(){super(),this._norV3=null,this.trail3D=null,this.target=null,this.speed=1,this.trail=null,this.deltaY=100}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){const t=this.owner;if(this.trail){const e=new Laya.Sprite3D,s=this.getRes(this.trail),i=Laya.Sprite3D.instantiate(s);e.addChild(i);let a=this.getVec3(),l=t.localToGlobal(new Laya.Point(t.width/2,t.height/2));this.target.camera3D.convertScreenCoordToOrthographicCoord(this.getVec3(l.x,l.y),a),e.transform.position=a,this.trail3D=e,this.target.scene3D.addChild(e)}r.on("UnlockPlaneDialog.close",this,()=>{this.owner.removeSelf()})}onDisable(){super.onDisable(),this.trail3D&&this.trail3D.removeSelf(),this.recover(this.owner)}onLateUpdate(){let t=this.target.ratio3D;const e=this.owner;let s=Laya.timer.delta*this.speed;e.rotation=-(180-Math.atan2(this.norV3.x,-this.norV3.y)/Math.PI*180);const i=s*this.norV3.x,a=s*this.norV3.y;e.x+=i,e.y+=a,this.trail3D&&this.trail3D.transform&&this.trail3D.transform.translate(this.getVec3(i/t,0,a/t)),(e.x<=0-this.deltaY||e.x>=667+this.deltaY||e.y<=0-this.deltaY||e.y>=700+this.deltaY)&&this.owner.removeSelf()}}class ts extends Q{constructor(){super(),this.closeBtn=null,this.titleLab=null,this.descLab=null,this.planeBg=null,this.attributeNode=null,this.scene3D=null,this.camera3D=null,this.ratio3D=null}onEnable(){const t=this.owner.addChild(new Laya.Scene3D);this.scene3D=t;const e=new Laya.Camera(0,.1,100);this.camera3D=e,t.addChild(e),e.clearFlag=Laya.CameraClearFlags.Nothing,e.clearColor=new Laya.Vector4(0,0,0,0),e.transform.rotate(new Laya.Vector3(-90,0,0),!1,!1),e.orthographic=!0,e.orthographicVerticalSize=10;const s=t.addChild(new Laya.DirectionLight);s.color=new Laya.Vector3(1,1,1),s.transform.worldMatrix.setForward(new Laya.Vector3(1,-1,0)),this.setClick(this.closeBtn,()=>{super.onDisable(),r.event("UnlockPlaneDialog.close"),this.scene3D.destroy(!0),this.scene3D=null,this.closeDialog(this)},this);const i=new Laya.Sprite;i.graphics.drawRect(0,50,667,650,""),this.planeBg.parent.mask=i}setData(t){let e=this.getVec3(),s=this.getVec3();this.camera3D.convertScreenCoordToOrthographicCoord(this.getVec3(360,640),e),this.camera3D.convertScreenCoordToOrthographicCoord(this.getVec3(360,641),s),this.ratio3D=1/(s.z-e.z),Laya.timer.once(200,this,()=>{this.initPlane(t)})}initPlane(t){3==t&&(this.planeBg.y-=110);const e=3==t?690:800,s=n.planes[t],i=n.planesUI[t];this.titleLab.text=s.name,this.descLab.text=y.HangarItem[t].replace("\n"," "),this.planeBg.skin="battle/player/plane/p"+t+".png";const a=this.attributeNode;let l=a.numChildren;for(let t=0;t<l;t++){const e=a.getChildAt(t),s=e.getChildAt(2);let l=i[t]/10,n=27+203*l;Laya.Tween.to(e,{value:l},200),Laya.Tween.to(s,{x:n},200)}const o=q;let h=this.getVec3();this.camera3D.convertScreenCoordToOrthographicCoord(this.getVec3(360,e),h);const r=Laya.Sprite3D.instantiate(this.getRes(I[t]));r.transform.position=h,r.transform.localScale=this.getVec3(1.55,1.55,1.55);const c=new Ne;c.albedoIntensity=1.4,c.shininess=.25;const d=r.getChildAt(0),p=this.getRes(o[t]);c.albedoTexture=p,Laya.Texture2D.load("res/lg.png",Laya.Handler.create(null,function(t){c.noiseTex=t,d.meshRenderer.material=c})),this.scene3D.addChild(r);const u=this.getRes(V.PlaneTrackModel),m=Laya.ShuriKenParticle3D.instantiate(u);m.transform.position=this.getVec3(0,0,.1),r.addChild(m),this.initPlaneBullet(t)}onDisable(){super.onDisable(),Ds.Lobby.clearBattlePool(),this.scene3D&&this.scene3D.destroy(!0)}initPlaneBullet(t){switch(t){case 2:this.initPlane2Bullet();break;case 3:this.initPlane3Bullet();break;case 4:this.initPlane4Bullet();break;case 6:this.initPlane6Bullet()}}initPlane2Bullet(){n.planes[2].shooting;const t=[10,-40,-40,10],e=[-50,-15,15,50],s=this.getRes(_.battle.PlayerLaser),i=this.getVec3(this.planeBg.x,this.planeBg.y);for(let a=0;a<t.length;a++){const l=this.open(_.battle.PlayerLaser,s);if(!l)return;l._components=null,l.getChildByName("laser1").blendMode=Laya.BlendMode.LIGHTER,l.getChildByName("laser2").blendMode=Laya.BlendMode.LIGHTER,l.pos(i.x+e[a],i.y+t[a]),this.planeBg.parent.addChild(l)}}initPlane3Bullet(){const t=n.planes[3],e=(t.shooting,[30,40,50,60,120,130,140,150,-150,-140,-130,-120,-60,-50,-40,-30]),s=this.getRes(_.battle.Player3Bullet),i=this.getVec3(this.planeBg.x,this.planeBg.y);Laya.timer.loop(400,this,()=>{for(let a=0;a<e.length;a++){const l=this.open("Lobby://"+_.battle.Player3Bullet,s);if(!l)return;l._components=null;let n=l.getComponent(Je);n||(n=l.addComponent(Je));const o=Math.tan(e[a]/180*Math.PI);let h=new Laya.Vector3(0,0,0);Laya.Vector3.normalize(new Laya.Vector3(1,-o,0),h),h.x*=Math.abs(e[a])>90?-1:1,n.norV3=h,n.target=this,n.speed=.5*t.bulletsp,n.trail=V.DaoDan,n.deltaY=-70,l.anchorX=l.anchorY=0,l.pos(i.x+0,i.y+0),this.planeBg.parent.addChild(l)}})}initPlane4Bullet(){const t=n.planes[4],e=(t.shooting,[this.getVec3(-.26,-.97),this.getVec3(-.09,-1),this.getVec3(.09,-1),this.getVec3(.26,-.97)]),s=gt[4][3],i=this.getRes(_.battle.Player4Bullet),a=this.getVec3(this.planeBg.x,this.planeBg.y);Laya.timer.loop(400,this,()=>{for(let l=0;l<s.length;l++){const n=this.open("Lobby://"+_.battle.Player4Bullet,i);if(!n)return;n._components=null;let o=n.getComponent(Je);o||(o=n.addComponent(Je)),o.norV3=e[l],o.target=this,o.speed=.8*t.bulletsp,o.trail=V.Main4,o.deltaY=-50,n.size(0,0),n.pos(a.x+s[l],a.y+30),this.planeBg.parent.addChild(n)}})}initPlane6Bullet(){const t=n.planes[6],e=(t.shooting,[181,181,180,180,127,127,126,126,76,76,74,74,16,16,20,20,-13,-13,-40]),s=[0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1],i=gt[6][3],a=this.getRes(_.battle.Player6Bullet),l=this.getRes(_.battle.Player6Bullet1),o=this.getVec3(this.planeBg.x,this.planeBg.y);Laya.timer.loop(400,this,()=>{for(let n=0;n<i.length;n++){let h=null;if(!(h=s[n]?this.open("Lobby://"+_.battle.Player6Bullet1,l):this.open("Lobby://"+_.battle.Player6Bullet,a)))return;h._components=null;let r=h.getComponent(Je);r||(r=h.addComponent(Je)),r.norV3=this.getVec3(0,-1),r.speed=.5*t.bulletsp,r.trail=null,r.target=this,r.deltaY=100,h.pos(o.x+i[n],o.y+e[n]),this.planeBg.parent.addChild(h)}})}}class es extends Q{constructor(){super(),this.startBtn=null,this.contBtn=null,this.rankBtn=null,this.taskBtn=null,this.achBtn=null,this.dailyBtn=null,this.endBtn=null,this.showBtn=null,this.chaHorSel=null,this.midNode=null,this.horNode=null,this.modeNode=null,this.modeBtn=null,this.nomBtn=null,this.difBtn=null,this.chaLab=null,this.chaNameLab=null,this.chaFigLab=null,this.chaLevLab=null,this.chaLevTitLab=null,this.nid=null,this.tabIndex=0}onEnable(){const t=this.horNode.numChildren,e=()=>{const e=S.chapter-1+15*(S.diff-1);for(let s=0;s<t;s++){const t=s<15?k.uchapter[s+1]:k.udchapter[s-15+1];this.horNode.getChildAt(s).getChildAt(0).getChildAt(1).visible=!t,this.horNode.getChildAt(s).getChildAt(0).getChildAt(0).alpha=e==s?1:0}},i=this.horNode.getComponent(Qe);i.selectIndex=S.chapter-1+15*(S.diff-1);const a=s.comChapters,l=s.difChapters;i.moveEndHandle=(t=>{const e=t>14?t-15+1:t+1,s=t>14?2:1;this.chaLab.text=e+"";const i=s,n=1==i?a[e-1]:l[e-1],o=1==s?"":`(${y.BattlePage[9]})`;if(this.chaNameLab.text=n.name+o,this.chaFigLab.text=n.fight+" ",this.contBtn.visible=!(!S.lastData||S.lastData.chapter!=e||S.lastData.diff!=i),1==i){this.chaLevLab.text=k.uchapter[e]+"/"+n.level;const t=!!k.chapter[e],s=!!k.uchapter[e];this.chaFigLab.parent.parent.visible=s,this.chaLevLab.parent.visible=s,this.startBtn.visible=s,this.chaNameLab.visible=s,t?(this.chaLevTitLab.text="Completed",this.chaLevLab.visible=!1):(this.chaLevTitLab.text=y.BattlePage[3],this.chaLevLab.visible=!0)}else if(2==i){this.chaLevLab.text=k.udchapter[e]+"/"+n.level;const t=!!k.dchapter[e],s=!!k.udchapter[e];this.chaFigLab.parent.parent.visible=s,this.chaLevLab.parent.visible=s,this.startBtn.visible=s,this.chaNameLab.visible=s,t?(this.chaLevTitLab.text="Completed",this.chaLevLab.visible=!1):(this.chaLevTitLab.text=y.BattlePage[3],this.chaLevLab.visible=!0)}S.chapter=e,S.diff=i,h(!0)});let n=!1;const o=()=>{if(n)return;n=!0;const t=()=>{this.loadBatPre().then(()=>{S.lastData=null,Laya.Scene.open("BattleScene.scene")})};S.lastData?J.Tip({title:y.Common[12],desc:y.Common[22],sure:t,close:()=>{n=!1}},Ke.instance.Dialog):t()};this.setClick(this.startBtn,()=>{k.chapter[2]?(this.showBtn.visible=!1,this.openDialog(_.lobby.HangarDialog,Ke.instance.Dialog)):o()},this),r.on("HangarDialog.go",this,()=>{o()}),this.setClick(this.contBtn,()=>{n||(n=!0,this.loadBatPre().then(()=>{window["__continue.battle__"]=!0,Laya.Scene.open("BattleScene.scene")}))},this),r.on(Ss.OpenPage,this,this.onOpen),r.on("adventure.start",this,()=>{n||(n=!0,this.loadBatPre().then(()=>{Laya.Scene.open("BattleScene.scene")}))}),this.setClick(this.rankBtn,()=>{this.openDialog(_.lobby.RankDialog,Ke.instance.Dialog)},this),this.setClick(this.taskBtn,()=>{this.openDialog(_.lobby.TaskDialog,Ke.instance.Dialog)},this),this.setClick(this.achBtn,()=>{this.openDialog(_.lobby.AchievementDialog,Ke.instance.Dialog)},this),this.setClick(this.dailyBtn,()=>{this.openDialog(_.lobby.DailyDialog,Ke.instance.Dialog)},this),this.setClick(this.endBtn,()=>{this.openDialog(_.lobby.EndlessDialog,Ke.instance.Dialog)},this),this.setClick(this.showBtn,()=>{c("点击左下角待解锁飞机","");const t=this.nid;if(!t)return;const e=[];e.push(V.PlaneTrackModel),e.push(I[t]),3==t&&e.indexOf(V.DaoDan)<0&&e.push(V.DaoDan),4==t&&e.indexOf(V.Main4)<0&&e.push(V.Main4);let s=0;const i=()=>{this.openDialog(_.lobby.UnlockPlaneDialog,Ke.instance.Dialog,e=>{e.getComponent(ts).setData(t)})};Y.load3D(e).then(()=>{console.log("load model complete..."),2==++s&&i()}),Laya.loader.create("prefab/battle/merge.json",Laya.Handler.create(this,()=>{console.log("load prefab complete..."),2==++s&&i()}),Laya.Handler.create(this,t=>{}))},this),Laya.timer.once(1e3,this,()=>{this.loadBatPre()}),this.modeNode.visible=!1;const h=t=>{const s=S.diff;this.modeBtn.text=1==s?y.BattlePage[4]:y.BattlePage[9];const a=Ke.instance;a.norNode&&(a.norNode.visible=1==s),a.difNode&&(a.difNode.visible=1!=s),t||e(),t||i.moveEndHandle(i.selectIndex)};h(),r.on("lobby.addbg",this,h);const p=C.achievements,u={};for(const t in p){const e=p[t];u[e.type]||(u[e.type]=[]),u[e.type].push(e)}if(ze.Register("BattlePage.achBtn",()=>{let t=!1;for(const e in u){const s=u[e];let i=L.getAchieve(e);const a=s[i.index-1]?s[i.index-1]:s[s.length-1];if(i.num>=a.num&&i.index<=a.index)return t=!0}return t}),ze.Register("BattlePage.dailyBtn",()=>{let t=!1;const e=L.dailys;for(const s in e){const i=e[s],a=C.dailyTasks[s];if(i.num>=a.num&&!i.recd)return t=!0}return t}),ze.Register("BattlePage.taskBtn",()=>{let t=!1;const e=Date.now(),s=L.tasks;for(const i in s){const a=s[i];if(a&&a.end<=e&&!a.recd&&a.start)return t=!0}return t}),m.guide2){if(!window["__global.data__"]){const t=m.signinData;!C.isSignin&&t.num<7&&!d.isSameDay(t.last,Date.now())&&(C.isSignin=!0,Laya.timer.once(500,this,()=>{this.openDialog(_.lobby.SigninDialog,Ke.instance.Dialog)}))}}else m.guide2=1,Laya.timer.once(200,this,()=>{this.loadPrefab("prefab/GuidanceDialog.json").then(t=>{const e=this.open("prefab/GuidanceDialog.json",t);Ke.instance.Guid.addChild(e),wt.init(e,[{x:360,y:910,radius:60}]),c("新手引导","进入第一章")})});window["__global.data__"]=null,r.on("UnlockChapterDialog.close",this,this.initShowNode.bind(this)),this.initShowNode()}initShowNode(){const t=this.showBtn,e=m.planes;if(k.chapter[13]||e.indexOf(6)>-1)t.visible=!1;else{t.visible=!0;const s=[1,2,3,4,6],i=[];for(let t=0;t<e.length;t++){const s=e[t];5!=s&&i.push(s)}const a=Math.max(...i),l=s[s.indexOf(a)+1];r.event(Ss.HangarPage,[l,t.getChildByName("skin")]),t.getChildByName("bg").getChildAt(0).text=y.HangarItem[l]||"",this.nid=l}}onDisable(){r.offAllCaller(this),Laya.timer.clearAll(this)}onOpen(t){const e=this.owner;t==this.tabIndex?(e.visible=!0,this.onEnActive(),this.midNode.x=-360,Laya.Tween.to(this.midNode,{x:360},300)):e.visible=!1}onEnActive(){this.initShowNode()}loadBatPre(){const t=[],e=_.battle;for(const s in e){const i=e[s];t.push(i)}const s=[];s.push(V.PlaneTrackModel),s.push(V.Coin),s.push(I[S.id]),3==S.id&&s.indexOf(V.DaoDan)<0&&s.push(V.DaoDan),4==S.id&&s.indexOf(V.Main4)<0&&s.push(V.Main4);let i=null;{const t=[1,2,3,4,5,6],e=S.id;t.splice(t.indexOf(e),1),i=t[d.getRandom(4,0)],u.FriendPlaneId=i,s.push(I[i]),3==i&&s.indexOf(V.DaoDan)<0&&s.push(V.DaoDan),4==i&&s.indexOf(V.Main4)<0&&s.push(V.Main4)}return new Promise((e,a)=>{let l=0,n=0;s.length&&n++,t.length&&n++,Y.load3D(s).then(()=>{console.log("load model complete..."),++l==n&&e()}),Laya.loader.create("prefab/battle/merge.json",Laya.Handler.create(this,()=>{console.log("load prefab complete..."),Y.loadPlayerPre(S.id),i&&Y.loadPlayerPre(i);const t=v.assets[S.chapter+""+S.diff];t&&Y.loadEnemyPre(t[1]),++l==n&&e()}),Laya.Handler.create(this,t=>{}))})}onDestroy(){}}class ss extends Q{constructor(){super(),this.cloBtn=null,this.itemList=null}static Reward(t){$.openDialog(_.lobby.CommonRewardDialog,Ke.instance.Dialog,e=>{e.getComponent(ss).setData(t)},!1,!0)}setData(t){if(t.length>=5)this.itemList.width=562,this.itemList.repeatX=5;else{const e=t.length;this.itemList.width=106*e+8*(e-1),this.itemList.repeatX=e}this.itemList.hScrollBarSkin="",this.itemList.renderHandler=Laya.Handler.create(this,(e,s)=>{(e=>{const i=e.getChildByName("bg1"),a=e.getChildByName("bg2"),l=e.getChildByName("icon"),n=e.getChildByName("num"),o=e.getChildByName("name"),h=t[s],r=h[2],c=h[0],p=h[1],y=!!(c>=1011&&c<=1016);null!=r?(i.visible=!0,i.skin=`lobby/itembg/${r>3?3:r}.png`):i.visible=!1,a.visible=y,l.skin=`lobby/equicon/${c}.png`,n.text=d.formatNumber(p),n.visible=!(p<=1);const m=u.items[c];o.text=m?m.des:""})(e)},null,!1),this.itemList.array=t}onEnable(){this.setClick(this.cloBtn,()=>{this.closeDialog(this)},this)}onDisable(){Laya.Tween.clearAll(this),Laya.timer.clearAll(this)}}class is extends Q{constructor(){super(),this.titleLab=null,this.cloBtn=null,this.adBtn=null,this.itemList=null}static Reward(t,e){$.openDialog(_.lobby.CommonRewardAdDialog,Ke.instance.Dialog,s=>{s.getComponent(is).setData(t,e)},!1,!0)}setData(t,e,s){if(t.length>=5)this.itemList.width=562;else{const e=t.length;this.itemList.width=106*e+8*(e-1)}this.titleLab.text=e||y.Shop[8],this.itemList.hScrollBarSkin="",this.itemList.renderHandler=Laya.Handler.create(this,(e,s)=>{(e=>{const i=e.getChildByName("bg1"),a=e.getChildByName("bg2"),l=e.getChildByName("icon"),n=e.getChildByName("num"),o=t[s],h=o[2],r=o[0],c=o[1],p=!!(r>=1011&&r<=1016);null!=h?(i.visible=!0,i.skin=`lobby/itembg/${h>3?3:h}.png`):i.visible=!1,a.visible=p,l.skin=`lobby/equicon/${r}.png`,n.text="x"+d.formatNumber(c),n.visible=!(c<=1)})(e)},null,!1),this.itemList.array=t;const i=this.adBtn;i.offAllCaller(i),this.setClick(i,()=>{h.gameSDK.faceBookAdvertisement.showRewardVideoAd(s||h.rewardedVideoID,()=>{this.closeDialog(this),k.updateItem(t),ss.Reward(t)})},i)}onEnable(){this.setClick(this.cloBtn,()=>{this.closeDialog(this)},this)}onDisable(){Laya.Tween.clearAll(this),Laya.timer.clearAll(this)}}class as extends Q{constructor(){super(),this.tipLab=null}static Tips(t,e){$.openDialog(_.lobby.CommonTipDialog,e||Ke.instance.Dialog,e=>{e.getComponent(as).setData(t)},!0)}setData(t){const e=this.owner;this.tipLab.text=t,Laya.timer.frameOnce(1,this,()=>{e.width=this.tipLab.width+30,e.height=this.tipLab.height+25})}onEnable(){const t=this.owner;t.alpha=0;const e=t.y-200;Laya.Tween.to(t,{alpha:1},300,Laya.Ease.circOut),Laya.timer.once(1200,this,()=>{Laya.Tween.to(t,{alpha:0,y:e},300,Laya.Ease.circIn,Laya.Handler.create(this,()=>{t.removeSelf()}))})}onDisable(){Laya.Tween.clearAll(this),Laya.timer.clearAll(this)}}class ls extends Q{constructor(){super(),this.closeBtn=null,this.titleLab=null,this.nameLab=null,this.icoIma=null,this.planeIma=null,this.nextHandle=null}onEnable(){this.setClick(this.closeBtn,()=>{this.closeDialog(this),this.nextHandle?this.nextHandle():(r.event("UnlockChapterDialog.close"),!m.guide3&&k.chapter[1]&&(m.guide3=1,Laya.timer.once(200,this,()=>{this.loadPrefab("prefab/GuidanceDialog.json").then(t=>{const e=this.open("prefab/GuidanceDialog.json",t);Ke.instance.Guid.addChild(e);const s=Laya.stage.height-52;wt.init(e,[{x:217,y:s,radius:40,arrow:2},{x:623,y:752,radius:40},{x:362,y:s,radius:40,arrow:2},{x:360,y:910,radius:60}]),c("新手引导","进入机库")})})))},this)}setData(t,e){if("chapter"==e){this.titleLab.text=y.Common[10];const e=t[0];this.planeIma.visible=!1,this.icoIma.visible=!0,this.icoIma.skin=`lobby/ball/${e}.png`;const i=2==S.diff?`[${y.BattlePage[9]}]`:"";this.nameLab.text=s.comChapters[e-1].name+i,t[1]&&(this.nextHandle=(()=>{this.openDialog(_.lobby.UnlockChapterDialog,Ke.instance.Dialog,e=>{e.getComponent(ls).setData(t,"plane")})}))}else if("plane"==e){this.titleLab.text=y.Common[11];const e=t[1];this.icoIma.visible=!1,this.planeIma.visible=!0,this.planeIma.graphics.clear(),r.event(Ss.HangarPage,[e,this.planeIma]);const s=n.planes[e];this.nameLab.text=s.name}}onDisable(){}}class ns extends Q{constructor(){super(),this.content=null,this.desc=null,this.closeBtn=null}onEnable(){this.setClick(this.closeBtn,()=>{this.closeDialog(this)},this)}setData(t){const e=t[0],s=u.items[e];this.desc.text=s.des,this.loadPrefab(_.lobby.EquMainItem).then(e=>{const s=this.open(_.lobby.EquMainItem,e),i=s.getComponent(os);i.touched=!1,i.initItem(t),s.pos(53,53),this.content.addChild(s)})}onDisable(){r.offAllCaller(this)}}class os extends Q{constructor(){super(),this.bg1Ima=null,this.bg2Ima=null,this.iconIma=null,this.titLab=null,this.numLab=null,this.levLab=null,this.selNode=null,this.lockNode=null,this.cind=null,this.sind=[],this.squa=-1,this.sid=-1,this.types=null,this.cdata=null,this.touched=!0,this.touHandle=null}onEnable(){const t=Ke.instance;this.owner.offAllCaller(this),this.setClick(this.owner,()=>{if(this.cdata&&this.touched){const e=this.cdata[0];!!(e>=1011&&e<=1016)?this.openDialog(_.lobby.EquMatDesDialog,t.Dialog,t=>{t.getComponent(ns).setData(this.cdata)},!1,!0):this.touHandle&&this.touHandle(this.cind)}},this,null,!0),r.on(Ss.EquSynItemSel,this,(t,e,s)=>{if("EquSymDialog"==this.types)if(this.sind=t,this.squa=e,this.sid=s,t.indexOf(this.cind)>-1?this.selNode.visible=!0:this.selNode.visible=!1,t.length){if(this.cdata){this.cdata[0]==s&&this.cdata[1]==e?(this.lockNode.visible=!1,this.touched=!0):(this.lockNode.visible=!0,this.touched=!1)}}else this.lockNode.visible=!1,this.touched=!0})}initItem(t,e,s){null!=e&&(this.cind=e),this.cdata=t;const a=t[0],l=t[1],n=t[2],o=t[4]||1;let h=i.equs[a];const r=!!(a>=1011&&a<=1016);r&&(h=u.items[a]);const c=l-3,d={1:y.EquipmentPage[1],2:y.EquipmentPage[2],3:y.EquipmentPage[3],4:y.EquipmentPage[4],5:y.EquipmentPage[5],6:y.EquipmentPage[6]};if(this.bg1Ima.visible=!r,r||(this.bg1Ima.skin=`lobby/itembg/${c>0?3:l}.png`),this.bg2Ima.visible=r,this.iconIma.skin=`lobby/equicon/${a}.png`,r){let t=h.name;s&&(t=h.name.replace("Materials","").replace("materials","")),this.titLab.text=t}else this.titLab.text=d[h.type];if(this.numLab.visible=!(!o||1==o),this.numLab.text=o+"",this.levLab.visible=!r,this.levLab.text="Lv."+n,"EquSymDialog"==this.types){let e=!!(this.sind.indexOf(this.cind)>-1);if(this.selNode.visible=e,this.sind.length){t[0]==this.sid&&t[1]==this.squa?(this.lockNode.visible=!1,this.touched=!0):(this.lockNode.visible=!0,this.touched=!1)}else this.lockNode.visible=!1,this.touched=!0}}onDisable(){r.offAllCaller(this)}onDestroy(){}}class hs extends Laya.Image{constructor(){super(),this.size(124,124)}onEnable(){}onDisable(){}}class rs extends Laya.Image{constructor(){super(),this.size(151,74)}onEnable(){}onDisable(){}}class cs extends Q{constructor(){super(),this.title1=null,this.title2=null,this.selNode=null,this.pid=0,this.cid=1}onEnable(){this.setClick(this.owner,()=>{this.pid!=this.cid&&r.event(Ss.EquItemSel,this.pid)},this,null,!0),r.on(Ss.EquItemSel,this,t=>{this.selNode.visible=t==this.pid,this.cid=t})}setData(t,e,s){this.pid=t,this.cid=e,this.title1.text=s,this.title2.text=s,this.selNode.visible=t==e}onDisable(){r.offAllCaller(this)}}class ds extends Q{constructor(){super(),this.closeBtn=null,this.decBtn=null,this.nameLab=null,this.lvLab=null,this.icoIma=null,this.goldNode=null,this.mateNode=null,this.cdata=null,this.etype=null,this.parcmp=null}onEnable(){this.setClick(this.closeBtn,()=>{this.closeDialog(this)},this),this.setClick(this.decBtn,()=>{if(!this.cdata)return;const t=this.cdata[0],e=this.cdata[2],s=1010+t-10*Math.floor(t/10);let i=0,a=0;for(let t=1;t<e;t++)i+=l.getGold(t,2),a+=l.getGold(t,3);if(i=Math.floor(.75*i),"OnEqu"==this.etype){const t=d.findKey(k.equips,this.cdata);k.equips[t][2]=1}else{const t=d.findKey(k.hequips,this.cdata);k.hequips[t][2]=1}k.updateItem([[101,i],[s,a]]),r.event(Ss.EquSyn),this.closeDialog(this),this.parcmp&&this.closeDialog(this.parcmp),ss.Reward([[101,i],[s,a]])},this)}setData(t){this.cdata=t;const e=t[0],s=t[1],a=t[2],n=i.equs[e];this.nameLab.text=n.name,this.icoIma.skin=`lobby/equicon/${e}.png`,this.lvLab.text=`Lv ${a}/${"number"==typeof n.maxlv?n.maxlv:n.maxlv.split("|")[s-1]}`;const o=this.goldNode.getChildAt(1);let h=0,r=0;for(let t=1;t<a;t++)h+=l.getGold(t,2),r+=l.getGold(t,3);h=Math.floor(.75*h),o.text="x"+d.formatNumber(h);const c=this.mateNode.getChildAt(2),p=this.mateNode.getChildAt(1),u=1010+e-10*Math.floor(e/10);p.skin=`lobby/equicon/${u}.png`,c.text="x"+d.formatNumber(r)}onDisable(){}}class ps extends Q{constructor(){super(),this.closeBtn=null,this.decBtn=null,this.equBtn=null,this.upBtn=null,this.title=null,this.itemBg=null,this.itemIcon=null,this.itemLvLab=null,this.mattsNode=null,this.fattsNode=null,this.thusNode=null,this.thusAttNode=null,this.dssNode=null,this.goiNode=null,this.maiNode=null,this.cdata=null,this.itype=null}onEnable(){this.setClick(this.closeBtn,()=>{this.closeDialog(this)},this),this.setClick(this.decBtn,()=>{this.cdata&&this.openDialog(_.lobby.EquDecDialog,Ke.instance.Dialog,t=>{const e=t.getComponent(ds);e.etype=this.itype,e.parcmp=this,e.setData(this.cdata)})},this),this.setClick(this.equBtn,()=>{if(!this.cdata)return;const t=this.cdata[0],e=i.equs[t].type;if("OnEqu"==this.itype)k.equips[e]=null,k.hequips[Date.now()]=this.cdata,as.Tips(y.Tips[3].replace("%s",i.equs[t].name));else{const s=d.findKey(k.hequips,this.cdata);delete k.hequips[s],k.equips[e]&&(k.hequips[Date.now()]=k.equips[e]),k.equips[e]=this.cdata,as.Tips(y.Tips[4].replace("%s",i.equs[t].name))}r.event(Ss.EquSyn),this.closeDialog(this)},this),this.setClick(this.upBtn,()=>{if(!this.cdata)return;const t=this.cdata[0],e=this.cdata[2],s=l.getGold(e,2),a=1010+t-10*Math.floor(t/10),n=l.getGold(e,3);if(k.coin>=s&&k.items[a]>=n){if(k.updateItem([[101,-s],[a,-n]]),"OnEqu"==this.itype){const t=d.findKey(k.equips,this.cdata);k.equips[t][2]++,this.setData(k.equips[t])}else{const t=d.findKey(k.hequips,this.cdata);k.hequips[t][2]++,this.setData(k.hequips[t])}r.event(Ss.EquSyn),as.Tips(y.Tips[5].replace("%s",i.equs[t].name)),r.event("player.upEquLevel")}else as.Tips(y.Tips[6])},this),r.on(Ss.EquSyn,this,()=>{this.setData(this.cdata)})}setData(t){this.cdata=t;const e=t[0],s=t[1],n=t[2];this.decBtn.visible=!(n<=1);const o=i.equs[e];this.title.text=o.name,this.itemBg.skin=`lobby/itembg/${s>3?3:s}.png`,this.itemIcon.skin=`lobby/equicon/${e}.png`,this.itemLvLab.text=`Lv${n}/${"number"==typeof o.maxlv?o.maxlv:o.maxlv.split("|")[s-1]}`;const h=y.EquMainStr,r=a.getAtts(e,s,n);for(let t=1;t<3;t++){const e=this.mattsNode.getChildAt(t),s=e.getChildAt(0),i=r[t-1];i?(e.skin=`lobby/equatticon/${i[0]}.png`,s.text=h[i[0]].replace("&",d.formatNumber(i[1]))):e.visible=!1}const c=t[3];for(let t=1;t<5;t++){const e=this.fattsNode.getChildAt(t),s=e.getChildAt(0),a=c[t-1];a?(e.skin=`lobby/equatticon/${a[0]-1e3<7?a[0]-1e3:6}.png`,s.text=i.equadds[a[0]].name.replace("s",d.formatNumber(a[1]))):e.visible=!1}const p=o.suit,u=k.equips;for(const t in i.equs){const e=i.equs[t];if(e.suit==p){const t=this.thusNode.getChildAt(e.type);t.text=`${e.name}`;const s=!!u[e.type]&&i.equs[u[e.type][0]].suit==p;t.color=s?"#48ff04":"#adaeae"}}let m=0;for(const t in u){const e=u[t];if(e){i.equs[e[0]].suit==p&&m++}}const g=a.thunders[p];if(g)for(let t=0;t<3;t++){const e=this.thusAttNode.getChildAt(t),s=g[2*(t+1)];s?(e.text=`(${2*(t+1)}) ${y.EquThunder2[p]}\n${y.EquThunder1[s[0]]}`,e.color=m>=2*(t+1)?"#48ff04":"#adaeae"):this.dssNode.getChildAt(t).visible=!1}else{this.thusAttNode.getChildAt(0).text="",this.dssNode.getChildAt(0).visible=!1,this.dssNode.getChildAt(1).visible=!1,this.dssNode.getChildAt(2).visible=!1}const b=this.equBtn.getChildAt(0);"OnEqu"==this.itype?b.text=y.EquOequDialog[8]:b.text=y.EquOequDialog[6];const f=this.goiNode.getChildAt(1),S=l.getGold(n,2);f.text=d.formatNumber(k.coin)+"/"+d.formatNumber(S),f.color=k.coin>=S?"#48ff04":"#ff0000";const C=1010+e-10*Math.floor(e/10),L=this.maiNode.getChildAt(1),D=this.maiNode.getChildAt(2);L.skin=`lobby/equicon/${C}.png`;const P=l.getGold(n,3),x=k.items[C]||0;D.text=d.formatNumber(x)+"/"+d.formatNumber(P),D.color=x>=P?"#48ff04":"#ff0000"}onDisable(){r.offAllCaller(this)}}class us extends Q{constructor(){super(),this.plaIma=null,this.attLab=null,this.hpLab=null,this.equNode=null,this.togList=null,this.itemList=null,this.suitBtn=null,this.synBtn=null,this.tabIndex=0,this.selid=1,this.heqArr=[]}onEnable(){const t=Ke.instance;r.on(Ss.OpenPage,this,this.onOpen),this.setClick(this.suitBtn,()=>{this.openDialog(_.lobby.EquSuitDialog,t.Dialog)},this),this.setClick(this.synBtn,()=>{this.openDialog(_.lobby.EquSymDialog,t.Dialog,null,!1,!0)},this);const e=k.hequips,s=this.heqArr,a=i.equs;for(const t in e){const i=e[t],l=i[0],n=a[l].type;s[0]||(s[0]=[]),s[1]||(s[1]=[]),s[2]||(s[2]=[]),s[3]||(s[3]=[]),s[4]||(s[4]=[]),s[5]||(s[5]=[]),s[6]||(s[6]=[]),s[0].push(i),s[n].push(i)}for(let t=0;t<s.length;t++){s[t].sort((t,e)=>{let s=t[0],i=e[0],l=t[1],n=e[1],o=a[s].type,h=a[i].type,r=a[s].suit,c=a[i].suit,d=t[2]||1;return 1e5*n+1e4*h+1e3*c+(e[2]||1)-(1e5*l+1e4*o+1e3*r+d)})}const l=k.items;for(const t in l){const e=l[t],i=parseInt(t);i>=1011&&i<=1016&&(s[0]||(s[0]=[]),s[i-1010]||(s[i-1010]=[]),s[0].push([i,0,0,[],e]),s[i-1010].push([i,0,0,[],e]))}this.selid=1,this.setItemList(this.selid);const n=[[1,"ALL"],[2,y.EquipmentPage[1]],[3,y.EquipmentPage[2]],[4,y.EquipmentPage[3]],[5,y.EquipmentPage[4]],[6,y.EquipmentPage[5]],[7,y.EquipmentPage[6]]];this.togList.itemRender=rs,this.togList.hScrollBarSkin="",this.togList.renderHandler=Laya.Handler.create(this,(t,e)=>{const s=t=>{t.getComponent(cs).setData(n[e][0],this.selid,n[e][1])},i=t.getChildAt(0);i?s(i):this.loadPrefab(_.lobby.EquMainTogItem).then(e=>{const i=this.open(_.lobby.EquMainTogItem,e);t.addChild(i),s(i)})},null,!1),this.togList.array=n,r.on(Ss.EquItemSel,this,t=>{this.selid=t,this.setItemList(t)}),this.itemList.itemRender=hs,this.itemList.vScrollBarSkin="",this.itemList.renderHandler=Laya.Handler.create(this,(t,e)=>{const s=t=>{const s=t.getComponent(os);s.touHandle=(()=>{const t=Ke.instance;this.openDialog(_.lobby.EquOequDialog,t.Dialog,t=>{const s=t.getComponent(ps);s.itype="OffEqu",s.setData(this.itemList.array[e])})}),s.initItem(this.itemList.array[e],void 0,!0)},i=t.getChildAt(0);i?s(i):this.loadPrefab(_.lobby.EquMainItem).then(e=>{const i=this.open(_.lobby.EquMainItem,e);i.pos(53,53),s(i),t.addChild(i)})},null,!1),r.on(Ss.EquSyn,this,()=>{this.initList()})}setItemList(t){const e=this.heqArr;this.itemList.array=e[t-1]}initList(){let t=S.attack,e=S.hp;S.initPlayer(),h.gameSDK.leaderboard.setScoreAsync(S.getCombatValue()),this.heqArr=[];const s=k.hequips,a=this.heqArr,l=i.equs;for(const t in s){const e=s[t],i=e[0],n=l[i].type;a[0]||(a[0]=[]),a[1]||(a[1]=[]),a[2]||(a[2]=[]),a[3]||(a[3]=[]),a[4]||(a[4]=[]),a[5]||(a[5]=[]),a[6]||(a[6]=[]),a[0].push(e),a[n].push(e)}for(let t=0;t<a.length;t++){a[t].sort((t,e)=>{let s=t[0],i=e[0],a=t[1],n=e[1],o=l[s].type,h=l[i].type,r=l[s].suit,c=l[i].suit,d=t[2]||1;return 1e5*n+1e4*h+1e3*c+(e[2]||1)-(1e5*a+1e4*o+1e3*r+d)})}const n=k.items;for(const t in n){const e=n[t],s=parseInt(t);s>=1011&&s<=1016&&(a[0]||(a[0]=[]),a[s-1010]||(a[s-1010]=[]),a[0].push([s,0,0,[],e]),a[s-1010].push([s,0,0,[],e]))}this.setItemList(this.selid),this.onEnActive(t,e)}onDisable(){r.offAllCaller(this)}onOpen(t){const e=this.owner;if(t==this.tabIndex){e.visible=!0;let t=S.id;r.event(Ss.HangarPage,[t,this.plaIma]),this.initList()}else e.visible=!1}textAnim(t,e,s){let i=(s-e)/20,a=e;Laya.timer.clearAll(t),this.schedule(50,()=>{a+=i,t.text=d.formatNumber(Math.floor(a))+" "},t,20,null,!0,()=>{t.text=d.formatNumber(s)+" "})}onEnActive(t,e){t?(this.textAnim(this.attLab,t,S.attack),this.textAnim(this.hpLab,e,S.hp)):(this.attLab.text=d.formatNumber(S.attack)+" ",this.hpLab.text=d.formatNumber(S.hp)+" ");const s=k.equips;let i=!0;for(const t in s){const e=s[t];e&&(i=!1);const a=this.equNode.getChildAt(parseInt(t)-1),l=a.getChildAt(1);if(a)if(e&&e.length)if(l){l.getComponent(os).initItem(e),l.visible=!0}else this.loadPrefab(_.lobby.EquMainItem).then(i=>{const l=this.open(_.lobby.EquMainItem,i),n=l.getComponent(os);n.touHandle=(()=>{const e=Ke.instance;this.openDialog(_.lobby.EquOequDialog,e.Dialog,e=>{const i=e.getComponent(ps);i.itype="OnEqu",i.setData(s[t])})}),n.initItem(e),l.pos(53,53),a.addChild(l)});else l&&(l.visible=!1)}this.suitBtn.visible=!i,this.synBtn.x=i?279:383}onDestroy(){}}class ys extends Laya.Image{constructor(){super(),this.size(203,143)}onEnable(){}onDisable(){}}const ms=U;class gs extends Q{constructor(){super(),this.newNode=null,this.planeSpr=null,this.selNode=null,this.lockNode=null,this.redDot=null,this.pid=0,this.cid=1}onEnable(){this.setClick(this.owner,()=>{if(this.pid!=this.cid){r.event(Ss.HangarItemSel,this.pid);const t=m.unlockPage.indexOf("plane"+this.pid);t>-1&&m.unlockPage.splice(t,1),this.redDot.visible=!1}},this,null,!0),r.on(Ss.HangarItemSel,this,t=>{this.selNode.visible=t==this.pid,this.cid=t})}setData(t,e){this.pid=t,this.cid=e,this.newNode.visible=!1,this.planeSpr.skin=ms[t],this.selNode.visible=t==e;const s=m.planes.indexOf(t);this.lockNode.visible=s<0,this.lockNode.visible&&(this.lockNode.getChildByName("title").text=y.HangarItem[t]||"");let i=!1;s>0&&m.unlockPage.indexOf("plane"+t)>-1&&(i=!0),this.redDot.visible=i}onDisable(){r.offAllCaller(this)}}class bs extends Q{constructor(){super(),this.levLab=null,this.descLab=null,this.powLab=null,this.plaNameLab=null,this.propNode=null,this.attLab=null,this.hpLab=null,this.upLevelBtn=null,this.goldLab=null,this.chooseBtn=null,this.planeSpr=null,this.planeList=null,this.closeBtn=null,this.goBtn=null,this.tabIndex=0,this.selid=0}onEnable(){let t=S.id;this.selid=t,this.setPlane(t),this.closeBtn&&this.setClick(this.closeBtn,()=>{r.event("UnlockChapterDialog.close"),this.closeDialog(this)},this),this.goBtn&&this.setClick(this.goBtn,()=>{r.event("UnlockChapterDialog.close"),r.event("HangarDialog.go"),this.closeDialog(this),c("通过GO进入游戏",S.chapter)},this),r.on(Ss.OpenPage,this,this.onOpen);const e=[1,2,3,4,5,6],s=m.planes,i=[],a=[];for(let t=0;t<e.length;t++){const l=e[t];s.indexOf(l)>-1?i.push(l):a.push(l)}i.push.apply(i,a),this.planeList.itemRender=ys,this.planeList.vScrollBarSkin="",this.planeList.renderHandler=Laya.Handler.create(this,(e,s)=>{const a=e.getChildAt(0);if(a){a.getComponent(gs).setData(i[s],t)}else this.loadPrefab(_.lobby.HangarPlaneItem).then(a=>{const l=this.open(_.lobby.HangarPlaneItem,a);e.addChild(l),l.getComponent(gs).setData(i[s],t)})},null,!1),this.planeList.array=i,this.planeList.scrollTo(i.indexOf(t)),r.on(Ss.HangarItemSel,this,t=>{this.selid=t;const e=S.attack,s=S.hp,a=S.getCombatValue();this.setPlane(t,e,s,a),this.planeList.scrollTo(i.indexOf(t))});const o=this.powLab.getChildAt(1),d=this.attLab.getChildAt(1);o&&(o.visible=!1,o.on(Laya.Event.STOPPED,this,()=>{o.visible=!1})),d&&(d.visible=!1,d.on(Laya.Event.STOPPED,this,()=>{d.visible=!1})),this.setClick(this.upLevelBtn,()=>{const t=l.getGold(m.level);if(k.coin>=t){m.level++,k.updateCoin(-t);const e=S.attack,s=S.hp,i=S.getCombatValue();S.initPlayer(),h.gameSDK.leaderboard.setScoreAsync(S.getCombatValue()),this.setPlane(this.selid,e,s,i),r.event("player.upHangarLevel"),Laya.SoundManager.playSound(O.PlaneLevUpSou),o&&o.templet&&(o.visible=!0,o.play(0,!1)),d&&d.templet&&(d.visible=!0,d.play(0,!1)),c("升级飞机",m.level)}else this.openDialog(_.lobby.CommonRewardAdDialog,Ke.instance.Dialog,t=>{t.getComponent(is).setData([[p.Gold,1e4]],y.Common[21])})},this),this.setClick(this.chooseBtn,()=>{S.id=this.selid;const t=S.attack,e=S.hp,s=S.getCombatValue();S.initPlayer(),h.gameSDK.leaderboard.setScoreAsync(S.getCombatValue()),this.setPlane(this.selid,t,e,s),as.Tips(y.Tips[12].replace("%s",n.planes[this.selid].name))},this),ze.Register("HangarPage.priBtn",()=>{let t=!1;const e=l.getGold(m.level);return k.coin>=e&&(t=!0),t})}onDisable(){r.offAllCaller(this);const t=this.powLab.getChildAt(1),e=this.attLab.getChildAt(1);t.offAllCaller(this),t.stop(),e.offAllCaller(this),e.stop()}textAnim(t,e,s){let i=(s-e)/20,a=e;Laya.timer.clearAll(t),this.schedule(50,()=>{a+=i,t.text=d.formatNumber(Math.floor(a))+" ",t.__endValue__=Math.floor(a)},t,20,null,!0,()=>{t.text=d.formatNumber(s)+" ",t.__endValue__=s})}setPlane(t,e,s,i){const a=n.planes[t],o=n.planesUI[t],h=S.id,c=m.planes.indexOf(t),p={2:2,3:5,4:7,6:13};if(c<0)Laya.timer.clearAll(this.powLab),Laya.timer.clearAll(this.attLab),Laya.timer.clearAll(this.hpLab),this.plaNameLab.text="??? ",this.powLab.text="??? ",this.attLab.text="??? ",this.hpLab.text="??? ",this.levLab.text="LV.??? ",this.descLab.text=5==t?y.HangarPage[10]:y.HangarPage[9].replace("$",p[t]);else{this.plaNameLab.text=a.name,this.descLab.text=y.HangarPage[8];const n=S.initPlayerUI(t);e?this.textAnim(this.powLab,this.powLab.__endValue__||i,S.getCombatValueUI(n.attack,n.hp)):this.powLab.text=d.formatNumber(S.getCombatValueUI(n.attack,n.hp))+" ";let o=m.level||1;e?(this.textAnim(this.attLab,this.attLab.__endValue__||e,n.attack),this.textAnim(this.hpLab,this.hpLab.__endValue__||s,n.hp)):(this.attLab.text=d.formatNumber(n.attack)+" ",this.hpLab.text=d.formatNumber(n.hp)+" "),this.goldLab.text=d.formatNumber(l.getGold(o)),this.levLab.text=`LV.${o}`}this.upLevelBtn.visible=c>-1,this.chooseBtn.visible=c>-1&&h!=t;let u=this.propNode.numChildren;for(let t=0;t<u;t++){const e=this.propNode.getChildAt(t),s=e.getChildAt(2);let i=o[t]/10,a=27+203*i;Laya.Tween.to(e,{value:i},200),Laya.Tween.to(s,{x:a},200)}r.event(Ss.HangarPage,[t,this.planeSpr])}onOpen(t){const e=this.owner;t==this.tabIndex?(e.visible=!0,this.onEnActive()):e.visible=!1}onEnActive(){this.setPlane(this.selid),this.topAnim()}topAnim(){const t=this.levLab.parent;t.y=-91.5,Laya.Tween.clearAll(t),Laya.Tween.to(t,{y:-6.5},500,Laya.Ease.quadInOut,Laya.Handler.create(this,()=>{Laya.Tween.to(t,{scaleY:.7},100,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{Laya.Tween.to(t,{scaleY:1},1e3,Laya.Ease.bounceOut)}))}))}onDestroy(){}}class fs extends Q{constructor(){super(),this.getBtn=null,this.buyBtn=null,this.titLab=null,this.descLab=null,this.timerLab=null,this.numLab=null,this.timer=0,this.cid=0}onEnable(){const t=u.shopitems,e=[],s=[];for(let i=0;i<t.length;i++){const a=t[i];a.box1&&e.push(a),a.box2&&s.push(a)}const i=()=>{const t=[],i=[];if(1==this.cid||3==this.cid){let a=1==this.cid?e:s;if(a&&a.length){const e=a[d.getRandom(a.length-1,0)].item,s=u.items[e];i.push([e,1]),t.push([s.equip,1,s.quality])}}else t.push([p.Diamond,150]),i.push([p.Diamond,150]);k.updateItem(i),ss.Reward(t),r.event("player.shopBox")};this.setClick(this.getBtn,()=>{if(!this.cid)return;const t=2==this.cid?h.DiamondVideoID:h.rewardedVideoID;h.gameSDK.faceBookAdvertisement.showRewardVideoAd(t,()=>{L.setShopBoxs(this.cid),this.setData(this.cid),i()})},this),this.setClick(this.buyBtn,()=>{if(!this.cid)return;const t=y.ShopData.Box,e=L.shopBoxs,s=t[this.cid],a=e[this.cid];let l=0;a&&(l=a.danum);let n=s.price+50*l;k.diamond>=n?(L.setShopBoxs(this.cid),this.setData(this.cid),k.updateItem([[p.Diamond,-n]]),i()):as.Tips(y.Tips[13])},this)}setData(t){this.cid=t;const e=y.ShopData.Box,s=L.shopBoxs,i=e[t],a=s[t];this.titLab.text=i.title,this.descLab.text=i.desc;let l=i.reset;if(a&&a.reset){const t=Date.now();l=Math.floor(a.reset-t)/1e3}const n=d.formatTimer(l);this.timerLab.text=y.Shop[1]+`${this.autoAddZero(n[0])}:${this.autoAddZero(n[1])}:${this.autoAddZero(n[2])}`;let o=i.adnum,h=0;a&&(o=a.adnum,h=a.danum),this.numLab.text=y.Shop[2]+o,this.getBtn.visible=!!o,this.buyBtn.visible=!o,2==t&&(this.buyBtn.visible=!1),this.buyBtn.getChildByName("tit").text=i.price+50*h+""}onLongUpdate(){if(!this.cid)return;const t=this.cid,e=L.shopBoxs[t],s=y.ShopData.Box[t].adnum;if(e&&e.reset){const i=Date.now();if(i>=e.reset)e.adnum=s,e.danum=0,e.reset=null,this.setData(t);else{let t=Math.floor(e.reset-i)/1e3;const s=d.formatTimer(t);this.timerLab.text=y.Shop[1]+`${this.autoAddZero(s[0])}:${this.autoAddZero(s[1])}:${this.autoAddZero(s[2])}`}}}autoAddZero(t){return t<10?"0"+t:t+""}onUpdate(){this.timer+=Laya.timer.delta,this.timer>=1e3&&(this.timer=0,this.onLongUpdate())}onDisable(){}}class ks extends Q{constructor(){super(),this.pan=null,this.rewNode=null,this.limRewNode=null,this.limSkiNode=null,this.tabIndex=0,this.timer=0,this.limRewRefBtn=null,this.limRewRefTit=null,this.limRewNumTit=null,this.limSkiRefBtn=null,this.limSkiRefTit=null,this.limSkiNumTit=null,this.limSkiTimLabs={}}onEnable(){r.on(Ss.OpenPage,this,this.onOpen),this.timer=0,this.pan.vScrollBarSkin=""}onDisable(){r.offAllCaller(this)}onOpen(t){const e=this.owner;t==this.tabIndex?(e.visible=!0,this.onEnActive()):e.visible=!1}onEnActive(){this.initRewNode(),this.initLimNode(),this.onLongUpdate()}initRewNode(){const t=this.rewNode,e=t.numChildren,s=[1,2,3];y.ShopData.Box,L.shopBoxs;for(let i=0;i<e;i++){const e=s[i];t.getChildAt(i).getComponent(fs).setData(e)}}initLimNode(){let t=L.shopLims;t&&(t.reset||(t.reset=Date.now()+1e3*y.ShopData.Lim.Timer),t.skill||this.resetLimSkill(),t.good||this.resetLimGood(),this.initSkillNode(),this.initGoodNode())}initSkillNode(){let t=L.shopLims.skill;if(!t)return;const e=this.limSkiNode,s=e.getChildByName("refBtn"),i=s.getChildByName("tit"),a=e.getChildByName("num");i.text=t.adnum==y.ShopData.Lim.Skill.adnum?y.Shop[3]:y.Shop[8],a.text=y.Shop[2]+t.adnum,this.limSkiRefBtn=s,this.limSkiRefTit=i,this.limSkiNumTit=a,s.offAllCaller(s),this.setClick(s,()=>{if(t.adnum<1)return;const e=()=>{const e=()=>{t.adnum--,this.resetLimSkill(),this.initSkillNode()};t.adnum!=y.ShopData.Lim.Skill.adnum?h.gameSDK.faceBookAdvertisement.showRewardVideoAd(h.rewardedVideoID,()=>{e()}):e()};Object.keys(t.bskills).length?J.Tip({title:y.Common[12],desc:y.Common[17],sure:e},Ke.instance.Dialog):e()},s);const l=e.getChildByName("items"),n=t.skills;this.limSkiTimLabs={};for(let e=0;e<n.length;e++){const s=n[e],i=l.getChildAt(e),a=i.getChildByName("tit"),o=i.getChildByName("icon"),r=i.getChildByName("timer"),c=i.getChildByName("freBtn"),u=i.getChildByName("diaBtn"),m=i.getChildByName("geted"),g=A.skills[s];if(a.text=g.name,o.skin=yt[g.id],this.limSkiTimLabs[s]=r,t.bskills[s])c.visible=u.visible=!1,m.visible=!0;else{let t=y.ShopData.Lim.Skill.timer;const i=d.formatTimer(t),a=`${this.autoAddZero(i[0])}:${this.autoAddZero(i[1])}:${this.autoAddZero(i[2])}`;r.text=a,m.visible=!1,c.visible=0==e,u.visible=0!=e,c.offAllCaller(c),this.setClick(c,()=>{h.gameSDK.faceBookAdvertisement.showRewardVideoAd(h.rewardedVideoID,()=>{L.setShopLimsSkill(s),this.initSkillNode(),as.Tips(y.Tips[17])})},c),u.offAllCaller(u),this.setClick(u,()=>{let t=y.ShopData.Lim.Skill.price;k.diamond>=t?(k.updateItem([[p.Diamond,-t]]),L.setShopLimsSkill(s),this.initSkillNode(),as.Tips(y.Tips[17])):as.Tips(y.Tips[13])},u)}}}initGoodNode(){let t=L.shopLims.good;if(!t)return;const e=this.limRewNode,s=e.getChildByName("refBtn"),i=s.getChildByName("tit"),a=e.getChildByName("num");a.text=y.Shop[2]+t.adnum,i.text=t.adnum==y.ShopData.Lim.Good.adnum?y.Shop[3]:y.Shop[8],this.limRewRefBtn=s,this.limRewRefTit=i,this.limRewNumTit=a,s.offAllCaller(s),this.setClick(s,()=>{if(t.adnum<1)return;const e=()=>{t.adnum--,this.resetLimGood(),this.initGoodNode()};t.adnum!=y.ShopData.Lim.Good.adnum?h.gameSDK.faceBookAdvertisement.showRewardVideoAd(h.rewardedVideoID,()=>{e()}):e()},s);const l=e.getChildByName("items"),n=t.goods;for(let e=0;e<n.length;e++){const s=n[e][0],i=n[e][1],a=l.getChildAt(e),o=a.getChildByName("tit"),r=a.getChildByName("num"),c=a.getChildByName("freBtn"),d=a.getChildByName("diaBtn"),m=a.getChildByName("geted"),g=a.getChildByName("bg").getChildByName("bg1"),b=a.getChildByName("bg").getChildByName("bg2"),f=a.getChildByName("bg").getChildByName("icon");let S=u.items[s];const C=!!(s>=1011&&s<=1016);if(o.text=S.des,g.visible=!C,b.visible=C,C||(g.skin=`lobby/itembg/${S.quality>3?3:S.quality}.png`),f.skin=`lobby/equicon/${C?s:S.equip}.png`,r.text="x"+i,t.bgoods[s])c.visible=d.visible=!1,m.visible=!0;else{m.visible=!1,c.visible=0==e,d.visible=0!=e;const t=(t,e)=>{const s=[],i=[],a=u.items[t];i.push([t,e]),C?s.push([t,e]):s.push([a.equip,e,a.quality]),k.updateItem(i),ss.Reward(s)};c.offAllCaller(c),this.setClick(c,()=>{h.gameSDK.faceBookAdvertisement.showRewardVideoAd(h.rewardedVideoID,()=>{L.setShopLimsGood(s),this.initGoodNode(),t(s,i)})},c),d.offAllCaller(d),this.setClick(d,()=>{let e=y.ShopData.Lim.Good.price;k.diamond>=e?(k.updateItem([[p.Diamond,-e]]),L.setShopLimsGood(s),this.initGoodNode(),t(s,i)):as.Tips(y.Tips[13])},d)}}}resetLimGood(){let t=L.shopLims;const e=u.shopitems,s=[];for(let t=0;t<e.length;t++){const i=e[t];i.lim2&&s.push(i)}const i=[],a=[];for(;i.length<4;){const t=d.getRandom(s.length-1,0),e=s[t];if(i.indexOf(e.item)<0){const l=d.getRandom(s[t].max,s[t].min);s.splice(t,1),i.push(e.item),a.push(l)}}const l=[];for(let t=0;t<i.length;t++){const e=i[t];l.push([e,a[t]])}let n=y.ShopData.Lim.Good.adnum;t&&t.good&&(n=t.good.adnum),t.good={adnum:n,goods:l,bgoods:{}}}resetLimSkill(){let t=L.shopLims;const e=S.unlock,s=[];for(let t=0;t<e.length;t++){if(1026==e[t]||1023==e[t])continue;A.skills[e[t]].add==B.Once&&s.push(e[t])}let i=y.ShopData.Lim.Skill.adnum;if(t&&t.skill&&(i=t.skill.adnum),s.length<4)t.skill={adnum:i,skills:[s[0],s[0],s[0],s[0]],bskills:{}};else{const e=[];for(;e.length<4;){const t=d.getRandom(s.length-1,0),i=s[t];e.indexOf(i)<0&&(s.splice(t,1),e.push(i))}t.skill={adnum:i,skills:e.concat(),bskills:{}}}}onLongUpdate(){let t=L.shopLims;if(t){if(t.reset){const e=Date.now();if(e>=t.reset)t.skill&&(t.skill.adnum=y.ShopData.Lim.Skill.adnum),t.good&&(t.good.adnum=y.ShopData.Lim.Good.adnum),t.reset=e+1e3*y.ShopData.Lim.Timer,this.limRewRefTit&&this.limRewRefBtn&&this.limRewNumTit&&(this.limRewRefTit.text=y.Shop[3],this.limRewRefBtn.gray=!1,this.limRewNumTit.text=y.Shop[2]+t.good.adnum),this.limSkiRefTit&&this.limSkiRefBtn&&this.limSkiNumTit&&(this.limSkiRefTit.text=y.Shop[3],this.limSkiRefBtn.gray=!1,this.limSkiNumTit.text=y.Shop[2]+t.skill.adnum);else{let s=Math.floor(t.reset-e)/1e3;const i=d.formatTimer(s),a=`${this.autoAddZero(i[0])}:${this.autoAddZero(i[1])}:${this.autoAddZero(i[2])}`;t.good&&t.good.adnum<1&&this.limRewRefTit&&this.limRewRefBtn&&(this.limRewRefTit.text=a,this.limRewRefBtn.gray=!0),t.skill&&t.skill.adnum<1&&this.limSkiRefTit&&this.limSkiRefBtn&&(this.limSkiRefTit.text=a,this.limSkiRefBtn.gray=!0)}}if(t.skill&&t.skill.bskills){const e=t.skill.bskills,s=Date.now();for(const t in e){const i=e[t];if(s>=i.reset)delete e[t],this.initSkillNode();else if(this.limSkiTimLabs[i.id]){let t=Math.floor(i.reset-s)/1e3;const e=d.formatTimer(t),a=`${this.autoAddZero(e[0])}:${this.autoAddZero(e[1])}:${this.autoAddZero(e[2])}`;this.limSkiTimLabs[i.id].text=a}}}}}autoAddZero(t){return t<10?"0"+t:t+""}onUpdate(){this.timer+=Laya.timer.delta,this.timer>=1e3&&(this.timer=0,this.onLongUpdate())}onDestroy(){}}var Ss;!function(t){t.OpenPage="lobby.openpage",t.HangarPage="lobby.hangar",t.HangarItemSel="lobby.hangar.item.sel",t.EquItemSel="lobby.equ.item.sel",t.EquSynItemSel="lobby.equ.syn.item.sel",t.EquSyn="lobby.equ.syn"}(Ss||(Ss={}));let Cs=1;const Ls=Laya.SoundManager;class Ds extends Q{constructor(){super(),this.ins=null,this.timer=0,this.scene3D=null,this.camera=null,this.staBY=0,this.coinLab=null,this.diaLab=null,this.battlePage=null,this.batTog=null,this.hangarPage=null,this.hanTog=null,this.equPage=null,this.equTog=null,this.advPage=null,this.advTog=null,this.shopPage=null,this.shopTog=null,this.planes3D={};const t=Laya.stage.addChild(new Laya.Scene3D);t.zOrder=-1,this.scene3D=t;const e=t.addChild(new Laya.Camera(0,.1,1e3));e.transform.translate(this.getVec3(-1.8,2,2)),e.transform.rotate(new Laya.Vector3(-45,-45,0),!1,!1),this.camera=e,e.renderTarget=new Laya.RenderTexture(720,600,Laya.RenderTextureFormat.R16G16B16A16,Laya.RenderTextureDepthFormat.DEPTH_16),e.renderingOrder=-1,e.clearFlag=Laya.CameraClearFlags.SolidColor,e.clearColor=this.getVec4(0,0,0,0);const s=t.addChild(new Laya.DirectionLight);s.color=new Laya.Vector3(1,1,1),s.transform.worldMatrix.setForward(new Laya.Vector3(1,-1,0))}onEnable(){Ds.Lobby=this,h.gameSDK.startGame(()=>{h.gameSDK.subscribeBotAsync(),h.gameSDK.createShortcut(()=>{})}),this.ins=Ke.instance;const t=this.ins;console.log("stage -> ",Laya.stage),this.loadPrefab(_.lobby.LobbySceneBgNode).then(e=>{const s=this.open(_.lobby.LobbySceneBgNode,e);t.bgNode.addChild(s),t.norNode=s.getChildByName("norNode"),t.difNode=s.getChildByName("difNode"),r.event("lobby.addbg")}),window.__Adventure__=null,window["__continue.battle__"]=null,window["__continue.endless__"]=null,window["__endless.battle__"]=null,this.clearBattlePool(),S.initPlayer(),h.gameSDK.leaderboard.setScoreAsync(S.getCombatValue()),this.staBY=t.bottomNode.y,this.loadPrefab(_.lobby.BattlePage).then(e=>{const s=this.open(_.lobby.BattlePage,e);t.content.addChild(s),this.battlePage=s.getComponent(es),this.battlePage.tabIndex=3}),this.batTog=t.batTog.getComponent(xt),this.batTog.clickHandle=(()=>{this.battlePage&&(r.event(Ss.OpenPage,this.battlePage.tabIndex),this.clickAnim(3))}),this.hanTog=t.hanTog.getComponent(xt),this.hanTog.clickHandle=(()=>{this.hangarPage?(r.event(Ss.OpenPage,this.hangarPage.tabIndex),this.clickAnim(2)):this.loadPrefab(_.lobby.HangarPage).then(e=>{const s=this.open(_.lobby.HangarPage,e);s.visible=!1,t.content.addChild(s),this.hangarPage=s.getComponent(bs),this.hangarPage.tabIndex=2,r.event(Ss.OpenPage,this.hangarPage.tabIndex),this.clickAnim(2)});const e=m.unlockPage.indexOf("HangarPage");e>=0&&m.unlockPage.splice(e,1)}),this.advTog=t.advTog.getComponent(xt),this.advTog.clickHandle=(()=>{this.advPage?(r.event(Ss.OpenPage,this.advPage.tabIndex),this.clickAnim(4)):this.loadPrefab(_.lobby.AdventurePage).then(e=>{const s=this.open(_.lobby.AdventurePage,e);s.visible=!1,t.content.addChild(s),this.advPage=s.getComponent(Ze),this.advPage.tabIndex=4,r.event(Ss.OpenPage,this.advPage.tabIndex),this.clickAnim(4)});const e=m.unlockPage.indexOf("AdventurePage");e>=0&&m.unlockPage.splice(e,1)}),this.advTog.cantHandle=(()=>{as.Tips(y.Tips[14].replace("$","6"))}),this.equTog=t.equTog.getComponent(xt),this.equTog.clickHandle=(()=>{this.equPage?(this.loadPrefab(_.lobby.EquMainItem).then(t=>{r.event(Ss.OpenPage,this.equPage.tabIndex)}),this.clickAnim(1)):this.loadPrefab(_.lobby.EquipmentPage).then(e=>{const s=this.open(_.lobby.EquipmentPage,e);s.visible=!1,t.content.addChild(s),this.equPage=s.getComponent(us),this.equPage.tabIndex=1,this.loadPrefab(_.lobby.EquMainItem).then(t=>{r.event(Ss.OpenPage,this.equPage.tabIndex)}),this.clickAnim(1)});const e=m.unlockPage.indexOf("EquipmentPage");e>=0&&m.unlockPage.splice(e,1)}),this.equTog.cantHandle=(()=>{as.Tips(y.Tips[14].replace("$","3"))}),this.shopTog=t.shopTog.getComponent(xt),this.shopTog.clickHandle=(()=>{this.shopPage?(r.event(Ss.OpenPage,this.shopPage.tabIndex),this.clickAnim(5)):this.loadPrefab(_.lobby.ShopPage).then(e=>{const s=this.open(_.lobby.ShopPage,e);s.visible=!1,t.content.addChild(s),this.shopPage=s.getComponent(ks),this.shopPage.tabIndex=5,r.event(Ss.OpenPage,this.shopPage.tabIndex),this.clickAnim(5)});const e=m.unlockPage.indexOf("EquipmentPage");e>=0&&m.unlockPage.splice(e,1)}),this.shopTog.cantHandle=(()=>{as.Tips(y.Tips[14].replace("$","3"))});const e=t.equTog.getChildByName("lockNode");k.uchapter[4]?(this.equTog.interactable=!0,this.shopTog.interactable=!0,e&&(e.visible=!1)):(this.equTog.interactable=!1,this.shopTog.interactable=!1,e&&(e.visible=!0));const s=t.advTog.getChildByName("lockNode");k.uchapter[7]?(this.advTog.interactable=!0,s&&(s.visible=!1)):(this.advTog.interactable=!1,s&&(s.visible=!0));let i=Laya.LocalStorage.getItem("Plane.Mute");i||(i="1"),i=parseInt(i);const a=t.soundTog.getComponent(xt);a.isChecked=!!i,a.clickHandle=(t=>{const e=t?1:0,s=t?.5:0;Ls.setSoundVolume(e),Ls.setMusicVolume(s);const i=t?"1":"0";Laya.LocalStorage.setItem("Plane.Mute",i)}),a.clickHandle(!!i),this.setClick(t.coinBtn,()=>{this.openDialog(_.lobby.CommonRewardAdDialog,Ke.instance.Dialog,t=>{t.getComponent(is).setData([[p.Gold,1e4]],y.Common[21],h.CoinVideoID)})},this),this.setClick(t.diaBtn,()=>{this.openDialog(_.lobby.CommonRewardAdDialog,Ke.instance.Dialog,t=>{t.getComponent(is).setData([[p.Diamond,100]],y.Common[20],h.DiamondVideoID)})},this),r.on(Ss.HangarPage,this,this.onHangarPage),r.on("PlayerItemConfig.coin",this,this.initCoin),r.on("PlayerItemConfig.diamond",this,this.initDia),this.initCoin(),this.initDia();const n=window["__global.data__"];n&&"object"==typeof n&&this.openDialog(_.lobby.UnlockChapterDialog,Ke.instance.Dialog,t=>{t.getComponent(ls).setData(n,"chapter")}),n&&"tips"==n&&J.Tip({title:y.Common[12],desc:y.Common[16],sure:null,only:!0},t.Dialog),n&&"tips.clearance"==n&&J.Tip({title:y.Common[12],desc:y.Common[18],sure:null,only:!0},t.Dialog),ze.Register("LobbyScene.EquipmentPage",()=>{let t=!1;return m.unlockPage.indexOf("EquipmentPage")>=0&&(t=!0),t}),ze.Register("LobbyScene.AdventurePage",()=>{let t=!1;return m.unlockPage.indexOf("AdventurePage")>=0&&(t=!0),t}),ze.Register("LobbyScene.HangarPage",()=>{let t=!1;m.unlockPage.indexOf("HangarPage")>=0&&(t=!0);const e=l.getGold(m.level);return k.coin>=e&&(t=!0),t})}initCoin(){this.coinLab.text=d.formatNumber(k.coin)+" "}initDia(){this.diaLab.text=d.formatNumber(k.diamond)+" "}onDisable(){this.scene3D.destroy(!0),Laya.timer.clearAll(this),r.offAllCaller(this)}clickAnim(t){const e=this.ins,s=Laya.stage.height-e.bottomNode.height;e.bottomNode.y=s+e.bottomNode.height,Laya.Tween.to(e.bottomNode,{y:s},500,Laya.Ease.quadInOut),e.topNode.y=0-e.topNode.height,Laya.Tween.to(e.topNode,{y:0},500,Laya.Ease.quadInOut),e.topTitLab.text=y.Common[t+1],e.titleBg.visible=!(3==t),e.soundTog.visible=3==t}clearBattlePool(){for(let t=0;t<pt.length;t++){const e=pt[t];Laya.Pool.clearBySign(e)}pt.length=0}onHangarPage(t,e){const s=this.planes3D,i=q;for(const t in s){s[t].active=!1}const a=s[t];e.graphics.clear(),Cs=t;const l=t;if(a){0==a.active&&(a.active=!0);let t=new Laya.Texture(this.camera.renderTarget,Laya.Texture.DEF_UV);e.graphics.drawTexture(t)}else s[t]={},this.loadRes(V["PlaneModel"+t]).then(a=>{const n=Laya.Sprite3D.instantiate(a);n.transform.localScale=new Laya.Vector3(3.5,3.5,3.5);const o=new Ne;o.albedoIntensity=1.4,o.shininess=.25;const h=n.getChildAt(0),r=this.getRes(i[t]);if(o.albedoTexture=r,Laya.Texture2D.load("res/lg.png",Laya.Handler.create(null,function(t){o.noiseTex=t,h.meshRenderer.material=o})),this.scene3D.addChild(n),Laya.timer.frameLoop(1,this,()=>{n.transform.rotate(this.getVec3(0,.005,0))}),s[t]=n,l==Cs){let t=new Laya.Texture(this.camera.renderTarget,Laya.Texture.DEF_UV);e.graphics.drawTexture(t)}else n.active=!1})}onUpdate(){this.timer+=Laya.timer.delta,this.timer>=1e3&&(this.timer=0,this.onLongUpdate())}onLongUpdate(){let t=L.shopLims;if(t&&t.skill&&t.skill.bskills){const e=t.skill.bskills,s=Date.now();for(const t in e){s>=e[t].reset&&delete e[t]}}}}Ds.Lobby=null;class Ps extends Q{constructor(){super()}onEnable(){const t=this.owner,e=t.getChildAt(0),s=t.getChildAt(1),i=Laya.LocalStorage.getItem("test_rate");i&&(e.text=i);const a=Laya.LocalStorage.getItem("test_chap");a&&(s.text=a);(t=>{const e=t.getChildAt(0),s=Laya.LocalStorage.getItem("test_php");s&&(e.text=s)})(t.getChildAt(3));(t=>{const e=t.getChildAt(0),s=t.getChildAt(1),i=t.getChildAt(2),a=t.getChildAt(3),l=Laya.LocalStorage.getItem("test_eid");l&&(e.text=l);const n=Laya.LocalStorage.getItem("test_ehp");n&&(s.text=n);const o=Laya.LocalStorage.getItem("test_eat");o&&(i.text=o);const h=Laya.LocalStorage.getItem("test_esp");h&&(a.text=h)})(t.getChildAt(2))}onDisable(){const t=this.owner;if(!t.visible)return;const e=t.getChildAt(0),s=t.getChildAt(1),i=parseInt(e.text),a=parseInt(s.text);i&&(S.rate=i,m.endlessData.startLevel=i,Laya.LocalStorage.setItem("test_rate",i+"")),a&&(S.chapter=a,Laya.LocalStorage.setItem("test_chap",a+""));(t=>{const e=t.getChildAt(0),s=parseInt(e.text);s&&(S.hp=s,Laya.LocalStorage.setItem("test_php",s+""))})(t.getChildAt(3));(t=>{const e=t.getChildAt(0),s=t.getChildAt(1),i=t.getChildAt(2),a=t.getChildAt(3),l=(t.getChildAt(4),t.getChildAt(5),t.getChildAt(6),t.getChildAt(7),t.getChildAt(8),parseInt(e.text)),n=parseInt(s.text),o=parseInt(i.text),h=parseFloat(a.text),r=v.enemys1,c=T.enemys;if(l&&n&&o&&h){c[l]&&(c[l].shooting=h);for(const t in r){const e=r[t];for(let t=0;t<e.length;t++){const s=e[t];s.type==l&&(s.hp=n,s.att=o)}}Laya.LocalStorage.setItem("test_eid",l+""),Laya.LocalStorage.setItem("test_ehp",n+""),Laya.LocalStorage.setItem("test_eat",o+""),Laya.LocalStorage.setItem("test_esp",h+"")}})(t.getChildAt(2))}}class xs extends Q{constructor(){super(),this.closeBtn=null,this.invBtn=null,this.itemList=null,this.planeId=0}onCloseBtnClick(){const t=ee.instance;this.closeDialog(this),t.gameState==rt.PAUSE&&(t.gameState=rt.START),r.event(dt.ClosePauseDialog)}onEnable(){this.setClick(this.closeBtn,this.onCloseBtnClick,this);let t=null;this.setClick(this.invBtn,()=>{t&&this.inviteFriends(t[d.getRandom(t.length-1,0)].name)},this);const e=this.itemList;e.vScrollBarSkin="",e.renderHandler=Laya.Handler.create(this,(t,s)=>{(t=>{const i=t.getChildByName("headIma"),a=t.getChildByName("plaBtn"),l=t.getChildByName("nameLab"),n=t.getChildByName("powLab"),o=e.array[s],h=o.photo;let r=!0;if(h)if(h.indexOf("http")>-1)r=!1,i.loadImage(h);else{let t=o.photo.replace("robot","");parseInt(t)<1&&(t="1"),parseInt(t)>20&&(t="20"),i.skin=`head/${t}.png`}else i.skin="head/1.png";l.text=o.name,n.text=d.formatNumber(o.score),a.offAllCaller(a);const c=L.friended[o.playerID];a.gray=!!c,this.setClick(a,()=>{c||(r?this.inviteFriends(o.name):this.inviteFriend(o))},a)})(t)},null,!1),e.array=[],h.gameSDK.leaderboard.getRankData(s=>{const i=[],a=[],l=L.friended;for(let t=0;t<s.length;t++){const e=s[t];e.playerID!=h.gameSDK.sdkInfo.playerID&&(l[e.playerID]?a.push(e):i.push(e))}i.push.apply(i,a),e.array=i,t=i})}inviteFriends(t){const e=()=>{L.friendRoboted++,this.startFriend(t)};e()}inviteFriend(t){const e=()=>{this.startFriend(t.name),L.friended[t.playerID]=1};h.gameSDK.faceBookUpdateAsync.appointFaceBookFriendAndUpdateAsync({width:750,height:380,playerID:t.playerID,pngData:[{playImage:null,url:h.gameSDK.sdkInfo.photo||"",posX:26,posY:101,imgWidth:145,imgHeight:145},{playImage:null,url:"res/fx.png",posX:0,posY:0,imgWidth:750,imgHeight:380}],fontData:[{des:d.formatNumber(S.getCombatValue()),posX:259,posY:225,font:"italic bold 30px Microsoft YaHei",lineWidth:2,fillStyle:"#fef523",textAlign:"left",strokeStyle:"#000000"}]},e,null,e)}startFriend(t){this.planeId&&(this.onCloseBtnClick(),r.event(dt.AddPlayer,[t,this.planeId]))}onDisable(){super.onDisable()}setData(t){this.planeId=t}onUpdate(){}}class vs extends Q{constructor(){super(),this.picon=null,this.icon=null}onEnable(){const t=ee.instance,e=_t.insUI,s=this.owner;if(!t)return void s.removeSelf();const i=u.FriendPlaneId;this.picon.skin=U[i];const a=this.icon,l=()=>{Laya.Tween.clearAll(a),a.alpha=1,Laya.Tween.to(a,{alpha:.4},1e3,null,Laya.Handler.create(this,()=>{Laya.Tween.to(a,{alpha:1},1e3,null)}))};l(),Laya.timer.loop(2500,this,l),this.setClick(s,()=>{t.gameState!=rt.START||e.isEnding||(t.gameState=rt.PAUSE,e.isPausing=!0,this.openDialog(_.battleUI.FriendDialog,t.dialogNode,t=>{t.getComponent(xs).setData(i)}))},this)}onDisable(){super.onDisable()}onUpdate(){}}class Es extends Laya.Script{constructor(){super(),this.speed=.1,this.bg1=null,this.bg2=null,this.eheight=1280}onEnable(){const t=Laya.stage.height>1280?Laya.stage.height:1280;this.eheight=t;const e=t/1280;this.bg1.scaleY=e,this.bg2.scaleY=-e,this.bg1.y=1.5*t,this.bg2.y=.5*t;let i=1;if(S.chapter<1?i=s.basChapter.map:(i=s.comChapters[S.chapter-1].map,2==S.diff&&(i=s.difChapters[S.chapter-1].map)),this.speed<.15){this.bg1.skin=this.bg2.skin=`battle/bg/${i}/1.png`;const t=this.bg1.numChildren;for(let e=0;e<t;e++){const t=this.bg1.getChildAt(0),e=this.bg2.getChildAt(0);t.name==i+""?t.visible=e.visible=!0:t.visible=e.visible=!1}}this.speed>.15&&(this.bg1.skin=this.bg2.skin=`battle/bg/${i}/2.png`)}onDisable(){}onUpdate(){let t=Laya.timer.delta;const e=this.eheight;if(this.bg1&&this.bg2){this.bg1.y>=1.5*e&&(this.bg1.y=.5*-e+(this.bg1.y-1.5*e)),this.bg2.y>=1.5*e&&(this.bg2.y=.5*-e+(this.bg2.y-1.5*e));let s=t*this.speed;this.bg1.y+=s,this.bg2.y+=s}}}class ws extends Q{constructor(){super(),this.lighter1=null,this.lighter2=null}onEnable(){for(let t=1;t<3;t++){const e=this["lighter"+t];e&&(e.blendMode=Laya.BlendMode.LIGHTER)}}onDisable(){}}class Ts extends Laya.Image{constructor(){super(),this.size(128,150),this.loadPrefab(_.battleUI.PlayerSkillItem).then(t=>{const e=Laya.Pool.getItemByCreateFun(_.battleUI.PlayerSkillItem,t.create,t);this.addChild(e)})}onEnable(){}onDisable(){}loadPrefab(t){return new Promise((e,s)=>{const i=Laya.loader.getRes(t);if(i)e(i);else{let s=null;if(!X.DEBUG&&t.indexOf("prefab/battle")>-1){const i=t.split("/"),a=i[i.length-1],l=Laya.loader.getRes("prefab/battle/merge.json")[a];(s=new Laya.Prefab).json=l,e(s)}else Laya.loader.create(t,Laya.Handler.create(this,t=>{t&&e(t)}),null,Laya.Loader.PREFAB)}})}}class Bs extends Q{constructor(){super(),this.ins=null,this.lvLab=null,this.blvLab=null,this.rewList=null,this.lockList=null,this.closeBtn=null,this.animNode=null,this.bg=null}onEnable(){this.ins=ee.instance,this.setClick(this.closeBtn,this.onCloseClick,this);const t=this.ins.playerData;this.lvLab.text=y.EndlessDialog[7]+t.rate,this.bg.height=Laya.stage.height,this.bg.width=Laya.stage.width;const e=this.animNode;e.x=-720;const s=this.rewList;s.scaleY=0,Laya.timer.once(200,this,()=>{Laya.Tween.to(e,{x:0},150,Laya.Ease.circOut,Laya.Handler.create(this,()=>{Laya.Tween.to(s,{scaleY:1},150,Laya.Ease.circOut,Laya.Handler.create(this,()=>{r.event("gameover.item.light",this.owner)}))}))});const i={},a=[];let l=5*Math.floor(t.rate/10);a.push({data:u.items[p.Gold],num:d.formatNumber(t.coin*this.ins.coinRate)}),a.push({data:u.items[p.Diamond],num:d.formatNumber(l)}),i[p.Gold]=[p.Gold,t.coin*this.ins.coinRate],i[p.Diamond]=[p.Diamond,l],k.updateItem(i),t.rate>m.endlessData.bestLevel&&(m.endlessData.bestLevel=t.rate),t.score>m.endlessData.bestScore&&(m.endlessData.bestScore=t.score);let n=1;50==t.rate?n=11:t.rate>50&&(n=11+10*Math.floor((t.rate-50)/20)),m.endlessData.startLevel<n&&(m.endlessData.startLevel=n),this.blvLab.text=y.EndlessDialog[8]+m.endlessData.bestLevel,h.gameSDK.postScoreToFB(t.score),s.itemRender=Ts,s.vScrollBarSkin="",s.renderHandler=Laya.Handler.create(this,(t,e)=>{const s=t.getChildAt(0);if(!s)return;s.__light__=!0;const i=s.getChildByName("desc"),l=s.getChildByName("num"),n=s.getChildByName("icon"),o=a[e];l.visible=!(!o.num||1==o.num),i.text=o.data.name,l.text=o.num||"0",n.scale(1,1),n.skin=`lobby/equicon/${o.data.equip&&"number"==typeof o.data.equip?o.data.equip:o.data.id}.png`},null,!1),s.array=a,this.lockList.itemRender=Ts,this.lockList.vScrollBarSkin="",this.lockList.renderHandler=Laya.Handler.create(this,(t,e)=>{const s=t.getChildAt(0);if(!s)return;const i=s.getChildByName("desc"),a=s.getChildByName("num"),l=s.getChildByName("icon"),n=this.lockList.array[e],o=A.skills[n];l.scale(.8,.8),l.skin=yt[o.id],o&&(i.text=o.name),a.visible=!1},null,!1);const o=[];for(const e in t.skills)o.push(parseInt(e));this.lockList.array=o;const c={pc:S,pic:k,ppc:m,ptc:L},g={[h.fbSaveDataKey[0]]:c};h.gameSDK.saveUserData(g,()=>{}),r.event("player.endlessed")}onCloseClick(){this.closeDialog(this,()=>{}),Laya.Scene.open("LobbyScene.scene")}onDisable(){}onUpdate(){}}class As extends Q{constructor(){super(),this.skin=null,this.speed=5}onEnable(){}onUpdate(){this.skin&&(this.skin.rotation+=this.speed)}}class _s extends Q{constructor(){super(),this.ins=null,this.sucNode=null,this.failNode=null,this.levelLab=null,this.rewList=null,this.unLockNode=null,this.lockList=null,this.closeBtn=null,this.rewBtn=null,this.animNode=null,this.lightNode=null,this.bg=null}onEnable(){this.ins=ee.instance,this.bg.height=Laya.stage.height,this.bg.width=Laya.stage.width;const t=window.__Adventure__;let e=null;t&&(e=E.advDrop[t[0].adv.model][t[0].adv.model]),this.setClick(this.closeBtn,this.onCloseClick,this),this.setClick(this.rewBtn,()=>{h.gameSDK.faceBookUpdateAsync.shareGame()},this);const i=this.ins.playerData;let a=!!(i.currHP>0);this.sucNode.visible=a,this.failNode.visible=!a,this.rewBtn.visible=!1,this.closeBtn.x=360;const l=this.unLockNode.getChildByName("title");if(l.text=y.Battle[3],t)this.levelLab.parent.visible=!1,this.unLockNode.visible=!0,l.text=y.AdventurePage[6],a&&m.setAdvData(t[0].adv.model,-1);else{this.unLockNode.visible=a,this.levelLab.text="Chapter "+i.chapter+" ",1==S.diff?k.chapter[i.chapter]>1&&(this.unLockNode.visible=!1):k.dchapter[i.chapter]>1&&(this.unLockNode.visible=!1)}const n=this.animNode;n.x=-720;const o=this.rewList;o.scaleY=0,Laya.timer.once(200,this,()=>{Laya.Tween.to(n,{x:0},150,Laya.Ease.circOut,Laya.Handler.create(this,()=>{Laya.Tween.to(o,{scaleY:1},150,Laya.Ease.circOut,Laya.Handler.create(this,()=>{r.event("gameover.item.light",this.owner)}))}))}),t&&!a&&(i.reward=0);const c={},g=[];let b=0;g.push({data:u.items[p.Gold],num:d.formatNumber(i.coin*this.ins.coinRate)});let f="101";if(i.chapter<1?f=s.basChapter.drop:(f=s.comChapters[i.chapter-1].drop,2==S.diff&&(f=s.difChapters[i.chapter-1].drop)),t&&(f=E.advDrop[t[0].adv.model][t[0].adv.model].drop),!t&&a){1==S.diff?1==k.chapter[i.chapter]&&(b=30,g.push({data:u.items[p.Diamond],num:d.formatNumber(b)})):1==k.dchapter[i.chapter]&&(b=30,g.push({data:u.items[p.Diamond],num:d.formatNumber(b)}))}if(t&&2==t[0].adv.model)b=i.reward*e.mindiamond,g.push({data:u.items[p.Diamond],num:d.formatNumber(b)});else{const e=f.split?f.split("|"):[f+""];e.indexOf("101")>-1&&e.splice(e.indexOf("101"),1);const s=i.reward,a=Math.floor(s/e.length),l=s%e.length,n=e=>{let s=1;return 1011!=e&&1012!=e&&1013!=e&&1014!=e&&1015!=e&&1016!=e||(s=t?30:8),s};if(a)for(let t=0;t<e.length;t++)c[e[t]]=[parseInt(e[t]),a*n(parseInt(e[t]))];for(let t=0;t<l;t++){const t=d.getRandom(e.length-1,0);c[e[t]]?c[e[t]][1]+=n(parseInt(e[t])):c[e[t]]=[parseInt(e[t]),n(parseInt(e[t]))]}for(const t in c){const e=c[t];g.push({data:u.items[e[0]],num:e[1]})}}if(c[p.Gold]=[p.Gold,i.coin*this.ins.coinRate],b&&(c[p.Diamond]=[p.Diamond,b]),k.updateItem(c),o.itemRender=Ts,o.vScrollBarSkin="",o.renderHandler=Laya.Handler.create(this,(t,e)=>{const s=t.getChildAt(0);if(!s)return;s.__light__=!0;const i=s.getChildByName("desc"),a=s.getChildByName("num"),l=s.getChildByName("icon"),n=g[e];a.visible=!(!n.num||1==n.num),i.text=n.data.name,a.text=n.num||"0",l.scale(1,1),l.skin=`lobby/equicon/${n.data.equip&&"number"==typeof n.data.equip?n.data.equip:n.data.id}.png`},null,!1),o.array=g,this.lockList.itemRender=Ts,this.lockList.hScrollBarSkin="",this.lockList.renderHandler=Laya.Handler.create(this,(t,e)=>{const s=t.getChildAt(0);if(!s)return;const i=s.getChildByName("desc"),a=s.getChildByName("num"),l=s.getChildByName("icon"),n=this.lockList.array[e],o=A.skills[n];l.scale(.8,.8),l.skin=yt[o.id],o&&(i.text=o.name),a.visible=!1},null,!1),t){const t=[];for(const e in i.skills)t.push(parseInt(e));this.lockList.array=t}else if(a){let t=[],e=[];i.chapter<1?t=s.basChapter.unlockskill:(t=s.comChapters[i.chapter-1].unlockskill,2==S.diff&&(t=s.difChapters[i.chapter-1].unlockskill));for(let s=0;s<t.length;s++){const i=t[s],a=A.skills[i];a&&a.weight&&e.push(i)}this.lockList.array=e}else this.closeBtn.x=360;const C={pc:S,pic:k,ppc:m,ptc:L},D={[h.fbSaveDataKey[0]]:C};h.gameSDK.saveUserData(D,()=>{}),h.gameSDK.faceBookAdvertisement.hideBannerAD()}onCloseClick(){this.owner.removeSelf();const t=this.ins.playerData;let e=!!(t.currHP>0);const s=window["__global.data__"];e&&s&&"unlock"==s[0]&&(s[0]=t.chapter+1>15?1:t.chapter+1),e||(window["__global.data__"]="tips"),Laya.Scene.open("LobbyScene.scene")}onDisable(){}onUpdate(){const t=this.lightNode;t.parent.visible&&t.rotation++}}class Vs extends Q{constructor(){super(),this.ins=null,this.closeBtn=null,this.returnBtn=null,this.contBtn=null,this.currAtt=null,this.currHp=null,this.skills=null,this.titleNode=null,this.souCloBtn=null,this.souOpenBtn=null,this.vibCloBtn=null,this.vibOpenBtn=null}onEnable(){this.ins=ee.instance,this.setClick(this.closeBtn,this.onCloseClick,this),this.setClick(this.contBtn,this.onCloseClick,this),this.setClick(this.returnBtn,this.onReturnClick,this);const t=this.ins.playerData;this.currAtt.text=d.formatNumber(t.attack)+" ",this.currHp.text=d.formatNumber(t.currHP)+" ";const e=[];for(const s in t.skills)e.push(parseInt(s));this.skills.itemRender=Ts,this.skills.vScrollBarSkin="",this.skills.renderHandler=Laya.Handler.create(this,(t,s)=>{const i=t.getChildAt(0);if(!i)return;const a=i.getChildByName("desc"),l=i.getChildByName("num"),n=i.getChildByName("icon");l.visible=!1;const o=e[s],h=A.skills[o];n.scale(.8,.8),n.skin=yt[h.id],h&&(a.text=h.name)},null,!1),this.skills.array=e;const s=this.skills.parent,i=s.x;s.x=-700;const a=this.titleNode;a.scaleY=.7,Laya.timer.once(200,this,()=>{Laya.Tween.to(s,{x:i},300,Laya.Ease.circOut),Laya.Tween.to(a,{scaleY:1},500,Laya.Ease.bounceOut)});let l=Laya.LocalStorage.getItem("Plane.Mute");l||(l="1"),l=parseInt(l),this.souCloBtn.visible=!l,this.souOpenBtn.visible=!!l,this.setClick(this.souCloBtn,()=>{Laya.SoundManager.setSoundVolume(1),Laya.SoundManager.setMusicVolume(.5);Laya.LocalStorage.setItem("Plane.Mute","1"),this.souCloBtn.visible=!1,this.souOpenBtn.visible=!0},this),this.setClick(this.souOpenBtn,()=>{Laya.SoundManager.setSoundVolume(0),Laya.SoundManager.setMusicVolume(0);Laya.LocalStorage.setItem("Plane.Mute","0"),this.souCloBtn.visible=!0,this.souOpenBtn.visible=!1},this);let n=Laya.LocalStorage.getItem("Plane.Vibrate");n||(n="1"),n=parseInt(n),this.vibCloBtn.visible=!n,this.vibOpenBtn.visible=!!n,this.setClick(this.vibCloBtn,()=>{Laya.LocalStorage.setItem("Plane.Vibrate","1"),this.ins.vibrate=!0,this.vibCloBtn.visible=!1,this.vibOpenBtn.visible=!0},this),this.setClick(this.vibOpenBtn,()=>{Laya.LocalStorage.setItem("Plane.Vibrate","0"),this.ins.vibrate=!1,this.vibCloBtn.visible=!0,this.vibOpenBtn.visible=!1},this),h.gameSDK.faceBookAdvertisement.hideBannerAD()}onCloseClick(){Laya.Tween.to(this.owner,{scaleX:0,scaleY:0,alpha:0},100,null,Laya.Handler.create(this,()=>{this.ins.gameState==rt.PAUSE&&(this.ins.gameState=rt.START),this.owner.removeSelf()})),r.event(dt.ClosePauseDialog),h.gameSDK.faceBookAdvertisement.showBannerAD()}onReturnClick(){Laya.Scene.open("LobbyScene.scene")}onDisable(){r.offAllCaller(this)}}class Rs extends Q{constructor(){super(),this.light=null}onEnable(){r.on("gameover.item.light",this,t=>{if(this.owner.__light__){const e=this.owner,s=e.getChildByName("light");if(s){s.visible=!0;const i=e.localToGlobal(new Laya.Point(s.x,s.y)),a=t.globalToLocal(i);s.pos(a.x,a.y),t.addChild(s),Laya.Tween.to(s,{scaleX:1,scaleY:1},150,Laya.Ease.backOut,Laya.Handler.create(this,()=>{Laya.Tween.to(s,{alpha:0},150,null,Laya.Handler.create(this,()=>{t.addChild(s)}))}))}}})}onDisable(){r.offAllCaller(this),Laya.Tween.clearAll(this)}}class Ns extends Q{constructor(){super()}onEnable(){const t=this.owner.getChildByName("coin");t.blendMode=Laya.BlendMode.LIGHTER,t.on(Laya.Event.STOPPED,this,()=>{this.owner.removeSelf()}),t.templet?(t.playbackRate(.4),t.play(0,!1)):Laya.timer.once(300,this,()=>{this.owner.removeSelf()})}onDisable(){const t=this.owner.getChildByName("coin");t.offAllCaller(this),t.stop(),Laya.timer.clearAll(this),this.recover(this.owner)}}class Is extends Q{constructor(){super()}onEnable(){const t=this.owner;t.alpha=1,Laya.Tween.to(t,{alpha:0},300,null,Laya.Handler.create(this,()=>{t.removeSelf()}))}onDisable(){Laya.Tween.clearAll(this.owner),this.recover(this.owner)}}class Ms extends Q{constructor(){super()}onEnable(){const t=this.owner;t.alpha=1,Laya.timer.once(300,this,()=>{Laya.Tween.to(t,{alpha:0},100,null,Laya.Handler.create(this,()=>{this.owner.removeSelf()}))})}onDisable(){Laya.timer.clearAll(this),this.recover(this.owner)}}class Hs extends Q{constructor(){super()}onEnable(){const t=this.owner.getChildByName("coin");t.on(Laya.Event.STOPPED,this,()=>{this.owner.removeSelf()}),t.templet?t.play(0,!1):Laya.timer.once(320,this,()=>{this.owner.removeSelf()})}onDisable(){const t=this.owner.getChildByName("coin");t.offAllCaller(this),t.stop(),Laya.timer.clearAll(this),this.recover(this.owner)}}class Os extends Q{constructor(){super(),this.ins=null,this.skin=null,this.speed=5}onEnable(){this.ins=ee.instance}onUpdate(){this.ins.gameState==rt.START&&this.skin&&(this.skin.rotation+=this.speed)}}class qs extends Q{constructor(){super(),this.line=null}onEnable(){const t=this.line;if(!t)return;t.alpha=0;const e=()=>{Laya.Tween.to(t,{alpha:1},250,Laya.Ease.circOut,Laya.Handler.create(this,()=>{Laya.Tween.to(t,{alpha:0},250,Laya.Ease.circIn)}))};e(),this.schedule(500,e,this,3)}onDisable(){}}class Us extends Q{constructor(){super(),this.ins=null,this.enemyCom=null,this.ecolCom=null,this.eskillCom=null,this.currSkill=null,this.hited=!1,this.inited=!1,this.isend=!1,this.ske=null,this.skill2001Pre=null,this.currAtt=0,this.currBsp=0,this.skill2001Pre=this.getRes(_.battle.EnemySkill2001)}onEnable(){if(this.ins=ee.instance,this.enemyCom=this.owner.getComponent(Gt),this.eskillCom=this.owner.getComponent(Ft),this.ecolCom=this.owner.getComponent(Zt),!this.enemyCom||!this.enemyCom.edata)return;const t=this.enemyCom.edata;this.ecolCom.invincible=!0,this.hited=!1,this.inited=!1,this.isend=!1;const e=t.att.split("|"),s=t.bulletsp.split("|");r.on(dt.EnemyHit,this,(i,a,l)=>{if(a==this.enemyCom.eid&&i==t.type){if(this.ske){let t=0;1001==l&&(t=1),1002==l&&(t=0),1003==l&&(t=2),this.ske.play(t,!1)}this.hited=!0,this.currSkill=l,this.currAtt=parseFloat(e[l-1001]),this.currBsp=parseFloat(s[l-1001])}}),r.on(dt.EnemyEnd,this,()=>{this.isend=!0,this.ske&&this.ske.templet&&this.ske.play(3,!1)})}onDisable(){r.offAllCaller(this),this.ske&&(this.ske.offAllCaller(this),this.ske.stop())}parseComplete(){const t=this.ske;t.on(Laya.Event.LABEL,this,this.onEvent),t.on(Laya.Event.STOPPED,this,this.completeHandler),t&&t.templet&&(t.play(3,!1),t.paused()),t.filters=[new Laya.ColorFilter],this.enemyCom.ske=t,this.isend&&r.event(dt.EnemyEnd)}completeHandler(){this.ecolCom&&this.ecolCom.invincible&&(this.ecolCom.invincible=!1),this.eskillCom&&!this.eskillCom.inited&&this.eskillCom.initSkill(),this.ske.play(4,!0)}onEvent(t){this.ins.gameState==rt.START&&this.hited&&("b2"==t.stringValue?this.skill1001():"b1"==t.stringValue?this.skill1002():"b3"==t.stringValue&&this.skill1003())}skill1001(){const t=this.owner,e=(this.enemyCom.edata,[-60,-40,-20,0,20,40,60]),s=ft[2001].b1,i=i=>{for(let a=0;a<e.length;a++){const l=this.open(_.battle.EnemySkill1,this.eskillCom.skill1Pre);let n=l.getComponent(Ut);n||(n=l.addComponent(Ut)),n.setData(this.currAtt,0,0,0,0);const o=l.getComponent(It);o.norV3=this.getVec3(0,1),o.speed=this.currBsp,o.state=rt.START,l.pos(t.x+s[i].x+e[a],t.y+s[i].y),this.ins.eneBulNode.addChild(l)}};for(let t=0;t<2;t++)i(t),this.schedule(100,()=>{i(t)},this,3)}skill1002(){const t=this.owner,e=(this.enemyCom.edata,ft[2001].b2),s=[this.getVec3(-.64,.77),this.getVec3(-.34,.94),this.getVec3(0,1),this.getVec3(.34,.94),this.getVec3(.64,.77)],i=i=>{for(let a=0;a<s.length;a++)for(let a=0;a<s.length;a++){const l=this.open(_.battle.EnemySkill2001,this.skill2001Pre);l.scale(.6,.6);let n=l.getComponent(Ut);n||(n=l.addComponent(Ut)),n.setData(this.currAtt,0,0,0,0);const o=l.getComponent(It);o.speed=this.currBsp,o.norV3=s[a].clone(),o.state=rt.START,l.pos(t.x+e[i].x,t.y+e[i].y),this.ins.eneBulNode.addChild(l)}};for(let t=0;t<2;t++)i(t),this.schedule(100,()=>{i(t)},this,5)}skill1003(){const t=this.owner,e=(this.enemyCom.edata,[-60,-30,0,30,60]),s=[0,0,0,0,0],i=ft[2001].b3,a=this.getVec2(t.x,t.y),l=t=>{for(let l=0;l<e.length;l++){const n=this.open(_.battle.EnemySkill2001,this.skill2001Pre);n.scale(.6,.6);let o=n.getComponent(Ut);o||(o=n.addComponent(Ut)),o.setData(this.currAtt,0,0,0,0);const h=n.getComponent(It);h.speed=this.currBsp,h.norV3=this.getVec3(0,1),h.state=rt.START,n.pos(a.x+i[t].x+e[l],a.y+i[t].y+s[l]),this.ins.eneBulNode.addChild(n)}};for(let t=0;t<2;t++)l(t),this.schedule(100,()=>{l(t)},this,5)}onUpdate(){const t=this.ske;!this.inited&&t&&t.templet&&(this.inited=!0,this.parseComplete())}}class Fs extends Q{constructor(){super(),this.ins=null,this.enemyCom=null,this.ecolCom=null,this.eskillCom=null,this.currSkill=null,this.currAtt=0,this.currBsp=0,this.bulPre=null,this.fbulPre=null,this.rotBulPre=null,this.cirBulPre=null,this.ske=null,this.hited=!1,this.inited=!1,this.isend=!1}onEnable(){if(this.bulPre=this.getRes(_.battle.EnemySkill1),this.fbulPre=this.getRes(_.battle.EnemySkill5),this.rotBulPre=this.getRes(_.battle.EnemySkill11),this.cirBulPre=this.getRes(_.battle.EnemySkill1011),this.ins=ee.instance,this.enemyCom=this.owner.getComponent(Gt),this.eskillCom=this.owner.getComponent(Ft),this.ecolCom=this.owner.getComponent(Zt),!this.enemyCom||!this.enemyCom.edata)return;const t=this.enemyCom.edata;this.ecolCom.invincible=!0,this.hited=!1,this.inited=!1,this.isend=!1;const e=t.att.split("|"),s=t.bulletsp.split("|");r.on(dt.EnemyHit,this,(i,a,l)=>{if(a==this.enemyCom.eid&&i==t.type){if(this.ske){let t=0;1011==l&&(t=1),1012==l&&(t=0),1013==l&&(t=2),this.ske.play(t,!1)}this.hited=!0,this.currSkill=l,this.currAtt=parseFloat(e[l-1011]),this.currBsp=parseFloat(s[l-1011])}}),r.on(dt.EnemyEnd,this,()=>{this.isend=!0,this.ske&&this.ske.templet&&this.ske.play(3,!1)})}onDisable(){r.offAllCaller(this),this.ske&&(this.ske.offAllCaller(this),this.ske.stop())}parseComplete(){const t=this.ske;t.on(Laya.Event.LABEL,this,this.onEvent),t.on(Laya.Event.STOPPED,this,this.completeHandler),t&&t.templet&&(t.play(3,!1),t.paused()),t.filters=[new Laya.ColorFilter],this.enemyCom.ske=t,this.isend&&r.event(dt.EnemyEnd)}completeHandler(){this.ecolCom&&this.ecolCom.invincible&&(this.ecolCom.invincible=!1),this.eskillCom&&!this.eskillCom.inited&&this.eskillCom.initSkill(),this.ske.play(4,!0)}onEvent(t){this.ins.gameState==rt.START&&this.hited&&("b2"==t.stringValue?this.skill1011():"b1"==t.stringValue?this.skill1012():"b3"==t.stringValue&&this.skill1013())}skill1011(){const t=this.owner,e=ft[2002].b1,s=[.5*Math.PI,-30/180*Math.PI,-150/180*Math.PI],i=[this.getVec3(1,0),this.getVec3(.5,-.87),this.getVec3(-.5,-.87)];for(let a=0;a<2;a++){const l=this.open(_.battle.EnemySkill11,this.rotBulPre);l.pos(t.x+e[a].x,t.y+e[a].y),this.ins.eneBulNode.addChild(l),Laya.Tween.to(l,{y:l.y+200},200,Laya.Ease.circOut,Laya.Handler.create(this,()=>{Laya.timer.once(450,this.ins,()=>{for(let t=0;t<s.length;t++){const e=s[t],a=l.x+100*Math.cos(e),n=l.y-100*Math.sin(e),o=i[t];this.schedule(100,()=>{const t=this.open(_.battle.EnemySkill1011,this.cirBulPre);t.pos(l.x,l.y),this.ins.eneBulNode.addChild(t),Laya.Tween.to(t,{x:a,y:n},100,Laya.Ease.circOut,Laya.Handler.create(this,()=>{for(let e=0;e<2;e++){const s=e?this.getVec3(-o.x,-o.y):o.clone(),i=this.open(_.battle.EnemySkill1,this.bulPre);let a=i.getComponent(Ut);a||(a=i.addComponent(Ut)),a.setData(this.currAtt,0,0,0,0);const l=i.getComponent(It);l.norV3=s,l.state=rt.START,l.speed=this.currBsp,i.pos(t.x,t.y),this.ins.eneBulNode.addChild(i)}t.removeSelf()}))},this.ins,12,null,!0,()=>{l.removeSelf()})}})}))}}skill1012(){const t=this.owner,e=ft[2002].b2,s=[this.getVec3(0,1),this.getVec3(.34,.94),this.getVec3(.64,.77),this.getVec3(.87,.5),this.getVec3(.98,.17),this.getVec3(.98,-.17),this.getVec3(.87,-.5),this.getVec3(.64,-.77),this.getVec3(.34,-.94),this.getVec3(0,-1),this.getVec3(-.34,-.94),this.getVec3(-.64,-.77)];for(let i=0;i<2;i++){const a=this.open(_.battle.EnemySkill11,this.rotBulPre);a.pos(t.x+e[i].x,t.y+e[i].y),this.ins.eneBulNode.addChild(a),Laya.Tween.to(a,{y:a.y+200},200,Laya.Ease.circOut,Laya.Handler.create(this,()=>{Laya.timer.once(450,this.ins,()=>{let t=0;this.schedule(100,()=>{const e=s[t],i=a.x+150*e.x,l=a.y+150*e.y,n=this.open(_.battle.EnemySkill1,this.bulPre);let o=n.getComponent(Ut);o||(o=n.addComponent(Ut)),o.setData(this.currAtt,0,0,0,0);const h=n.getComponent(It);h.norV3=this.getVec3(-e.x,-e.y),h.state=rt.READY,h.speed=this.currBsp,n.pos(a.x,a.y),this.ins.eneBulNode.addChild(n),Laya.Tween.to(n,{x:i,y:l},500,Laya.Ease.circOut,Laya.Handler.create(this,()=>{Laya.timer.once(1e3-80*t,this.ins,()=>{h.state=rt.START})})),t++},this.ins,s.length,null,!0,()=>{a.removeSelf()})})}))}}skill1013(){const t=this.owner,e=ft[2002].b3,s=[[this.getVec3(.09,1),this.getVec3(0,1),this.getVec3(-.09,1)],[this.getVec3(.22,.98),this.getVec3(.13,.99),this.getVec3(.04,1),this.getVec3(-.04,1),this.getVec3(-.13,.99),this.getVec3(-.22,.98)],[this.getVec3(.34,.94),this.getVec3(.26,.97),this.getVec3(.17,.98),this.getVec3(.09,1),this.getVec3(0,1),this.getVec3(-.09,1),this.getVec3(-.17,.98),this.getVec3(-.26,.97),this.getVec3(-.34,.94)]];let i=0;this.schedule(100,()=>{const a=s[i];for(let s=0;s<a.length;s++){const i=a[s],l=this.open(_.battle.EnemySkill5,this.fbulPre);let n=l.getComponent(Ut);n||(n=l.addComponent(Ut)),n.setData(this.currAtt,0,0,0,0);const o=l.getComponent(It);o.norV3=i,o.state=rt.START,o.speed=this.currBsp,l.pos(t.x+e[0].x,t.y+e[0].y),this.ins.eneBulNode.addChild(l)}i++},this,3)}onUpdate(){const t=this.ske;!this.inited&&t&&t.templet&&(this.inited=!0,this.parseComplete())}}class js extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this._norV3=null,this.state=rt.READY,this.lastPos=null,this.addRadius=0,this.centerPos=null,this.radius=100,this.angle=0,this.speed=.4,this.add=1,this.s3d=null}get norV3(){return this._norV3}set norV3(t){this._norV3=t;const e=this.owner;e&&(e.rotation=-(180-Math.atan2(t.x,-t.y)/Math.PI*180))}onEnable(){this.ins=ee.instance,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.state=rt.START;const t=this.ins,e=this.owner;this.lastPos=this.getVec3(e.x,e.y);const s=new Laya.Sprite3D,i=this.getRes(V.E_DaoDan),a=Laya.Sprite3D.instantiate(i);s.addChild(a),t.modSceneV3.getChildByName("trails").addChild(s);let l=this.getVec3();t.modCameraV3.convertScreenCoordToOrthographicCoord(this.getVec3(e.x,e.y),l),s.transform.position=l,this.s3d=s,this.addRadius=0,Laya.Tween.to(this,{addRadius:2},3e3,Laya.Ease.quartIn)}onDisable(){this.s3d&&Laya.timer.once(200,this,()=>{this.s3d.removeSelf(),this.recover(this.owner)}),r.offAllCaller(this)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onUpdate(){if(this.ins.gameState!=rt.START)return;if(this.state!=rt.START)return;if(!this.centerPos)return;this.ins;const t=this.owner;Laya.timer.delta,this.speed;let e=this.ins.ratio3D;this.angle+=1*this.add,this.radius+=this.addRadius;const s=this.angle/180*Math.PI;t.x=this.centerPos.x+this.radius*Math.cos(s)*.8,t.y=this.centerPos.y-this.radius*Math.sin(s);const i=this.getVec3();Laya.Vector3.subtract(this.getVec3(t.x,t.y),this.lastPos,i);const a=Math.atan2(i.x,-i.y)/Math.PI*180+180;t.rotation=a,this.lastPos=this.getVec3(t.x,t.y),this.s3d&&this.s3d.transform&&this.s3d.transform.translate(this.getVec3(i.x/e,0,i.y/e)),(t.x<=-360||t.x>=1080||t.y<=-640||t.y>=1920)&&this.owner.removeSelf(),this.quadTree.check(this.ins.playerCols,this.selfCol)}}class Gs extends Q{constructor(){super(),this.ins=null,this.enemyCom=null,this.ecolCom=null,this.eskillCom=null,this.currSkill=null,this.currAtt=0,this.currBsp=0,this.bulPre=null,this.mbulPre=null,this.cbulPre=null,this.rotBulPre=null,this.cirBulPre=null,this.ske=null,this.hited=!1,this.inited=!1,this.isend=!1}onEnable(){if(this.bulPre=this.getRes(_.battle.EnemySkill1),this.mbulPre=this.getRes(_.battle.EnemySkill1022),this.cbulPre=this.getRes(_.battle.EnemySkill2001),this.rotBulPre=this.getRes(_.battle.EnemySkill11),this.cirBulPre=this.getRes(_.battle.EnemySkill1011),this.ins=ee.instance,this.enemyCom=this.owner.getComponent(Gt),this.ecolCom=this.owner.getComponent(Zt),!this.enemyCom||!this.enemyCom.edata)return;this.eskillCom=this.owner.getComponent(Ft);const t=this.enemyCom.edata;this.ecolCom.invincible=!0,this.hited=!1,this.inited=!1,this.isend=!1;const e=t.att.split("|"),s=t.bulletsp.split("|");r.on(dt.EnemyHit,this,(i,a,l)=>{if(a==this.enemyCom.eid&&i==t.type){if(this.ske){let t=0;1021==l&&(t=0),1022==l&&(t=1),1023==l&&(t=1),this.ske.play(t,!1)}this.hited=!0,this.currSkill=l,this.currAtt=parseFloat(e[l-1021]),this.currBsp=parseFloat(s[l-1021])}}),r.on(dt.EnemyEnd,this,()=>{this.isend=!0,this.ske&&this.ske.templet&&this.ske.play(3,!1)})}onDisable(){r.offAllCaller(this),this.ske&&(this.ske.offAllCaller(this),this.ske.stop())}onUpdate(){const t=this.ske;!this.inited&&t&&t.templet&&(this.inited=!0,this.parseComplete())}parseComplete(){const t=this.ske;t.on(Laya.Event.LABEL,this,this.onEvent),t.on(Laya.Event.STOPPED,this,this.completeHandler),t&&t.templet&&(t.play(3,!1),t.paused()),t.filters=[new Laya.ColorFilter],this.enemyCom.ske=t,this.isend&&r.event(dt.EnemyEnd)}completeHandler(){this.ecolCom&&this.ecolCom.invincible&&(this.ecolCom.invincible=!1),this.eskillCom&&!this.eskillCom.inited&&this.eskillCom.initSkill(),this.ske.play(4,!0)}onEvent(t){this.ins.gameState==rt.START&&this.hited&&(1021==this.currSkill?this.skill1021():1022==this.currSkill?this.skill1022():1023==this.currSkill&&this.skill1023())}skill1021(){const t=this.owner,e=ft[2003].b1,s=[this.getVec3(.71,-.71),this.getVec3(-.71,-.71),this.getVec3(-.71,-.71),this.getVec3(.71,-.71)],i=[this.getVec3(-.71,-.71),this.getVec3(.71,-.71),this.getVec3(-.71,.71),this.getVec3(.71,.71)],a=[50,200];for(let l=0;l<i.length;l++)for(let n=0;n<a.length;n++){const o=this.open(_.battle.EnemySkill1011,this.cirBulPre),h=t.x+e[l].x,r=t.y+e[l].y;o.pos(h,r),this.ins.eneBulNode.addChild(o);const c=h+a[n]*i[l].x,d=r+a[n]*i[l].y,p=s[l];Laya.Tween.to(o,{x:c,y:d},200*a[n]/50,Laya.Ease.circOut,Laya.Handler.create(this,()=>{Laya.timer.once(500,this,()=>{this.schedule(1e3,()=>{for(let t=0;t<2;t++){const e=t?this.getVec3(-p.x,-p.y):p.clone(),s=this.open(_.battle.EnemySkill1,this.bulPre);let i=s.getComponent(Ut);i||(i=s.addComponent(Ut)),i.setData(this.currAtt,0,0,0,0);const a=s.getComponent(It);a.norV3=e,a.state=rt.START,a.speed=this.currBsp,s.pos(o.x,o.y),this.ins.player2Node.addChild(s)}},this,3,null,!0,()=>{o.removeSelf()})})}))}}skill1022(){const t=this.owner,e=(ft[2003].b2,[this.getVec3(-.71,-.71),this.getVec3(.71,-.71),this.getVec3(-.71,.71),this.getVec3(.71,.71)]),s=[45,135,-45,-135],i=[this.getVec3(-250,-23),this.getVec3(250,-23),this.getVec3(-250,-23),this.getVec3(250,-23)],a=a=>{if(!this.getRes(V.E_DaoDan))return void Y.load3D([V.E_DaoDan]);"number"!=typeof a&&(a=a[0]);const l=this.open(_.battle.EnemySkill1022,this.mbulPre);let n=l.getComponent(Ut);n||(n=l.addComponent(Ut)),n.setData(this.currAtt,0,0,0,0);const o=l.getComponent(js);o.norV3=e[a].clone(),o.centerPos=this.getVec3(t.x+i[a].x,t.y+i[a].y),o.radius=180,o.angle=s[a],o.speed=this.currBsp,o.add=0==a||3==a?1:-1;const h=o.angle/180*Math.PI,r=o.centerPos.x+o.radius*Math.cos(h)*.8,c=o.centerPos.y-o.radius*Math.sin(h);l.pos(r,c),this.ins.eneBulNode.addChild(l)};for(let t=0;t<e.length;t++)a(t),this.schedule(1e3,a,this,3,[t],!0)}skill1023(){const t=this.owner,e=ft[2003].b3,s=[this.getVec3(-.71,-.71),this.getVec3(.71,-.71),this.getVec3(-.71,.71),this.getVec3(.71,.71)],i=[this.getVec3(1,0),this.getVec3(.87,-.5),this.getVec3(.5,-.87),this.getVec3(0,-1),this.getVec3(-.5,-.87),this.getVec3(-.87,-.5),this.getVec3(-1,0),this.getVec3(-.87,.5),this.getVec3(-.5,.87),this.getVec3(0,1),this.getVec3(.5,.87),this.getVec3(.87,.5)];for(let a=0;a<s.length;a++){const l=this.open(_.battle.EnemySkill11,this.rotBulPre),n=t.x+e[a].x,o=t.y+e[a].y;l.pos(n,o),this.ins.eneBulNode.addChild(l);const h=n+50*s[a].x,r=o+50*s[a].y;Laya.Tween.to(l,{x:h,y:r},200,Laya.Ease.circOut,Laya.Handler.create(this,()=>{Laya.timer.once(450,this.ins,()=>{for(let t=0;t<i.length;t++){const e=this.open(_.battle.EnemySkill2001,this.cbulPre);e.scale(.6,.6);let s=e.getComponent(Ut);s||(s=e.addComponent(Ut)),s.setData(this.currAtt,0,0,0,0);let a=e.getComponent(It);a.speed=this.currBsp,a.norV3=i[t].clone(),a.state=rt.START,e.pos(l.x,l.y),this.ins.eneBulNode.addChild(e)}l.removeSelf()})}))}}}class Ws extends Q{constructor(){super(),this.ins=null,this.enemyCom=null,this.ecolCom=null,this.eskillCom=null,this.currSkill=null,this.currAtt=0,this.currBsp=0,this.bulletPre1=null,this.bulletPre2=null,this.bulletPre3=null,this.ske=null,this.hited=!1,this.inited=!1,this.isend=!1,this.currAnimIndex=-1}onEnable(){if(this.bulletPre1=this.getRes(_.battle.EnemySkill2001),this.bulletPre2=this.getRes(_.battle.EnemySkill9),this.bulletPre3=this.getRes(_.battle.EnemySkill5),this.ins=ee.instance,this.enemyCom=this.owner.getComponent(Gt),this.ecolCom=this.owner.getComponent(Zt),!this.enemyCom||!this.enemyCom.edata)return;this.eskillCom=this.owner.getComponent(Ft);const t=this.enemyCom.edata;this.ecolCom.invincible=!0,this.hited=!1,this.inited=!1,this.isend=!1,this.currAnimIndex=-1;const e=t.att.split("|"),s=t.bulletsp.split("|");r.on(dt.EnemyHit,this,(i,a,l)=>{if(a==this.enemyCom.eid&&i==t.type){if(this.ske){let t=0;1031==l&&(t=0),1032==l&&(t=1),1033==l&&(t=2),this.currAnimIndex=t}this.hited=!0,this.currSkill=l,this.currAtt=parseFloat(e[l-1031]),this.currBsp=parseFloat(s[l-1031])}}),r.on(dt.EnemyEnd,this,()=>{this.isend=!0,this.ske&&this.ske.templet&&this.ske.play(3,!1)})}onDisable(){r.offAllCaller(this),this.ske&&(this.ske.offAllCaller(this),this.ske.stop())}onUpdate(){const t=this.ske;!this.inited&&t&&t.templet&&(this.inited=!0,this.parseComplete())}parseComplete(){const t=this.ske;t.on(Laya.Event.LABEL,this,this.onEvent),t.on(Laya.Event.STOPPED,this,this.completeHandler),t&&t.templet&&(t.play(3,!1),t.paused()),t.filters=[new Laya.ColorFilter],this.enemyCom.ske=t,this.isend&&r.event(dt.EnemyEnd)}completeHandler(){this.ecolCom&&this.ecolCom.invincible&&(this.ecolCom.invincible=!1),this.eskillCom&&!this.eskillCom.inited&&this.eskillCom.initSkill(),this.currAnimIndex>-1?(this.ske.play(this.currAnimIndex,!1),this.currAnimIndex=-1):this.ske.play(4,!1)}onEvent(t){this.ins.gameState==rt.START&&this.hited&&(1031==this.currSkill?this.skill1031():1032==this.currSkill?this.skill1032():1033==this.currSkill&&this.skill1033())}skill1031(){const t=this.owner,e=[300,285],s=[110,105,100,95,90,85,80,75,70];let i=0;this.schedule(200,()=>{if(!(i>1)){for(let a=0;a<s.length;a++){const l=s[a]/180*Math.PI,n=this.open(_.battle.EnemySkill2001,this.bulletPre1);n.scale(.6,.6);let o=n.getComponent(Ut);o||(o=n.addComponent(Ut)),o.setData(this.currAtt,0,0,0,0);const h=n.getComponent(It);h.norV3=this.getVec3(),h.state=rt.READY,h.speed=this.currBsp;const r=t.x,c=t.y+20;n.pos(r,c),this.ins.player2Node.addChild(n),Laya.Tween.to(n,{x:r+e[i]*Math.cos(l),y:c+e[i]*Math.sin(l)},600,Laya.Ease.expoOut,Laya.Handler.create(this,()=>{let t=400-200*i;t<0&&(t=0),Laya.timer.once(t,this,()=>{const t=this.ins.playerV2;let e=this.getVec3();Laya.Vector3.subtract(this.getVec3(t.x,t.y),this.getVec3(n.x,n.y),e),Laya.Vector3.normalize(e,h.norV3),h.state=rt.START})}))}i++}},this,2)}skill1032(){const t=this.owner,e=[this.getVec3(.866,-.5),this.getVec3(.5,-.866),this.getVec3(-.866,-.5),this.getVec3(-.5,-.866),this.getVec3(.866,.5),this.getVec3(.5,.866),this.getVec3(-.866,.5),this.getVec3(-.5,.866)],s=this.open(_.battle.EnemySkill9,this.bulletPre2),i=t.x,a=t.y+118;s.pos(i,a),this.ins.eneBulNode.addChild(s),Laya.Tween.to(s,{y:a+300},1e3,Laya.Ease.expoOut,Laya.Handler.create(this,()=>{Laya.timer.once(500,this,()=>{this.schedule(500,()=>{for(let t=0;t<e.length;t++){const i=e[t];for(let t=0;t<4;t++){const e=t%2?3:1,a=this.getVec3(-i.y,i.x);t>1&&(a.x*=-1,a.y*=-1);const l=this.open(_.battle.EnemySkill2001,this.bulletPre1);l.scale(.6,.6);let n=l.getComponent(Ut);n||(n=l.addComponent(Ut)),n.setData(this.currAtt,0,0,0,0);const o=l.getComponent(It);o.norV3=i,o.state=rt.READY,o.speed=this.currBsp;const h=s.x+20*i.x+8*a.x*e,r=s.y+20*i.y+8*a.y*e;l.pos(h,r),this.ins.player2Node.addChild(l),Laya.Tween.to(l,{x:h+150*i.x,y:r+150*i.y},500,Laya.Ease.expoOut,Laya.Handler.create(this,()=>{Laya.timer.once(50,this,()=>{o.state=rt.START})}))}}},this,6,null,!0,()=>{s.removeSelf()})})}))}skill1033(){const t=this.owner,e=ft[2004].b3,s=[200,180],i=[this.getVec3(.1736,.985),this.getVec3(.5,.866),this.getVec3(.766,.6428),this.getVec3(-.1736,.985),this.getVec3(-.5,.866),this.getVec3(-.766,.6428)];for(let a=0;a<e.length;a++){const l=e[a];this.schedule(500,()=>{for(let e=0;e<i.length;e++){const n=i[e],o=this.open(_.battle.EnemySkill5,this.bulletPre3);let h=o.getComponent(Ut);h||(h=o.addComponent(Ut)),h.setData(this.currAtt,0,0,0,0);const r=o.getComponent(It);r.norV3=n,r.state=rt.READY,r.speed=this.currBsp;const c=t.x+l.x,d=t.y+l.y;o.pos(c,d),this.ins.player2Node.addChild(o),Laya.Tween.to(o,{x:c+s[a]*n.x,y:d+s[a]*n.y},500,Laya.Ease.expoOut,Laya.Handler.create(this,()=>{Laya.timer.once(50,this,()=>{r.state=rt.START})}))}},this,2)}}}class Ks extends Q{constructor(){super(),this.ins=null,this.enemyCom=null,this.ecolCom=null,this.eskillCom=null,this.currSkill=null,this.currAtt=0,this.currBsp=0,this.bulletPre1=null,this.bulletPre2=null,this.bulletPre3=null,this.ske=null,this.hited=!1,this.inited=!1,this.isend=!1,this.currAnimIndex=-1}onEnable(){if(this.bulletPre1=this.getRes(_.battle.EnemySkill3),this.bulletPre2=this.getRes(_.battle.EnemySkill9),this.bulletPre3=this.getRes(_.battle.EnemySkill2001),this.ins=ee.instance,this.enemyCom=this.owner.getComponent(Gt),this.ecolCom=this.owner.getComponent(Zt),!this.enemyCom||!this.enemyCom.edata)return;this.eskillCom=this.owner.getComponent(Ft);const t=this.enemyCom.edata;this.ecolCom.invincible=!0,this.hited=!1,this.inited=!1,this.isend=!1,this.currAnimIndex=-1;const e=t.att.split("|"),s=t.bulletsp.split("|");r.on(dt.EnemyHit,this,(i,a,l)=>{if(a==this.enemyCom.eid&&i==t.type){if(this.ske){let t=0;1041==l&&(t=0),1042==l&&(t=1),1043==l&&(t=2),this.currAnimIndex=t}this.hited=!0,this.currSkill=l,this.currAtt=parseFloat(e[l-1041]),this.currBsp=parseFloat(s[l-1041])}}),r.on(dt.EnemyEnd,this,()=>{this.isend=!0,this.ske&&this.ske.templet&&this.ske.play(3,!1)})}onDisable(){r.offAllCaller(this),this.ske&&(this.ske.offAllCaller(this),this.ske.stop())}onUpdate(){const t=this.ske;!this.inited&&t&&t.templet&&(this.inited=!0,this.parseComplete())}parseComplete(){const t=this.ske;t.on(Laya.Event.LABEL,this,this.onEvent),t.on(Laya.Event.STOPPED,this,this.completeHandler),t&&t.templet&&(t.play(3,!1),t.paused()),t.filters=[new Laya.ColorFilter],this.enemyCom.ske=t,this.isend&&r.event(dt.EnemyEnd)}completeHandler(){this.ecolCom&&this.ecolCom.invincible&&(this.ecolCom.invincible=!1),this.eskillCom&&!this.eskillCom.inited&&this.eskillCom.initSkill(),this.currAnimIndex>-1?(this.ske.play(this.currAnimIndex,!1),this.currAnimIndex=-1):this.ske.play(4,!1)}onEvent(t){this.ins.gameState==rt.START&&this.hited&&(1041==this.currSkill?this.skill1041():1042==this.currSkill?this.skill1042():1043==this.currSkill&&this.skill1043())}skill1041(){const t=this.owner,e=ft[2005].b1,s=[210,-30],i=[this.getVec3(-.866,.5),this.getVec3(.866,.5)],a=[1,3,5,1,3,5],l=[1200,1050,900];let n=0;this.schedule(400,()=>{if(!(n>2)){for(let o=0;o<e.length;o++){const h=e[o],r=i[o];for(let e=0;e<6;e++){if(!this.getRes(V.E_DaoDan))return void Y.load3D([V.E_DaoDan]);const i=a[e],c=this.getVec3(-r.y,r.x);e>2&&(c.x*=-1,c.y*=-1);const d=this.open(_.battle.EnemySkill3,this.bulletPre1);let p=d.getComponent(Ut);p||(p=d.addComponent(Ut)),p.setData(this.currAtt,0,0,0,0);const u=d.getComponent(Ot);u.aspeed=.5,u.norV3=this.getVec3(0,-1),u.angle=s[o],u.xv=s[o]>0?-1:1,u.tar=this.getVec2(360,l[n]),u.speed=this.currBsp;const y=t.x+h.x+15*c.x*i,m=t.y+h.y+15*c.y*i;d.pos(y,m),this.ins.eneBulNode.addChild(d)}}n++}},this,3)}skill1042(){const t=this.owner,e=ft[2005].b2,s=[[this.getVec3(0,1),this.getVec3(.1736,.9848)],[this.getVec3(.0872,.9962),this.getVec3(.2588,.9659)],[this.getVec3(.1736,.9848),this.getVec3(.342,.9397)]];let i=0;this.schedule(300,()=>{if(!(i>2)){for(let a=0;a<e.length;a++){const l=e[a],n=a?-1:1;for(let e=0;e<2;e++){const a=s[i][e];if(!this.getRes(V.E_DaoDan))return void Y.load3D([V.E_DaoDan]);const o=this.open(_.battle.EnemySkill3,this.bulletPre1);let h=o.getComponent(Ut);h||(h=o.addComponent(Ut)),h.setData(this.currAtt,0,0,0,0);const r=o.getComponent(Ot);r.aspeed=1,r.angle=0,r.xv=1,r.tar=null,r.norV3=this.getVec3(a.x*n,a.y),r.speed=this.currBsp;const c=t.x+l.x+15,d=t.y+l.y+15;o.pos(c,d),this.ins.eneBulNode.addChild(o)}}i++}},this,3)}skill1043(){const t=this.owner,e=ft[2005].b3,s=[this.getVec3(.9511,-.309),this.getVec3(.5878,.809),this.getVec3(-.5878,.809),this.getVec3(-.9511,-.309),this.getVec3(0,-1)],i=this.getVec3(-.342,.9397);for(let a=0;a<e.length;a++){const l=a?-1:1,n=e[a],o=this.open(_.battle.EnemySkill9,this.bulletPre2),h=t.x+n.x,r=t.y+n.y;o.pos(h,r),this.ins.eneBulNode.addChild(o),Laya.Tween.to(o,{x:h+300*i.x*l,y:r+300*i.y},1e3,Laya.Ease.expoOut,Laya.Handler.create(this,()=>{Laya.timer.once(500,this,()=>{this.schedule(100,()=>{for(let t=0;t<s.length;t++){const e=s[t],i=this.open(_.battle.EnemySkill2001,this.bulletPre3);i.scale(.6,.6);let a=i.getComponent(Ut);a||(a=i.addComponent(Ut)),a.setData(this.currAtt,0,0,0,0);const l=i.getComponent(It);l.norV3=e,l.state=rt.START,l.speed=this.currBsp;const n=o.x+10*e.x,h=o.y+10*e.y;i.pos(n,h),this.ins.player2Node.addChild(i)}},this,20,null,!0,()=>{o.removeSelf()})})}))}}}class Ys extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this.animNode=null,this.target=null,this.devX=0,this.devY=0}onEnable(){this.ins=ee.instance,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280}));const t=this.animNode;Laya.Tween.clearAll(t),t&&Laya.timer.loop(300,this,()=>{t&&Laya.Tween.to(t,{scaleX:1.5},150,null,Laya.Handler.create(this,()=>{t&&Laya.Tween.to(t,{scaleX:1},150,null)}))})}onDisable(){super.onDisable(),this.clearBids(),this.recover(this.owner)}clearBids(){this.selfCol.bids.length=0,r.event(dt.EnemyLaserHide,this.selfCol)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){if(this.ins.gameState!=rt.START)return;const t=this.owner,e=this.target;e&&e.parent?(t.x=e.x+this.devX,t.y=e.y+this.devY,this.quadTree.check(this.ins.playerCols,this.selfCol)):t.removeSelf()}}class zs extends Q{constructor(){super(),this.ins=null,this.enemyCom=null,this.ecolCom=null,this.eskillCom=null,this.currSkill=null,this.currAtt=0,this.currBsp=0,this.bulletPre1=null,this.bulletPre2=null,this.bulletPre3=null,this.ske=null,this.lines=null,this.hited=!1,this.inited=!1,this.isend=!1,this.currAnimIndex=-1,this.lasers=[]}onEnable(){if(this.bulletPre1=this.getRes(_.battle.EnemySkill2001),this.bulletPre2=this.getRes(_.battle.EnemySkill9),this.bulletPre3=this.getRes(_.battle.EnemyLaser),this.ins=ee.instance,this.enemyCom=this.owner.getComponent(Gt),this.ecolCom=this.owner.getComponent(Zt),!this.enemyCom||!this.enemyCom.edata)return;this.eskillCom=this.owner.getComponent(Ft);const t=this.enemyCom.edata;this.ecolCom.invincible=!0,this.hited=!1,this.inited=!1,this.isend=!1,this.currAnimIndex=-1;const e=t.att.split("|"),s=t.bulletsp.split("|");this.clearLasers(),r.on(dt.EnemyHit,this,(i,a,l)=>{if(a==this.enemyCom.eid&&i==t.type){if(this.ske){let t=0;1051==l&&(t=0),1052==l&&(t=1),1053==l&&(t=2),this.currAnimIndex=t}this.hited=!0,this.currSkill=l,this.currAtt=parseFloat(e[l-1051]),this.currBsp=parseFloat(s[l-1051])}}),r.on(dt.EnemyEnd,this,()=>{this.isend=!0,this.ske&&this.ske.templet&&this.ske.play(3,!1)})}clearLasers(){this.lines.visible=!1;for(let t=0;t<this.lasers.length;t++)this.lasers[t].removeSelf();this.lasers.length=0}onDisable(){this.clearLasers(),r.offAllCaller(this),this.ske&&(this.ske.offAllCaller(this),this.ske.stop())}onUpdate(){const t=this.ske;!this.inited&&t&&t.templet&&(this.inited=!0,this.parseComplete())}parseComplete(){const t=this.ske;t.on(Laya.Event.LABEL,this,this.onEvent),t.on(Laya.Event.STOPPED,this,this.completeHandler),t&&t.templet&&(t.play(3,!1),t.paused()),t.filters=[new Laya.ColorFilter],this.enemyCom.ske=t,this.isend&&r.event(dt.EnemyEnd)}completeHandler(){this.ecolCom&&this.ecolCom.invincible&&(this.ecolCom.invincible=!1),this.eskillCom&&!this.eskillCom.inited&&this.eskillCom.initSkill(),this.currAnimIndex>-1?(this.ske.play(this.currAnimIndex,!1),this.currAnimIndex=-1):this.ske.play(4,!1)}onEvent(t){this.ins.gameState==rt.START&&this.hited&&(1051==this.currSkill?this.skill1051():1052==this.currSkill?this.skill1052():1053==this.currSkill&&this.skill1053())}skill1051(){const t=this.owner,e=[[this.getVec3(-.866,.5),this.getVec3(-.7071,.7071),this.getVec3(-.5,.866),this.getVec3(-.2588,.9659),this.getVec3(.866,.5),this.getVec3(.7071,.7071),this.getVec3(.5,.866),this.getVec3(.2588,.9659),this.getVec3(0,1)],[this.getVec3(-.7071,.7071),this.getVec3(-.5,.866),this.getVec3(-.2588,.9659),this.getVec3(.7071,.7071),this.getVec3(.5,.866),this.getVec3(.2588,.9659),this.getVec3(0,1)],[this.getVec3(-.5,.866),this.getVec3(-.2588,.9659),this.getVec3(.5,.866),this.getVec3(.2588,.9659),this.getVec3(0,1)],[this.getVec3(-.2588,.9659),this.getVec3(.2588,.9659),this.getVec3(0,1)],[this.getVec3(0,1)]];let s=0;this.schedule(100,()=>{if(s>4)return;const i=e[s];for(let e=0;e<i.length;e++){const s=i[e],a=this.open(_.battle.EnemySkill2001,this.bulletPre1);a.scale(1,1);let l=a.getComponent(Ut);l||(l=a.addComponent(Ut)),l.setData(this.currAtt,0,0,0,0);const n=a.getComponent(It);n.norV3=s,n.state=rt.START,n.speed=this.currBsp;const o=t.x,h=t.y+156;a.pos(o,h),this.ins.eneBulNode.addChild(a)}s++},this,5)}skill1052(){const t=this.owner,e=[this.getVec3(0,1),this.getVec3(.6428,.766),this.getVec3(.9848,.1736),this.getVec3(.866,-.5),this.getVec3(.342,-.9397),this.getVec3(-.6428,.766),this.getVec3(-.9848,.1736),this.getVec3(-.866,-.5),this.getVec3(-.342,-.9397)],s=[this.getVec3(1,0),this.getVec3(-1,0),this.getVec3(.5,.866),this.getVec3(-.5,.866),this.getVec3(.5,-.866),this.getVec3(-.5,-.866)],i=[0,30,60,90,120,30,60,90,120],a=[1,1,1,1,1,-1,-1,-1,-1],l=this.open(_.battle.EnemySkill9,this.bulletPre2);l.scale(1,1);const n=t.y+156;l.pos(t.x,n),this.ins.eneBulNode.addChild(l),Laya.Tween.to(l,{y:n+150},1e3,Laya.Ease.expoOut,Laya.Handler.create(this,()=>{for(let t=0;t<e.length;t++){const n=e[t],o=this.open(_.battle.EnemySkill9,this.bulletPre2),h=l.x,r=l.y;o.pos(h,r),this.ins.eneBulNode.addChild(o),Laya.Tween.to(o,{x:h+150*n.x,y:r+150*n.y},1e3,Laya.Ease.expoOut,Laya.Handler.create(this,()=>{Laya.timer.once(500,this,()=>{for(let e=0;e<s.length;e++){const l=s[e],n=this.open(_.battle.EnemySkill2001,this.bulletPre1);n.scale(1,1);let h=n.getComponent(Ut);h||(h=n.addComponent(Ut)),h.setData(this.currAtt,0,0,0,0);const r=n.getComponent(It),c=i[t]/180*Math.PI;let d=l.x*Math.cos(c)+l.y*Math.sin(c),p=l.y*Math.cos(c)-l.x*Math.sin(c);d*=a[t],r.norV3=this.getVec3(d,p),r.state=rt.START,r.speed=.5*this.currBsp,n.pos(o.x,o.y),this.ins.eneBulNode.addChild(n)}o.removeSelf()})}))}l.removeSelf()}))}skill1053(){this.clearLasers(),Laya.timer.clear(this,this.clearLasers);const t=this.owner,e=ft[2006].b3;this.lines.visible=!0,Laya.timer.once(1e3,this,()=>{this.lines.visible=!1;for(let s=0;s<e.length;s++){const i=e[s],a=this.open(_.battle.EnemyLaser,this.bulletPre3),l=a.getComponent(Ys);l.target=this.owner,l.devX=i.x,l.devY=i.y,a.pos(t.x+i.x,t.y+i.y),this.ins.eneBulNode.addChild(a),this.lasers.push(a)}Laya.timer.once(3e3,this,this.clearLasers)})}}class Xs extends Q{constructor(){super()}onEnable(){const t=this.owner;t.color=t.__color__?"#ff0300":"#ffffff";const e=t.__color__?1.2:1;t.scale(0,0),t.alpha=1;let s=Math.floor(21*Math.random()+10),i=Math.floor(16*Math.random()+45),a=Math.floor(16*Math.random()+5),l=Math.floor(6*Math.random()+15);Laya.Tween.to(t,{x:t.x+s,y:t.y-i,scaleX:e,scaleY:e},300,Laya.Ease.quintOut,Laya.Handler.create(this,()=>{Laya.timer.once(100,this,()=>{Laya.Tween.to(t,{x:t.x-a,y:t.y-l,alpha:0},100,null,Laya.Handler.create(this,()=>{t.removeSelf()}))})}))}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this),this.recover(this.owner)}onUpdate(){}}class $s extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this.timer=0}onEnable(){this.ins=ee.instance,this.timer=0,this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280}))}onDisable(){r.offAllCaller(this),this.recover(this.owner)}onCollisionEnter(t,e){this.owner.removeSelf()}onCollisionExit(t,e){}onLateUpdate(){this.ins.gameState==rt.START&&(this.quadTree.check(this.ins.playerCols,this.selfCol),this.timer+=Laya.timer.delta,this.timer>=2e3&&this.owner.removeSelf())}}class Zs extends Q{constructor(){super(),this.ins=null,this.left=null,this.right=null,this.vec=0,this.tar=null,this.im=null,this.point=null}onEnable(){this.ins=ee.instance;const t=this.owner,e=A.skills[ut.LaserRobot],s=e.robotbullet||5;e.fspeed;this.left.alpha=0,this.right.alpha=0;const i=[this.right,this.left],a=this.ins;Laya.timer.loop(1e3*s,this,()=>{if(a.gameState!=rt.START)return;const e=i[this.vec],s=e.getChildByName("point");if(e){let a=this.ins.getMinEnemy(t),l=this.vec?90:-90,n=730;if(a&&a.parent){let s=t.x+(e.x-25)-a.x,i=t.y-a.y;n=Math.sqrt(s*s+i*i),l=Math.atan2(s,-i)/Math.PI*180;const o=a.getComponent(Zt);o.onCollisionEnter(this,o,!0)}e.height=n,e.rotation=l,s.y=n/730*713,Laya.Tween.to(e,{alpha:1},100,null,Laya.Handler.create(this,()=>{if(a&&a.parent){const t=a.getComponent(Zt);t.onCollisionEnter(this,t,!0)}})),Laya.timer.once(200,this,()=>{Laya.Tween.to(e,{alpha:0},100)}),this.tar=a,this.im=e,this.point=s,this.vec++,this.vec>=i.length&&(this.vec=0)}})}onDisable(){Laya.timer.clearAll(this),Laya.Tween.clearAll(this),r.offAllCaller(this),this.recover(this.owner)}onLateUpdate(){if(this.ins.gameState==rt.START&&this.im&&this.point){const t=this.owner;let e=1500,s=this.vec?90:-90,i=this.tar;if(i&&i.parent){let a=t.x+(this.im.x-25)-i.x,l=t.y-i.y;e=Math.sqrt(a*a+l*l),s=Math.atan2(a,-l)/Math.PI*180}this.im.height=e,this.im.rotation=s,this.point.y=e/730*713}}}class Qs extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this.inited=!1,this.ske=null}onEnable(){this.ins=ee.instance;const t=this.owner;this.inited=!1;this.ins;this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.ske&&(this.ske.blendMode=Laya.BlendMode.LIGHTER),this.ske.on(Laya.Event.STOPPED,this,()=>{this.quadTree.check(this.ins.enemyCols,this.selfCol),t.removeSelf()})}parseComplete(){this.ske&&this.ske.templet&&this.ske.play(0,!1)}onDisable(){this.selfCol.bids=[],r.event(dt.LaserHide,this.selfCol),r.offAllCaller(this),Laya.timer.clearAll(this),this.ske&&(this.ske.offAllCaller(this),this.ske.stop()),this.recover(this.owner)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onUpdate(){const t=this.ske;!this.inited&&t&&t.templet&&(this.inited=!0,this.parseComplete())}}class Js extends Q{constructor(){super(),this.ins=null,this.selfCol=null,this.quadTree=null,this.boomSke=null}onEnable(){this.ins=ee.instance;const t=this.owner;this.ins;this.selfCol=this.owner.getComponent(kt),this.quadTree||(this.quadTree=new Nt({x:0,y:0,width:720,height:1280})),this.boomSke&&(this.boomSke.blendMode=Laya.BlendMode.LIGHTER),Laya.timer.once(265,this,()=>{this.quadTree.check(this.ins.enemyCols,this.selfCol),t.removeSelf()})}onDisable(){this.selfCol.bids=[],r.event(dt.LaserHide,this.selfCol),r.offAllCaller(this),Laya.timer.clearAll(this)}onCollisionEnter(t,e){}onCollisionExit(t,e){}onLateUpdate(){}}class ti extends Q{constructor(){super(),this.mainBrid=null,this.bulBg=null}onEnable(){const t=this.mainBrid,e=this.bulBg;t.alpha=0,t.scale(0,0),t.pos(192,430),e.scaleY=-.7,Laya.Tween.to(e,{scaleY:-1},50,null,Laya.Handler.create(this,()=>{Laya.Tween.to(e,{scaleY:-1.5},400),Laya.Tween.to(t,{scaleX:1,scaleY:1,alpha:1},100,null,Laya.Handler.create(this,()=>{Laya.Tween.to(t,{y:125},400,null,Laya.Handler.create(this,()=>{Laya.Tween.to(t,{alpha:0},100)}))}))}))}onDisable(){Laya.Tween.clearAll(this)}}class ei extends Q{constructor(){super(),this.closeBtn=null,this.conPan=null,this.daiList=null,this.achList=null,this.achData2=null}initDaiList(){const t=L.dailys,e=[],s=[];for(const i in t){const a=t[i],l=C.dailyTasks[i];a.num>=l.num?e.push(parseInt(i)):s.push(parseInt(i))}e.push.apply(e,s),this.daiList.array=e}onEnable(){this.setClick(this.closeBtn,()=>{this.closeDialog(this)},this),this.conPan.vScrollBarSkin="",this.daiList.vScrollBarSkin="",this.daiList.renderHandler=Laya.Handler.create(this,(t,e)=>{(t=>{this.setData(t,this.daiList.array[e])})(t)},null,!1);const t=this.daiList.parent.parent.parent;this.daiList.scrollBar.on(Laya.Event.START,this,()=>{t&&t.vScrollBar.stopScroll()}),this.initDaiList();const e=C.achievements,s={};for(const t in e){const i=e[t];s[i.type]||(s[i.type]=[]),s[i.type].push(i)}this.achData2=s,this.achList.renderHandler=Laya.Handler.create(this,(t,e)=>{(t=>{this.setData2(t,this.achList.array[e])})(t)},null,!1),this.initAchList()}initAchList(){const t=[],e=[],s=this.achData2;for(const i in s){const a=s[i];let l=L.getAchieve(i);const n=a[l.index-1]?a[l.index-1]:a[a.length-1];l.num>=n.num?t.push(n):e.push(n)}t.push.apply(t,e),this.achList.array=t}onDisable(){}setData(t,e){const s=t.getChildByName("item"),i=s.getChildByName("icon"),a=s.getChildByName("num"),l=t.getChildByName("title"),n=t.getChildByName("valLab"),o=t.getChildByName("valBar"),h=t.getChildByName("recBtn"),r=t.getChildByName("recNode"),c=C.dailyTasks[e];let p=L.dailys[e];i.skin=`lobby/equicon/${c.rewardtype+"01"}.png`,a.text=d.formatNumber(c.reward),l.text=c.des,n.text=p.num+"/"+c.num,o.value=p.num/c.num,p.num>=c.num?p.recd?(h.visible=!1,r.visible=!0):(h.visible=!0,r.visible=!1):h.visible=r.visible=!1,h.offAllCaller(h),this.setClick(h,()=>{L.dailys[e].recd=!0,L.dailys[21].num++,k.updateItem({1:[100*c.rewardtype+1,c.reward]}),ss.Reward([[100*c.rewardtype+1,c.reward]]),this.initDaiList()},h)}setData2(t,e){const s=t.getChildByName("item"),i=s.getChildByName("icon"),a=s.getChildByName("num"),l=t.getChildByName("title"),n=t.getChildByName("valLab"),o=t.getChildByName("valBar"),h=t.getChildByName("recBtn"),r=t.getChildByName("recNode"),c=L.getAchieve(e.type);i.skin=`lobby/equicon/${e.rewardtype+"01"}.png`,a.text=d.formatNumber(e.reward),l.text=e.des,n.text=c.num+"/"+e.num,o.value=c.num/e.num,c.num>=e.num?c.index>e.index?(h.visible=!1,r.visible=!0):(h.visible=!0,r.visible=!1):h.visible=r.visible=!1,h.offAllCaller(h),this.setClick(h,()=>{L.setAchieve(e.type,1),k.updateItem({1:[100*e.rewardtype+1,e.reward]}),ss.Reward([[100*e.rewardtype+1,e.reward]]),this.initAchList()},h)}}class si extends Q{constructor(){super(),this.closeBtn=null,this.daiList=null}initDaiList(){const t=L.dailys,e=[],s=[];for(const i in t){const a=t[i],l=C.dailyTasks[i];a.num>=l.num?e.push(parseInt(i)):s.push(parseInt(i))}e.push.apply(e,s),this.daiList.array=e}onEnable(){this.setClick(this.closeBtn,()=>{this.closeDialog(this)},this),this.daiList.renderHandler=Laya.Handler.create(this,(t,e)=>{(t=>{this.setData(t,this.daiList.array[e])})(t)},null,!1),this.initDaiList()}onDisable(){}setData(t,e){const s=t.getChildByName("item"),i=s.getChildByName("icon"),a=s.getChildByName("num"),l=t.getChildByName("title"),n=t.getChildByName("valLab"),o=t.getChildByName("valBar"),h=t.getChildByName("recBtn"),r=t.getChildByName("recNode"),c=C.dailyTasks[e];let p=L.dailys[e];i.skin=`lobby/equicon/${c.rewardtype+"01"}.png`,a.text=d.formatNumber(c.reward),l.text=c.des,n.text=p.num+"/"+c.num,o.value=p.num/c.num,p.num>=c.num?p.recd?(h.visible=!1,r.visible=!0):(h.visible=!0,r.visible=!1):h.visible=r.visible=!1,h.offAllCaller(h),this.setClick(h,()=>{L.dailys[e].recd=!0,L.dailys[21].num++,k.updateItem({1:[100*c.rewardtype+1,c.reward]}),ss.Reward([[100*c.rewardtype+1,c.reward]]),this.initDaiList()},h)}}class ii extends Q{constructor(){super(),this.closeBtn=null,this.playBtn=null,this.conBtn=null,this.bsLab=null,this.blLab=null,this.lvLab=null}onEnable(){this.setClick(this.closeBtn,()=>{this.closeDialog(this)},this);const t=m.endlessData;this.bsLab.text=d.formatNumber(t.bestScore||0),this.blLab.text=(t.bestLevel||1)+"",this.lvLab.text="LV."+(t.startLevel||1),this.conBtn.visible=!!t.lastData,t.lastData&&(this.lvLab.text="LV."+(t.lastData.rate||1));let e=!1;this.setClick(this.playBtn,()=>{if(e)return;e=!0;const s=()=>{const e=d.getRandom(15,1),s=d.getRandom(2,1);this.loadBatPre(e,s,1).then(()=>{t.lastData=null,window["__endless.battle__"]=[e,s,1],Laya.Scene.open("BattleScene.scene")})};t.lastData?J.Tip({title:y.Common[12],desc:y.Common[22],sure:s,close:()=>{e=!1}},Ke.instance.Dialog):s()},this),this.setClick(this.conBtn,()=>{if(e||!t)return;e=!0;const s=t.lastEnemy[0],i=t.lastEnemy[1],a=t.lastEnemy[2];this.loadBatPre(s,i,a).then(()=>{window["__endless.battle__"]=[s,i,a],window["__continue.endless__"]=!0,Laya.Scene.open("BattleScene.scene")})},this)}onDisable(){}loadBatPre(t,e,s){const i=[],a=_.battle;for(const t in a){const e=a[t];i.push(e)}const l=[];l.push(V.PlaneTrackModel),l.push(V.Coin),l.push(I[S.id]),3==S.id&&l.indexOf(V.DaoDan)<0&&l.push(V.DaoDan),4==S.id&&l.indexOf(V.Main4)<0&&l.push(V.Main4);let n=null;if(k.uchapter[3]&&S.chapter>0){const t=[1,2,3,4,5,6],e=S.id;t.splice(t.indexOf(e),1),n=t[d.getRandom(4,0)],u.FriendPlaneId=n,l.push(I[n]),3==n&&l.indexOf(V.DaoDan)<0&&l.push(V.DaoDan),4==n&&l.indexOf(V.Main4)<0&&l.push(V.Main4)}return new Promise((a,o)=>{let h=0,r=0;l.length&&r++,i.length&&r++,Y.load3D(l).then(()=>{console.log("load model complete..."),++h==r&&a()}),Laya.loader.create("prefab/battle/merge.json",Laya.Handler.create(this,()=>{console.log("load prefab complete..."),Y.loadPlayerPre(S.id),n&&Y.loadPlayerPre(n);const i=v.assets2[t+""+e];i&&Y.loadEnemyPre(i[s]),++h==r&&a()}),Laya.Handler.create(this,t=>{}))})}}class ai extends Q{constructor(){super(),this.closeBtn=null,this.nameLab=null,this.itemIma=null,this.lvBox=null,this.att1Box=null,this.att2Box=null,this.nattLab=null}onEnable(){this.setClick(this.closeBtn,()=>{this.closeDialog(this)},this)}setData(t,e){const s=e[0],l=t[0],n=i.equs[s],o=i.equs[l];this.nameLab.text=n.name,this.itemIma.getComponent(os).initItem(e);const h=this.lvBox.getChildByName("old"),r=this.lvBox.getChildByName("new");h.text="string"==typeof o.maxlv?o.maxlv.split("|")[t[1]-1]:o.maxlv+"",r.text="string"==typeof n.maxlv?n.maxlv.split("|")[e[1]-1]:n.maxlv+"";const c=a.getAtts(l,t[1],t[2]),d=a.getAtts(s,e[1],e[2]);this.att1Box.getChildAt(0).text=y.EquNewAttDialog[3]+" "+y.EquSuitDialog[d[0][0]+1];const p=this.att1Box.getChildByName("old"),u=this.att1Box.getChildByName("new");p.text=c[0][1]+"",u.text=d[0][1]+"",this.att2Box.getChildAt(0).text=y.EquNewAttDialog[3]+" "+y.EquSuitDialog[d[1][0]+1];const m=this.att2Box.getChildByName("old"),g=this.att2Box.getChildByName("new");m.text=(c[1]?c[1][1]:0)+"",g.text=d[1][1]+"";const b=e[3][e[3].length-1],f=i.equadds[b[0]].name.replace("s",b[1]);this.nattLab.text=y.EquNewAttDialog[5]+" "+f}onDisable(){r.offAllCaller(this)}}class li extends Q{constructor(){super(),this.maskNode=null,this.closeBtn=null,this.bgNode=null,this.conBox=null,this.attBox=null,this.thuBox=null}onEnable(){this.setClick(this.closeBtn,this.onCloseClick,this);const t=k.equips,e=i.equs,s={},l={};for(const i in t){const n=t[i];if(n){const t=a.getAtts(n[0],n[1],n[2]);for(let e=0;e<t.length;e++){const i=t[e];s[i[0]]||(s[i[0]]=[]),s[i[0]].push(i)}const i=e[n[0]];l[i.suit]?l[i.suit]++:l[i.suit]=1}}const n=this.attBox;for(let t=0;t<n.numChildren;t++){n.getChildAt(t).visible=!1}const o=[[53,0],[403,0],[53,100],[403,100],[53,200],[403,200]];let h=0;for(const t in s){const e=s[t],i=n.getChildAt(parseInt(t)-1);i.visible=!0,i.pos(o[0][0],o[0][1]),h=o[0][1],o.shift();const a=i.getChildByName("num");let l=0;for(let t=0;t<e.length;t++){l+=e[t][1]}a.text=d.formatNumber(l)}this.thuBox.y=h+100;const r=this.thuBox;for(let t=1;t<r.numChildren;t++){r.getChildAt(t).visible=!1}let c=0;for(const t in l){let e=l[t];for(let s=0;s<Math.floor(e/2);s++){let e=2*s+2;if(a.thunders[t]&&a.thunders[t][e]){c++;const s=r.getChildAt(c);s.visible=!0;const i=s.getChildAt(0),l=a.thunders[t][e][0];i.text=`(${e}) ${y.EquThunder2[t]}\n${y.EquThunder1[l]}`}}}r.visible=!!c;const p=h+100+50+62*c;this.bgNode.height=p+160}onCloseClick(){Laya.Tween.to(this.owner,{scaleX:0,scaleY:0,alpha:0},100,null,Laya.Handler.create(this,()=>{this.owner.removeSelf()}))}onDisable(){}}class ni extends Q{constructor(){super(),this.closeBtn=null,this.synBtn=null,this.choBtn=null,this.topNode=null,this.itemList=null,this.sels=[],this.heqs=[]}iniWithData(){const t=k.hequips,e=[];for(const s in t){const i=t[s];i[1]<7&&e.push([i,s])}const s=i.equs;e.sort((t,e)=>{let i=t[0],a=e[0],l=i[0],n=a[0],o=i[1],h=a[1],r=s[l].type,c=s[n].type,d=s[l].suit,p=s[n].suit,u=i[2]||1;return 1e5*h+1e4*c+1e3*p+(a[2]||1)-(1e5*o+1e4*r+1e3*d+u)}),this.sels=[],this.heqs=e,this.itemList.array=e,this.initList(-1,-1)}initList(t,e){const s=this.sels,i=this.heqs;r.event(Ss.EquSynItemSel,[s,t,e]);for(let t=0;t<3;t++){const e=this.topNode.getChildAt(t).getChildAt(0);if(null!=s[t]){e.visible=!0,e.getComponent(os).initItem(i[s[t]][0])}else e.visible=!1}}onEnable(){this.setClick(this.closeBtn,()=>{this.closeDialog(this)},this);const t=this.topNode;for(let e=0;e<3;e++){const s=t.getChildAt(e).getChildAt(0);s&&(s.visible=!1,this.setClick(s,()=>{const t=this.sels[e];if(null==t)return;this.sels.indexOf(t)>-1&&this.sels.splice(this.sels.indexOf(t),1);let s=this.sels.length?this.heqs[this.sels[0]][0][1]:-1,i=-1;this.sels.length&&(i=this.heqs[this.sels[0]][0][0]),this.initList(s,i)},this,null,!0))}const e=t=>{if(this.sels.indexOf(t)>-1)this.sels.splice(this.sels.indexOf(t),1);else{if(this.sels.length>=3)return;this.sels.push(t)}let e=this.sels.length?this.heqs[this.sels[0]][0][1]:-1,s=-1;this.sels.length&&(s=this.heqs[this.sels[0]][0][0]),this.initList(e,s)};this.itemList.vScrollBarSkin="",this.itemList.renderHandler=Laya.Handler.create(this,(t,s)=>{const i=t=>{const i=t.getComponent(os);i.touHandle=e,i.types="EquSymDialog",i.initItem(this.heqs[s][0],s)},a=t.getChildAt(0);a?i(a):this.loadPrefab(_.lobby.EquMainItem).then(e=>{const s=this.open(_.lobby.EquMainItem,e);s.pos(53,53),i(s),t.addChild(s)})},null,!1),this.setClick(this.synBtn,()=>{const t=this.sels;if(this.sels.length<3)return void as.Tips(y.Tips[7]);const e=this.heqs;let s,a;for(let i=0;i<t.length;i++){const l=e[t[i]][0][2];(!s||s<l)&&(s=l,a=i)}for(let s=0;s<t.length;s++){const l=e[t[s]][1];if(s!=a)delete k.hequips[l];else{const a=e[t[s]][0][0],n=k.hequips[l].concat();if(a>2e3)k.hequips[l][1]++;else{const t=1e3*d.getRandom(4,2)+a-1e3;k.hequips[l][0]=t,k.hequips[l][1]++}const o=k.hequips[l],h=o[0],r=o[1],c=o[3];let p=i.equs[h].addnum.split("|")[r-1];for(let t=0;t<parseInt(p);t++){let e,s,a;if(c[t]){const l=c[t][0],n=c[t][1],o=i.equadds[l];e=n,s=parseFloat(o.maxv.split("|")[r]),a=l}else{a=d.getRandom(1007,1001);const t=i.equadds[a];s=parseFloat(t.maxv.split("|")[r]),e=parseFloat(t.minv.split("|")[r])}c[t]=[],c[t][0]=a,c[t][1]=this.getAddV(s,e)}this.openDialog(_.lobby.EquNewAttDialog,Ke.instance.Dialog,t=>{t.getComponent(ai).setData(n,k.hequips[l])},!1,!0)}}this.iniWithData(),r.event(Ss.EquSyn),as.Tips(y.Tips[8]),r.event("player.getEqu")},this),this.setClick(this.choBtn,()=>{const t=this.heqs;let e=null;if(this.sels&&this.sels.length){const s=this.sels[0],i=t[s][0],a=i[0],l=i[1];let n=[s];for(let s=0;s<t.length;s++){const i=t[s][0];if(i[0]==a&&i[1]==l&&n.indexOf(s)<0&&(n.push(s),n.length>=3)){e=n;break}}}else for(let s=0;s<t.length;s++){const i=t[s][0],a=i[0],l=i[1];let n=[s];for(let s=0;s<t.length;s++){const i=t[s][0];if(i[0]==a&&i[1]==l&&n.indexOf(s)<0&&(n.push(s),n.length>=3)){e=n;break}}if(n.length>=3)break}if(e){this.sels=e;let s=t[e[0]][0][1],i=t[e[0]][0][0];this.initList(s,i)}else as.Tips(y.Tips[9])},this),this.iniWithData()}getAddV(t,e){const s=[];let i=e;for(;i<=t;)s.push(i),i+=.5;return s[d.getRandom(s.length-1,0)]}onDisable(){}}class oi extends Q{constructor(){super(),this.closeBtn=null,this.invBtn=null,this.itemList=null}onEnable(){this.owner.getChildByName("bg1").size(Laya.stage.width,Laya.stage.height),this.setClick(this.closeBtn,()=>{this.closeDialog(this)},this),this.setClick(this.invBtn,()=>{h.gameSDK.faceBookUpdateAsync.sendFaceBookFriend({width:750,height:380,pngData:[{playImage:null,url:h.gameSDK.sdkInfo.photo||"",posX:26,posY:101,imgWidth:145,imgHeight:145},{playImage:null,url:"res/fx.png",posX:0,posY:0,imgWidth:750,imgHeight:380}],fontData:[{des:d.formatNumber(S.getCombatValue()),posX:259,posY:225,font:"italic bold 30px Microsoft YaHei",lineWidth:2,fillStyle:"#fef523",textAlign:"left",strokeStyle:"#000000"}]},()=>{},()=>{},()=>{})},this),this.itemList.vScrollBarSkin="",this.itemList.renderHandler=Laya.Handler.create(this,(t,e)=>{const s=t=>{const s=t.getChildByName("indIma"),i=t.getChildByName("headIma"),a=t.getChildByName("indLab"),l=t.getChildByName("nameLab"),n=t.getChildByName("powLab"),o=this.itemList.array[e],r=!!(e<=2);t.skin=o.playerID==h.gameSDK.sdkInfo.playerID?"lobby/rank/li_r_h.png":"lobby/rank/li_r.png";const c=o.photo;if(c)if(c.indexOf("http")>-1)i.loadImage(c);else{let t=o.photo.replace("robot","");parseInt(t)<=0&&(t="1"),parseInt(t)>=21&&(t="20"),i.skin=`head/${t}.png`}else i.skin="head/1.png";s.visible=r,a.visible=!r,r?s.skin=`lobby/rank/num_${e+1}.png`:a.text=e+1+"",l.text=o.name,n.text=d.formatNumber(o.score)},i=t.getChildAt(0);i&&s(i)},null,!1),this.itemList.array=[],h.gameSDK.leaderboard.getRankData(t=>{this.itemList.array=t})}onDisable(){}}const hi=[[[101,1e4]],[[201,100]],[[5,1]],[[2101,1,2]],[[101,2e4]],[[201,100]],[[101,5e4],[201,200],[2203,1,3]]];class ri extends Q{constructor(){super(),this.closeBtn=null,this.items=null,this.item7=null,this.rewBtn=null,this.rew2Btn=null,this.currLight=null}onEnable(){this.setClick(this.closeBtn,()=>{this.closeDialog(this)},this);const t=t=>{const e=m.signinData;if(!e||e.num>6||d.isSameDay(e.last,Date.now()))return;const s=e.num;if(2==s)m.planes.push(5),m.unlockPage.indexOf("HangarPage")<0&&m.unlockPage.push("HangarPage"),m.unlockPage.indexOf("plane5")<0&&m.unlockPage.push("plane5"),this.openDialog(_.lobby.UnlockChapterDialog,Ke.instance.Dialog,t=>{t.getComponent(ls).setData([0,5],"plane")}),m.setSignData(),this.closeDialog(this);else{const e=hi[s];if(t){const t=[],s=[];for(let i=0;i<e.length;i++){const a=e[i],l=a[0];l<1e3?(t.push([l,2*a[1]]),s.push([l,2*a[1]])):(t.push(a,a),s.push([u.items[l].equip,a[1]],[u.items[l].equip,a[1]]))}h.gameSDK.faceBookAdvertisement.showRewardVideoAd(h.SigninVideoID,()=>{k.updateItem(t),ss.Reward(s),m.setSignData(),this.closeDialog(this)})}else{const t=[];for(let s=0;s<e.length;s++){const i=e[s],a=i[0];a<1e3?t.push(i):t.push([u.items[a].equip,i[1]])}k.updateItem(e),ss.Reward(t),m.setSignData(),this.closeDialog(this)}}let i=1;const a=k.uchapter;for(const t in a){const e=parseInt(t);e>i&&(i=e)}c(`签到第${m.signinData.num}天`,`已解锁第${i}章`)};this.setClick(this.rewBtn,()=>{t(!1)},this),this.setClick(this.rew2Btn,()=>{t(!0)},this),this.initItems()}initItems(){const t=this.items,e=t.numChildren,s=m.signinData;if(!s)return;this.currLight&&(this.currLight.rotation=0),this.currLight=null;for(let i=0;i<e;i++){const e=t.getChildAt(i),a=e.getChildByName("light"),l=e.getChildByName("dayLab"),o=l.getChildByName("dayLab"),h=e.getChildByName("numLab"),r=e.getChildByName("selNode"),c=e.getChildByName("getNode"),p="DAY "+(i+1);l.text=o.text=p,h.text=2==i?n.planes[5].name:"x"+d.formatNumber(hi[i][0][1]),i<s.num?(r.visible=!1,c.visible=!0):i==s.num?(r.visible=!0,c.visible=!1,this.currLight=a):(r.visible=!1,c.visible=!1)}const i=this.item7,a=hi[6];for(let t=0;t<i.numChildren;t++){const e=i.getChildAt(t),s=e.getChildByName("nameLab"),l=e.getChildByName("numLab");s.text=u.items[a[t][0]].name,l.text="x"+d.formatNumber(a[t][1])}2==s.num&&(this.rewBtn.x=360,this.rew2Btn.visible=!1)}onDisable(){}onUpdate(){this.currLight&&(this.currLight.rotation+=1)}}class ci extends Q{constructor(){super(),this.staBtn=null,this.recBtn=null,this.item1=null,this.recNode=null,this.titLab=null,this.desLab=null,this.timeBar=null,this.timeLab=null,this.timerLab=null,this.timer=0,this.tdata=null}onEnable(){this.setClick(this.staBtn,()=>{if(!this.tdata)return;const t=Date.now();L.setTask(this.tdata.id,{id:this.tdata.id,start:t,end:t+1e3*this.tdata.time,recd:!1,num:0}),this.setData(this.tdata)},this),this.setClick(this.recBtn,()=>{if(!this.tdata)return;const t=this.tdata;L.getTask(t.id),this.setData(t);let e=null,s=t.drop;if("null"!=s){const t=s=s.split("|");if(t.length){if(d.getRandom(100,1)<=15){e=t[d.getRandom(t.length-1,0)]}}}const i=t.reward,a={1:[p.Gold,i]},l=[[p.Gold,i]];if(e){let t=1,s=parseInt(e);const i=u.items[e];i&&(t=i.quality,s=i.equip),a[2]=[parseInt(e),1],l.push([s,1,t])}k.updateItem(a),ss.Reward(l)},this)}setData(t){this.tdata=t,this.titLab.text=t.title,this.desLab.text=t.des,this.item1.getChildAt(1).text=d.formatNumber(t.reward);const e=d.formatTimer(t.time);this.timerLab.text=`${e[0]}H ${e[1]}M ${e[2]}S`;const s=L.tasks[t.id];if(s&&s.start){this.staBtn.visible=!1;const t=Date.now();if(t>=s.end)s.recd?(this.recBtn.visible=!1,this.recNode.visible=!0,this.timeBar.visible=!1,this.timeLab.visible=!1):(this.recBtn.visible=!0,this.recNode.visible=!1,this.timeBar.visible=!0,this.timeLab.visible=!0,this.timeBar.value=0,this.timeLab.text="00:00:00");else{this.recBtn.visible=!1,this.recNode.visible=!1,this.timeBar.visible=!0,this.timeLab.visible=!0,this.timeBar.value=1-(t-s.start)/(s.end-s.start);const e=d.formatTimer(Math.floor((s.end-t)/1e3));this.timeLab.text=`${this.autoAddZero(e[0])}:${this.autoAddZero(e[1])}:${this.autoAddZero(e[2])}`}}else this.staBtn.visible=!0,this.recBtn.visible=!1,this.recNode.visible=!1,this.timeBar.visible=!1,this.timeLab.visible=!1;this.onLongUpdate()}onLongUpdate(){if(!this.tdata)return;const t=Date.now(),e=this.tdata,s=L.tasks[e.id];if(s&&s.recd&&s.reset&&t>=s.reset&&(s.start=s.end=s.reset=null,s.num=0,s.recd=!1,this.setData(this.tdata)),s&&s.start)if(t>=s.end)if(s.recd){this.recNode.visible=!0,this.recBtn.visible=!1;const e=s.reset;if(e){this.timeBar.visible=!0,this.timeLab.visible=!0,this.timeBar.value=(e-t)/144e5;const s=d.formatTimer(Math.floor((e-t)/1e3));this.timeLab.text=`${this.autoAddZero(s[0])}:${this.autoAddZero(s[1])}:${this.autoAddZero(s[2])}`}}else this.recBtn.visible=!0,this.recNode.visible=!1,this.timeBar.visible=!0,this.timeLab.visible=!0,this.timeBar.value=0,this.timeLab.text="00:00:00";else{this.recBtn.visible=!1,this.recNode.visible=!1,this.timeBar.visible=!0,this.timeLab.visible=!0,this.timeBar.value=1-(t-s.start)/(s.end-s.start);const e=d.formatTimer(Math.floor((s.end-t)/1e3));this.timeLab.text=`${this.autoAddZero(e[0])}:${this.autoAddZero(e[1])}:${this.autoAddZero(e[2])}`}}autoAddZero(t){return t<10?"0"+t:t+""}onUpdate(){this.timer+=Laya.timer.delta,this.timer>=1e3&&(this.timer=0,this.onLongUpdate())}onDisable(){}}class di extends Q{constructor(){super(),this.closeBtn=null,this.itemList=null}onEnable(){this.setClick(this.closeBtn,()=>{this.closeDialog(this)},this);const t=C.tasks,e=[],s=[],i=Date.now();for(const a in t){const l=t[a],n=L.tasks[l.id];n&&n.end<=i&&!n.recd&&n.start?e.push(l):s.push(l)}e.push.apply(e,s),this.itemList.vScrollBarSkin="",this.itemList.renderHandler=Laya.Handler.create(this,(t,s)=>{const i=t=>{t.getComponent(ci).setData(e[s])},a=t.getChildAt(0);a?i(a):this.loadPrefab(_.lobby.TaskItem).then(e=>{const s=this.open(_.lobby.TaskItem,e);t.addChild(s),i(s)})},null,!1),this.itemList.array=e}onDisable(){}}class pi{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("app/battle/SkillManager.ts",Te),t("app/battle/EnemyManager.ts",Qt),t("app/battle/PlayerManager.ts",Oe),t("app/battle/SkillDialog.ts",qe),t("app/battle/BattleScene.ts",ee),t("app/battle/bg/BattleSceneUI.ts",_t),t("app/battle/bg/GuidHand.ts",Ue),t("app/lobby/LobbySceneUI.ts",Ke),t("core/component/Toggle.ts",xt),t("core/component/ToggleContainer.ts",Pt),t("app/data/LanguageLab.ts",Ye),t("core/utils/RedDot.ts",Xe),t("core/component/GuidanceBtn.ts",$e),t("app/lobby/LobbyScene.ts",Ds),t("app/lobby/TestUI.ts",Ps),t("app/battle/bg/BattleCompareNode.ts",Dt),t("app/battle/bg/BattleFriendNode.ts",vs),t("app/battle/effect/BossComingNode.ts",St),t("app/battle/bg/BgNode.ts",Es),t("app/battle/effect/LighterSkeleton.ts",ws),t("app/battle/bg/ChooseAdvSkillDialog.ts",vt),t("app/battle/bg/ChooseSkillDialog.ts",Tt),t("app/battle/bg/EndlessOverDialog.ts",Bs),t("app/lobby/common/NodeRotation.ts",As),t("app/battle/bg/EndlessOverstepDialog.ts",Bt),t("app/battle/bg/FriendDialog.ts",xs),t("app/battle/bg/GameOverDialog.ts",_s),t("app/battle/bg/GamePauseDialog.ts",Vs),t("app/battle/effect/EnemyReward.ts",Vt),t("app/battle/bg/PlayerSkillItem2.ts",Rs),t("app/battle/bg/RebornDialog.ts",At),t("app/battle/bg/SupplySkillDialog.ts",Ct),t("app/battle/effect/EnemyBoom.ts",Wt),t("app/battle/effect/PlayerWave.ts",Ns),t("app/battle/effect/HpBarLight.ts",Is),t("app/battle/effect/PlayerBlast.ts",Ms),t("app/battle/effect/PlayerCoin.ts",Hs),t("app/battle/effect/PlayerLaserHit.ts",Yt),t("core/utils/BoxCollision.ts",kt),t("app/battle/enemy/Enemy.ts",Gt),t("app/battle/enemy/EnemyCollision.ts",Zt),t("app/battle/enemy/EnemySkill.ts",Ft),t("app/battle/enemy/Enemy1001.ts",Os),t("app/battle/enemy/Enemy1008.ts",$t),t("app/battle/enemy/Enemy1017.ts",qs),t("app/battle/enemy/Enemy2001.ts",Us),t("app/battle/enemy/Enemy2002.ts",Fs),t("app/battle/enemy/Enemy2003.ts",Gs),t("app/battle/enemy/Enemy2004.ts",Ws),t("app/battle/enemy/Enemy2005.ts",Ks),t("app/battle/enemy/Enemy2006.ts",zs),t("app/battle/enemy/Enemy3002.ts",Lt),t("app/battle/enemy/EnemyHPTip.ts",Xs),t("app/battle/enemySkill/EnemyLaser.ts",Ys),t("app/battle/enemySkill/EnemyLine.ts",Rt),t("app/battle/enemySkill/EnemySkill1.ts",It),t("app/battle/enemySkill/EnemySkill1022.ts",js),t("app/battle/enemySkill/EnemySkill13.ts",$s),t("app/battle/enemySkill/EnemySkill3.ts",Ot),t("app/battle/enemySkill/EnemySkill16.ts",Mt),t("app/battle/enemySkill/EnemySkill18.ts",Ht),t("app/battle/player/Player.ts",te),t("app/battle/player/PlayerCollision.ts",Me),t("app/battle/player/Player1.ts",Ie),t("app/battle/player/PlayerHP.ts",He),t("app/battle/robot/PlayerRobot.ts",ae),t("app/battle/robot/PlayerRobot1.ts",ne),t("app/battle/robot/PlayerRobot2.ts",he),t("app/battle/robot/PlayerRobot3.ts",Zs),t("app/battle/skill/PlayerSkill10.ts",ce),t("app/battle/skill/Player4MainBoom.ts",Qs),t("app/battle/skill/PlayerDieBoom.ts",Js),t("app/battle/skill/PlayerSkill1.ts",zt),t("app/battle/player/PlayerLaser.ts",se),t("app/battle/player/PlayerLaserCollision.ts",ie),t("app/battle/skill/PlayerShield.ts",re),t("app/battle/skill/PlayerSkill6.ts",ye),t("app/battle/skill/PlayerSkill2.ts",de),t("app/battle/skill/PlayerSkill2012.ts",pe),t("app/battle/skill/PlayerSkill2013.ts",ti),t("app/battle/skill/PlayerSkill3.ts",De),t("app/battle/skill/PlayerSkill4.ts",le),t("app/battle/skill/PlayerSkill5.ts",ue),t("app/battle/skill/PlayerSkill7.ts",me),t("app/battle/skill/PlayerSkill9.ts",ge),t("app/battle/skill/PlayerTimeShield.ts",fe),t("app/battle/wing/PlayerWing.ts",ke),t("app/battle/wing/PlayerWing1.ts",Ce),t("app/battle/skill/PlayerSkill11.ts",Se),t("app/battle/wing/PlayerWing2.ts",Le),t("app/battle/wing/PlayerWing3.ts",xe),t("app/battle/wing/PlayerWingLaser.ts",Pe),t("app/battle/wing/PlayerWing4.ts",ve),t("app/battle/wing/PlayerWing5.ts",Ee),t("app/battle/wing/PlayerWing6.ts",we),t("app/battle/skill/PlayerSkill12.ts",oe),t("core/component/GuidanceDialog.ts",Et),t("app/lobby/AchievementDialog.ts",ei),t("app/lobby/AdventurePage.ts",Ze),t("core/component/HorizontalSelect.ts",Qe),t("app/lobby/BattlePage.ts",es),t("app/lobby/common/CommonDialog.ts",J),t("app/lobby/common/CommonLoadingDialog.ts",tt),t("app/lobby/common/CommonRewardAdDialog.ts",is),t("app/lobby/common/CommonRewardDialog.ts",ss),t("app/lobby/common/CommonTipDialog.ts",as),t("app/lobby/common/UnlockChapterDialog.ts",ls),t("app/lobby/DailyDialog.ts",si),t("app/lobby/EndlessDialog.ts",ii),t("app/lobby/equipment/EquDecDialog.ts",ds),t("app/lobby/equipment/EquMainItem.ts",os),t("app/lobby/equipment/EquMainTogItem2.ts",cs),t("app/lobby/equipment/EquMatDesDialog.ts",ns),t("app/lobby/equipment/EquNewAttDialog.ts",ai),t("app/lobby/equipment/EquOequDialog.ts",ps),t("app/lobby/equipment/EquSuitDialog.ts",li),t("app/lobby/equipment/EquSymDialog.ts",ni),t("app/lobby/equipment/EquipmentPage.ts",us),t("app/lobby/hangar/HangarPage.ts",bs),t("app/lobby/hangar/HangarPlaneItem2.ts",gs),t("app/lobby/RankDialog2.ts",oi),t("app/lobby/task/ShopBoxItem.ts",fs),t("app/lobby/ShopPage.ts",ks),t("app/lobby/SigninDialog.ts",ri),t("app/lobby/task/TaskItem.ts",ci),t("app/lobby/TaskDialog.ts",di),t("app/lobby/UnlockPlaneDialog.ts",ts)}}pi.width=720,pi.height=1280,pi.scaleMode="fixedwidth",pi.screenMode="vertical",pi.alignV="top",pi.alignH="center",pi.startScene="LobbyScene.scene",pi.sceneRoot="",pi.debug=!1,pi.stat=!1,pi.physicsDebug=!1,pi.exportSceneToJson=!0,pi.init();new class{constructor(){window.Laya3D?Laya3D.init(pi.width,pi.height):Laya.init(pi.width,pi.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=pi.scaleMode,document.documentElement.clientWidth,document.documentElement.clientHeight,Laya.stage.screenMode=pi.screenMode,Laya.stage.alignV=pi.alignV,Laya.stage.alignH=pi.alignH,Laya.URL.exportSceneToJson=pi.exportSceneToJson,(pi.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),pi.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),pi.stat&&Laya.Stat.show(),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION),Laya.ClassUtils.regClass("laya.effect.ColorFilterSetter",Laya.ColorFilterSetter),Laya.ClassUtils.regClass("laya.effect.GlowFilterSetter",Laya.GlowFilterSetter),Laya.ClassUtils.regClass("laya.effect.BlurFilterSetter",Laya.BlurFilterSetter),h.gameSDK=new ht,Laya.SoundManager.useAudioMusic=!1,Laya.MouseManager.multiTouchEnabled=!1}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}loadBatPre(t){const e=[],s=_.battle;for(const t in s){const i=s[t];e.push(i)}const i=[];return i.push(V.PlaneTrackModel),i.push(V.Coin),i.push(I[t]),3==t&&i.push(V.DaoDan),4==t&&i.push(V.Main4),new Promise((s,a)=>{let l=0,n=0;i.length&&n++,e.length&&n++,Y.load3D(i).then(()=>{console.log("load model complete..."),++l==n&&s()}),Laya.loader.create("prefab/battle/merge.json",Laya.Handler.create(this,()=>{console.log("load prefab complete..."),Y.loadPlayerPre(t);const e=v.assets[S.chapter+""+S.diff];e&&Y.loadEnemyPre(e[1]),++l==n&&s()}),Laya.Handler.create(this,t=>{}))})}onConfigLoaded(){const t=()=>{Y.loadGamePre(),console.log("start game!!!"),m.guide?pi.startScene&&Laya.Scene.open(pi.startScene):(m.guide=1,S.diff=1,S.id=2,S.chapter=0,S.rate=1,S.initPlayer(!0),S.id=1,this.loadBatPre(2).then(()=>{Laya.Scene.open("BattleScene.scene")})),c("进入游戏","")};Ne.__initDefine__(),Ne.initShader();const e=(t,e)=>{for(const s in t){const i=t[s];e[s]=i}};setInterval(()=>{const t={pc:S,pic:k,ppc:m,ptc:L},e={[h.fbSaveDataKey[0]]:t};h.gameSDK.saveUserData(e,()=>{})},1e4);const o=[];for(const t in M){const e=M[t];o.push(e)}let d=0;const p={pc:S,pic:k,ppc:m,ptc:L};h.gameSDK.getUserData(s=>{if(s){const t=s;if(t)if(Object.keys(t).length){const s=t;for(const t in s){const i=s[t];e(i,p[t])}r.event("config.setter")}else h.isNewPlayer=!0;else h.isNewPlayer=!0}else h.isNewPlayer=!0;2==++d&&t()}),Laya.loader.load(["json/merge.json"],Laya.Handler.create(this,()=>{d++;const e=Laya.loader.getRes("json/merge.json"),o=e[H.Chapter];s.setChatpers(o);const h=e[H.Skill];A.setSkills(h);const r=e[H.Enaircraft];T.setEnemys(r);for(let t=0;t<16;t++){const s=e[H["Level"+t]];v.setEnemys1(s,t)}const c=e[H.Exp];w.setExps(c);const p=e[H.Upaircraft];l.setPlanes(p);const y=e[H.Upgold];l.setGolds(y);const m=e[H.Aircraft];n.setPlanes(m);const g=e[H.Item];u.setItems(g);const b=e[H.Shop];u.setShopItems(b);const f=e[H.Equip];i.setItems(f);const k=e[H.Addskill];i.setAdds(k);const S=e[H.Upequip];a.setUpequips(S);const L=e[H.Task];C.setTasks(L);const D=e[H.Achievement];C.setAchis(D);const P=e[H.DailyTask];C.setDailyTasks(P);const x=e[H.Adventurefight];E.setData(x);const B=e[H.Adventuredrop];E.setDrop(B),2==d&&t()}),null,Laya.Loader.JSON)}}}();